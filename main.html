<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Jeng Chi | Employee Information Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap"
    rel="stylesheet" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#fff5f5',
              100: '#ffe1dd',
              200: '#ffc3bf',
              300: '#ff9c96',
              400: '#f26d63',
              500: '#d64045', /* primary red */
              600: '#b73238',
              700: '#8c2429',
              800: '#64161b',
              900: '#3e0c10'
            },
            accent: {
              50: '#fff9e6',
              100: '#ffefbf',
              200: '#ffe38f',
              300: '#ffd55e',
              400: '#ffc433',
              500: '#f5a623', /* gold accent */
              600: '#d68118',
              700: '#b15d11',
              800: '#8c430b',
              900: '#5c2704'
            }
          },
          boxShadow: {
            'elevated': '0 18px 45px rgba(0,0,0,0.45)',
            'soft': '0 12px 30px rgba(0,0,0,0.25)'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            display: ['Playfair Display', 'serif']
          }
        }
      }
    };
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* Custom scrollbars for a premium feel */
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(248, 250, 252, 0.4) rgba(15, 23, 42, 0.8);
    }

    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    *::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.9);
    }

    *::-webkit-scrollbar-thumb {
      background-color: rgba(248, 250, 252, 0.45);
      border-radius: 999px;
    }

    .glass-panel {
      background: radial-gradient(circle at 0 0, rgba(245, 166, 35, 0.08), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(214, 64, 69, 0.14), transparent 55%),
        rgba(15, 23, 42, 0.90);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
    }

    .chip {
      border-radius: 9999px;
      padding: 0.125rem 0.625rem;
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .chip-soft {
      background: linear-gradient(to right, rgba(214, 64, 69, 0.12), rgba(245, 166, 35, 0.12));
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #e5e7eb;
    }

    .chip-success {
      background: rgba(22, 163, 74, 0.18);
      border: 1px solid rgba(22, 163, 74, 0.55);
      color: #bbf7d0;
    }

    .chip-warning {
      background: rgba(245, 158, 11, 0.18);
      border: 1px solid rgba(245, 158, 11, 0.65);
      color: #fef3c7;
    }

    .chip-danger {
      background: rgba(220, 38, 38, 0.18);
      border: 1px solid rgba(239, 68, 68, 0.7);
      color: #fecaca;
    }

    .field-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgb(148, 163, 184);
      font-weight: 500;
    }

    .field-input {
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.08), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border-radius: 0.9rem;
      border: 1px solid rgba(30, 64, 175, 0.6);
    }

    .field-input:focus {
      outline: none;
      box-shadow:
        0 0 0 1px rgba(248, 250, 252, 0.5),
        0 0 0 3px rgba(245, 158, 11, 0.55);
      border-color: rgba(248, 250, 252, 0.9);
    }

    .tab-pill-active {
      background: linear-gradient(to right, rgba(214, 64, 69, 0.9), rgba(245, 166, 35, 0.9));
      color: #0b1120;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
    }

    .tab-pill-inactive {
      background: linear-gradient(to right, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.95));
      color: #e5e7eb;
      border: 1px solid rgba(55, 65, 81, 0.75);
    }

    .btn-primary {
      background: linear-gradient(to right, #d64045, #f5a623);
      color: #0b1120;
      font-weight: 600;
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.5);
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .btn-ghost {
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.16), transparent 60%);
    }

    .badge-dot {
      position: relative;
    }

    .badge-dot::after {
      content: '';
      position: absolute;
      top: -0.15rem;
      right: -0.15rem;
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(22, 163, 74, 0.35);
    }

    .tag-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      padding: 0.2rem 0.55rem;
      font-size: 0.7rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .tag-pill span {
      color: #e5e7eb;
      letter-spacing: 0;
      text-transform: none;
      margin-left: 0.15rem;
    }

    .shadow-focus-ring {
      box-shadow:
        0 0 0 1px rgba(248, 250, 252, 0.3),
        0 0 0 3px rgba(245, 166, 35, 0.45);
    }
  </style>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100 font-sans antialiased">
  <div class="relative min-h-screen overflow-hidden">
    <!-- Gradient accents background -->
    <div
      class="pointer-events-none fixed inset-0 -z-10 opacity-60 mix-blend-screen bg-[radial-gradient(circle_at_10%_0,#d64045_0,transparent_55%),radial-gradient(circle_at_90%_0,#f5a623_0,transparent_50%),radial-gradient(circle_at_10%_100%,#0f172a_0,transparent_50%)]">
    </div>

    <!-- Global layout -->
    <div class="relative mx-auto flex min-h-screen max-w-7xl flex-col px-4 pb-10 pt-6 sm:px-6 lg:px-8">
      <!-- HEADER / TOP NAV -->
      <header
        class="glass-panel mb-6 flex items-center justify-between rounded-3xl border border-white/10 px-4 py-3 shadow-elevated sm:px-6">
        <div class="flex items-center gap-4">
          <div
            class="flex h-12 w-12 items-center justify-center overflow-hidden rounded-2xl border border-white/15 bg-slate-950/80 shadow-soft">
            <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg"
              alt="Jeng Chi Logo" class="h-12 w-12 object-contain" />
          </div>
          <div>
            <p class="text-[0.7rem] uppercase tracking-[0.3em] text-slate-300/70">
              Jeng Chi Restaurant
            </p>
            <h1
              class="font-display text-xl font-semibold tracking-tight text-slate-50 drop-shadow sm:text-2xl md:text-3xl">
              Employee Information Hub
            </h1>
            <p class="mt-1 text-xs text-slate-300/80">
              Forbes 500–grade employee intelligence for your executive HR ecosystem.
            </p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="hidden items-center gap-2 md:flex">
            <span class="tag-pill">
              Module <span>01 · Employees2025</span>
            </span>
            <span class="tag-pill">
              Environment <span>Production Ready</span>
            </span>
          </div>
          <div class="mx-3 hidden h-8 w-px bg-gradient-to-b from-transparent via-slate-500/60 to-transparent md:block">
          </div>
          <button id="theme-toggle"
            class="inline-flex h-9 items-center gap-2 rounded-2xl border border-slate-500/60 bg-slate-900/80 px-3 text-xs font-medium text-slate-100 shadow-soft hover:border-slate-200 hover:bg-slate-900/95 focus-visible:outline-none focus-visible:shadow-focus-ring">
            <i data-lucide="moon-star" class="h-4 w-4"></i>
            <span>Theme</span>
          </button>
          <button id="new-employee-btn"
            class="ml-1 inline-flex h-9 items-center gap-2 rounded-2xl px-4 text-xs font-semibold uppercase tracking-[0.16em] btn-primary focus-visible:outline-none focus-visible:shadow-focus-ring">
            <i data-lucide="user-plus" class="h-4 w-4"></i>
            <span>New Employee</span>
          </button>
        </div>
      </header>

      <!-- MAIN CONTENT GRID -->
      <main class="flex-1">
        <div class="grid gap-6 lg:grid-cols-[360px,minmax(0,1fr)]">
          <!-- LEFT PANE: EMPLOYEE DIRECTORY -->
          <section
            class="glass-panel flex flex-col rounded-3xl border border-white/10 p-4 shadow-elevated sm:p-5 lg:p-6">
            <header class="mb-4 flex items-center justify-between gap-2">
              <div>
                <p class="field-label text-[0.6rem]">
                  Directory
                </p>
                <h2 class="font-display text-lg font-semibold text-slate-50">
                  Employee Index
                </h2>
              </div>
              <div class="flex items-center gap-2 text-[0.7rem] text-slate-300/80">
                <div class="inline-flex items-center gap-1 rounded-full bg-slate-900/90 px-2 py-1">
                  <span class="h-1.5 w-1.5 rounded-full bg-emerald-400 shadow-[0_0_0_4px_rgba(52,211,153,0.3)]"></span>
                  <span class="font-medium">Live</span>
                </div>
              </div>
            </header>

            <!-- SEARCH & FILTERS -->
            <div class="space-y-3">
              <div class="relative">
                <label for="employee-search" class="field-label mb-1 block">Search Employee</label>
                <div
                  class="field-input flex items-center gap-2 rounded-2xl px-3 py-2.5 text-sm text-slate-50 shadow-soft">
                  <i data-lucide="search" class="h-4 w-4 text-slate-400"></i>
                  <input id="employee-search" type="text" placeholder="Search by name, username, department…"
                    class="w-full bg-transparent text-xs text-slate-50 placeholder:text-slate-500 focus:outline-none" />
                  <button id="clear-search-btn"
                    class="hidden text-[0.65rem] font-semibold uppercase tracking-[0.16em] text-slate-300 hover:text-slate-50">
                    Clear
                  </button>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-2.5">
                <div>
                  <label for="employment-status-filter" class="field-label mb-1 block">Status</label>
                  <select id="employment-status-filter"
                    class="field-input w-full rounded-2xl bg-transparent px-3 py-2 text-xs text-slate-50 focus:outline-none">
                    <option value="">All statuses</option>
                  </select>
                </div>
                <div>
                  <label for="department-filter" class="field-label mb-1 block">Department</label>
                  <select id="department-filter"
                    class="field-input w-full rounded-2xl bg-transparent px-3 py-2 text-xs text-slate-50 focus:outline-none">
                    <option value="">All departments</option>
                  </select>
                </div>
              </div>

              <div class="flex items-center justify-between gap-2">
                <p id="employee-count" class="text-[0.70rem] text-slate-400">
                  Loading employees…
                </p>
                <div class="flex items-center gap-1.5">
                  <button id="refresh-btn"
                    class="inline-flex items-center gap-1 rounded-full border border-slate-600/70 bg-slate-900/80 px-2.5 py-1.5 text-[0.65rem] font-medium text-slate-100 shadow-soft hover:bg-slate-900/95">
                    <i data-lucide="refresh-ccw" class="h-3.5 w-3.5"></i>
                    <span>Refresh</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- EMPLOYEE LIST -->
            <div class="mt-4 flex-1 overflow-hidden rounded-2xl border border-white/5 bg-slate-950/80">
              <div class="flex items-center justify-between border-b border-white/5 px-3 py-2">
                <span class="text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-slate-400">
                  Employee List
                </span>
                <div class="flex items-center gap-1.5 text-[0.65rem] text-slate-400">
                  <span class="flex items-center gap-1">
                    <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
                    <span>Active</span>
                  </span>
                  <span class="flex items-center gap-1">
                    <span class="h-2 w-2 rounded-full bg-amber-400"></span>
                    <span>On Leave</span>
                  </span>
                  <span class="flex items-center gap-1">
                    <span class="h-2 w-2 rounded-full bg-rose-400"></span>
                    <span>Terminated</span>
                  </span>
                </div>
              </div>
              <div id="employee-list"
                class="max-h-[calc(100vh-260px)] space-y-1 overflow-y-auto px-2.5 py-2 text-sm sm:max-h-[calc(100vh-300px)]">
                <!-- Dynamic employee rows -->
              </div>
            </div>
          </section>

          <!-- RIGHT PANE: DETAIL VIEW -->
          <section
            class="glass-panel relative flex flex-col rounded-3xl border border-white/10 p-4 shadow-elevated sm:p-5 lg:p-6">
            <!-- Empty state: no employee selected -->
            <div id="empty-state" class="flex h-full flex-col items-center justify-center text-center">
              <div
                class="mb-4 flex h-16 w-16 items-center justify-center rounded-3xl border border-dashed border-slate-600/80 bg-slate-950/70 shadow-soft">
                <i data-lucide="users" class="h-7 w-7 text-slate-400"></i>
              </div>
              <h2 class="font-display text-lg font-semibold text-slate-50">
                Select an employee to begin
              </h2>
              <p class="mt-2 max-w-md text-sm text-slate-300/80">
                Use the directory on the left to locate any employee from the
                <span class="font-semibold text-slate-100">employees2025</span> table.
                Their full profile, benefits, and documents will appear here.
              </p>
              <div class="mt-4 flex flex-wrap items-center justify-center gap-3 text-xs text-slate-300/80">
                <span class="tag-pill">Real-time Supabase</span>
                <span class="tag-pill">Secure PII View</span>
                <span class="tag-pill">Benefits 2025 · 2026</span>
                <span class="tag-pill">Dependents &amp; Beneficiaries</span>
              </div>
            </div>

            <!-- Detail panel -->
            <div id="employee-detail-panel" class="hidden h-full flex-col">
              <!-- Top header -->
              <div class="flex flex-col gap-4 border-b border-white/5 pb-4 md:flex-row md:items-start md:justify-between">
                <div class="flex flex-1 items-start gap-3">
                  <div
                    class="badge-dot flex h-12 w-12 items-center justify-center rounded-3xl border border-slate-700/70 bg-slate-950/80 shadow-soft">
                    <i data-lucide="user-circle-2" class="h-7 w-7 text-slate-200"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="flex flex-wrap items-center gap-2">
                      <h2 id="detail-name" class="font-display text-2xl font-semibold tracking-tight text-slate-50">
                        <!-- Employee Name -->
                      </h2>
                      <span id="detail-status-chip" class="chip chip-soft">
                        <!-- Status -->
                      </span>
                      <span id="detail-benefit-year-chip" class="chip chip-soft">
                        <!-- Benefit Year -->
                      </span>
                    </div>
                    <div class="flex flex-wrap items-center gap-3 text-xs text-slate-300/80">
                      <div class="flex items-center gap-1.5">
                        <i data-lucide="id-card" class="h-3.5 w-3.5"></i>
                        <span id="detail-username">—</span>
                      </div>
                      <div class="flex items-center gap-1.5">
                        <i data-lucide="briefcase" class="h-3.5 w-3.5"></i>
                        <span id="detail-job-title">—</span>
                      </div>
                      <div class="flex items-center gap-1.5">
                        <i data-lucide="building-2" class="h-3.5 w-3.5"></i>
                        <span id="detail-department">—</span>
                      </div>
                      <div class="flex items-center gap-1.5">
                        <i data-lucide="user-square-2" class="h-3.5 w-3.5"></i>
                        <span id="detail-report-to">Reports to: —</span>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Actions -->
                <div class="flex items-center gap-2">
                  <button id="view-pdf-btn"
                    class="inline-flex h-9 items-center gap-2 rounded-2xl border border-slate-600/70 bg-slate-900/80 px-3 text-xs font-medium text-slate-100 shadow-soft hover:bg-slate-900/95 disabled:opacity-40"
                    disabled>
                    <i data-lucide="file-text" class="h-4 w-4"></i>
                    <span>View PDF</span>
                  </button>
                  <button id="view-signed-pdf-btn"
                    class="inline-flex h-9 items-center gap-2 rounded-2xl border border-emerald-600/80 bg-emerald-900/40 px-3 text-xs font-medium text-emerald-100 shadow-soft hover:bg-emerald-900/60 disabled:opacity-40"
                    disabled>
                    <i data-lucide="file-signature" class="h-4 w-4"></i>
                    <span>Signed</span>
                  </button>
                  <div class="mx-1 hidden h-7 w-px bg-gradient-to-b from-transparent via-slate-500/70 to-transparent md:block">
                  </div>
                  <button id="reset-form-btn"
                    class="inline-flex h-9 items-center gap-1.5 rounded-2xl border border-slate-600/70 bg-slate-900/80 px-3 text-xs font-medium text-slate-100 shadow-soft hover:bg-slate-900/95">
                    <i data-lucide="rotate-ccw" class="h-4 w-4"></i>
                    <span>Reset</span>
                  </button>
                  <button id="save-employee-btn"
                    class="inline-flex h-9 items-center gap-2 rounded-2xl px-4 text-xs font-semibold uppercase tracking-[0.16em] btn-primary">
                    <i data-lucide="save" class="h-4 w-4"></i>
                    <span>Save</span>
                  </button>
                  <button id="delete-employee-btn"
                    class="inline-flex h-9 items-center gap-1.5 rounded-2xl border border-red-700/80 bg-red-900/40 px-3 text-xs font-semibold uppercase tracking-[0.16em] text-red-100 shadow-soft hover:bg-red-900/60">
                    <i data-lucide="user-x-2" class="h-4 w-4"></i>
                    <span>Terminate</span>
                  </button>
                </div>
              </div>

              <!-- Tabs -->
              <div class="mt-4">
                <div class="flex flex-wrap gap-2 rounded-2xl bg-slate-950/60 p-1.5">
                  <button type="button" data-tab-target="tab-overview"
                    class="tab-pill-active flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="layout-dashboard" class="h-3.5 w-3.5"></i>
                    <span>Overview</span>
                  </button>
                  <button type="button" data-tab-target="tab-personal"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="user" class="h-3.5 w-3.5"></i>
                    <span>Personal</span>
                  </button>
                  <button type="button" data-tab-target="tab-employment"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="id-card" class="h-3.5 w-3.5"></i>
                    <span>Employment</span>
                  </button>
                  <button type="button" data-tab-target="tab-comp"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="coins" class="h-3.5 w-3.5"></i>
                    <span>Comp &amp; Pay</span>
                  </button>
                  <button type="button" data-tab-target="tab-benefits"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="shield-plus" class="h-3.5 w-3.5"></i>
                    <span>Benefits</span>
                  </button>
                  <button type="button" data-tab-target="tab-dependents"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="users-2" class="h-3.5 w-3.5"></i>
                    <span>Dependents</span>
                  </button>
                  <button type="button" data-tab-target="tab-system"
                    class="tab-pill-inactive flex flex-1 items-center justify-center gap-1 rounded-2xl px-3 py-2 text-xs font-semibold uppercase tracking-[0.16em]">
                    <i data-lucide="lock-keyhole" class="h-3.5 w-3.5"></i>
                    <span>System</span>
                  </button>
                </div>
              </div>

              <!-- TAB CONTENT AREA -->
              <div class="mt-4 flex-1 overflow-y-auto rounded-2xl border border-white/5 bg-slate-950/70 p-4 sm:p-5">
                <!-- TAB: OVERVIEW -->
                <div id="tab-overview" class="tab-panel space-y-4">
                  <div class="grid gap-4 md:grid-cols-3">
                    <div
                      class="rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900/80 to-slate-950/80 p-4 shadow-soft">
                      <div class="flex items-center justify-between gap-2">
                        <p class="field-label">Headlines</p>
                        <i data-lucide="sparkles" class="h-4 w-4 text-amber-300"></i>
                      </div>
                      <p id="overview-title" class="mt-1 text-sm font-medium text-slate-100">—</p>
                      <p id="overview-department" class="text-xs text-slate-400">—</p>
                      <div class="mt-3 space-y-1 text-[0.7rem] text-slate-300">
                        <div class="flex items-center justify-between">
                          <span>Employment Status</span>
                          <span id="overview-employment-status" class="chip chip-soft">—</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span>Benefit Year</span>
                          <span id="overview-benefit-year" class="chip chip-soft">—</span>
                        </div>
                      </div>
                    </div>

                    <div
                      class="rounded-2xl border border-emerald-700/60 bg-gradient-to-b from-emerald-900/40 to-slate-950/80 p-4 shadow-soft">
                      <div class="flex items-center justify-between gap-2">
                        <p class="field-label">Tenure</p>
                        <i data-lucide="calendar-clock" class="h-4 w-4 text-emerald-200"></i>
                      </div>
                      <div class="mt-2 grid grid-cols-2 gap-3 text-[0.7rem] text-emerald-50/90">
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-emerald-200/80">Original Hire</p>
                          <p id="overview-original-hire-date" class="text-xs font-medium">—</p>
                        </div>
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-emerald-200/80">Current Hire</p>
                          <p id="overview-hire-date" class="text-xs font-medium">—</p>
                        </div>
                      </div>
                      <div class="mt-3 grid grid-cols-2 gap-2 text-[0.68rem] text-emerald-50/90">
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.18em] text-emerald-200/80">Tenure</p>
                          <p id="overview-tenure" class="text-xs font-semibold">—</p>
                        </div>
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.18em] text-emerald-200/80">Last Modified</p>
                          <p id="overview-last-modified" class="text-xs font-semibold">—</p>
                        </div>
                      </div>
                    </div>

                    <div
                      class="rounded-2xl border border-amber-700/60 bg-gradient-to-b from-amber-900/40 to-slate-950/80 p-4 shadow-soft">
                      <div class="flex items-center justify-between gap-2">
                        <p class="field-label">Quick Compensation</p>
                        <i data-lucide="wallet-cards" class="h-4 w-4 text-amber-200"></i>
                      </div>
                      <div class="mt-2 space-y-2 text-[0.7rem] text-amber-50/90">
                        <div class="flex items-center justify-between">
                          <span>Base Rate</span>
                          <span id="overview-base-rate" class="font-semibold">—</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span>Hourly Rate</span>
                          <span id="overview-hourly-rate" class="font-semibold">—</span>
                        </div>
                        <div class="flex items-center justify-between">
                          <span>Annual Salary</span>
                          <span id="overview-annual-salary" class="font-semibold">—</span>
                        </div>
                      </div>
                      <div class="mt-3 text-[0.68rem] text-amber-100/90">
                        <p id="overview-payroll-note" class="line-clamp-2">
                          — Payroll summary will appear here.
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div
                      class="rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900/80 to-slate-950/80 p-4 shadow-soft">
                      <div class="flex items-center justify-between">
                        <p class="field-label">Contact Snapshot</p>
                        <i data-lucide="phone-call" class="h-4 w-4 text-slate-300"></i>
                      </div>
                      <dl class="mt-3 space-y-2 text-xs text-slate-300">
                        <div class="flex items-center justify-between gap-2">
                          <dt class="flex items-center gap-1.5 text-slate-400">
                            <i data-lucide="mail" class="h-3.5 w-3.5"></i>
                            <span>Email</span>
                          </dt>
                          <dd id="overview-email" class="max-w-[65%] truncate text-right">—</dd>
                        </div>
                        <div class="flex items-center justify-between gap-2">
                          <dt class="flex items-center gap-1.5 text-slate-400">
                            <i data-lucide="smartphone" class="h-3.5 w-3.5"></i>
                            <span>Primary Phone</span>
                          </dt>
                          <dd id="overview-phone" class="max-w-[65%] truncate text-right">—</dd>
                        </div>
                        <div class="flex items-center justify-between gap-2">
                          <dt class="flex items-center gap-1.5 text-slate-400">
                            <i data-lucide="map-pin" class="h-3.5 w-3.5"></i>
                            <span>Location</span>
                          </dt>
                          <dd id="overview-location" class="max-w-[65%] truncate text-right">—</dd>
                        </div>
                      </dl>
                    </div>

                    <div
                      class="rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900/80 to-slate-950/80 p-4 shadow-soft">
                      <div class="flex items-center justify-between">
                        <p class="field-label">Benefits Snapshot</p>
                        <i data-lucide="shield-check" class="h-4 w-4 text-slate-300"></i>
                      </div>
                      <div class="mt-3 grid grid-cols-2 gap-3 text-[0.7rem] text-slate-200">
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-slate-400">2025 Coverage</p>
                          <p id="overview-benefits-2025" class="mt-1 text-xs">—</p>
                        </div>
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-slate-400">2026 Coverage</p>
                          <p id="overview-benefits-2026" class="mt-1 text-xs">—</p>
                        </div>
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-slate-400">Tier</p>
                          <p id="overview-tier" class="mt-1 text-xs">—</p>
                        </div>
                        <div>
                          <p class="text-[0.65rem] uppercase tracking-[0.16em] text-slate-400">Employer Life</p>
                          <p id="overview-employer-life" class="mt-1 text-xs">—</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- TAB: PERSONAL -->
                <div id="tab-personal" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">Core Identity</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Personal Profile
                      </h3>
                    </div>
                    <span class="tag-pill">
                      PII Guarded<span> · Internal HR Only</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">First Name</label>
                        <input id="first_name_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="First name" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Last Name</label>
                        <input id="last_name_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Last name" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Date of Birth</label>
                        <input id="dob_input" type="date"
                          class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Legacy Date of Birth (dob)</label>
                        <input id="legacy_dob_input" type="date"
                          class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                      </div>
                    </div>

                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Social Security (obscured)</label>
                        <input id="ssn_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="XXX-XX-XXXX (ssn)" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Legacy SSN (sssn)</label>
                        <input id="sssn_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Legacy SSN field (sssn)" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Primary Phone</label>
                        <input id="primary_phone_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="(555) 555-5555" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Phone (Alternate)</label>
                        <input id="phone_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Alternate phone" />
                      </div>
                    </div>
                  </div>

                  <div class="grid gap-4 md:grid-cols-3">
                    <div class="space-y-3 md:col-span-2">
                      <div>
                        <label class="field-label mb-1 block">Address Line 1</label>
                        <input id="address_line_1_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Street address" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Address Line 2</label>
                        <input id="address_line_2_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Apt, Suite, Unit" />
                      </div>
                      <div class="grid grid-cols-3 gap-2">
                        <div>
                          <label class="field-label mb-1 block">City</label>
                          <input id="city_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                            placeholder="City" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">State</label>
                          <input id="state_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                            placeholder="State" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">ZIP Code</label>
                          <input id="zip_code_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                            placeholder="ZIP" />
                        </div>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Structured Address (JSON)</label>
                        <textarea id="address_json_input" rows="7"
                          class="field-input w-full resize-none px-3 py-2 text-[0.7rem] font-mono"
                          placeholder='{"line1":"", "city":"", "state":"", "zip":""}'></textarea>
                        <p class="mt-1 text-[0.65rem] text-slate-400">
                          Mirrors the <span class="font-semibold text-slate-100">address</span> jsonb column for
                          integration and analytics.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- TAB: EMPLOYMENT -->
                <div id="tab-employment" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">Role &amp; Lifecycle</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Employment Profile
                      </h3>
                    </div>
                    <span class="tag-pill">
                      Lifecycle<span> · Hire · Rehire · Termination</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Employment Status</label>
                        <input id="employment_status_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Active / On Leave / Terminated / etc." />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Status (General)</label>
                        <input id="status_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Active (default), Inactive, etc." />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Termination Status</label>
                        <input id="termination_status_input" type="text"
                          class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Pending, Finalized, Not Applicable, etc." />
                      </div>
                      <div class="grid grid-cols-2 gap-2">
                        <div>
                          <label class="field-label mb-1 block">Original Hire Date</label>
                          <input id="original_hire_date_input" type="date"
                            class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Current Hire Date</label>
                          <input id="hire_date_input" type="date"
                            class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                        </div>
                      </div>
                    </div>

                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Job Title</label>
                        <input id="job_title_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Job title in payroll system" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Position Title</label>
                        <input id="position_title_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Position title for HR / Org chart" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Department</label>
                        <input id="department_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="E.g., FOH, BOH, Management, Admin" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Reports To</label>
                        <input id="report_to_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Manager or supervisor name" />
                      </div>
                    </div>
                  </div>

                  <div class="grid gap-4 md:grid-cols-3">
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Terminated Date</label>
                        <input id="terminated_date_input" type="datetime-local"
                          class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Rehire Date</label>
                        <input id="rehire_date_input" type="datetime-local"
                          class="field-input w-full px-3 py-2 text-xs [color-scheme:dark]" />
                      </div>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Last Modified (Read-only)</label>
                        <input id="last_modified_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          disabled />
                        <p class="mt-1 text-[0.65rem] text-slate-400">
                          Maintained automatically by
                          <span class="font-semibold text-slate-100">set_employees_last_modified</span>
                          trigger.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- TAB: COMP & PAY -->
                <div id="tab-comp" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">Compensation Architecture</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Pay &amp; Rates
                      </h3>
                    </div>
                    <span class="tag-pill">
                      Compensation<span> · Hourly · Salary</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-3">
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Hourly Rate</label>
                        <input id="hourly_rate_input" type="number" step="0.01"
                          class="field-input w-full px-3 py-2 text-xs" placeholder="0.00" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Base Rate (Text)</label>
                        <input id="base_rate_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Base rate label" />
                      </div>
                    </div>

                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Annual Salary</label>
                        <input id="annual_salary_input" type="number" step="0.01"
                          class="field-input w-full px-3 py-2 text-xs" placeholder="0.00" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Benefit Year</label>
                        <input id="benefit_year_input" type="number" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="2026" />
                      </div>
                    </div>

                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Additional Info</label>
                        <textarea id="additional_info_input" rows="5"
                          class="field-input w-full resize-none px-3 py-2 text-[0.7rem]"
                          placeholder="Notes, compensation remarks, special instructions"></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- TAB: BENEFITS -->
                <div id="tab-benefits" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">Benefits Intelligence</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Medical · Dental · Vision
                      </h3>
                    </div>
                    <span class="tag-pill">
                      Plan Codes<span> · 2025 · 2026</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-3">
                      <p class="text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-slate-400">
                        2025 Elections
                      </p>
                      <div class="grid gap-2">
                        <div>
                          <label class="field-label mb-1 block">Medical Plan 2025</label>
                          <input id="medical_plan_2025_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Dental Plan 2025</label>
                          <input id="dental_plan_2025_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Vision Plan 2025</label>
                          <input id="vision_plan_2025_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                      </div>
                    </div>

                    <div class="space-y-3">
                      <p class="text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-slate-400">
                        2026 Elections
                      </p>
                      <div class="grid gap-2">
                        <div>
                          <label class="field-label mb-1 block">Medical Plan 2026</label>
                          <input id="medical_plan_2026_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Dental Plan 2026</label>
                          <input id="dental_plan_2026_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Vision Plan 2026</label>
                          <input id="vision_plan_2026_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-3">
                      <p class="text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-slate-400">
                        Current &amp; Clean Codes
                      </p>
                      <div class="grid gap-2">
                        <div>
                          <label class="field-label mb-1 block">Medical Plan Code</label>
                          <input id="medical_plan_code_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Dental Plan Code</label>
                          <input id="dental_plan_code_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Vision Plan Code</label>
                          <input id="vision_plan_code_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Medical Plan Code Clean</label>
                          <input id="medical_plan_code_clean_input" type="text"
                            class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                      </div>
                    </div>

                    <div class="space-y-3">
                      <p class="text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-slate-400">
                        Plan Labels &amp; Tiering
                      </p>
                      <div class="grid gap-2">
                        <div>
                          <label class="field-label mb-1 block">Medical Plan (Label)</label>
                          <input id="medical_plan_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Dental Plan (Label)</label>
                          <input id="dental_plan_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Vision Plan (Label)</label>
                          <input id="vision_plan_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Tier Election</label>
                          <input id="tier_election_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                            placeholder="Employee only, Employee + Spouse, Family, etc." />
                        </div>
                        <div>
                          <label class="field-label mb-1 block">Employer Life</label>
                          <input id="employer_life_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                            placeholder="Employer-paid life coverage" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div>
                      <label class="field-label mb-1 block">Effective Year</label>
                      <input id="effective_year_input" type="number" class="field-input w-full px-3 py-2 text-xs"
                        placeholder="Effective year for active elections" />
                    </div>
                  </div>
                </div>

                <!-- TAB: DEPENDENTS & BENEFICIARIES -->
                <div id="tab-dependents" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">Household &amp; Beneficiaries</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Dependents &amp; Beneficiaries
                      </h3>
                    </div>
                    <span class="tag-pill">
                      JSONB<span> · Structured Data</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-2">
                      <label class="field-label mb-1 block">Dependents (JSON)</label>
                      <textarea id="dependents_input" rows="10"
                        class="field-input w-full resize-none px-3 py-2 text-[0.7rem] font-mono"
                        placeholder='[{"name":"John Doe Jr.","relationship":"Child","dob":"2018-01-01"}]'></textarea>
                      <p class="mt-1 text-[0.65rem] text-slate-400">
                        Mirrors the <span class="font-semibold text-slate-100">dependents</span> jsonb column. Use valid
                        JSON.
                      </p>
                    </div>
                    <div class="space-y-2">
                      <label class="field-label mb-1 block">Beneficiaries (JSON)</label>
                      <textarea id="beneficiaries_input" rows="10"
                        class="field-input w-full resize-none px-3 py-2 text-[0.7rem] font-mono"
                        placeholder='[{"name":"Jane Doe","relationship":"Spouse","percentage":100}]'></textarea>
                      <p class="mt-1 text-[0.65rem] text-slate-400">
                        Mirrors the <span class="font-semibold text-slate-100">beneficiaries</span> jsonb column. Ensure
                        totals add up according to plan rules.
                      </p>
                    </div>
                  </div>
                </div>

                <!-- TAB: SYSTEM & SECURITY -->
                <div id="tab-system" class="tab-panel hidden space-y-4">
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="field-label">System Identity</p>
                      <h3 class="font-display text-lg font-semibold text-slate-50">
                        Credentials &amp; Document Links
                      </h3>
                    </div>
                    <span class="tag-pill">
                      Security<span> · Internal Use Only</span>
                    </span>
                  </div>

                  <div class="grid gap-4 md:grid-cols-2">
                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">Username</label>
                        <input id="username_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Portal username" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">PIN</label>
                        <input id="pin_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="Unique PIN (unique_pin constraint)" />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Email</label>
                        <input id="email_input" type="email" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="user@jengchirestaurant.com" />
                      </div>
                    </div>

                    <div class="space-y-3">
                      <div>
                        <label class="field-label mb-1 block">PDF URL</label>
                        <input id="pdf_url_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="https://..." />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Signed PDF URL</label>
                        <input id="signed_pdf_url_input" type="text" class="field-input w-full px-3 py-2 text-xs"
                          placeholder="https://..." />
                      </div>
                      <div>
                        <label class="field-label mb-1 block">Signature</label>
                        <textarea id="signature_input" rows="3"
                          class="field-input w-full resize-none px-3 py-2 text-[0.7rem]"
                          placeholder="Signature payload, base64, or metadata"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- FOOTER / SUMMARY -->
              <div class="mt-4 flex flex-wrap items-center justify-between gap-3 text-[0.68rem] text-slate-400">
                <div class="flex flex-wrap items-center gap-2">
                  <span class="flex items-center gap-1">
                    <i data-lucide="database" class="h-3.5 w-3.5"></i>
                    <span>Source: employees2025</span>
                  </span>
                  <span class="flex items-center gap-1">
                    <i data-lucide="shield" class="h-3.5 w-3.5"></i>
                    <span>Audit: log_employee_changes trigger</span>
                  </span>
                </div>
                <div class="flex items-center gap-2 text-[0.65rem]">
                  <span class="h-1.5 w-1.5 rounded-full bg-emerald-400"></span>
                  <span>Changes auto-logged on save.</span>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loading-overlay"
      class="pointer-events-none fixed inset-0 z-30 hidden items-center justify-center bg-slate-950/70">
      <div
        class="flex items-center gap-3 rounded-2xl border border-white/10 bg-slate-900/95 px-4 py-2 text-sm text-slate-100 shadow-elevated">
        <svg class="h-4 w-4 animate-spin text-amber-400" viewBox="0 0 24 24" fill="none">
          <circle class="opacity-20" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-90" fill="currentColor"
            d="M4 12a8 8 0 0 1 8-8v4a4 4 0 0 0-4 4H4Z"></path>
        </svg>
        <span>Syncing with employees2025…</span>
      </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-40 space-y-2"></div>

    <!-- NEW EMPLOYEE MODAL -->
    <div id="new-employee-modal"
      class="fixed inset-0 z-40 hidden items-center justify-center bg-slate-950/80 p-4">
      <div class="glass-panel w-full max-w-lg rounded-3xl border border-white/10 p-5 shadow-elevated">
        <div class="flex items-center justify-between">
          <div>
            <p class="field-label mb-1">Create Record</p>
            <h3 class="font-display text-lg font-semibold text-slate-50">
              New Employee · employees2025
            </h3>
          </div>
          <button id="close-new-employee-modal"
            class="inline-flex h-8 w-8 items-center justify-center rounded-2xl border border-slate-600/70 bg-slate-900/90 text-slate-200 hover:bg-slate-900">
            <i data-lucide="x" class="h-4 w-4"></i>
          </button>
        </div>

        <div class="mt-4 grid gap-3 text-xs md:grid-cols-2">
          <div>
            <label class="field-label mb-1 block">First Name</label>
            <input id="new_first_name_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Last Name</label>
            <input id="new_last_name_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Job Title</label>
            <input id="new_job_title_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Department</label>
            <input id="new_department_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Employment Status</label>
            <input id="new_employment_status_input" type="text" class="field-input w-full px-3 py-2 text-xs"
              placeholder="Active" />
          </div>
          <div>
            <label class="field-label mb-1 block">Email</label>
            <input id="new_email_input" type="email" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Username</label>
            <input id="new_username_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
          <div>
            <label class="field-label mb-1 block">Primary Phone</label>
            <input id="new_primary_phone_input" type="text" class="field-input w-full px-3 py-2 text-xs" />
          </div>
        </div>

        <div class="mt-5 flex items-center justify-between">
          <p class="text-[0.65rem] text-slate-400">
            Additional attributes can be edited after creation.
          </p>
          <div class="flex items-center gap-2">
            <button id="cancel-new-employee-btn"
              class="inline-flex h-8 items-center gap-1.5 rounded-2xl border border-slate-600/70 bg-slate-900/90 px-3 text-[0.7rem] font-medium text-slate-100 hover:bg-slate-900">
              <i data-lucide="ban" class="h-3.5 w-3.5"></i>
              <span>Cancel</span>
            </button>
            <button id="create-new-employee-btn"
              class="inline-flex h-8 items-center gap-1.5 rounded-2xl px-3 text-[0.7rem] font-semibold uppercase tracking-[0.16em] btn-primary">
              <i data-lucide="check-circle-2" class="h-3.5 w-3.5"></i>
              <span>Create</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- TERMINATE / DELETE CONFIRM MODAL -->
    <div id="confirm-delete-modal"
      class="fixed inset-0 z-40 hidden items-center justify-center bg-slate-950/80 p-4">
      <div class="glass-panel w-full max-w-md rounded-3xl border border-red-700/60 p-5 shadow-elevated">
        <div class="flex items-center gap-3">
          <div
            class="flex h-11 w-11 items-center justify-center rounded-2xl border border-red-700/70 bg-red-950/70 text-red-200">
            <i data-lucide="alert-triangle" class="h-5 w-5"></i>
          </div>
          <div>
            <p class="field-label mb-1 text-red-200">Confirm Action</p>
            <h3 class="font-display text-lg font-semibold text-slate-50">
              Terminate Employee Record
            </h3>
          </div>
        </div>

        <p class="mt-3 text-[0.8rem] text-slate-200">
          This will mark the employee as terminated in the
          <span class="font-semibold text-slate-50">employees2025</span> table and log the change for auditing
          purposes.
          You can still rehire the employee later.
        </p>

        <div class="mt-4 flex items-center justify-between text-[0.7rem] text-slate-400">
          <span id="confirm-delete-employee-name" class="font-medium text-slate-100">—</span>
          <span>Soft-termination · record preserved</span>
        </div>

        <div class="mt-5 flex items-center justify-end gap-2">
          <button id="cancel-delete-btn"
            class="inline-flex h-8 items-center gap-1.5 rounded-2xl border border-slate-600/70 bg-slate-900/90 px-3 text-[0.7rem] font-medium text-slate-100 hover:bg-slate-900">
            <i data-lucide="x" class="h-3.5 w-3.5"></i>
            <span>Cancel</span>
          </button>
          <button id="confirm-delete-btn"
            class="inline-flex h-8 items-center gap-1.5 rounded-2xl border border-red-700/80 bg-red-900/80 px-3 text-[0.7rem] font-semibold uppercase tracking-[0.16em] text-red-50 shadow-soft hover:bg-red-900">
            <i data-lucide="skull" class="h-3.5 w-3.5"></i>
            <span>Terminate</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- APP SCRIPT -->
  <script>
    // === CONFIG: UPDATE WITH YOUR SUPABASE PROJECT DETAILS ===
   const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";

  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // === DOM HELPERS ===
    const qs = (sel) => document.querySelector(sel);
    const qsa = (sel) => Array.from(document.querySelectorAll(sel));
    const el = (tag, className = '', html = '') => {
      const node = document.createElement(tag);
      if (className) node.className = className;
      if (html) node.innerHTML = html;
      return node;
    };

    // === STATE ===
    let employeesRaw = [];
    let employeesFiltered = [];
    let selectedEmployee = null;
    let isSaving = false;

    // === UI ELEMENTS ===
    const employeeListEl = qs('#employee-list');
    const employeeCountEl = qs('#employee-count');
    const searchInputEl = qs('#employee-search');
    const clearSearchBtn = qs('#clear-search-btn');
    const statusFilterEl = qs('#employment-status-filter');
    const departmentFilterEl = qs('#department-filter');
    const refreshBtn = qs('#refresh-btn');
    const detailPanelEl = qs('#employee-detail-panel');
    const emptyStateEl = qs('#empty-state');
    const loadingOverlayEl = qs('#loading-overlay');
    const toastContainerEl = qs('#toast-container');
    const themeToggleBtn = qs('#theme-toggle');

    const saveBtn = qs('#save-employee-btn');
    const resetFormBtn = qs('#reset-form-btn');
    const deleteBtn = qs('#delete-employee-btn');
    const viewPdfBtn = qs('#view-pdf-btn');
    const viewSignedPdfBtn = qs('#view-signed-pdf-btn');

    const newEmployeeBtn = qs('#new-employee-btn');
    const newEmployeeModal = qs('#new-employee-modal');
    const closeNewEmployeeModalBtn = qs('#close-new-employee-modal');
    const cancelNewEmployeeBtn = qs('#cancel-new-employee-btn');
    const createNewEmployeeBtn = qs('#create-new-employee-btn');

    const confirmDeleteModal = qs('#confirm-delete-modal');
    const cancelDeleteBtn = qs('#cancel-delete-btn');
    const confirmDeleteBtn = qs('#confirm-delete-btn');
    const confirmDeleteNameEl = qs('#confirm-delete-employee-name');

    // Detail header fields
    const detailNameEl = qs('#detail-name');
    const detailStatusChipEl = qs('#detail-status-chip');
    const detailBenefitYearChipEl = qs('#detail-benefit-year-chip');
    const detailUsernameEl = qs('#detail-username');
    const detailJobTitleEl = qs('#detail-job-title');
    const detailDepartmentEl = qs('#detail-department');
    const detailReportToEl = qs('#detail-report-to');

    // Overview fields
    const overviewTitleEl = qs('#overview-title');
    const overviewDepartmentEl = qs('#overview-department');
    const overviewEmploymentStatusEl = qs('#overview-employment-status');
    const overviewBenefitYearEl = qs('#overview-benefit-year');
    const overviewOriginalHireDateEl = qs('#overview-original-hire-date');
    const overviewHireDateEl = qs('#overview-hire-date');
    const overviewTenureEl = qs('#overview-tenure');
    const overviewLastModifiedEl = qs('#overview-last-modified');
    const overviewBaseRateEl = qs('#overview-base-rate');
    const overviewHourlyRateEl = qs('#overview-hourly-rate');
    const overviewAnnualSalaryEl = qs('#overview-annual-salary');
    const overviewPayrollNoteEl = qs('#overview-payroll-note');
    const overviewEmailEl = qs('#overview-email');
    const overviewPhoneEl = qs('#overview-phone');
    const overviewLocationEl = qs('#overview-location');
    const overviewBenefits2025El = qs('#overview-benefits-2025');
    const overviewBenefits2026El = qs('#overview-benefits-2026');
    const overviewTierEl = qs('#overview-tier');
    const overviewEmployerLifeEl = qs('#overview-employer-life');

    // Personal tab inputs
    const firstNameInput = qs('#first_name_input');
    const lastNameInput = qs('#last_name_input');
    const dobInput = qs('#dob_input');
    const legacyDobInput = qs('#legacy_dob_input');
    const ssnInput = qs('#ssn_input');
    const sssnInput = qs('#sssn_input');
    const primaryPhoneInput = qs('#primary_phone_input');
    const phoneInput = qs('#phone_input');
    const addressLine1Input = qs('#address_line_1_input');
    const addressLine2Input = qs('#address_line_2_input');
    const cityInput = qs('#city_input');
    const stateInput = qs('#state_input');
    const zipCodeInput = qs('#zip_code_input');
    const addressJsonInput = qs('#address_json_input');

    // Employment tab inputs
    const employmentStatusInput = qs('#employment_status_input');
    const statusInput = qs('#status_input');
    const terminationStatusInput = qs('#termination_status_input');
    const originalHireDateInput = qs('#original_hire_date_input');
    const hireDateInput = qs('#hire_date_input');
    const jobTitleInput = qs('#job_title_input');
    const positionTitleInput = qs('#position_title_input');
    const departmentInput = qs('#department_input');
    const reportToInput = qs('#report_to_input');
    const terminatedDateInput = qs('#terminated_date_input');
    const rehireDateInput = qs('#rehire_date_input');
    const lastModifiedInput = qs('#last_modified_input');

    // Comp tab
    const hourlyRateInput = qs('#hourly_rate_input');
    const baseRateInput = qs('#base_rate_input');
    const annualSalaryInput = qs('#annual_salary_input');
    const benefitYearInput = qs('#benefit_year_input');
    const additionalInfoInput = qs('#additional_info_input');

    // Benefits tab
    const medicalPlan2025Input = qs('#medical_plan_2025_input');
    const dentalPlan2025Input = qs('#dental_plan_2025_input');
    const visionPlan2025Input = qs('#vision_plan_2025_input');
    const medicalPlan2026Input = qs('#medical_plan_2026_input');
    const dentalPlan2026Input = qs('#dental_plan_2026_input');
    const visionPlan2026Input = qs('#vision_plan_2026_input');

    const medicalPlanCodeInput = qs('#medical_plan_code_input');
    const dentalPlanCodeInput = qs('#dental_plan_code_input');
    const visionPlanCodeInput = qs('#vision_plan_code_input');
    const medicalPlanCodeCleanInput = qs('#medical_plan_code_clean_input');

    const medicalPlanInput = qs('#medical_plan_input');
    const dentalPlanInput = qs('#dental_plan_input');
    const visionPlanInput = qs('#vision_plan_input');
    const tierElectionInput = qs('#tier_election_input');
    const employerLifeInput = qs('#employer_life_input');
    const effectiveYearInput = qs('#effective_year_input');

    // Dependents tab
    const dependentsInput = qs('#dependents_input');
    const beneficiariesInput = qs('#beneficiaries_input');

    // System tab
    const usernameInput = qs('#username_input');
    const pinInput = qs('#pin_input');
    const emailInput = qs('#email_input');
    const pdfUrlInput = qs('#pdf_url_input');
    const signedPdfUrlInput = qs('#signed_pdf_url_input');
    const signatureInput = qs('#signature_input');

    // New employee modal inputs
    const newFirstNameInput = qs('#new_first_name_input');
    const newLastNameInput = qs('#new_last_name_input');
    const newJobTitleInput = qs('#new_job_title_input');
    const newDepartmentInput = qs('#new_department_input');
    const newEmploymentStatusInput = qs('#new_employment_status_input');
    const newEmailInput = qs('#new_email_input');
    const newUsernameInputModal = qs('#new_username_input');
    const newPrimaryPhoneInput = qs('#new_primary_phone_input');

    // === UTILITIES ===
    function setLoading(isLoading) {
      if (isLoading) {
        loadingOverlayEl.classList.remove('hidden');
        loadingOverlayEl.classList.add('flex');
      } else {
        loadingOverlayEl.classList.add('hidden');
        loadingOverlayEl.classList.remove('flex');
      }
    }

    function showToast(message, type = 'success') {
      const toast = el(
        'div',
        'flex items-center gap-2 rounded-2xl border px-3 py-2 text-xs shadow-soft'
      );
      const icon = el('i', 'h-4 w-4');
      icon.setAttribute(
        'data-lucide',
        type === 'error' ? 'circle-alert' : type === 'warning' ? 'alert-triangle' : 'check-circle-2'
      );
      const text = el('span', 'max-w-xs');
      text.textContent = message;

      if (type === 'error') {
        toast.classList.add(
          'border-red-500/60',
          'bg-red-950/90',
          'text-red-50'
        );
      } else if (type === 'warning') {
        toast.classList.add(
          'border-amber-500/60',
          'bg-amber-950/90',
          'text-amber-50'
        );
      } else {
        toast.classList.add(
          'border-emerald-500/60',
          'bg-emerald-950/90',
          'text-emerald-50'
        );
      }

      toast.appendChild(icon);
      toast.appendChild(text);
      toastContainerEl.appendChild(toast);
      lucide.createIcons({ icons: { ...lucide.icons }, attrs: { 'stroke-width': 2 } });

      setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-1', 'transition', 'duration-300');
        setTimeout(() => toast.remove(), 300);
      }, 3200);
    }

    function formatDate(dateStr) {
      if (!dateStr) return '—';
      const date = new Date(dateStr);
      if (Number.isNaN(date.getTime())) return '—';
      return date.toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'short',
        day: '2-digit'
      });
    }

    function formatDateTime(dateStr) {
      if (!dateStr) return '—';
      const date = new Date(dateStr);
      if (Number.isNaN(date.getTime())) return '—';
      return date.toLocaleString(undefined, {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatCurrency(value) {
      if (value === null || value === undefined || value === '') return '—';
      const num = Number(value);
      if (Number.isNaN(num)) return '—';
      return num.toLocaleString(undefined, {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 2
      });
    }

    function safeJsonStringify(value, fallback = '') {
      try {
        if (!value) return fallback;
        return JSON.stringify(value, null, 2);
      } catch (err) {
        return fallback;
      }
    }

    function safeJsonParse(value, fallback) {
      if (!value || !value.trim()) return fallback;
      try {
        return JSON.parse(value);
      } catch (err) {
        showToast('Invalid JSON format. Please correct and try again.', 'error');
        throw err;
      }
    }

    function computeTenure(startDateStr) {
      if (!startDateStr) return '—';
      const start = new Date(startDateStr);
      if (Number.isNaN(start.getTime())) return '—';
      const now = new Date();
      let years = now.getFullYear() - start.getFullYear();
      let months = now.getMonth() - start.getMonth();
      if (months < 0) {
        years -= 1;
        months += 12;
      }
      if (years < 0) return '—';
      const parts = [];
      if (years > 0) parts.push(`${years} yr${years > 1 ? 's' : ''}`);
      if (months > 0) parts.push(`${months} mo`);
      return parts.length ? parts.join(' ') : '< 1 mo';
    }

    function mapStatusToChipClass(status) {
      const s = (status || '').toLowerCase();
      if (!s) return 'chip chip-soft';
      if (s.includes('active')) return 'chip chip-success';
      if (s.includes('leave')) return 'chip chip-warning';
      if (s.includes('term')) return 'chip chip-danger';
      return 'chip chip-soft';
    }

    function openModal(modalEl) {
      modalEl.classList.remove('hidden');
      modalEl.classList.add('flex');
    }

    function closeModal(modalEl) {
      modalEl.classList.add('hidden');
      modalEl.classList.remove('flex');
    }

    // === EMPLOYEE LIST RENDERING ===
    function updateEmployeeCount() {
      const total = employeesRaw.length;
      const filtered = employeesFiltered.length;
      if (!total) {
        employeeCountEl.textContent = 'No employees found in employees2025.';
        return;
      }
      if (filtered === total) {
        employeeCountEl.textContent = `${total} employee${total === 1 ? '' : 's'} · full directory`;
      } else {
        employeeCountEl.textContent = `${filtered} of ${total} employees · filters active`;
      }
    }

    function renderEmployeeList() {
      employeeListEl.innerHTML = '';

      if (!employeesFiltered.length) {
        const empty = el(
          'div',
          'flex flex-col items-center justify-center py-6 text-center text-xs text-slate-400'
        );
        empty.innerHTML = `
          <i data-lucide="search-x" class="mb-2 h-6 w-6 text-slate-500"></i>
          <p>No employees match your filters.</p>
          <p class="mt-1 text-[0.68rem] text-slate-500">Adjust search text or filters and try again.</p>
        `;
        employeeListEl.appendChild(empty);
        lucide.createIcons();
        updateEmployeeCount();
        return;
      }

      employeesFiltered.forEach((emp) => {
        const status = (emp.employment_status || emp.status || '').toLowerCase();
        let statusColor = 'bg-slate-500';
        if (status.includes('active')) statusColor = 'bg-emerald-500';
        else if (status.includes('leave')) statusColor = 'bg-amber-400';
        else if (status.includes('term')) statusColor = 'bg-rose-500';

        const row = el(
          'button',
          'group flex w-full items-center justify-between gap-2 rounded-2xl border border-transparent px-2.5 py-2 text-left text-xs text-slate-100 transition hover:border-amber-400/80 hover:bg-slate-900/90'
        );
        row.type = 'button';
        row.dataset.id = emp.id;

        const name = `${emp.first_name || ''} ${emp.last_name || ''}`.trim() || 'Unnamed Employee';
        const job = emp.job_title || emp.position_title || '—';
        const dept = emp.department || '—';

        row.innerHTML = `
          <div class="flex min-w-0 items-center gap-2">
            <div class="flex h-8 w-8 items-center justify-center rounded-2xl bg-slate-900/90 ring-1 ring-slate-700/80">
              <span class="text-[0.7rem] font-semibold text-slate-100">
                ${(emp.first_name || '?')[0].toUpperCase()}
              </span>
            </div>
            <div class="min-w-0">
              <p class="truncate text-xs font-semibold text-slate-50 group-hover:text-amber-100">
                ${name}
              </p>
              <p class="flex items-center gap-1 text-[0.67rem] text-slate-400">
                <span class="truncate max-w-[8rem]">${job}</span>
                <span class="text-slate-500">·</span>
                <span class="truncate max-w-[5rem]">${dept}</span>
              </p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="inline-flex items-center gap-1 rounded-full bg-slate-900/90 px-1.5 py-0.5 text-[0.6rem] text-slate-300">
              <span class="h-1.5 w-1.5 rounded-full ${statusColor}"></span>
              <span class="uppercase tracking-[0.18em]">
                ${(emp.employment_status || emp.status || 'Unknown').slice(0, 18)}
              </span>
            </span>
            <i data-lucide="chevron-right" class="h-3.5 w-3.5 text-slate-500 group-hover:text-amber-200"></i>
          </div>
        `;

        row.addEventListener('click', () => {
          selectEmployee(emp.id);
        });

        employeeListEl.appendChild(row);
      });

      lucide.createIcons();
      updateEmployeeCount();
    }

    function applyFilters() {
      const term = (searchInputEl.value || '').trim().toLowerCase();
      const statusFilter = statusFilterEl.value;
      const deptFilter = departmentFilterEl.value;

      employeesFiltered = employeesRaw.filter((emp) => {
        const name = `${emp.first_name || ''} ${emp.last_name || ''}`.toLowerCase();
        const username = (emp.username || '').toLowerCase();
        const dept = (emp.department || '').toLowerCase();

        let matchesTerm = true;
        if (term) {
          matchesTerm =
            name.includes(term) ||
            username.includes(term) ||
            dept.includes(term);
        }

        let matchesStatus = true;
        if (statusFilter) {
          const s = (emp.employment_status || emp.status || '').toLowerCase();
          matchesStatus = s === statusFilter.toLowerCase();
        }

        let matchesDept = true;
        if (deptFilter) {
          matchesDept = (emp.department || '').toLowerCase() === deptFilter.toLowerCase();
        }

        return matchesTerm && matchesStatus && matchesDept;
      });

      renderEmployeeList();
    }

    function populateFilters() {
      const statusSet = new Set();
      const deptSet = new Set();

      employeesRaw.forEach((emp) => {
        const s = (emp.employment_status || emp.status || '').trim();
        if (s) statusSet.add(s);
        const d = (emp.department || '').trim();
        if (d) deptSet.add(d);
      });

      // Populate status filter
      const statusOptions = ['<option value="">All statuses</option>'];
      Array.from(statusSet)
        .sort((a, b) => a.localeCompare(b))
        .forEach((s) => {
          statusOptions.push(`<option value="${s}">${s}</option>`);
        });
      statusFilterEl.innerHTML = statusOptions.join('');

      // Populate department filter
      const deptOptions = ['<option value="">All departments</option>'];
      Array.from(deptSet)
        .sort((a, b) => a.localeCompare(b))
        .forEach((d) => {
          deptOptions.push(`<option value="${d}">${d}</option>`);
        });
      departmentFilterEl.innerHTML = deptOptions.join('');
    }

    // === LOAD EMPLOYEES ===
    async function loadEmployees() {
      setLoading(true);
      try {
        const { data, error } = await supabaseClient
          .from('employees2025')
          .select('id, first_name, last_name, job_title, department, employment_status, status, username')
          .order('last_name', { ascending: true });

        if (error) {
          console.error(error);
          showToast('Failed to load employees from employees2025.', 'error');
          employeesRaw = [];
          employeesFiltered = [];
          renderEmployeeList();
          return;
        }

        employeesRaw = data || [];
        employeesFiltered = [...employeesRaw];
        populateFilters();
        renderEmployeeList();
      } catch (err) {
        console.error(err);
        showToast('Unexpected error loading employees.', 'error');
      } finally {
        setLoading(false);
      }
    }

    // === SELECT & LOAD EMPLOYEE DETAILS ===
    async function selectEmployee(id) {
      if (!id) return;
      setLoading(true);
      try {
        const { data, error } = await supabaseClient
          .from('employees2025')
          .select('*')
          .eq('id', id)
          .single();

        if (error) {
          console.error(error);
          showToast('Failed to load employee details.', 'error');
          return;
        }

        selectedEmployee = data;
        bindEmployeeToForm();
        showDetailPanel();
      } catch (err) {
        console.error(err);
        showToast('Unexpected error loading employee details.', 'error');
      } finally {
        setLoading(false);
      }
    }

    function showDetailPanel() {
      emptyStateEl.classList.add('hidden');
      detailPanelEl.classList.remove('hidden');
      lucide.createIcons();
    }

    function resetTabs() {
      const tabButtons = qsa('[data-tab-target]');
      const panels = qsa('.tab-panel');
      tabButtons.forEach((btn) => {
        btn.classList.remove('tab-pill-active');
        btn.classList.add('tab-pill-inactive');
      });
      panels.forEach((p) => p.classList.add('hidden'));

      const defaultTabBtn = qs('[data-tab-target="tab-overview"]');
      const defaultPanel = qs('#tab-overview');
      if (defaultTabBtn && defaultPanel) {
        defaultTabBtn.classList.add('tab-pill-active');
        defaultTabBtn.classList.remove('tab-pill-inactive');
        defaultPanel.classList.remove('hidden');
      }
    }

    function bindEmployeeToForm() {
      if (!selectedEmployee) return;

      resetTabs();

      const emp = selectedEmployee;
      const name =
        `${emp.first_name || ''} ${emp.last_name || ''}`.trim() || 'Unnamed Employee';

      // Header
      detailNameEl.textContent = name;
      detailStatusChipEl.className = mapStatusToChipClass(emp.employment_status || emp.status);
      detailStatusChipEl.textContent = emp.employment_status || emp.status || 'Status: N/A';
      detailBenefitYearChipEl.textContent = `Benefit ${emp.benefit_year || 2026}`;
      detailUsernameEl.textContent = emp.username || 'No username';
      detailJobTitleEl.textContent = emp.job_title || emp.position_title || '—';
      detailDepartmentEl.textContent = emp.department || '—';
      detailReportToEl.textContent = `Reports to: ${emp.report_to || '—'}`;

      // Overview
      overviewTitleEl.textContent = emp.job_title || emp.position_title || '—';
      overviewDepartmentEl.textContent = emp.department || '—';
      overviewEmploymentStatusEl.textContent = emp.employment_status || emp.status || '—';
      overviewEmploymentStatusEl.className = mapStatusToChipClass(emp.employment_status || emp.status);
      overviewBenefitYearEl.textContent = emp.benefit_year || '—';
      overviewOriginalHireDateEl.textContent = formatDate(emp.original_hire_date);
      overviewHireDateEl.textContent = formatDate(emp.hire_date);
      overviewTenureEl.textContent = computeTenure(emp.hire_date || emp.original_hire_date);
      overviewLastModifiedEl.textContent = formatDateTime(emp.last_modified);

      overviewBaseRateEl.textContent = emp.base_rate || '—';
      overviewHourlyRateEl.textContent = formatCurrency(emp.hourly_rate);
      overviewAnnualSalaryEl.textContent = formatCurrency(emp.annual_salary);

      overviewPayrollNoteEl.textContent =
        emp.annual_salary || emp.hourly_rate
          ? 'Compensation data ready for payroll sync and executive reporting.'
          : 'Add base, hourly, or salary details to complete payroll view.';

      overviewEmailEl.textContent = emp.email || '—';
      overviewPhoneEl.textContent = emp.primary_phone || emp.phone || '—';
      const prettyLocation = [
        emp.city || (emp.address && emp.address.city),
        emp.state || (emp.address && emp.address.state),
        emp.zip_code || (emp.address && emp.address.zip)
      ]
        .filter(Boolean)
        .join(', ');
      overviewLocationEl.textContent = prettyLocation || '—';

      const benefits2025 = [emp.medical_plan_2025, emp.dental_plan_2025, emp.vision_plan_2025]
        .filter(Boolean)
        .join(' · ');
      const benefits2026 = [emp.medical_plan_2026, emp.dental_plan_2026, emp.vision_plan_2026]
        .filter(Boolean)
        .join(' · ');
      overviewBenefits2025El.textContent = benefits2025 || '—';
      overviewBenefits2026El.textContent = benefits2026 || '—';
      overviewTierEl.textContent = emp.tier_election || '—';
      overviewEmployerLifeEl.textContent = emp.employer_life || '—';

      // Personal
      firstNameInput.value = emp.first_name || '';
      lastNameInput.value = emp.last_name || '';
      dobInput.value = emp.date_of_birth || '';
      legacyDobInput.value = emp.dob || '';
      ssnInput.value = emp.ssn || '';
      sssnInput.value = emp.sssn || '';
      primaryPhoneInput.value = emp.primary_phone || '';
      phoneInput.value = emp.phone || '';
      addressLine1Input.value = emp.address_line_1 || '';
      addressLine2Input.value = emp.address_line_2 || '';
      cityInput.value = emp.city || '';
      stateInput.value = emp.state || '';
      zipCodeInput.value = emp.zip_code || '';
      addressJsonInput.value = safeJsonStringify(emp.address, '');

      // Employment
      employmentStatusInput.value = emp.employment_status || '';
      statusInput.value = emp.status || '';
      terminationStatusInput.value = emp.termination_status || '';
      originalHireDateInput.value = emp.original_hire_date || '';
      hireDateInput.value = emp.hire_date || '';
      jobTitleInput.value = emp.job_title || '';
      positionTitleInput.value = emp.position_title || '';
      departmentInput.value = emp.department || '';
      reportToInput.value = emp.report_to || '';
      terminatedDateInput.value = emp.terminated_date ? emp.terminated_date.substring(0, 16) : '';
      rehireDateInput.value = emp.rehire_date ? emp.rehire_date.substring(0, 16) : '';
      lastModifiedInput.value = formatDateTime(emp.last_modified);

      // Comp
      hourlyRateInput.value = emp.hourly_rate != null ? emp.hourly_rate : '';
      baseRateInput.value = emp.base_rate || '';
      annualSalaryInput.value = emp.annual_salary != null ? emp.annual_salary : '';
      benefitYearInput.value = emp.benefit_year != null ? emp.benefit_year : '';
      additionalInfoInput.value = emp.additional_info || '';

      // Benefits
      medicalPlan2025Input.value = emp.medical_plan_2025 || '';
      dentalPlan2025Input.value = emp.dental_plan_2025 || '';
      visionPlan2025Input.value = emp.vision_plan_2025 || '';
      medicalPlan2026Input.value = emp.medical_plan_2026 || '';
      dentalPlan2026Input.value = emp.dental_plan_2026 || '';
      visionPlan2026Input.value = emp.vision_plan_2026 || '';

      medicalPlanCodeInput.value = emp.medical_plan_code || '';
      dentalPlanCodeInput.value = emp.dental_plan_code || '';
      visionPlanCodeInput.value = emp.vision_plan_code || '';
      medicalPlanCodeCleanInput.value = emp.medical_plan_code_clean || '';

      medicalPlanInput.value = emp.medical_plan || '';
      dentalPlanInput.value = emp.dental_plan || '';
      visionPlanInput.value = emp.vision_plan || '';
      tierElectionInput.value = emp.tier_election || '';
      employerLifeInput.value = emp.employer_life || '';
      effectiveYearInput.value = emp.effective_year != null ? emp.effective_year : '';

      // Dependents & beneficiaries
      dependentsInput.value = safeJsonStringify(emp.dependents, '[]');
      beneficiariesInput.value = safeJsonStringify(emp.beneficiaries, '[]');

      // System
      usernameInput.value = emp.username || '';
      pinInput.value = emp.pin || '';
      emailInput.value = emp.email || '';
      pdfUrlInput.value = emp.pdf_url || '';
      signedPdfUrlInput.value = emp.signed_pdf_url || '';
      signatureInput.value = emp.signature || '';

      // PDF buttons
      if (emp.pdf_url) {
        viewPdfBtn.disabled = false;
      } else {
        viewPdfBtn.disabled = true;
      }

      if (emp.signed_pdf_url) {
        viewSignedPdfBtn.disabled = false;
      } else {
        viewSignedPdfBtn.disabled = true;
      }
    }

    function collectFormData() {
      if (!selectedEmployee) return null;

      return {
        employment_status: employmentStatusInput.value || null,
        first_name: firstNameInput.value || null,
        last_name: lastNameInput.value || null,
        original_hire_date: originalHireDateInput.value || null,
        address_line_1: addressLine1Input.value || null,
        address_line_2: addressLine2Input.value || null,
        primary_phone: primaryPhoneInput.value || null,
        sssn: sssnInput.value || null,
        date_of_birth: dobInput.value || null,
        city: cityInput.value || null,
        state: stateInput.value || null,
        zip_code: zipCodeInput.value || null,
        job_title: jobTitleInput.value || null,
        hourly_rate: hourlyRateInput.value !== '' ? Number(hourlyRateInput.value) : null,
        additional_info: additionalInfoInput.value || null,
        username: usernameInput.value || null,
        pdf_url: pdfUrlInput.value || null,
        signature: signatureInput.value || null,
        pin: pinInput.value || null,
        signed_pdf_url: signedPdfUrlInput.value || null,
        position_title: positionTitleInput.value || null,
        base_rate: baseRateInput.value || null,
        hire_date: hireDateInput.value || null,
        email: emailInput.value || null,
        department: departmentInput.value || null,
        medical_plan_code: medicalPlanCodeInput.value || null,
        dental_plan_code: dentalPlanCodeInput.value || null,
        vision_plan_code: visionPlanCodeInput.value || null,
        tier_election: tierElectionInput.value || null,
        effective_year: effectiveYearInput.value !== '' ? Number(effectiveYearInput.value) : null,
        medical_plan: medicalPlanInput.value || null,
        dental_plan: dentalPlanInput.value || null,
        vision_plan: visionPlanInput.value || null,
        medical_plan_code_clean: medicalPlanCodeCleanInput.value || null,
        report_to: reportToInput.value || null,
        dependents: safeJsonParse(dependentsInput.value, []),
        beneficiaries: safeJsonParse(beneficiariesInput.value, []),
        ssn: ssnInput.value || null,
        dob: legacyDobInput.value || null,
        address: safeJsonParse(addressJsonInput.value, {}),
        phone: phoneInput.value || null,
        annual_salary: annualSalaryInput.value !== '' ? Number(annualSalaryInput.value) : null,
        benefit_year: benefitYearInput.value !== '' ? Number(benefitYearInput.value) : null,
        employer_life: employerLifeInput.value || null,
        medical_plan_2025: medicalPlan2025Input.value || null,
        dental_plan_2025: dentalPlan2025Input.value || null,
        vision_plan_2025: visionPlan2025Input.value || null,
        medical_plan_2026: medicalPlan2026Input.value || null,
        dental_plan_2026: dentalPlan2026Input.value || null,
        vision_plan_2026: visionPlan2026Input.value || null,
        terminated_date: terminatedDateInput.value || null,
        rehire_date: rehireDateInput.value || null,
        status: statusInput.value || null,
        termination_status: terminationStatusInput.value || null
      };
    }

    async function saveEmployee() {
      if (!selectedEmployee) return;
      if (isSaving) return;

      let payload;
      try {
        payload = collectFormData();
      } catch (err) {
        console.error(err);
        return;
      }

      if (!payload) return;

      isSaving = true;
      setLoading(true);

      try {
        const { data, error } = await supabaseClient
          .from('employees2025')
          .update(payload)
          .eq('id', selectedEmployee.id)
          .select()
          .single();

        if (error) {
          console.error(error);
          showToast('Failed to save employee changes.', 'error');
          return;
        }

        selectedEmployee = data;

        // Update list cache
        const idx = employeesRaw.findIndex((e) => e.id === data.id);
        if (idx !== -1) {
          employeesRaw[idx] = {
            ...employeesRaw[idx],
            first_name: data.first_name,
            last_name: data.last_name,
            employment_status: data.employment_status,
            status: data.status,
            job_title: data.job_title,
            department: data.department,
            username: data.username
          };
        }

        applyFilters();
        bindEmployeeToForm();
        showToast('Employee profile saved and logged.', 'success');
      } catch (err) {
        console.error(err);
        showToast('Unexpected error saving employee.', 'error');
      } finally {
        isSaving = false;
        setLoading(false);
      }
    }

    function resetForm() {
      if (!selectedEmployee) return;
      bindEmployeeToForm();
      showToast('Form reset to last saved state.', 'warning');
    }

    function openTerminateModal() {
      if (!selectedEmployee) return;
      confirmDeleteNameEl.textContent =
        `${selectedEmployee.first_name || ''} ${selectedEmployee.last_name || ''}`.trim() ||
        `Employee #${selectedEmployee.id}`;
      openModal(confirmDeleteModal);
    }

    async function softTerminateEmployee() {
      if (!selectedEmployee) return;

      setLoading(true);
      try {
        const payload = {
          status: 'Inactive',
          employment_status: 'Terminated',
          termination_status: 'Pending',
          terminated_date: new Date().toISOString()
        };

        const { data, error } = await supabaseClient
          .from('employees2025')
          .update(payload)
          .eq('id', selectedEmployee.id)
          .select()
          .single();

        if (error) {
          console.error(error);
          showToast('Failed to terminate employee.', 'error');
          return;
        }

        selectedEmployee = data;
        const idx = employeesRaw.findIndex((e) => e.id === data.id);
        if (idx !== -1) {
          employeesRaw[idx] = {
            ...employeesRaw[idx],
            employment_status: data.employment_status,
            status: data.status
          };
        }

        applyFilters();
        bindEmployeeToForm();
        closeModal(confirmDeleteModal);
        showToast('Employee marked as terminated.', 'warning');
      } catch (err) {
        console.error(err);
        showToast('Unexpected error terminating employee.', 'error');
      } finally {
        setLoading(false);
      }
    }

    function clearNewEmployeeForm() {
      newFirstNameInput.value = '';
      newLastNameInput.value = '';
      newJobTitleInput.value = '';
      newDepartmentInput.value = '';
      newEmploymentStatusInput.value = 'Active';
      newEmailInput.value = '';
      newUsernameInputModal.value = '';
      newPrimaryPhoneInput.value = '';
    }

    async function createNewEmployee() {
      const firstName = (newFirstNameInput.value || '').trim();
      const lastName = (newLastNameInput.value || '').trim();

      if (!firstName || !lastName) {
        showToast('First and last name are required to create a new employee.', 'warning');
        return;
      }

      setLoading(true);
      try {
        const payload = {
          first_name: firstName,
          last_name: lastName,
          job_title: newJobTitleInput.value || null,
          department: newDepartmentInput.value || null,
          employment_status: newEmploymentStatusInput.value || 'Active',
          status: 'Active',
          email: newEmailInput.value || null,
          username: newUsernameInputModal.value || null,
          primary_phone: newPrimaryPhoneInput.value || null
        };

        const { data, error } = await supabaseClient
          .from('employees2025')
          .insert(payload)
          .select()
          .single();

        if (error) {
          console.error(error);
          showToast('Failed to create employee.', 'error');
          return;
        }

        showToast('New employee record created.', 'success');
        closeModal(newEmployeeModal);
        clearNewEmployeeForm();

        // Push into cache and reload list
        employeesRaw.push({
          id: data.id,
          first_name: data.first_name,
          last_name: data.last_name,
          job_title: data.job_title,
          department: data.department,
          employment_status: data.employment_status,
          status: data.status,
          username: data.username
        });

        employeesFiltered = [...employeesRaw];
        populateFilters();
        renderEmployeeList();
        selectEmployee(data.id);
      } catch (err) {
        console.error(err);
        showToast('Unexpected error creating employee.', 'error');
      } finally {
        setLoading(false);
      }
    }

    function openPdf(url) {
      if (!url) return;
      window.open(url, '_blank', 'noopener,noreferrer');
    }

    function initTabs() {
      qsa('[data-tab-target]').forEach((btn) => {
        btn.addEventListener('click', () => {
          const targetId = btn.getAttribute('data-tab-target');
          if (!targetId) return;

          qsa('[data-tab-target]').forEach((b) => {
            b.classList.remove('tab-pill-active');
            b.classList.add('tab-pill-inactive');
          });

          qsa('.tab-panel').forEach((panel) => {
            panel.classList.add('hidden');
          });

          const targetPanel = qs(`#${targetId}`);
          if (targetPanel) {
            targetPanel.classList.remove('hidden');
          }

          btn.classList.add('tab-pill-active');
          btn.classList.remove('tab-pill-inactive');
        });
      });
    }

    function initThemeToggle() {
      const stored = localStorage.getItem('jengchi-theme');
      if (stored === 'dark' || !stored) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }

      themeToggleBtn.addEventListener('click', () => {
        const html = document.documentElement;
        const isDark = html.classList.toggle('dark');
        localStorage.setItem('jengchi-theme', isDark ? 'dark' : 'light');
      });
    }

    function initSearchAndFilters() {
      let searchDebounce;
      searchInputEl.addEventListener('input', () => {
        clearTimeout(searchDebounce);
        searchDebounce = setTimeout(() => {
          applyFilters();
          clearSearchBtn.classList.toggle('hidden', !searchInputEl.value);
        }, 200);
      });

      clearSearchBtn.addEventListener('click', () => {
        searchInputEl.value = '';
        clearSearchBtn.classList.add('hidden');
        applyFilters();
      });

      statusFilterEl.addEventListener('change', applyFilters);
      departmentFilterEl.addEventListener('change', applyFilters);
      refreshBtn.addEventListener('click', loadEmployees);
    }

    function initActions() {
      saveBtn.addEventListener('click', saveEmployee);
      resetFormBtn.addEventListener('click', resetForm);
      deleteBtn.addEventListener('click', openTerminateModal);

      viewPdfBtn.addEventListener('click', () => {
        if (selectedEmployee && selectedEmployee.pdf_url) {
          openPdf(selectedEmployee.pdf_url);
        }
      });

      viewSignedPdfBtn.addEventListener('click', () => {
        if (selectedEmployee && selectedEmployee.signed_pdf_url) {
          openPdf(selectedEmployee.signed_pdf_url);
        }
      });

      // New employee modal
      newEmployeeBtn.addEventListener('click', () => {
        clearNewEmployeeForm();
        openModal(newEmployeeModal);
      });

      closeNewEmployeeModalBtn.addEventListener('click', () => closeModal(newEmployeeModal));
      cancelNewEmployeeBtn.addEventListener('click', () => closeModal(newEmployeeModal));
      createNewEmployeeBtn.addEventListener('click', createNewEmployee);

      // Confirm terminate modal
      cancelDeleteBtn.addEventListener('click', () => closeModal(confirmDeleteModal));
      confirmDeleteBtn.addEventListener('click', softTerminateEmployee);
    }

    function initLucide() {
      lucide.createIcons({
        icons: { ...lucide.icons },
        attrs: { 'stroke-width': 1.8 }
      });
    }

    async function bootstrap() {
      initLucide();
      initThemeToggle();
      initTabs();
      initSearchAndFilters();
      initActions();
      await loadEmployees();
    }

    document.addEventListener('DOMContentLoaded', bootstrap);
  </script>
</body>

</html>