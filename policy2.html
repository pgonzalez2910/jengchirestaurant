<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeng Chi — Employee Handbook</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 'serif-head': ['Playfair Display','serif'], 'sans': ['Inter','system-ui','sans-serif'] },
          colors: { 'jc-primary':'#1F2937','jc-secondary':'#334155','jc-gold':'#C0A06D','jc-border':'#E2E8F0', 'jc-green':'#10B981' },
          boxShadow: {
            'soft':'0 18px 80px rgba(0,0,0,.12)',
            'glow':'0 0 0 1px rgba(255,255,255,.3), 0 30px 80px rgba(0,0,0,.22)'
          }
        }
      }
    }
  </script>

  <!-- Supabase v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- DOMPurify for XSS protection (optional, but good practice) -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  
<style>
  .prose-handbook h2,
  .prose-handbook h3 { font-family: 'Playfair Display', serif; }

  /* Force justified copy inside handbook sections */
  .prose-handbook p,
  .prose-handbook ul,
  .prose-handbook li {
    text-align: justify !important;
    text-justify: inter-word;
  }
</style>


</head>

<body class="h-full bg-slate-50 text-slate-800 font-sans">
  <div class="fixed inset-0 -z-10 bg-gradient-to-b from-white via-[#faf7f3] to-[#f3f0ea]"></div>
  <div class="fixed inset-0 -z-10 pointer-events-none opacity-30"
       style="background:
        radial-gradient(800px 400px at 50% -50%, rgba(192,160,109,.25), transparent 60%),
        radial-gradient(600px 320px at 120% 20%, rgba(192,160,109,.18), transparent 60%),
        radial-gradient(700px 500px at -20% 60%, rgba(0,0,0,.06), transparent 65%);">
  </div>

  <!-- ===================== LOGIN ===================== -->
  <main id="loginView" class="min-h-screen flex items-center justify-center p-6">
    <section class="w-full max-w-[560px] rounded-[24px] bg-white/80 backdrop-blur-md shadow-soft border border-jc-border ring-1 ring-white/50">
      <div class="p-8">
        <div class="flex justify-center">
          <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg"
               alt="Jeng Chi" class="h-20 w-auto rounded-xl bg-white/70 shadow-glow ring-1 ring-white/50 object-contain"/>
        </div>

        <h1 class="font-serif-head text-3xl text-center mt-6 text-jc-primary">Employee Portal</h1>
        <p class="text-center text-sm text-slate-600 mt-1">Enterprise Sign-In</p>

        <div class="mt-8 space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-700">Username</label>
            <input id="username" class="mt-1 w-full rounded-xl border border-jc-border px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-jc-gold/40" placeholder="e.g., pg"/>
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700">PIN</label>
            <input id="pin" type="password" inputmode="numeric" maxlength="8"
                   class="mt-1 w-full rounded-xl border border-jc-border px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-jc-gold/40" placeholder="••••" autocomplete="current-password" aria-label="PIN"/>
          </div>

          <button id="btnLogin" class="w-full mt-2 rounded-xl bg-jc-gold text-white py-3 text-sm font-medium hover:opacity-95">Sign in</button>
          <div id="loginMsg" class="text-sm h-5 mt-2 text-center" role="status" aria-live="polite"></div>
        </div>

        <div class="mt-10 text-center text-[13px] leading-5 text-slate-600">
          <div>400 North Greenville Avenue Ste 11, Richardson TX 75081</div>
          <div class="mt-1">© 2025 Jeng Chi Restaurant — All Rights Reserved</div>
        </div>
      </div>
    </section>
  </main>

  <!-- ===================== APP ===================== -->
  <div id="appView" class="hidden">
    <!-- top address -->
    <div class="w-full max-w-[1200px] mx-auto px-6 pt-4">
      <div class="flex items-start justify-between">
        <div></div>
        <div class="text-right text-[13px] leading-5 text-slate-600">
          <div>400 North Greenville Avenue Ste 11</div>
          <div>Richardson Texas 75081</div>
          <div class="mt-1">© 2025 Jeng Chi Restaurant — All Rights Reserved</div>
        </div>
      </div>
    

    <!-- logo + signout -->
    <header class="w-full max-w-[1200px] mx-auto px-6 mt-4">
      <div class="w-full flex items-center justify-between gap-3">
        <div class="flex-1"></div>
        <div class="w-full flex justify-center">
          <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg"
               alt="Jeng Chi logo"
               class="h-20 w-auto rounded-xl bg-white/70 backdrop-blur-sm shadow-glow ring-1 ring-white/50 object-contain" />
        </div>
        <div class="flex-1 flex justify-end">
          <button id="btnSignOut" class="rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">Sign out</button>
        </div>
      </div>
    </header>

    <!-- employee card -->
    <section class="w-full max-w-[1200px] mx-auto px-6 mt-6">
      <div class="rounded-2xl bg-white/80 backdrop-blur-sm shadow-soft ring-1 ring-white/40 border border-jc-border">
        <div class="px-6 py-4 border-b border-jc-border">
          <h2 class="font-serif-head text-2xl text-jc-primary">Employee Information</h2>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-4 text-[15px]">
            <div><div class="text-slate-500">Employee</div><div id="fi_name" class="font-medium">—</div></div>
            <div><div class="text-slate-500">User</div><div id="fi_user" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Position</div><div id="fi_position" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Department</div><div id="fi_department" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Reports to</div><div id="fi_reports_to" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Email</div><div id="fi_email" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Phone</div><div id="fi_phone" class="font-medium">—</div></div>
            <div><div class="text-slate-500">Session started</div><div id="fi_session_started" class="font-medium">—</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- section tabs -->
    <section class="w-full max-w-[1200px] mx-auto px-6 mt-6">
      <div class="flex flex-wrap gap-2">
        <button data-tab="I"   class="tabbtn rounded-xl px-4 py-2 text-sm bg-jc-primary text-white">Section I – Introduction</button>
        <button data-tab="II"  class="tabbtn rounded-xl px-4 py-2 text-sm border">Section II – Employment Policies</button>
        <button data-tab="III" class="tabbtn rounded-xl px-4 py-2 text-sm border">Section III – Hours of Work & Payroll Practices</button>
        <button data-tab="IV"  class="tabbtn rounded-xl px-4 py-2 text-sm border">Section IV – Standards of Conduct</button>
        <button data-tab="V"   class="tabbtn rounded-xl px-4 py-2 text-sm border">Section V – Discipline & Corrective Action</button>
        <button data-tab="VI" class="tabbtn rounded-xl px-4 py-2 text-sm border">Section VI – Family and Medical Leave (FMLA)</button>
        <button data-tab="VII" class="tabbtn rounded-xl px-4 py-2 text-sm border">Section VII – Doctor’s Notice & Medical Leave Documentation</button>
        <button data-tab="VIII"class="tabbtn rounded-xl px-4 py-2 text-sm border">Section VIII – Employee Benefits & Services</button>
      </div>
    </section>

    <!-- section body -->
    <main class="w-full max-w-[1200px] mx-auto px-6 mt-4 pb-24">
      <div class="rounded-2xl bg-white shadow-soft border border-jc-border ring-1 ring-white/40">
        <div class="px-6 pt-6 pb-4 border-b border-jc-border">
          <h1 id="sectionTitle" class="font-serif-head text-3xl text-jc-primary tracking-tight" tabindex="-1">Section I — Introduction</h1>
          <p class="text-sm text-slate-600 mt-1">Initial each policy below and press <span class="font-medium">Acknowledge</span>. “Next Section” unlocks when all policies in this section are saved.</p>
        </div>

        <div class="px-6 py-4 border-b border-jc-border flex items-center justify-between">
          <!-- Progress only shows total saved/total -->
          <div class="text-sm text-slate-600">Overall Progress: <span id="progCount" class="font-semibold">0</span>/<span id="progTotal">0</span> saved</div>
          <div class="w-56 h-2 bg-slate-100 rounded-full overflow-hidden">
            <div id="progBar" class="h-2 bg-jc-gold rounded-full" style="width:0%"></div>
          </div>
        </div>

        <div id="policies" class="p-6 prose-handbook"></div>

        <!-- buttons -->
        <div class="px-6 pt-2 pb-6 border-t border-jc-border flex items-center justify-between gap-3" id="btnRowFinalize">
          <button id="btnBack" class="rounded-xl border px-4 py-2 text-sm w-full md:w-auto">Back</button>

          <button id="btnFinalize"
                  class="hidden rounded-xl bg-slate-600 text-white px-4 py-2 text-sm font-medium w-full md:w-auto hover:bg-slate-700">
            Finalize & Submit Acknowledgment
          </button>

          <button id="btnNext"
                  class="rounded-xl bg-slate-400 text-white px-4 py-2 text-sm cursor-not-allowed opacity-70"
                  disabled>
            Next Section
          </button>
        </div>
        <!-- status line for submit / errors -->
        <div id="finalizeMsg" class="text-sm h-5 text-center mt-3"></div>

      </div>
    </main>
  </div>

  <script>
    /* ========= SUPABASE ========= */
   const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
  const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);



(async () => {
  const { error } = await client
    .from('hb_policies')
    .select('id', { head: true, count: 'exact' })
    .limit(1);

  if (error) {
    const msg = document.getElementById('loginMsg');
    msg.textContent = error.message.includes('API key')
      ? 'Invalid API key — paste the current anon key from Supabase Settings → API.'
      : error.message;
    msg.className = 'text-sm text-red-600';
    console.warn('Supabase connectivity test failed:', error);
  } else {
    console.log('Supabase connectivity: OK');
  }
})();



    /* --- EMAIL CONFIG --- */
    const ADMIN_EMAIL_CC = "admin@jengchirestaurant.com";
    const WITNESS_NAME = "Janelle Teng";
    // NOTE: Edge Function URL must be deployed to this path on Supabase.
    // We keep the full URL here for logging/clarity, but use the function name in client.functions.invoke()
    const EMAIL_FUNCTION_URL = "https://kpldzwlftkvjjntgsqxx.functions.supabase.co/new-generate-ack-pdf-and-email";


    /* ========= DOM ========= */
    const loginView = document.getElementById('loginView');
    const appView   = document.getElementById('appView');
    const usernameEl = document.getElementById('username');
    const pinEl      = document.getElementById('pin');
    const btnLogin   = document.getElementById('btnLogin');
    const loginMsg   = document.getElementById('loginMsg');

    const sectionTitle = document.getElementById('sectionTitle');
    const policiesEl   = document.getElementById('policies');
    const btnNext      = document.getElementById('btnNext');
    const btnFinalize  = document.getElementById('btnFinalize');
    const progCountEl  = document.getElementById('progCount');
    const progTotalEl  = document.getElementById('progTotal');
    const progBar      = document.getElementById('progBar');
    const btnBack      = document.getElementById('btnBack');

    /* ========= STATE / EMP CARD ========= */
    let empProfile = { // Global object to hold current user's full data
      full_name: null, position: null, department: null, reports_to: null,
      reports_to_position: null, // <-- ADDED: Manager's position
      email: null, phone: null
    };

    /* ========= UTIL ========= */
    const CODE_RE = /^(\d+\.\d+)/;
    const UUID_RE = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    const safe = (v, dash='—') => (v===null || v===undefined || v==='') ? dash : v;
    const toInitials = (u) => (String(u||'').trim().slice(0,2) || '').toUpperCase();
    const toast = (el, msg, ok=false) => { el.textContent = msg; el.className = `text-sm ${ok?'text-jc-green':'text-red-600'}`; setTimeout(()=>{ el.textContent=''; el.className='text-sm'; }, 4000); };
    const extractCode = (t='') => { const m=String(t).toUpperCase().match(CODE_RE); return m?m[1]:null; };

    const setSession = (s)=> localStorage.setItem('hb_session', JSON.stringify(s||{}));
    const getSession = ()=> { try { return JSON.parse(localStorage.getItem('hb_session')||'{}'); } catch { return {}; } };
    const getInitials = ()=> {
      const s = getSession();
      if (s?.initials) return String(s.initials).toUpperCase();
      if (s?.username) return toInitials(s.username);
      return '';
    };
    const getSessionId = ()=> { const sid = localStorage.getItem('hb_session_id'); return sid ? Number(sid) : null; };
    const getSessionStartedAt = ()=> localStorage.getItem('hb_session_started_at') || new Date().toISOString();

    // Stable per-user namespace: employee_id -> initials -> username
    function userNamespace() {
      const s = getSession();
      if (s?.employee_id) return `emp_${s.employee_id}`;
      if (getInitials()) return `init_${getInitials()}`;
      if (s?.username) return `user_${String(s.username).toLowerCase()}`;
      return 'anon';
    }
    const nsKey = (base) => `${userNamespace()}__${base}`;
    
    /**
     * Determines the primary email recipient based on the employee's position.
     * Note: This function is only for client-side logging/UI. The Edge Function must implement the real routing.
     * @param {string} position 
     * @returns {{to: string, cc: string}}
     */
    function getFinalRecipient(position) {
        const p = (position || '').toLowerCase();
        let to = ADMIN_EMAIL_CC; // Default to admin

        if (p.includes('server')) {
            to = "info@jengchirestaurant.com"; 
        } else if (p.includes('bartender')) { 
            to = "pablo@jengchirestaurant.com";
        } else if (p.includes('cashier') || p.includes('host')) {
            to = "info@jengchirestaurant.com"; 
        }
        
        return { to, cc: ADMIN_EMAIL_CC };
    }

    // Helper: Checks if the current tab is the last one
    const isLastSection = (tabKey) =>
      SECTION_ORDER.indexOf(tabKey) === SECTION_ORDER.length - 1;


    /* ========= LOGIN ========= */
    function showApp(){ 
      loginView.classList.add('hidden'); 
      appView.classList.remove('hidden'); 
      requestAnimationFrame(()=> document.getElementById('sectionTitle')?.focus()); 
    }
    function showLogin(){ 
      appView.classList.add('hidden'); 
      loginView.classList.remove('hidden'); 
    }

    async function startRemoteSession(initials){
      try{
        const { data, error } = await client.rpc('hb_start_session', { p_initials: initials });
        const sessionId = data || null;
        const startedAt = new Date().toISOString();
        if(sessionId) localStorage.setItem('hb_session_id', String(sessionId));
        localStorage.setItem('hb_session_started_at', startedAt);
      }catch(e){
        localStorage.setItem('hb_session_started_at', new Date().toISOString());
      }
    }
    
    let loginBusy = false;
    let loginAttempts = 0;
    let lastAttemptAt = 0;
    async function doLogin(){
      if (loginBusy) return;
      
      const now = Date.now();
      const THROTTLE_MINUTES = 5;
      if (loginAttempts >= 5 && now - lastAttemptAt < THROTTLE_MINUTES * 60_000) {
        return toast(loginMsg, `Too many attempts. Try again in ${THROTTLE_MINUTES} minutes.`);
      }

      const u = (usernameEl.value||'').trim();
      const p = (pinEl.value||'').trim();
      if(!u || !p){ toast(loginMsg, 'Enter username and PIN.'); return; }
      loginMsg.textContent='';
      
      loginBusy = true;
      btnLogin.disabled = true; 
      btnLogin.classList.add('opacity-60','cursor-wait');

      try{
       const { data, error } = await client.rpc('hb_login_v3', { p_username: u, p_pin: p });
        if (error) { toast(loginMsg, error.message || 'Login failed'); return; }
        if (!data) { toast(loginMsg, 'Invalid username or PIN'); return; }           // no such user
        if (data.ok === false) { toast(loginMsg, 'Invalid username or PIN'); return; } // wrong pin

        // success
        const s = {
          username: u,
          initials: data.initials || toInitials(u),
          employee_id: data.employee_id || null,
          full_name: data.full_name || null,
          position: data.position || null,
          department: data.department || null,
          is_owner: !!data.is_owner,
          email: data.email || null,
          phone: data.phone || null,
          reports_to: data.reports_to || null
        };
        setSession(s);
        await startRemoteSession(s.initials);
        showApp();
        await bootApp();
        loginAttempts = 0; // Reset attempts on success

      }catch(e){
        loginAttempts++; 
        lastAttemptAt = now;
        console.error(e);
        toast(loginMsg, 'Login error');
      } finally {
        loginBusy = false;
        btnLogin.disabled = false; 
        btnLogin.classList.remove('opacity-60','cursor-wait');
      }
    }
    btnLogin.addEventListener('click', doLogin);
    pinEl?.addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });

    // Sign out: keep local progress so employees don't lose their place
    document.getElementById('btnSignOut')?.addEventListener('click', ()=>{
      localStorage.removeItem('hb_session');
      localStorage.removeItem('hb_session_id');
      localStorage.removeItem('hb_session_started_at');
      showLogin();
    });

    /* ========= EMPLOYEE CARD (FILLS empProfile) ========= */
    
    async function fillEmployeeCard(){
      const s = getSession();
      const initials = getInitials();
      const started  = getSessionStartedAt();

      // 1) seed from login/session
      let name        = s?.full_name || null;
      let position    = s?.position || null;
      let department  = s?.department || null;
      let reports_to  = s?.reports_to || null;
      let email       = s?.email || null;
      let phone       = s?.phone || null;
      const username  = s?.username || null;

      // Update global profile object
      empProfile = { ...s, full_name: name, position, department, reports_to, email, phone };


      // show what we have right away
      document.getElementById('fi_user').textContent        = safe(initials || toInitials(username));
      document.getElementById('fi_name').textContent        = safe(name);
      document.getElementById('fi_position').textContent    = safe(position);
      document.getElementById('fi_department').textContent  = safe(department);
      document.getElementById('fi_reports_to').textContent  = safe(reports_to);
      document.getElementById('fi_email').textContent       = safe(email);
      document.getElementById('fi_phone').textContent       = safe(phone);
      document.getElementById('fi_session_started').textContent = new Date(started).toLocaleString();

      // 2) If we still need basics, use hb_handbook_access (by username)
      if ((!name || !position || !department) && username){
        const { data: ha } = await client
          .from('hb_handbook_access')
          .select('employee_name, position, department')
          .eq('username', username)
          .maybeSingle();

        if (ha){
          name       = name       || ha.employee_name || null;
          position   = position   || ha.position || null;
          department = department || ha.department || null;

          document.getElementById('fi_name').textContent        = safe(name);
          document.getElementById('fi_position').textContent    = safe(position);
          document.getElementById('fi_department').textContent  = safe(department);
        }
      }

      // 3) Use the official employees data for contact + manager (by full_name)
      if (name){
        const { data: ec } = await client
          .from('v_employee_card')
          .select('email, phone, reports_to, department')
          .ilike('full_name', name);   // case-insensitive match

        if (ec && ec.length){
          // pick the first match or the one whose dept matches
          const row = ec.find(r => r.department && department && r.department.toLowerCase() === department.toLowerCase()) || ec[0];

          email      = email      || row.email || null;
          phone      = phone      || row.phone || null;
          reports_to = reports_to || row.reports_to || null;

          document.getElementById('fi_reports_to').textContent  = safe(reports_to);
          document.getElementById('fi_email').textContent       = safe(email);
          document.getElementById('fi_phone').textContent       = safe(phone);
        }
      }
      // Final update to global profile object
      empProfile = { ...empProfile, full_name: name, position, department, reports_to, email, phone };
    }


    /* ========= SECTION DATA (All the HTML content) ========= */
    // All SECTION data remains here (SECTION_I through SECTION_VIII, SECTION_V/VI/VII CODES/constants)
    /* --- REDACTED FOR BREVITY --- */
    const SECTION_I = [
  {
    code: "1.1",
    title: "Welcome to Jeng Chi Restaurant",
    html: `
      <p>We are pleased to have you join our team here at Jeng Chi. This restaurant has been operating since 1990 and we would like to recognize our employees as our most valuable resource for our continuous success. Our capability in providing customers with authentic Taiwanese food and an enjoyable customers dining experience depends on having high quality people like yourself and your fellow employees. We want you to enjoy your time with us here and we are committed to helping you succeed in your new job opportunity.</p>
    `
  },
  {
    code: "1.2",
    title: "Employee Handbook — Purpose and Coverage",
    html: `
      <p>This Employee Handbook (“Handbook”) summarizes key personnel policies, benefits, and workplace standards of Jeng Chi Restaurant (the “Company”), 400 N. Greenville Avenue, Suite 11, Richardson, Texas 75081. It applies to all employees and is intended to promote consistent, lawful practices in accordance with guidance from the Texas Workforce Commission (TWC) and applicable federal, state, and local laws. Compliance with this Handbook is a condition of employment.</p>
    `
  },
  {
    code: "1.3",
    title: "Disclaimer, Employment-At-Will & Management Approval Authority",
    html: `
      <p><strong>Purpose.</strong> This section clarifies the nature of employment at Jeng Chi Restaurant (“The Company”), explains how handbook policies may change, and sets the approval standard for any changes to an employee’s position or pay.</p>
      <p><strong>Not a Contract.</strong> This handbook is a general guide to THE COMPANY policies and does not create a contract, guarantee of employment, or promise of specific terms or continued employment. Nothing in this handbook alters the at-will employment relationship, which may be ended by the employee or by THE COMPANY at any time, with or without notice and with or without cause, to the extent permitted by law.</p>
      <p><strong>Right to Modify.</strong> THE COMPANY may interpret, revise, suspend, or discontinue any policy, benefit, or practice described in this handbook at any time, with or without notice, except where advance notice is required by law. If there is a conflict between this handbook and an official plan document (for example, insurance plan documents), the official plan document controls.</p>
      <p><strong>No Unauthorized Promises.</strong> No supervisor, manager, or employee may make any oral or written promise, agreement, or representation contrary to this section. Only a written agreement signed by Janelle Teng or Francisco Teng may modify the at-will relationship or these approval requirements.</p>
      <p><strong>Equal Employment & Non-Retaliation.</strong> All decisions regarding hiring, compensation, scheduling, promotion, demotion, and separation are made based on legitimate business reasons and in compliance with federal, state, and local law. THE COMPANY prohibits unlawful discrimination and retaliation. Employees who raise good-faith concerns or participate in investigations are protected from retaliation.</p>
      <hr class="my-4 border-jc-border">
    `
  },
  {
    code: "1.4",
    title: "Approval Authority for Position & Pay Changes",
    html: `
      <p>To ensure consistency, internal controls, and legal compliance:</p>
      <p><strong>Scope:</strong></p>
      <ul class="list-disc pl-6">
        <li><strong>Pay changes</strong> — Base rate/hourly rate adjustments, salary adjustments, tip-differential changes, bonuses unrelated to formulaic programs, or changes to incentive plans.</li>
        <li><strong>Position changes</strong> — Promotions, demotions, reclassifications (e.g., full-time/part-time status), title changes, and changes in FLSA exemption status.</li>
        <li><strong>Work schedule/pay basis changes</strong> that may affect overtime eligibility (e.g., moving from salary to hourly, or vice versa).</li>
      </ul>
      <p><strong>Authorized Approvers.</strong> Approval must be provided in writing by one of the following: Janelle Teng (Owner) or Francisco Teng (Owner). Either approver may act; delegation to another leader must be in writing and kept on file.</p>
      <p><strong>Effective Dates.</strong> Changes become effective only after written approval and written notice to the employee. Retroactive changes are prohibited unless required to correct an error or ensure legal compliance.</p>
      <p><strong>Invalid Changes.</strong> Any unapproved promise or change is void and will be corrected. Employees should report concerns to HR.</p>
    `
  },
  {
    code: "1.5",
    title: "Administration and Changes",
    html: `
      <p>The Company may modify, rescind, delete, or add policies at any time, in its sole discretion, with or without advance notice, consistent with applicable law. Policy updates may be communicated by revised Handbook pages, written memoranda, email, the HR system, or postings on the employee bulletin board. Unless an effective date is stated, changes are effective upon communication. Employees are responsible for reviewing and complying with updated policies.</p>
    `
  },
  {
    code: "1.6",
    title: "Interpretation; Deviation; No Past-Practice Rights",
    html: `
      <p>The Company retains discretion to interpret and apply this Handbook and, where appropriate, to deviate from stated procedures based on the facts and business needs of a particular situation, consistent with applicable law. No supervisor’s verbal statement, prior practice, or past decision creates a binding rule, promise of continued employment, or contractual right. Nothing in this Handbook requires the Company to use progressive discipline or follow any specific sequence of corrective steps; the Company may proceed directly to any level of discipline, including termination, where warranted by the circumstances and applicable law.</p>
      <p><strong>Supersession.</strong> This Handbook supersedes and replaces all prior handbooks, policies, and summaries on the same subjects, including the Employee Handbook dated August 2024. To the extent of any conflict between this Handbook and earlier materials, this Handbook controls. (If any policy conflicts with applicable law or an official plan document, the law/plan controls.)</p>
    `
  },
  {
    code: "1.7",
    title: "Conflicts with Law or Other Documents",
    html: `
      <p>If a policy conflicts with applicable law, the law controls, and the policy will be interpreted or modified to comply. If a conflict exists between this Handbook and an official plan document (for example, a group health plan), the plan document controls. If this Handbook is translated, the English version controls in the event of any inconsistency.</p>
    `
  }
];

const SECTION_II = [
  {
    code: "2.1",
    title: "Employee Classifications",
    html: `
      <p><strong>Purpose.</strong> To clarify how we categorize jobs for pay, scheduling, and benefits; and to comply with the Fair Labor Standards Act (FLSA) and Texas law.</p>
      <p><strong>Status Types.</strong></p>
      <ul class="list-disc pl-6">
        <li><strong>Exempt</strong> (salary, not overtime-eligible): Roles that meet FLSA duties and salary basis tests (e.g., certain executive, administrative, or professional positions).</li>
        <li><strong>Nonexempt</strong> (hourly, overtime-eligible): Roles that do not meet the FLSA exemption tests. Nonexempt employees must record all hours worked and are paid overtime for hours &gt; 40 in a workweek.</li>
        <li><strong>Full-Time</strong>: Regularly scheduled 30+ hours per week.</li>
        <li><strong>Part-Time</strong>: Regularly scheduled &lt; 30 hours per week.</li>
        <li><strong>Temporary/Seasonal</strong>: Hired for a defined period or project.</li>
      </ul>
      <p><strong>Notes.</strong></p>
      <ul class="list-disc pl-6">
        <li>Classification is determined by the Company and may change with role changes.</li>
        <li>All employment remains at-will regardless of classification.</li>
      </ul>
    `
  },
  {
    code: "2.2",
    title: "Equal Employment Opportunity (EEO) & Americans with Disabilities Act (ADA)",
    html: `
      <p><strong>Policy.</strong> We provide equal employment opportunities without regard to protected characteristics (including race, color, religion, sex—including pregnancy—sexual orientation, gender identity, national origin, age, disability, genetic information, marital status, veteran status, or any other status protected by law). This policy applies to all employment actions (recruiting, hiring, scheduling, pay, promotion, training, discipline, and termination). Retaliation for raising good-faith concerns is strictly prohibited.</p>
      <p><strong>Reasonable Accommodation</strong></p>
      <ul class="list-disc pl-6">
        <li><strong>Who may request:</strong> Applicants and employees with disabilities; employees with sincerely held religious beliefs/practices; nursing employees requesting lactation accommodation.</li>
        <li><strong>How to request:</strong> Notify your supervisor or HR/Owner at any time (earlier is better). You may be asked for limited documentation to understand needs.</li>
        <li><strong>Interactive process:</strong> We will review job essential functions, potential accommodations, and undue hardship.</li>
        <li><strong>Decision:</strong> HR/Owner will provide the accommodation granted or explain alternative options/denials in writing.</li>
        
      </ul>
    `
  },
  {
    code: "2.3",
    title: "Introductory Period",
    html: `
      <p>The first 60 days of employment are an introductory period to confirm job fit and performance expectations.</p>
      <ul class="list-disc pl-6">
        <li><strong>During the period:</strong> You’ll receive training, feedback, and any needed coaching.</li>
        <li><strong>Review:</strong> At ~60 days, your supervisor evaluates performance and communicates next steps.</li>
        <li><strong>At-will:</strong> Completion (or early completion/extension) does not guarantee continued employment or change at-will status.</li>
        <li><strong>Work authorization:</strong> Within three business days of hire, employees must complete Form I-9 and provide acceptable documentation.</li>
      </ul>
    `
  },
  {
    code: "2.4",
    title: "Reporting Discrimination/Harassment",
    html: `
      <ul class="list-disc pl-6">
        <li>Report immediately to your supervisor or HR/Owner (or any manager).</li>
        <li>We will investigate promptly, keep matters as confidential as practicable, and take corrective action where appropriate.</li>
        <li>No one will be retaliated against for good-faith reports or participation in investigations.</li>
      </ul>
    `
  },
  {
    code: "2.5",
    title: "Required Certifications & Paid Training",
    html: `
      <h3 class="text-xl font-semibold mt-2 mb-1">2.5.1 Food Safety (Food Handler – TXDSHS)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Who needs it:</strong> Any employee who handles food, food-contact surfaces, utensils, or works in food-prep/BOH/FOH areas.</li>
        <li><strong>Deadline:</strong> Complete an approved Texas Food Handler course within 30 days of hire.</li>
        <li><strong>Company pays the fee:</strong> The Company pays the course/card cost initial.</li>
        <li><strong>Scheduling:</strong> A manager will schedule your course on-site. Do not self-enroll without approval.</li>
        <li><strong>Paid training time:</strong> Time spent attending required Food Handler training is compensable and paid at the Training Rate (defined below).</li>
        <li><strong>Proof & renewals:</strong> Provide a copy of your valid card to your Supervisor/HR and notify them 30 days before expiration. Missing or expired credentials may result in removal from food-handling duties until renewed and may lead to discipline.</li>
      </ul>

      <h3 class="text-xl font-semibold mt-4 mb-1">2.5.2 Alcohol Service (TABC Seller-Server)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Who needs it:</strong> Employees who sell/serve alcohol (servers, bartenders, some FOH). Must be 18+ to serve alcohol in Texas.</li>
        <li><strong>Before any alcohol shift:</strong> Maintain a current TABC seller-server certification.</li>
        <li><strong>Company pays the fee:</strong> The Company pays the course/exam fee initial.</li>
        <li><strong>Scheduling:</strong> A manager will schedule your course (on-site). Do not self-enroll without approval.</li>
        <li><strong>Paid training time:</strong> Time spent attending required TABC training is compensable and paid at the Training Rate (defined below).</li>
        <li><strong>Proof & renewals:</strong> Provide proof of certification to your Supervisor/HR and notify them 30 days before expiration. Employees with lapsed certification may be removed from alcohol-service shifts until renewed and may face discipline.</li>
      </ul>
    `
  },
  {
    code: "2.6",
    title: "Paid Training – FLSA/TWC Compliance Rules",
    html: `
      <p><strong>Training Rate (compensable time):</strong> Required, job-related training time is paid time at a Training Rate equal to at least the applicable minimum wage (federal or Texas, whichever is higher).</p>
      <ul class="list-disc pl-6">
        <li>For tipped employees, training hours are paid at full minimum wage (no tip credit) because training time does not produce tips.</li>
        <li>For non-exempt employees with a regular rate above minimum wage, required training hours may be paid at the Training Rate. If the employee’s total hours in the workweek trigger overtime (over 40), overtime is calculated using the weighted-average (blended) regular rate for that week, per FLSA.</li>
      </ul>
    `
  },
  {
    code: "2.7",
    title: "Parking",
    html: `
      <p>Employees must park along Greenville Avenue or in designated employee areas past the third statue. Do not park in front of Jeng Chi or other businesses. Spaces nearest the restaurants are reserved for guests. Violations may result in corrective action.</p>
    `
  },
  {
    code: "2.8",
    title: "Required Notices and Postings",
    html: `
      <p>We post all required federal and Texas workplace notices (e.g., TWC Texas Payday/Unemployment, EEOC “Know Your Rights,” FLSA minimum wage, and Workers’ Compensation status).</p>
      <ul class="list-disc pl-6">
        <li>HR/Owner maintains current versions and audits quarterly.</li>
        <li>Managers ensure posters are visible and undamaged.</li>
        <li>Employees should review posted notices and direct questions to management.</li>
      </ul>
    `
  }
];

const SECTION_II_CODES = SECTION_II.map(i => i.code);


    // Section III (Hours & Payroll)
   /* ========= SECTION III — Hours of Work & Payroll Practices ========= */
/* Drop this RIGHT BELOW your SECTION_II definition. It works with your
   existing renderer (policyCardTemplate/renderPolicies/etc.). */

const SECTION_III = [
  {
    code: "3.1",
    title: "Pay Periods & Paydays (Texas Payday Law)",
    html: `
      <p><strong>Pay frequency.</strong> The Company pays bi-weekly; payday is every other Friday by direct deposit or check.</p>
      <p><strong>Methods.</strong> Direct deposit is encouraged; paper checks are available when direct deposit is not used.</p>
    `
  },
  {
    code: "3.2",
    title: "Workweek & Hours of Work",
    html: `
      <p><strong>Workweek definition:</strong> The Company’s workweek is Sunday 12:00 a.m. through Saturday 11:59 p.m. This fixed workweek is used to calculate overtime.</p>
      <p><strong>Scheduling:</strong> Managers schedule based on business needs. Employees are expected to be available for assigned shifts and to arrive fit for duty.</p>
      <h3 class="text-lg font-semibold mt-3 mb-1">Scheduling & the Sling App (Employee Setup)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Download the app</strong></li>
        <li>iPhone: Open App Store → search “Sling: Employee Scheduling” → Install.</li>
        <li>Android: Open Google Play → search “Sling: Employee Scheduling” → Install.</li>
        <li class="mt-2 italic">Tip: do not download “Sling TV.” The correct icon says Sling with “Employee Scheduling.”</li>
      </ul>
      <ul class="list-disc pl-6 mt-2">
        <li><strong>Create your account</strong></li>
        <li>Open the app → tap Sign up (or log in if invited previously).</li>
        <li>Use the same email or mobile number you gave Payroll/HR.</li>
        <li>Create a strong password; enable two-factor authentication if prompted.</li>
      </ul>
      <ul class="list-disc pl-6 mt-2">
        <li><strong>Join our workplace</strong></li>
        <li>If you received an invite link by text/email: tap it and follow prompts (you’ll land in Jeng Chi Restaurant automatically).</li>
        <li>If you did not get an invite: open Sling → Join an existing workplace → enter the workplace code provided by your manager/HR or search “Jeng Chi Restaurant (Richardson, TX)” and request access.</li>
      </ul>
      <ul class="list-disc pl-6 mt-2">
        <li><strong>Set your profile & availability</strong></li>
        <li>Tap Profile → add your name and preferred contact.</li>
        <li>Tap Availability to mark regular days/times you can work.</li>
        <li>If needed, submit Time Off requests under Time Off (not guaranteed—subject to business needs).</li>
      </ul>
      <ul class="list-disc pl-6 mt-2">
        <li><strong>Turn on notifications</strong></li>
        <li>In the app: Settings → Notifications → enable Schedule changes, New shifts, Messages, Time off status.</li>
        <li>On your phone: allow Push Notifications for Sling.</li>
      </ul>
      <ul class="list-disc pl-6 mt-2">
        <li><strong>View your schedule</strong></li>
        <li>Tap Schedule → select Week/Month view.</li>
        <li>Accept shifts as required; contact the Manager on Duty in-app if there’s a conflict (do not no-show).</li>
      </ul>
      <p class="mt-2"><strong>Off-the-clock work is not allowed.</strong> Any work performed must be recorded and will be paid.</p>
    `
  },
  {
    code: "3.3",
    title: "Timekeeping (All Employees)",
    html: `
      <p><strong>Record all time worked:</strong> This includes required meetings, mandatory trainings taken during work hours, and any pre-/post-shift duties.</p>
      <p><strong>Missed punch procedure:</strong> If you forget to clock in/out, notify your supervisor the same day.</p>
      <p><strong>Clock window:</strong> Do not clock in earlier than 7 minutes before your shift; more than 7 minutes requires manager approval.</p>
    `
  },
  {
    code: "3.4",
    title: "Timekeeping: Record all training time on your timecard",
    html: `
      <p><strong>When training occurs:</strong> The Company will schedule required training during work hours or at designated times. If you complete required training at a different time without approval, report the time anyway—it will be paid—and we may address the scheduling issue separately through coaching.</p>
      <p><strong>Consequences for non-completion:</strong> Failure to complete required training/renewals on time may result in removal from related duties and/or discipline, up to and including termination, consistent with law and Company policy.</p>
    `
  },
  {
    code: "3.5",
    title: "Timekeeping & Wage Compliance",
    html: `
      <ul class="list-disc pl-6">
        <li>Nonexempt & Exempt employees must accurately record all time spent in required training during work hours.</li>
        <li>Training time cannot be taken simultaneously with other duties.</li>
        <li>Nothing in this policy permits pay to fall below applicable minimum wage or to avoid overtime for compensable training hours in a workweek.</li>
        <li>No off-the-clock work. All work must be recorded. Working without recording time is prohibited. If work occurs, it will be paid; policy violations may lead to discipline.</li>
      </ul>
    `
  },
  {
    code: "3.6",
    title: "Overtime (Nonexempt)",
    html: `
      <p><strong>When owed.</strong> Overtime is paid at 1.5× the regular rate for all hours worked over 40 in a workweek. Only hours actually worked count toward the 40-hour threshold.</p>
      <p><strong>Authorization.</strong> Overtime must be approved in advance by a supervisor. If unapproved overtime occurs, it will be paid and may be addressed through coaching or discipline.</p>
      <p><strong>Multiple rates.</strong> If you work at different rates in the same week, overtime is based on the weighted average regular rate unless a lawful alternative is used.</p>
    `
  },
  {
    code: "3.7",
    title: "Overtime for Tipped Employees (Servers)",
    html: `
      <p>Applies to all Server employees. Overtime is paid at $6.13 per hour for all hours worked over 40 in a single workweek. Overtime must be approved in advance by management unless there’s an emergency.</p>
    `
  },
  {
    code: "3.8",
    title: "Meal & Rest Breaks",
    html: `
      <ul class="list-disc pl-6">
        <li>Texas law does not require meal or rest breaks. When the Company provides a meal period, it is unpaid and you must be fully relieved of duty.</li>
        <li><strong>Clocking:</strong> Non-exempt employees must clock out at the start of an unpaid meal period and clock back in when returning to work. No off-the-clock work.</li>
        <li><strong>Location:</strong> Eat only in designated employee dining areas. Do not eat in food-prep, service pass, cookline, or dish areas. Wash hands before returning to duty.</li>
      </ul>
    `
  },
  {
    code: "3.9",
    title: "Payroll Deductions (Texas Payday Law)",
    html: `
      <p><strong>Required by law:</strong> The Company deducts taxes and other legally required amounts (e.g., child support, tax levies).</p>
      <p><strong>Employee-authorized:</strong> Any other deduction requires a specific, written authorization that states the purpose and exact dollar amount (no blanket/open-ended authorizations).</p>
      <p><strong>Overpayments:</strong> The Company may recover wage overpayments consistent with law; we will notify the employee and may use a reasonable repayment schedule if needed.</p>
    `
  },
  {
    code: "3.10",
    title: "Uniforms & Work Equipment (Deductions)",
    html: `
      <p><strong>Employee-paid uniforms.</strong> Employees are required to obtain and maintain the Company’s designated uniform and appearance standards at their own expense; any payroll deduction must be expressly authorized in writing, state the specific item and exact dollar amount, and comply with the Texas Payday Law. No blanket or open-ended authorizations.</p>
    `
  },
  {
    code: "3.11",
    title: "Wage Garnishments",
    html: `
      <p>Upon receipt of a valid court order or agency notice, the Company will withhold wages as directed until the order is satisfied or we receive a formal release. Employees should provide documentation if they believe an order is satisfied or incorrect.</p>
    `
  },
  {
    code: "3.12",
    title: "Direct Deposit & Lost/Returned Payments",
    html: `
      <p>Direct deposit is encouraged but not required. Employees using direct deposit must keep bank information current. If a direct deposit is returned (closed/incorrect account), the Company will reissue payment on the next regular business day after funds are returned to the Company.</p>
      <p>If a replacement is requested due to reasons not caused by the Company (e.g., employee lost or damaged the check, provided wrong banking information, or failed to update a closed account), the Company may assess a $35 processing fee to cover bank stop-payment/administrative costs.</p>
      <p><strong>Written authorization required (Texas Payday Law):</strong> The fee will only be taken if the employee signs a Payroll Deduction Authorization stating the specific purpose ($35 stop-payment/reissue fee) and exact amount ($35) for that occurrence.</p>
    `
  },
  {
    code: "3.13",
    title: "Pay Statements & Access (MyToast)",
    html: `
      <p><strong>Payroll system of record.</strong> The Company uses Toast Payroll (“Toast”) as the Company’s payroll system of record. All wages are processed in Toast, and the official pay statement (paystub) for each pay period is generated by Toast.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">How to access your paystub in MyToast (mobile app)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Download the app:</strong> iOS (App Store): search “MyToast”; Android (Google Play): search “MyToast”.</li>
        <li><strong>Create or sign in to your account:</strong> Use the personal email on file with Payroll; set a strong password; enable two-factor authentication (optional).</li>
        <li><strong>Find your pay statements:</strong> Open the app → Pay → select a Pay Date → View/Download. Download/Save a PDF (recommended).</li>
        <li><strong>Paper copy:</strong> Request a printed paystub from HR using the Pay Statement (Paystub) Print Request form. Standard processing time: up to 2 business days.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Final Pay (Separations)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Involuntary separation:</strong> Final wages are due within 6 calendar days of discharge.</li>
        <li><strong>Voluntary resignation:</strong> Final wages are due on the next regular payday after the resignation date.</li>
      </ul>
      <p>The Company may not hold a final paycheck past the statutory deadline for reasons like unreturned property; if amounts are owed and allowed, we use lawful deductions with written authorization or other lawful means.</p>
    `
  },
  {
    code: "3.14",
    title: "Payroll Questions & Disputes",
    html: `
      <p><strong>Who to contact.</strong> Report any pay discrepancy to HR/Payroll in writing as soon as you discover it (ideally within 2 business days of payday).</p>
      <p><strong>Investigation & correction.</strong> HR will review time records and pay data and respond within 3 business days; any confirmed underpayment will be corrected on the next regular payroll.</p>
    `
  },
  {
    code: "3.15",
    title: "Tips & Gratuities Policy (Texas) — Pooling, Credit-Card Tips & Processing Fees",
    html: `
      <p><strong>Scope & Purpose.</strong> This policy applies to all tipped and non-tipped employees at Jeng Chi Restaurant (JCR) and governs tips, tip pooling, credit-card tips and associated processing fees, service charges, and required legal notices under federal law (FLSA) and Texas law (Texas Payday Rules).</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Definitions</h3>
      <ul class="list-disc pl-6">
        <li><strong>Tip:</strong> A voluntary amount a guest leaves for service. Tips are the employee’s property except as set out in a valid tip pool.</li>
        <li><strong>Credit-Card Tip:</strong> A tip left by a guest as part of a payment by credit or debit card.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Core Rules (FLSA/Texas Compliance)</h3>
      <ul class="list-disc pl-6">
        <li>JCR does not keep employees’ tips. Managers and Back of the House are prohibited from keeping any portion of employees’ tips or receiving tips from a tip pool.</li>
        <li>Tip pools will be operated only as allowed by law and this policy, with full and prompt distribution on or before the regular payday for the workweek (or as soon as practicable thereafter if necessary for payroll).</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Credit-Card Processing Fees on Tipped Amounts</h3>
      <p>When a guest leaves a tip on a credit or debit card, JCR may deduct from the employee’s credit/debit card tip an amount equal to the actual percentage processing fee charged by the card processor on that tip amount, not to exceed three percent (3%). If the actual processing percentage is lower than 3%, only the lower actual percentage will be deducted.</p>
      <p><strong>Acknowledgment.</strong> Employees must sign the acknowledgments and any applicable authorizations attached to this policy. Refusal to sign required legal notices may affect eligibility for a tip credit or participation in a tip pool.</p>
    `
  }
];

const SECTION_III_CODES = SECTION_III.map(i => i.code);


    // Section IV (Conduct)
    /* ========= SECTION IV — Standards of Conduct ========= */
/* Paste this below your SECTION_III block. It uses the same renderer. */

const SECTION_IV = [
  {
    code: "4.1",
    title: "Zero-Tolerance Policy (Safety, Integrity & Respect)",
    html: `
      <p><strong>Purpose.</strong> To protect employees, guests, and the business, Jeng Chi Restaurant maintains zero tolerance for conduct that seriously endangers safety, violates law, or undermines trust. This policy applies to employees, managers, owners, contractors, vendors, and guests while on Company time or premises.</p>
      <p><strong>What “zero tolerance” means.</strong> Reports are acted on immediately; employees may be removed from duty pending review. If facts are confirmed, the Company may proceed directly to final discipline up to and including termination on the first offense, consistent with our investigation process and applicable law. See Speak-Up & Investigation and Anti-Retaliation below, and 5.4 Zero-Tolerance / Immediate-Termination Offenses for examples.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Zero-tolerance categories (non-exhaustive)</h3>
      <ol class="list-decimal pl-6">
        <li>Unlawful harassment or discrimination based on any protected status; retaliation for reporting or participating in an investigation.</li>
        <li>Violence, threats, intimidation, or weapons on premises.</li>
        <li>Theft, fraud, or serious dishonesty (e.g., stealing cash/merchandise, deliberate POS manipulation).</li>
        <li>Serious safety or food-safety endangerment, including willful bypass of critical controls; working while knowingly ill with restricted symptoms; refusing to stop food handling when directed.</li>
        <li>Illicit drugs at work; sale/distribution; on-duty impairment that creates a safety risk; refusal to comply with reasonable safety measures.</li>
        <li>Wage/timekeeping fraud (e.g., off-the-clock direction or falsification); egregious cash-handling violations.</li>
      </ol>
      <p><strong>Mandatory reporting.</strong> Report immediately to any Manager on Duty or HR/Owner; you may bypass your supervisor. The Company investigates promptly and as confidentially as practicable. Retaliation is itself a zero-tolerance violation.</p>
      <p><strong>Due process & documentation.</strong> We will review facts (interviews, POS/camera logs, documents) and decide discipline based on severity, intent, impact, and prior record. Findings and required corrective actions will be documented and shared with the employee.</p>
      <p><strong>Management approval & exceptions.</strong> Only a written determination by Janelle Teng or Francisco Teng may authorize any exception to this policy, and any exception must remain compliant with law and Company standards.</p>
    `
  },
  {
    code: "4.2",
    title: "Anti-Harassment / Anti-Discrimination & Diversity",
    html: `
      <p><strong>Policy Statement.</strong> Jeng Chi Restaurant prohibits harassment, discrimination, and retaliation based on any status protected by law (for example: race, color, religion, sex—including pregnancy—sexual orientation, gender identity, national origin, age, disability, genetic information, veteran status, or any other status protected by federal, Texas, or local law). We will act promptly and appropriately once we know or should know about a concern.</p>
    `
  },
  {
    code: "4.3",
    title: "Diversity & Inclusion Commitment",
    html: `
      <p>We value a workforce that reflects many backgrounds and perspectives. We strive to: (1) hire, promote, pay, and schedule based on merit and business needs; (2) build respectful teams; (3) provide reasonable accommodations for disability and religion; and (4) offer fair processes to report and resolve concerns without fear of retaliation.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Definitions (Plain Language)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Discrimination</strong> – An adverse job action (e.g., firing, demotion, pay cut, schedule cut, denial of training) because of a protected status.</li>
        <li><strong>Harassment</strong> – Unwelcome conduct based on a protected status that is severe or pervasive enough to create a hostile, intimidating, or offensive work environment, or that results in a job decision.</li>
        <li><strong>Sexual harassment</strong> – Unwelcome sexual advances, requests for sexual favors, or other verbal/physical conduct of a sexual nature and hostile environment.</li>
        <li><strong>Retaliation</strong> – Any adverse action because someone reported a concern, requested accommodation, or participated in an investigation. Retaliation is strictly prohibited.</li>
      </ul>
    `
  },
  {
    code: "4.4",
    title: "Examples of Prohibited Conduct (Not Exhaustive)",
    html: `
      <ul class="list-disc pl-6">
        <li><strong>Verbal/Visual:</strong> slurs, epithets, insults, demeaning jokes or memes; repeated misgendering; derogatory comments about accent, disability, or religion; displaying offensive images or symbols at work or in work chats.</li>
        <li><strong>Physical:</strong> unwanted touching, blocking movement, assault, intimidation.</li>
        <li><strong>Sexual:</strong> sexual advances, comments about body/sex life, lewd messages, requests for dates after a “no,” quid-pro-quo arrangements.</li>
        <li><strong>Electronic/Online:</strong> texts, DMs, group chats, social media, or collaboration tools that target coworkers or affect the workplace.</li>
        <li><strong>Third Parties:</strong> customers, vendors, delivery drivers, or visitors who harass employees. We will intervene and take corrective steps.</li>
      </ul>
    `
  },
  {
    code: "4.5",
    title: "Speak-Up & Investigation Policy",
    html: `
      <p><strong>Zero tolerance</strong> for unlawful harassment, discrimination, or retaliation.</p>
      <p><strong>How to report:</strong> Tell any manager, your supervisor, or HR/Owner—you may bypass your supervisor.</p>
      <p><strong>Fast response:</strong> We aim to acknowledge within 1 business day and begin review within 1–3 business days.</p>
      <p><strong>Confidentiality:</strong> We protect privacy to the extent possible while investigating.</p>
      <p><strong>No retaliation:</strong> Protected for reporting in good faith or participating in a review—even if not substantiated.</p>
    `
  },
  {
    code: "4.6",
    title: "Our Investigation (What Happens Behind the Scenes)",
    html: `
      <ol class="list-decimal pl-6">
        <li><strong>Start:</strong> Target 1–3 business days after notice.</li>
        <li><strong>Reviewer:</strong> HR/Owner (impartial).</li>
        <li><strong>Evidence:</strong> Interviews of complainant, respondent, witnesses; collection of documents, chats, schedules, and available video.</li>
        <li><strong>Standard of proof:</strong> Preponderance of the evidence (“more likely than not”).</li>
        <li><strong>Corrective actions (as warranted):</strong> coaching/training, written or final warning, suspension, removal from guest areas, vendor or third-party restrictions, or termination.</li>
        <li><strong>Closing notice:</strong> Complainant receives confirmation the matter was reviewed and addressed.</li>
        <li><strong>Records:</strong> Investigation files kept in a restricted HR file and retained at least 1 year (longer if required by law or Company policy).</li>
      </ol>
    `
  },
  {
    code: "4.7",
    title: "Anti-Retaliation (Zero Tolerance)",
    html: `
      <p>The Company prohibits retaliation against anyone who in good faith reports a concern, asks for accommodation, or participates in a review. Retaliation includes actions that could deter a reasonable person from speaking up (e.g., threats, schedule cuts, undesirable reassignment, isolation). Report suspected retaliation immediately; we will review and correct.</p>
    `
  },
  {
    code: "4.8",
    title: "Professional Boundaries & No Horseplay",
    html: `
      <p><strong>Applies to:</strong> All employees, managers.</p>
      <p><strong>Purpose:</strong> Maintain a safe, respectful, and professional workplace free from harassment, distractions, and preventable injuries.</p>
      <p><strong>Zero Tolerance Areas:</strong> Physical contact or behavior that could reasonably make someone uncomfortable, feel unsafe, or create a harassment risk is prohibited. Safety-risk behavior (horseplay) is also prohibited. This policy supplements our EEO/Anti-Harassment Policy and Code of Conduct.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Definitions (Plain Language)</h3>
      <ul class="list-disc pl-6">
        <li><strong>Horseplay:</strong> Pranks, roughhousing, running, shoving, tripping, throwing/spraying items, blocking paths/doors, pulling chairs, startling others, or any game-like behavior that distracts from work or creates hazard.</li>
        <li><strong>Unprofessional Physical Contact:</strong> Any unnecessary touch not required for the job—e.g., shoulder rubbing, back/neck massage, hugging, tickling, lap sitting, patting, touching or grooming someone’s hair, braiding, applying makeup, or similar conduct.</li>
        <li><strong>Consent & Power Imbalance:</strong> Even if someone says a behavior is “okay,” it may still be unwelcome or coercive when there’s a power imbalance or workplace pressure. “Mutual” behavior can still violate policy if it affects others or the work environment.</li>
        <li><strong>Incidental Job-Related Contact (allowed):</strong> Brief, necessary contact to hand items, guide a tray/cart, or render first aid. Keep contact minimal and professional and announce movements (e.g., “behind,” “corner hot”).</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Prohibited Conduct (Examples — not exhaustive)</h3>
      <ul class="list-disc pl-6">
        <li>No horseplay anywhere, especially near hot equipment, knives, fryers/steamer, dish area, storage rooms, or guest areas.</li>
        <li>No touching that isn’t required for work: no shoulder rubbing, massages, hair touching/grooming, hugging, lap sitting, playful shoving, or similar.</li>
        <li>No pranks or physical jokes (e.g., hiding tools, blocking aisles, flicking towels, spraying water/condiments).</li>
        <li>No body/appearance comments or innuendo; no suggestive or explicit remarks, gestures, images, or sounds.</li>
        <li>No retaliation against anyone who refuses contact, sets a boundary, or reports concerns.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Professional Greetings & Exceptions</h3>
      <ul class="list-disc pl-6">
        <li>Handshakes/fist bumps may be appropriate only if clearly welcome and must be brief.</li>
        <li>Job-required contact (e.g., assisting a fall, first aid) is permitted; notify MOD and complete an incident report.</li>
        <li>Cultural greetings should be verbal or non-contact in work areas.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Reporting & Response</h3>
      <ul class="list-disc pl-6">
        <li>Report to any supervisor/MOD or HR.</li>
        <li>Reports are taken seriously and investigated promptly. We share information only with those who need to know.</li>
        <li>No retaliation: Anyone who retaliates will face corrective action, up to termination.</li>
      </ul>
      <p><strong>Consequences.</strong> Violations of this policy may result in corrective action up to and including termination. Severity, frequency, intent, impact, and safety risk will guide the response. See Discipline & Corrective Action section below.</p>
      <p><strong>Acknowledgment.</strong> Employees must acknowledge receipt and understanding via the Handbook Acknowledgment. Refusal to sign is noted with a witness signature.</p>
    `
  },
  {
    code: "4.9",
    title: "Workplace Searches & Monitoring",
    html: `
      <p><strong>Scope.</strong> “Company Property” includes: offices, desks, file drawers, cabinets, lockers issued by the Company, POS systems, Company-owned devices (computers/phones/tablets), email/voicemail/accounts provisioned by the Company, and Company vehicles.</p>
      <p><strong>Right to inspect.</strong> The Company may inspect Company Property at any time, with or without notice. Employees should not expect privacy in Company Property.</p>
      <p><strong>Personal items (on premises).</strong> Bags, containers, and personal vehicles on Company premises may be inspected with the employee’s consent where allowed by law.</p>
      <p><strong>Electronic monitoring (notice).</strong> Company systems (POS, networks, email, business messaging) may be monitored, logged, and reviewed for business, safety, security, and legal compliance. Do not use Company systems for communications you wish to remain private.</p>
      <p><strong>Professional and nondiscriminatory.</strong> Searches/monitoring will be conducted professionally and without discrimination or retaliation. Any direction to maintain confidentiality will be narrow and time-limited (for example, during an active investigation to protect evidence/witnesses).</p>
      <p><strong>Cooperation.</strong> Employees must cooperate in inspections of Company Property. Refusal is insubordination and may lead to discipline up to termination.</p>
    `
  },
  {
    code: "4.10",
    title: "Personal Cell Phone & Earbud Policy",
    html: `
      <p><strong>Purpose.</strong> Maintain guest focus, safety, and productivity; prevent injuries and food-safety risks.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Baseline rules</h3>
      <ul class="list-disc pl-6">
        <li>Phones silent/out of sight while working. Personal use limited to authorized breaks or manager-approved urgent matters.</li>
        <li>No earbuds/headphones in guest areas and Back of House. Exceptions only for a work-approved task/training away from hazards and with manager approval.</li>
        <li><strong>Prohibited during work:</strong> personal calls/chats, social media browsing, gaming, studying/reading for non-work purposes.</li>
        <li><strong>Allowed for work:</strong> business calls, urgent Company messages, productivity apps as assigned.</li>
      </ul>
      <p><strong>Safety.</strong> Never use a phone while walking in BOH, carrying hot items/knives, or operating equipment. Observe no-phone zones as posted.</p>
      <p><strong>Emergencies.</strong> Brief personal calls for emergencies are allowed with manager awareness and away from guest/food-prep areas.</p>
      <p><strong>Enforcement.</strong> Progressive discipline up to termination.</p>
      <p><strong>Protected rights.</strong> Nothing here restricts lawful protected concerted activity (e.g., discussing wages, hours, or working conditions).</p>
    `
  },
  {
    code: "4.11",
    title: "No Smoking, Vaping, Chewing Gum, Dipping",
    html: `
      <p><strong>Covered products.</strong> Cigarettes, e-cigarettes/vapes, cigars, pipes, smokeless tobacco, and similar products.</p>
      <p><strong>Where prohibited.</strong> No use inside or within the posted distance of entrances/exits and guest areas. No gum while on duty.</p>
      <p><strong>Designated area.</strong> Use only the designated outdoor spot, out of guest sight, during authorized breaks. Wash hands before returning to duty.
      <p><strong>Smoke break limit.</strong> One brief smoke break per shift may be permitted at manager discretion and must not interfere with operations.</p>
      <p><strong>Local rules control.</strong> Where local ordinances or landlord rules are stricter, those rules control.
      <p><strong>Enforcement.</strong> Progressive discipline up to termination.</p>
    `
  },
  {
    code: "4.12",
    title: "Personal Errands While on the Clock",
    html: `
      <p><strong>Not permitted.</strong> Personal errands are not allowed on Company time. For urgent matters, request manager approval to clock out and leave.</p>
      <p><strong>Company errands.</strong> Tasks like grocery runs, storage trips, DCCC, mailbox or bank drops require manager authorization; you must be on the clock and follow timekeeping rules (no off-the-clock work). Follow any cash-handling/chain-of-custody SOP.</p>
    `
  },
  {
    code: "4.13",
    title: "Employee Bar Policy",
    html: `
      <ul class="list-disc pl-6">
        <li>Must be 18+ to work behind the bar; 21+ to consume alcohol (off duty).</li>
        <li><strong>On duty:</strong> absolutely no alcohol.</li>
        <li><strong>Off duty:</strong> employees may patronize the bar only if off shift, 21+, out of uniform, and not interfering with operations; limit 2 employees as customers at a time; manager may refuse service.</li>
        <li>All alcohol service must comply with TABC rules and Company ID/over-service SOPs.</li>
      </ul>
    `
  },
  {
    code: "4.14",
    title: "FOH Order Integrity & Guest Service",
    html: `
      <p><strong>Applies to:</strong> Servers, Bartenders, Hosts, Cashiers.</p>
      <p><strong>Purpose & Scope.</strong> Maintain 100% accuracy and honesty in ordering, charging, packing, and collecting payment for all service channels (dine-in, bar, to-go, phone, online), and ensure fair guest assignment and non-discriminatory service.</p>

      <h3 class="text-lg font-semibold mt-2 mb-1">Core Duties by Role</h3>
      <ul class="list-disc pl-6">
        <li><strong>Servers/Bartenders:</strong> Ring every item in POS before serving; verify age/ID for alcohol; monitor tabs; follow the close-out procedure; confirm payment before leaving the area.</li>
        <li><strong>Hosts:</strong> Seat per rotation rules; communicate section changes; never re-assign guests without manager approval; support to-go staging if assigned.</li>
        <li><strong>Cashiers:</strong> Verify order and payment method; match receipts; secure cash, cards, and gift cards; close checks accurately.</li>
        <li><strong>Managers (MOD):</strong> Enforce ring-before-serve/pack; maintain fair seating rotation; approve comps/voids/discounts/price edits in POS with reason code + note; run integrity reports and investigate anomalies same shift; manage tills/paid-outs/deposits/drawers; enforce packing checklist and second-person verification on large/high-risk orders; support alcohol decisions; ensure allergen prompts and confirm high-risk orders; coach on floor and assign targeted retraining; lead incident response for walk-outs/fraud and document actions.</li>
        <li><strong>All FOH:</strong> Use checklists.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-2 mb-1">Daily Controls (Managers & FOH)</h3>
      <ul class="list-disc pl-6">
        <li><strong>POS integrity:</strong> No free items unless a manager-approved promo is applied correctly in POS.</li>
        <li><strong>Required reports each shift:</strong> Open checks; comps/discounts; voids; re-fires; price edits; cash over/short. Investigate anomalies.</li>
        <li><strong>Packing accuracy:</strong> Use the packing checklist; second-person verification for large or high-risk orders.</li>
        <li><strong>Retraining triggers:</strong> Patterns of errors → targeted retraining, refresher quiz, and manager sign-off.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-2 mb-1">Prohibited Conduct (Examples)</h3>
      <ul class="list-disc pl-6">
        <li>Failing to ring items; serving without a POS entry; unapproved comps/voids/discounts; holding open checks to avoid payment.</li>
        <li>Cash-handling violations; manipulating tips or tip lines; altering receipts.</li>
        <li>Bypassing allergen prompts or packing checks; ignoring second-verification on large orders.</li>
        <li>Transferring tables without approval; re-assigning to steer guests or for personal advantage.</li>
        <li>Dishonesty in any audit/investigation.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-2 mb-1">Core Expectations</h3>
      <ul class="list-disc pl-6">
        <li>Ring before serve/pack; manager-approved promos only.</li>
        <li>Follow the close-out process and confirm payment before moving on.</li>
        <li>Use packing checklists and request second-person verification for large/high-risk orders.</li>
        <li>Secure cash/cards, match receipts, follow ID/age checks and allergen prompts.</li>
        <li>No unapproved comps/voids/discounts.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-2 mb-1">Payment Verification & “Walk-Outs”</h3>
      <p><strong>Negligence (definition):</strong> Handing a payment device to a guest and leaving without timely verification, or failing to follow the Company’s close-out procedure.</p>
      <ol class="list-decimal pl-6">
        <li>Notify the Manager on Duty immediately (do not pursue guests).</li>
        <li>Preserve evidence: note table, time, guest description; retain the check; identify witnesses.</li>
        <li>Manager reviews camera footage and POS logs and determines next steps (e.g., voids, police report if appropriate).</li>
      </ol>
    `
  },
  {
    code: "4.15",
    title: "Dress Code & Uniform Standards",
    html: `
      <h3 class="text-lg font-semibold mt-1 mb-1">Back-of-House (BOH) — Dishwashers, Line Cooks, Wok Chefs, Prep Cooks, Pastry Chefs, Dumpling Makers, Noodle Makers</h3>
      <ul class="list-disc pl-6">
        <li>Solid black jeans or dark blue jean or Chef Pants. Not allowed: rips/holes, heavy fading, baggy or excessively tight fits, leggings/jeggings, yoga pants, sweatpants, shorts, or capris.</li>
        <li>Solid plain top with no logos/graphics (short or long sleeve). May be worn under the chef coat; undershirts must be solid black/white/gray with no visible branding.</li>
        <li>Closed-toe, closed-heel, slip-resistant, non-absorbent shoes. No canvas slip-ons, open backs, sandals, or heels.</li>
        <li><strong>Company-issued items (provided):</strong> Chef coat, BOH hat, and white bib apron. Wear on shift and place in laundry bin at shift end. Items remain Company property and must be returned at separation. If you arrive without your BOH hat, you must wear a hairnet for that shift.</li>
        <li>Hair fully restrained under hat (hairnet as needed). Beard guard required where facial hair poses a contamination risk.</li>
        <li>Piercings to meet food-safety and sanitation standards; visible facial piercings must be removed or replaced with clear retainers while working. Ear jewelry limited to small, low-profile studs only; no hoops, gauges, or dangling items.</li>
        <li>Nails short, clean, natural (not extending past fingertips). No artificial nails, nail charms, or nail polish in food-prep areas.</li>
        <li>Fragrance: fragrance-free.</li>
        <li>Tattoos: Not on face/neck/hands and never with content that is profane, sexually explicit, violent, or otherwise offensive. Tattoos with prohibited content must be covered. Policy enforced uniformly and without regard to race or protected status.</li>
        <li>Religious head coverings and cultural hairstyle pair with a food-safety restraint in BOH.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-3 mb-1">Front-of-House (FOH) — Servers, Bartenders, Hosts, Cashiers, Bussers</h3>
      <ul class="list-disc pl-6">
        <li>Jeng Chi black logo polo; black slacks or black jeans (no rips, fading, baggy styles, leggings/jeggings, yoga pants, or sweatpants); belt if loops; black socks covering the ankle; closed-toe slip-resistant shoes.</li>
        <li>Seasonal layers: Jeng Chi logo fleece vest or jacket; black undershirts permitted.</li>
        <li>Apron (Servers & Bussers): Company specialty apron, clean and worn properly.</li>
        <li>Hair: Neat, clean, and secured away from the face (ponytail, bun, braid, or clip).</li>
        <li>Piercings: modest ear studs allowed; one small nose stud permitted. Septum, lip, and Monroe piercings may not be worn or visible in guest areas. Multiple ear-cartilage piercings must use small, low-profile jewelry (no hoops/dangling).</li>
        <li>Nails: FOH may wear polish if neat and unchipped; no exaggerated length or sharp/ornate acrylics that pose safety or sanitation concerns.</li>
        <li>Tattoos: Not on face/neck/hands and never with prohibited content; cover as needed. Enforced uniformly without regard to protected status.</li>
        <li>Fragrance: fragrance-free.</li>
        <li>Religious head coverings and cultural hairstyles; pair with a food-safety restraint in FOH.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-3 mb-1">Laundry & Care</h3>
      <ul class="list-disc pl-6">
        <li>Uniforms must be clean at the start of the shift. BOH coats/aprons go in the laundry basket nightly.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-3 mb-1">Costs & Deductions</h3>
      <ul class="list-disc pl-6">
        <li>If employees purchase required uniforms from the Company, any payroll deduction must be expressly authorized in writing, state the exact item and dollar amount, and cannot reduce pay below minimum wage or interfere with overtime in that workweek.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-3 mb-1">Care, Compliance & Enforcement</h3>
      <ul class="list-disc pl-6">
        <li>Employees out of compliance may be asked to correct immediately or be reassigned until compliant. Non-exempt employees sent home to change are off the clock unless otherwise required by law.</li>
        <li>Repeated or serious violations may lead to progressive discipline up to termination.</li>
      </ul>
    `
  }
];

const SECTION_IV_CODES = SECTION_IV.map(i => i.code);


    // Section V (Discipline)
    /* ========= SECTION V — Discipline & Corrective Action ========= */
/* Paste this below your SECTION_IV block. It uses the same renderer. */

const SECTION_V = [
  {
    code: "5.0",
    title: "Purpose & Principles; Definitions",
    html: `
      <h3 class="text-lg font-semibold mb-1">Purpose & Principles</h3>
      <ol class="list-decimal pl-6">
        <li>Maintain a safe, respectful, and lawful workplace.</li>
        <li>Apply standards consistently and without discrimination/retaliation.</li>
        <li>Use progressive discipline to correct conduct and performance where appropriate.</li>
        <li>The Company may deviate or skip steps (up to immediate termination) based on the facts and business needs, consistent with law.</li>
      </ol>
      <h3 class="text-lg font-semibold mt-3 mb-1">Definitions</h3>
      <ul class="list-disc pl-6">
        <li><strong>Coaching/Documented Conversation (“Verbal Warning”)</strong>: A formal, documented talk stating the issue, expectations, and a Corrective Action Plan (CAP) with a defined improvement window.</li>
        <li><strong>Written Warning</strong>: A formal, documented warning with expectations and a CAP; may be designated as <em>Final Written Warning</em> when one step short of termination.</li>
        <li><strong>Termination</strong>: End of employment.</li>
      </ul>
    `
  },
  {
    code: "5.1",
    title: "Standard Progressive Path",
    html: `
      <p>Unless otherwise stated below or facts warrant skipping steps:</p>
      <ul class="list-disc pl-6">
        <li><strong>Step 1</strong> – Verbal Warning #1 + CAP (Documented) → Improvement window: 1 week</li>
        <li><strong>Step 2</strong> – Verbal Warning #2 + CAP (Documented) → Improvement window: 1 week</li>
        <li><strong>Step 3</strong> – Written Warning #1 + CAP (specific steps, check-ins) → Improvement window: up to 2 weeks</li>
        <li><strong>Step 4</strong> – Written Warning #2 + CAP (or Final Written Warning, depending on severity)</li>
        <li><strong>Step 5</strong> – Termination</li>
      </ul>
    `
  },
  {
    code: "5.2",
    title: "Cross-Policy Progression (No Reset)",
    html: `
      <p>Warnings accumulate across policies. Breaking a different policy while on a CAP does not reset the ladder; we continue to the next step in the progression.</p>
      <p><em>Example:</em> If you’re on Verbal #2 for attendance and commit a safety violation, we move to Written #1.</p>
      <p><strong>Manager discretion:</strong> For egregious conduct, the Company may skip directly to Final Written or Termination.</p>
    `
  },
  {
    code: "5.3",
    title: "Documentation & Timelines",
    html: `
      <ol class="list-decimal pl-6">
        <li>Each step includes: date, policy violated, facts, expectations, improvement window, training (if any), and consequences of not improving.</li>
        <li>Managers provide a copy to the employee and forward to HR for the restricted personnel file.</li>
        <li>Refusal to sign an acknowledgment is noted; the warning is still effective.</li>
      </ol>
    `
  },
  {
    code: "5.4",
    title: "Zero-Tolerance / Immediate-Termination Offenses (Examples)",
    html: `
      <p>The Company may proceed directly to termination for any of the following, even if there is no prior discipline (investigation still required):</p>
      <ol class="list-decimal pl-6">
        <li>Violence/Fighting.</li>
        <li>Theft, fraud, or serious dishonesty (e.g., stealing cash/merchandise, deliberate POS manipulation).</li>
        <li>Harassment, discrimination, or retaliation that is severe, pervasive, or clearly violates law or policy.</li>
        <li>Serious safety/food-safety endangerment (willful bypass of critical controls; working while knowingly ill with restricted symptoms; refusing to stop food handling when directed).</li>
        <li>Illicit drugs at work; sale/distribution on premises; impairment creating a safety risk with refusal to comply with reasonable measures.</li>
      </ol>
      <p>We will still investigate before deciding on termination; if facts are confirmed, termination may occur immediately.</p>
    `
  },
  {
    code: "5.5",
    title: "Attendance & Punctuality – Specific Ladder",
    html: `
      <ul class="list-disc pl-6">
        <li>Call-in rule and timing must be followed (see Attendance Policy).</li>
        <li>Doctor’s notes: If required by policy (e.g., after 3+ consecutive full days, post-warning, or safety-sensitive illness), the note should confirm fitness for duty or restrictions (no diagnosis). Consider ADA/FMLA rights.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Example progression</h3>
      <ul class="list-disc pl-6">
        <li>1st late/miss (within 60 days): Verbal #1 + CAP (documented) → Improvement window: 1 week</li>
        <li>2nd late/miss (within window): Verbal #2 + 1-week window + CAP</li>
        <li>3rd late/miss (within window): Written #1 + CAP (targeted schedule counseling)</li>
        <li>4th late/miss (within window): Written #2 (or Final Written, if disruption is severe)</li>
        <li>5th late/miss: Termination</li>
      </ul>
      <p><strong>No-call/no-show:</strong> May result in Final Written or Termination on the first occurrence, depending on impact and prior record.</p>
    `
  },
  {
    code: "5.6",
    title: "Fights, Threats & Workplace Violence",
    html: `
      <ol class="list-decimal pl-6">
        <li><strong>Mutual fighting</strong>: Termination for both, absent credible evidence of legitimate self-defense.</li>
        <li><strong>Retreat vs. hitter</strong>: If one disengages/retreats and the other continues to hit, the hitter is terminated; the retreating party may receive coaching or no discipline depending on facts.</li>
        <li><strong>Threats/credible intimidation</strong>: Final Written up to Termination, depending on severity.</li>
        <li>Always conduct an immediate safety response and prompt investigation (review camera footage, witness statements, incident reports).</li>
      </ol>
    `
  },
  {
    code: "5.7",
    title: "Dishonesty, Theft & Wage/Time Integrity",
    html: `
      <p><strong>Theft or attempted theft</strong> (Company/guest/employee property) → Termination. The Company may refer matters to law enforcement or pursue civil recovery.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Timekeeping & Wage Integrity</h3>
      <ul class="list-disc pl-6">
        <li>Off-the-clock work, buddy punching → Verbal → Verbal → Written → Written → Termination (or skip steps if willful/recurring).</li>
        <li>All worked time will be paid; working without authorization may result in discipline.</li>
      </ul>
    `
  },
  {
    code: "5.8",
    title: "Unprofessional / Disrespectful Conduct (Employees ↔ Managers/Owners)",
    html: `
      <ul class="list-disc pl-6">
        <li>Yelling, abusive language, harassment, or insubordination:
          <ul class="list-disc pl-6 mt-1">
            <li>Verbal #1 → Verbal #2 → Written #1 (+ CAP on professional conduct) → Written #2/Final → Termination.</li>
            <li>Severe incidents (e.g., slurs, targeted harassment) may skip steps.</li>
          </ul>
        </li>
      </ul>
    `
  },
  {
    code: "5.9",
    title: "Social Media & Communications",
    html: `
      <ol class="list-decimal pl-6">
        <li><strong>Prohibited:</strong> Posting confidential information, doxxing, threats/harassment, discriminatory content, or misusing logos/uniforms in a way that implies Company endorsement.</li>
        <li><strong>Protected:</strong> Nothing here restricts lawful protected concerted activity (e.g., discussing wages/safety/working conditions).</li>
        <li><strong>Discipline:</strong> Final Written up to Termination for violations that harass, disclose confidential business info, threaten, or materially disrupt operations.</li>
        <li>“Automatic termination” language is replaced with “up to termination” to ensure we assess context and protected activity.</li>
      </ol>
    `
  },
  {
    code: "5.10",
    title: "Drugs, Alcohol & Impairment",
    html: `
      <p>Arriving impaired or becoming impaired on duty: remove from duty, arrange safe transport home, and issue discipline per the ladder (Verbal → Written(s) → Termination) unless severity or recurrence warrants skipping steps.</p>
    `
  },
  {
    code: "5.11",
    title: "Harassment, Discrimination & Retaliation",
    html: `
      <ol class="list-decimal pl-6">
        <li>Zero tolerance for unlawful harassment/discrimination/retaliation.</li>
        <li>Discipline: Written, Final Written, or Termination, depending on severity and findings (investigation required). Interim measures and no-contact may apply.</li>
        <li>Retaliation for reporting or participating in an investigation is itself a stand-alone violation subject to Final Written up to Termination.</li>
      </ol>
    `
  },
  {
    code: "5.12",
    title: "Corrective Action Plans (CAPs)",
    html: `
      <p>Each Verbal/Written/Final Written includes a CAP with:</p>
      <ul class="list-disc pl-6">
        <li>What to fix (policy, behavior, or metric),
        <li>How to fix it (training, checklists, coaching),
        <li>Who & when (responsible manager; dates),
        <li>The window for improvement (1–2 weeks unless otherwise stated),
        <li>How success is measured (attendance %; error-free orders; no further incidents; guest feedback),
        <li>Consequences if not met (next step up to termination).
      </ul>
    `
  },
];

/* --- START DEDUPED SECTION V CONTENT --- */
const SECTION_V_SUPPLEMENT = [
  {
    code: "5.13",
    title: "Benefits & PTO on Separation",
    html: `
      <ul class="list-disc pl-6">
        <li>Accrued PTO payout follows the Company’s PTO policy and any plan document. (Texas law allows employers to define payout rules by policy.)</li>
        <li>Unless a plan document states otherwise, unused PTO is not paid at termination (voluntary or involuntary).</li>
      </ul>
    `
  },
  {
    code: "5.14",
    title: "Resignation (Two-Weeks’ Notice) & How to Submit",
    html: `
      <h3 class="text-lg font-semibold mb-1">Purpose</h3>
      <p>Provide a clear, consistent process for employees to resign, ensure smooth handoffs, and comply with Texas Payday Law and federal rules.</p>
      <p><strong>At-Will Reminder.</strong> Employment is at-will. Either the employee or the Company may end employment at any time, with or without cause or advance notice, consistent with law.</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Notice Expectation (Two Weeks)</h3>
      <ul class="list-disc pl-6">
        <li>The Company requests at least two (2) weeks’ written notice for most roles so we can schedule coverage and transition duties.</li>
        <li>Longer notice is appreciated for supervisory/critical roles; discuss timing with your manager/HR.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">How to Submit Your Resignation</h3>
      <p>Employees must use one of the following: <em>Resignation Notice Form</em> (available from HR/Manager).</p>
    `
  },
  {
    code: "5.15",
    title: "Company Acceptance / Scheduling During Notice",
    html: `
      <ul class="list-disc pl-6">
        <li>Management will confirm your last working day in writing.</li>
        <li>Schedules during the notice period are set by business needs. The Company may adjust, reduce, or release you earlier (pay only for hours worked).</li>
      </ul>
    `
  },
  {
    code: "5.16",
    title: "Conduct During Notice (Discipline Still Applies)",
    html: `
      <ul class="list-disc pl-6">
        <li>All policies remain in force during the notice period.</li>
        <li>If you violate policy during your notice (two-week or longer), the Company will apply the Discipline & Corrective Action process. Depending on severity, the Company may skip steps and end employment immediately.</li>
        <li>Performance/attendance expectations do not change during notice.</li>
      </ul>
    `
  },
  {
    code: "5.17",
    title: "Job Abandonment (No-Call/No-Show)",
    html: `
      <ul class="list-disc pl-6">
        <li>Failing to report or call in for two (2) consecutive scheduled shifts may be treated as job abandonment and separation as of the last day worked.</li>
        <li>Job abandonment during a notice period may result in ineligible-for-rehire status.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Final Pay, Tips & Benefits</h3>
      <ul class="list-disc pl-6">
        <li>Final wages for voluntary resignations are paid on the next regular payday.</li>
        <li>PTO payout follows the Company’s PTO policy/plan documents.</li>
        <li>Update your mailing address and email for W-2 or other year-end forms.</li>
      </ul>
      <h3 class="text-lg font-semibold mt-2 mb-1">Rehire Eligibility</h3>
      <p>Rehire status depends on overall record, transition cooperation, and policy compliance during notice. Proper notice, working as scheduled, and returning property improves eligibility; separations for policy violations or job abandonment are generally not eligible.</p>
    `
  },
  {
    code: "5.18",
    title: "Discipline & Corrective Action (FOH: Order Integrity & Guest Service)",
    html: `
      <p><strong>Purpose.</strong> Correct issues quickly, protect revenue and guest trust, and apply standards consistently, lawfully, and without retaliation to all FOH team members (servers, bartenders, hosts, cashiers).</p>
      <h3 class="text-lg font-semibold mt-2 mb-1">Payment Verification & “Walk-Outs”</h3>
      <p><strong>Expectation.</strong> Follow the Company close-out process and confirm payment before leaving the area.</p>
      <p><strong>Negligence (definition).</strong> Handing a payment device to a guest and leaving without timely verification, or failing to follow the Company’s close-out procedure.</p>
      <h4 class="font-semibold mt-2 mb-1">Required response if a guest leaves without paying</h4>
      <ol class="list-decimal pl-6">
        <li>Notify the Manager on Duty immediately (do not pursue guests).</li>
        <li>Preserve evidence: note table/time/guest description; retain the check; identify witnesses.</li>
        <li>Manager review: cameras and POS logs; determine next steps (e.g., voids, police report where appropriate).</li>
      </ol>
      <p><strong>Discipline path (default):</strong> Verbal → Verbal → Written → Final/Termination. The Company may skip steps for repeated/serious negligence or any evidence of dishonesty.</p>

      <h3 class="text-lg font-semibold mt-3 mb-1">Order Management — Audits & Incident Handling</h3>
      <ul class="list-disc pl-6">
        <li>Run open-check/discount/void reports each shift; investigate anomalies.</li>
        <li>Enforce “ring before serve/pack”; no free items unless a manager-approved promo is applied correctly in POS.</li>
        <li>Require packing checklists and second-person verification for large/high-risk orders.</li>
        <li>Provide targeted retraining (menu changes, POS updates, allergen prompts) when error patterns emerge.</li>
      </ul>
      <h4 class="font-semibold mt-2 mb-1">Incident handling (discipline)</h4>
      <ul class="list-disc pl-6">
        <li>First single, non-egregious error: Coaching/Verbal + CAP (targeted retraining, checklist use, manager sign-off).</li>
        <li>Repeating errors/pattern: Written Warning + CAP.</li>
        <li>Persistent/serious issues (e.g., willful POS bypass, comp/void abuse, price manipulation): Final Written/Suspension or Termination after investigation.</li>
      </ul>

      <h3 class="text-lg font-semibold mt-3 mb-1">Guest Assignment — No Transfers Without Approval</h3>
      <p><strong>Rule.</strong> Do not give away, transfer, or accept guest tables/orders without manager approval.</p>
      <p><strong>Why.</strong> Ensures fair rotations, nondiscrimination, balanced workload, and consistent guest experience.</p>
      <p><strong>Discipline.</strong> Progressive discipline (Coaching/Verbal → Written → Final/Termination). Retraining and/or section/shift adjustments may be used as corrective action.</p>

      <h3 class="text-lg font-semibold mt-3 mb-1">Investigations & Documentation</h3>
      <p><strong>What we review.</strong> Camera footage, POS exception reports (open checks, comps/discounts/voids), cash over/short, packing sheets, run-slips, and witness statements.</p>
      <p><strong>Employee input.</strong> You may be interviewed and may submit a written statement. You can request a support person (non-disruptive) in manager meetings.</p>
      <p><strong>Findings & notice.</strong> Management will document the facts, violated policy, required improvements, timelines, and next-step consequences. You’ll receive a copy.</p>
      <p><strong>Recordkeeping.</strong> All discipline and CAPs are stored in the personnel/HR file. Video and electronic logs are preserved per Company retention schedules.</p>

      <h3 class="text-lg font-semibold mt-3 mb-1">Corrective Action Plans (CAP) — Required Elements</h3>
      <ul class="list-disc pl-6">
        <li>Issue/standard: what policy or procedure was missed.</li>
        <li>Action steps: training modules, checklists, co-sign-offs, or POS refreshers.</li>
        <li>Owner & timeline: responsible manager; start/end dates (1–2 weeks typical).</li>
        <li>Success measures: e.g., zero missed close-outs; zero unverified device drops; error rate under X%; clean audit reports.</li>
        <li>Consequence for not meeting the CAP (advance to next step up to termination).</li>
      </ul>
    `
  }
];
SECTION_V.push(...SECTION_V_SUPPLEMENT);
/* --- END DEDUPED SECTION V CONTENT --- */


const SECTION_V_CODES = SECTION_V.map(i => i.code);


    // Section VI (FMLA/PWFA/ADA) — uses 6.x codes per your text
  /* ========= SECTION VI — Family and Medical Leave (FMLA) ========= */
/* Paste this below your SECTION_V block. It follows the same renderer shape. */

const SECTION_VI = [
  {
    code: "6.0",
    title: "Family and Medical Leave (FMLA) — Purpose & Overview",
    html: `
      <p>Jeng Chi Restaurant (“Company”) provides job-protected, unpaid leave consistent with the Family and Medical Leave Act (FMLA). Where applicable, the Company also provides reasonable accommodations for pregnancy-related limitations under the Pregnant Workers Fairness Act (PWFA) and the ADA.</p>
      <p><strong>Texas notes:</strong> Texas does not have a separate state Pregnancy Disability Leave (PDL) law. Pregnancy-related time off and schedule/duty adjustments are handled through FMLA (if eligible) and/or PWFA/ADA accommodations, not a stand-alone PDL.</p>
    `
  },
  {
    code: "6.1",
    title: "Eligibility (FMLA)",
    html: `
      <p>An employee is FMLA-eligible if all are met:</p>
      <ul class="list-disc pl-6">
        <li>Employed by the Company for 12 months (need not be consecutive);</li>
        <li>Worked at least 1,250 hours in the 12 months before leave begins;</li>
        <li>Company employs 50+ employees within 75 miles of the employee’s worksite.</li>
      </ul>
    `
  },
  {
    code: "6.2",
    title: "Qualifying Reasons (FMLA)",
    html: `
      <p>Up to 12 weeks of unpaid, job-protected leave in a 12-month period for:</p>
      <ul class="list-disc pl-6">
        <li>The employee’s serious health condition (includes pregnancy/prenatal care and childbirth recovery);</li>
        <li>Care for a spouse, child, or parent with a serious health condition;</li>
        <li>Bonding with a newborn, adopted, or newly placed foster child (within 12 months of birth/placement);</li>
        <li>Certain military exigencies. (Up to 26 weeks to care for a covered servicemember with a serious injury/illness.)</li>
      </ul>
    `
  },
  {
    code: "6.3",
    title: "Pregnancy & Childbirth — How FMLA and PWFA/ADA Interact",
    html: `
      <ul class="list-disc pl-6">
        <li>During pregnancy/childbirth recovery: time off may be FMLA-qualifying (if eligible).</li>
        <li>If not FMLA-eligible or after FMLA is exhausted: the Company will assess PWFA/ADA reasonable accommodations (e.g., additional unpaid leave, modified schedules, light duty, lifting restrictions), absent undue hardship.</li>
        <li><strong>No Texas PDL:</strong> Do not rely on a separate PDL entitlement in Texas.</li>
      </ul>
    `
  },
  {
    code: "6.4",
    title: "Amount, Scheduling & Intermittent Leave",
    html: `
      <ul class="list-disc pl-6">
        <li>Leave may be taken continuously, intermittently, or on a reduced schedule when medically necessary (or as agreed for bonding).</li>
        <li>Employees must make reasonable efforts to schedule planned treatment to avoid unduly disrupting operations.</li>
      </ul>
    `
  },
  {
    code: "6.5",
    title: "Pay & Benefits During Leave",
    html: `
      <p><strong>Unpaid Leave & Substitution.</strong> FMLA leave is generally unpaid. The Company may require the substitution of any available, accrued PTO to cover otherwise unpaid (“lost”) leave hours, provided the absence qualifies under our PTO policy and required notices are given.</p>
      <p><strong>Exceptions (No Mandatory Substitution).</strong> The Company will not require PTO substitution when the employee is receiving wage-replacement benefits for the same period (e.g., workers’ compensation, employer disability benefits, or applicable state/local paid family/medical leave). PTO may be used only if the employee elects to supplement benefits up to 100% of regular pay and if permitted by law/plan terms.</p>
      <p><strong>Procedures.</strong> When PTO is substituted (by employee election or Company requirement), employees must follow PTO procedural requirements (e.g., forms, documentation). The Company will reflect the substitution in the FMLA Designation Notice and payroll.</p>
      <p><strong>Health Benefits During FMLA.</strong> Group health coverage continues on the same terms as active employment; employees must continue the employee-share of premiums. If premiums are 30+ days late, coverage may lapse after written 15-day notice of intent to cancel; coverage is restored upon return from FMLA as required.</p>
      <p><strong>FLSA Notes.</strong> Overtime: PTO hours do not count as “hours worked” for FLSA overtime thresholds; overtime is based on hours actually worked. Exempt pay basis: For salaried-exempt employees, the Company may charge PTO for full- or partial-day FMLA absences, but the salary itself is not reduced for partial-day absences.</p>
    `
  },
  {
    code: "6.6",
    title: "Employee Notice Responsibilities",
    html: `
      <ul class="list-disc pl-6">
        <li>Foreseeable leave (e.g., planned surgery, due date): provide 30 days’ notice or as soon as practicable.</li>
        <li>Unforeseeable leave: notify as soon as practicable and follow usual call-in rules.</li>
        <li>Provide enough information for the Company to determine FMLA applicability (not required to disclose diagnosis).</li>
      </ul>
    `
  },
  {
    code: "6.7",
    title: "Medical Certification & Fitness-for-Duty",
    html: `
      <ul class="list-disc pl-6">
        <li>The Company may require medical certification supporting a serious health condition. Employees get 15 calendar days to return the certification (longer if not practicable). If never provided, the absence may not be FMLA-protected.</li>
        <li>Incomplete/insufficient certifications: the employee will be given an opportunity to cure deficiencies.</li>
        <li>The Company may require a fitness-for-duty release for return to safety-sensitive or physically demanding roles, limited to the condition that caused the leave.</li>
      </ul>
    `
  },
  {
    code: "6.8",
    title: "Employer Notices (What You’ll Receive)",
    html: `
      <ul class="list-disc pl-6">
        <li>Eligibility Notice & Rights/Responsibilities after the employee requests leave or the Company learns leave may be FMLA-qualifying.</li>
        <li>Designation Notice stating whether the leave is designated as FMLA-qualifying, generally within five business days after the Company has sufficient information (e.g., after receiving certification).</li>
      </ul>
    `
  },
  {
    code: "6.9",
    title: "Performance, Conduct & Anti-Retaliation",
    html: `
      <ul class="list-disc pl-6">
        <li>FMLA provides leave and restoration rights, not immunity from lawful performance or conduct standards. The Company may apply its consistent, documented performance/discipline process to misconduct or policy violations unrelated to FMLA use, including after an employee returns from leave.</li>
        <li>The Company prohibits interference, restraint, or retaliation for requesting or using FMLA or pregnancy-related accommodations.</li>
      </ul>
    `
  },
  {
    code: "6.10",
    title: "Fraud/Abuse",
    html: `
      <p>Knowingly misusing FMLA (e.g., false statements, improper use of leave) may result in discipline up to and including termination, consistent with law.</p>
    `
  },
  {
    code: "6.11",
    title: "Concurrent Leaves & Workers’ Compensation",
    html: `
      <p>Where applicable, FMLA may run concurrently with workers’ compensation or other leave types if the absence meets FMLA criteria.</p>
    `
  },
  {
    code: "6.12",
    title: "How to Request FMLA or Pregnancy-Related Accommodation",
    html: `
      <ol class="list-decimal pl-6">
        <li>Notify your manager or HR as soon as possible (30 days for foreseeable).</li>
        <li>Complete forms provided by HR (FMLA request; medical certification if required).</li>
        <li>Return medical certification within 15 calendar days (or promptly if not practicable).</li>
        <li>For pregnancy-related limitations (before/after FMLA or if ineligible), contact HR to explore PWFA/ADA accommodations (e.g., light duty, schedule changes, additional unpaid time off).</li>
      </ol>
    `
  },
  {
    code: "6.13",
    title: "Administration & Questions",
    html: `
      <p>HR administers this policy. Questions or requests for forms should be directed to HR.</p>
    `
  }
];

const SECTION_VI_CODES = SECTION_VI.map(i => i.code);

/* ========= SECTION VII — Doctor’s Notice & Medical Leave Documentation ========= */
/* Paste this below your SECTION_VI block. It matches the same {code,title,html} shape. */

const SECTION_VII = [
  {
    code: "7.0",
    title: "Doctor’s Notice & Medical Leave Documentation — Purpose & Scope",
    html: `
      <p><strong>Purpose.</strong> To keep guests and employees safe, comply with federal/state law, and set a clear, fair process for medical absences and return-to-work.</p>
      <p><strong>Scope.</strong> Applies to all employees. Nothing here creates a contract or alters at-will status. We will administer this policy consistently, without discrimination or retaliation.</p>
    `
  },
  {
    code: "7.1",
    title: "When a Doctor’s Note Is Required",
    html: `
      <ol class="list-decimal pl-6">
        <li><strong>Short absences (1–2 schedule-shift days).</strong> A note is not routinely required, but may be requested for safety-sensitive roles or patterns of absence.</li>
        <li><strong>3+ schedule-shift days absent (any medical reason).</strong> A doctor’s note is required to return, confirming:
          <ul class="list-disc pl-6 mt-2">
            <li>dates unable to work; and</li>
            <li>fitness for duty to return (or any temporary restrictions and expected duration). Diagnosis is not required.</li>
          </ul>
        </li>
        <li><strong>Food-safety symptoms or diagnoses.</strong> Vomiting, diarrhea, jaundice, sore throat with fever, or infected hand/arm lesions (or diagnosis of Norovirus, Hep A, Salmonella Typhi, Shigella, STEC/E. coli) require exclusion from food handling and medical clearance before return, consistent with health-department rules.</li>
        <li><strong>After a written attendance warning</strong> or post-surgery/injury affecting job duties: a doctor’s note/fitness-for-duty release may be required.</li>
      </ol>
    `
  },
  {
    code: "7.2",
    title: "How to Submit Your Doctor’s Note",
    html: `
      <ul class="list-disc pl-6">
        <li>Deliver directly to HR before your first shift back, or within 2 business days of return.</li>
        <li><strong>Acceptable method:</strong> in person (sealed).</li>
        <li><strong>HR Receipt:</strong> HR will issue a Medical Documentation Receipt noting date/time received and type (doctor’s note, fitness-for-duty, medical certification), and whether it appears complete. You’ll get a copy for your records.</li>
      </ul>
      <p><strong>Confidentiality.</strong> All medical information is kept in a confidential HR medical file, separate from personnel files, and shared only with those who need to know (e.g., scheduling for restrictions).</p>
    `
  },
  {
    code: "7.3",
    title: "FMLA Screening & Paperwork (if/when FMLA-covered)",
    html: `
      <p>When an absence could qualify for FMLA (e.g., 3+ full calendar days with treatment/continuing care; inpatient care; chronic/serious conditions; pregnancy/prenatal), HR will:</p>
      <ol class="list-decimal pl-6">
        <li>Issue <em>FMLA Eligibility & Rights/Responsibilities</em> (Form WH-381) within 5 business days of learning about a potential FMLA need (absent extenuating circumstances).</li>
        <li>Request medical certification (Form WH-380-E for the employee, WH-380-F for a family member). You have 15 calendar days to return it; if incomplete, HR will give 7 calendar days to cure deficiencies.</li>
        <li><em>Designation Notice</em> (Form WH-382): Once HR has enough information, we will approve/deny and designate the leave in writing within 5 business days.</li>
        <li><strong>Fitness-for-duty (FFD) on return:</strong> If uniformly required for similar jobs, we may require an FFD related to the condition, and may ask the provider to address essential job functions (we will give you that list with the WH-381).</li>
      </ol>
      <p><strong>While paperwork is pending:</strong> Leave may be provisionally treated as FMLA-pending. If certification is not returned by the deadline (and no good-cause extension), the leave may be unprotected and subject to attendance rules.</p>
      <p><strong>Job restoration:</strong> If FMLA applies, you will be restored to the same or an equivalent position (equivalent pay/benefits/terms). If business conditions change and hours/position would have changed regardless of the leave, HR will document the legitimate reason and place you appropriately under the law.</p>
    `
  },
  {
    code: "7.4",
    title: "Pregnancy, Childbirth & Related Conditions (PWFA/ADA)",
    html: `
      <p>We will provide reasonable accommodations for known limitations related to pregnancy/childbirth unless it causes undue hardship (examples: extra breaks, water, seating, temporary transfer away from heavy lifting, schedule changes). Request through your supervisor or HR; limited documentation may be requested. No retaliation.</p>
    `
  },
  {
    code: "7.5",
    title: "Workers’ Compensation & Work-Injury Notes",
    html: `
      <ul class="list-disc pl-6">
        <li>Report immediately any work injury/illness to the Manager on Duty and HR no later than end of shift.</li>
        <li>Use the carrier’s network (if applicable). Provide return-to-work notes and restrictions to HR only. We may offer temporary modified duty when available and consistent with medical restrictions.</li>
      </ul>
    `
  },
  {
    code: "7.6",
    title: "Pay, PTO & Scheduling During Medical Leave",
    html: `
      <ul class="list-disc pl-6">
        <li><strong>Pay:</strong> Time away is unpaid unless you use available PTO or another paid benefit. (FLSA does not require pay for non-worked time.)</li>
        <li><strong>Overtime:</strong> Only hours actually worked count toward overtime.</li>
        <li><strong>Scheduling:</strong> Provide restrictions/estimated return dates as soon as practicable so we can plan coverage fairly.</li>
      </ul>
    `
  },
  {
    code: "7.7",
    title: "If Documentation Is Not Provided (Doctor’s Notes, FMLA Certification, FFD)",
    html: `
      <p><strong>General rule (3+ day medical absences).</strong> If you are absent three (3) or more full calendar days for a medical reason, you must provide a doctor’s note/fitness-for-duty (FFD) confirming you are able to return (with or without restrictions). Diagnosis is not required. Until HR receives required documentation, you may not work and will be placed on unpaid administrative leave.</p>
      <p><strong>A. Doctor’s Note / Fitness-for-Duty Not Provided</strong></p>
      <ul class="list-disc pl-6">
        <li><em>Initial deadline.</em> If no note/FFD is provided by your first shift back (or within 2 business days of return, if not practicable), HR will issue a Written Notice to Provide Medical Documentation with a final deadline of 3 business days.</li>
        <li><em>Status during the deadline.</em> You remain off the schedule/unpaid pending receipt. You must maintain contact with HR.</li>
        <li><em>Failure to provide by the final deadline.</em> Absent extenuating circumstances (e.g., hospitalization, provider delay you cannot control and that you promptly communicate), the Company will treat the continued absence and lack of clearance as inability to return to duty and/or job abandonment under the Attendance Policy and may proceed to termination of employment.</li>
        <li><em>Late documentation.</em> If you provide the note after separation, the Company may, at its discretion, consider you for re-hire based on staffing needs and overall record.</li>
      </ul>
      <p><strong>B. FMLA Medical Certification Not Returned (when FMLA could apply)</strong></p>
      <ul class="list-disc pl-6">
        <li><em>15-day deadline.</em> You must return the certification within 15 calendar days.</li>
        <li><em>7-day cure.</em> If incomplete/insufficient, HR will give you 7 calendar days to cure.</li>
        <li><em>No certification.</em> If you do not return a sufficient certification within these timelines (and no good-cause extension applies), FMLA protection may be denied. Your time away is then handled under the Attendance Policy.</li>
        <li>If you also lack a doctor’s note/FFD to return: follow Section A timelines above. Continued inability to provide clearance after the final deadline may result in termination for inability to return/job-abandonment.</li>
      </ul>
      <p><strong>C. No-Call/No-Show During This Process</strong><br/>Failing to report and failing to contact the Company for two (2) consecutive scheduled shifts may be deemed job abandonment under the Attendance Policy and may result in termination, separate from FMLA/FFD requirements.</p>
      <p><strong>D. Anti-Retaliation / Accommodation</strong><br/>We will not retaliate against anyone for requesting leave/accommodation, submitting medical documentation, or participating in a related process. If your provider indicates temporary restrictions, HR will engage in the interactive process (ADA/PWFA). If no reasonable accommodation is available without undue hardship, separation may occur based on inability to perform essential functions.</p>
    `
  },
  {
    code: "7.8",
    title: "Fitness-for-Duty (FFD) to Return",
    html: `
      <ul class="list-disc pl-6">
        <li>Required after 3+ day medical absences with potential safety impact, after certain food-safety illnesses, or as stated in your FMLA Rights &amp; Responsibilities.</li>
        <li>FFD must confirm you’re able to work (with or without restrictions). If restrictions exist, HR will review whether a temporary accommodation is available (ADA/PWFA interactive process).</li>
      </ul>
    `
  },
  {
    code: "7.9",
    title: "No Retaliation / Consistent Application",
    html: `
      <p>We prohibit retaliation against anyone who in good faith requests leave/accommodation, submits medical documentation, or participates in a related process. We apply this policy consistently and keep medical information confidential.</p>
    `
  }
];

const SECTION_VII_CODES = SECTION_VII.map(i => i.code);

/* If you maintain a master list, remember to include SECTION_VII when you build or render:
   const ALL_SECTIONS = [...SECTION_I, ...SECTION_II, ...SECTION_III, ...SECTION_IV, ...SECTION_V, ...SECTION_VI, ...SECTION_VII];
*/



  /* ========= SECTION VIII — Employee Benefits & Services (Overview) ========= */
/* Paste this below your SECTION_VII block. It matches the same {code,title,html} shape. */

const SECTION_VIII = [
  {
    code: "8.0",
    title: "Employee Benefits & Services — Overview",
    html: `
      <p>Aside from benefits required by law, Jeng Chi Restaurant offers additional benefits for eligible full-time employees. From time to time, benefits may be added, modified, or discontinued at the Company’s discretion, consistent with law. This Handbook provides general summaries only; official plan documents/SPDs (Summary Plan Descriptions) control eligibility, coverage, and claims. Questions? Contact HR.</p>
    `
  },
  {
    code: "8.1",
    title: "Eligibility & Waiting Period",
    html: `
      <ul class="list-disc pl-6">
        <li><strong>Full-time status:</strong> Regularly scheduled 30+ hours per week.</li>
        <li><strong>Waiting period:</strong> Benefits eligibility begins after 60 calendar days of continuous employment in full-time status.</li>
        <li><strong>Effective date:</strong> Coverage generally starts the first day after you satisfy the waiting period (or the first of the next month, if required by the plan). HR will confirm your exact effective date per the plan rules.</li>
        <li><strong>Rehires / status changes:</strong> If you drop below 30 hours on an ongoing basis, future eligibility may end per plan rules. If later restored to full-time, the waiting period may re-apply unless the plan provides otherwise.</li>
      </ul>
      <p><strong>Medical, Dental, Vision, Life (Plan-Document Controlled)</strong></p>
      <ul class="list-disc pl-6">
        <li>Once you meet the 60-day waiting period: Health Insurance (medical), Dental Insurance, Vision Insurance, Life Insurance.</li>
        <li><strong>How to enroll:</strong> HR will provide the enrollment link/forms and the deadline (often within 30 days of eligibility). If you do not enroll by the deadline, you may have to wait until the next Open Enrollment.</li>
        <li><strong>Cost sharing:</strong> The Company may contribute toward premiums; any employee share is paid via payroll deduction.</li>
        <li><strong>Dependents:</strong> You may add eligible dependents if the plan allows (spouse, children, etc.). Proof of eligibility may be required.</li>
        <li><strong>Qualifying Life Events (mid-year changes):</strong> Marriage, birth/adoption, divorce, loss/gain of other coverage, etc. You generally have 30 days from the event to submit changes.</li>
        <li><strong>End of coverage:</strong> Coverage ends per plan terms (e.g., last day of the month of separation or hours reduction).</li>
      </ul>
    `
  },
  {
    code: "8.2",
    title: "PTO (Paid Time Off) — Accrual Start",
    html: `
      <p>This policy governs accrual. Details on use, scheduling, carry, and payout are in the related policies below.</p>
      <ul class="list-disc pl-6">
        <li><strong>Who accrues:</strong> Full-time employees (regularly scheduled 30+ hours/week).</li>
        <li><strong>When accrual begins:</strong> After 60 calendar days of continuous employment and full-time status.</li>
        <li>PTO accrual, caps, scheduling, carry, year-end payout, and termination rules are set out in the PTO Policy.</li>
      </ul>
    `
  },
  {
    code: "8.3",
    title: "Coordination With Leave & Payroll",
    html: `
      <ul class="list-disc pl-6">
        <li>Benefit eligibility and deductions continue while you work sufficient hours and pay required employee contributions.</li>
        <li>During unpaid leaves, you may be responsible for direct payment of your premiums to maintain coverage (HR will advise options and deadlines).</li>
      </ul>
    `
  },
  {
    code: "8.4",
    title: "Payroll Advance Policy — Overview",
    html: `
      <p><strong>Policy brief & purpose:</strong> Describes terms for advancing pay to employees as an emergency short-term loan.</p>
      <p><strong>Scope:</strong> Applies to all permanent full-time or part-time employees; temporary employees with contracts longer than 60 days may be included.</p>
      <p><strong>Policy elements:</strong> “Payroll advance” = receiving a portion of pay before the next normal payday. The Company isn’t obliged to advance pay; we may choose to do so for legitimate reasons.</p>
      <p><strong>Amount:</strong> Up to 50% of earned hours worked in the current payroll; tips earned are included in the calculation. The full amount is deducted from the next paycheck. Maximum usage: 6 times per calendar year.</p>
    `
  },
  {
    code: "8.5",
    title: "Payroll Advance — Conditions & Request Process",
    html: `
      <p><strong>Conditions to request:</strong></p>
      <ul class="list-disc pl-6">
        <li>Employed 60+ days with no disciplinary action.</li>
        <li>Good standing and satisfactory performance.</li>
        <li>Emergency circumstances.</li>
      </ul>
      <p><strong>How to request:</strong></p>
      <ol class="list-decimal pl-6">
        <li>Obtain the <em>Payroll Advance Request Form</em> from a manager on duty or the Payroll Department.</li>
        <li>Submit the completed form to Payroll, Mon–Fri, 10:00 a.m.–5:00 p.m. (Requests after 5 p.m. are reviewed next business day.)</li>
        <li>Payroll reviews within one business day for outstanding balances and eligibility.</li>
        <li>You will be notified of approval/denial.</li>
        <li>If approved, amount = up to 50% of earned hours in current payroll (tips included per guidelines). The full amount is deducted from the next paycheck.</li>
        <li>Maximum availability: 6 times per calendar year.</li>
      </ol>
    `
  },
  {
    code: "8.6",
    title: "Employee Meal (Unpaid Meal Break)",
    html: `
      <p><strong>What this is:</strong> As a courtesy, our wok chefs prepare an employee meal between 2:30–3:30 p.m. daily. Participation is voluntary and does not change the unpaid status of your meal period.</p>
      <p><strong>Very important — unpaid status:</strong></p>
      <ul class="list-disc pl-6">
        <li>Employee meals are taken during your unpaid meal break.</li>
        <li>Clock out at the start of your break and clock in when you return.</li>
      </ul>
      <p><strong>Where to eat:</strong></p>
      <ul class="list-disc pl-6">
        <li>Use the employee dining area. If seating is designated in the guest dining room, use only manager-approved tables/section, remove aprons, and do not interact with guests or perform work. Managers may restrict seating in guest areas during peak periods.</li>
      </ul>
      <p><strong>How to handle food & space:</strong></p>
      <ul class="list-disc pl-6">
        <li>Use China plates/bowls—not to-go packaging.</li>
        <li>Label and store any saved food in the designated area; reheat in the kitchen microwave only during your break.</li>
        <li>Wash hands before returning to duty.</li>
      </ul>
      <p><strong>Beverages & purchases:</strong></p>
      <ul class="list-disc pl-6">
        <li>Fountain beverage: $0.50 per 16–20 oz (pay at the fountain).</li>
        <li>Other non-alcoholic beverages: 30% off—order and pay through a cashier, server, or manager and keep your receipt.</li>
        <li>Employees may purchase menu items for their break through a cashier, server, or manager; show your receipt.</li>
      </ul>
    `
  },
  {
    code: "8.7",
    title: "Workers’ Compensation Insurance",
    html: `
      <p><strong>Coverage status:</strong> The Company is a Workers’ Compensation subscriber and carries coverage through Society Insurance (the “Carrier”). Workers’ compensation is the exclusive remedy for covered work injuries/illnesses except in limited circumstances under Texas law.</p>
    `
  },
  {
    code: "8.8",
    title: "Employee Time Off (General Leaves)",
    html: `
      <p>While regular attendance is crucial to maintain business operations, the Company recognizes employees may need time off. For planned leaves, submit requests at least 21 days in advance; in emergencies, submit as soon as you become aware. All leaves require management approval.</p>
      <p>If during a leave an employee accepts another job, engages in outside work/consulting, or applies for unemployment insurance, the employee may be considered to have voluntarily resigned.</p>
      <p>All requests will be considered in light of business needs; management reserves approval/denial discretion unless otherwise required by law. For disability-related leave, we will engage in the interactive process. Medical certification may be required; failure to timely provide may delay/deny leave. Extensions must be approved before the current leave expires.</p>
      <p>The Company will make a reasonable effort to return the employee to their former or comparable position following an approved leave, but reinstatement is not guaranteed except as required by law.</p>
    `
  },
  {
    code: "8.9",
    title: "Paid Time Off Policy (PTO) — General",
    html: `
      <p>The Company provides full-time employees with vacation on a periodic basis. Eligibility is determined by length of service as of his or her employment anniversary date. We support healthy work–life balance; details below explain how the plan works.</p>
      <p><strong>Holiday-season hire exception:</strong> Employees hired in Q4 who reach their anniversary during peak holidays may use first-year rollover PTO until Jan 31 of the new year (not combined with new-year PTO; first year only).</p>
      <ul class="list-disc pl-6">
        <li>Direct manager approves/denies in Sling.</li>
        <li>Sling maintains a centralized calendar to prevent overlaps.</li>
        <li>Employees must arrange coverage for duties during PTO.</li>
        <li>Management may deny PTO if operations would be disrupted (e.g., insufficient coverage; no server substitute when short-staffed). Alternate dates may be requested.</li>
        <li>For illness/emergencies, submit the Paid Time Off Request Form upon return for payroll processing.</li>
        <li>All benefits terminate if an employee resigns without notice or takes a leave &gt; 30 days.</li>
        <li>If re-hired full-time, eligibility for health/dental/life resumes after a 60-day waiting period; PTO eligibility resumes after 1 year of full-time service.</li>
        <li>If status drops from full-time to part-time, the PTO benefit is forfeited.</li>
      </ul>
    `
  },
  {
    code: "8.10",
    title: "Use & Management of PTO",
    html: `
      <ul class="list-disc pl-6">
        <li>All PTO is upfront (at start of year or on first anniversary).</li>
        <li>PTO does not roll over to the next year.</li>
        <li>Unused PTO is paid in full on the last paycheck of the year.</li>
        <li>If an employee voluntarily resigns with ≥ 2 weeks’ written notice, unused PTO is paid on the final check.</li>
        <li>Employees who are terminated, resign without notice, or abandon their job are not eligible to receive unpaid PTO.</li>
        <li>Black-out dates are released before the year; PTO cannot be used on those dates.</li>
        <li>First-come, first-served; two employees in the same department may not take PTO at the same time.</li>
        <li>PTO may be used for vacation, personal business, illness, medical/dental appointments, or personal emergencies.</li>
      </ul>
    `
  },
  {
    code: "8.11",
    title: "Request to Use PTO — Process",
    html: `
      <ol class="list-decimal pl-6">
        <li>Request vacation PTO at least 21 days in advance in Sling.</li>
        <li>Complete the Sling time-off request <em>and</em> the Company Paid Time Off Request Form with manager and employee signatures.</li>
        <li>Submit the signed form to Payroll.</li>
      </ol>
      <p><strong>When Accrual Starts — New Hires:</strong> PTO accrual begins on the 61st calendar day of continuous employment. No PTO accrues during the first 60 days. In the first calendar year, accrual runs from day 61 through Dec 31 (subject to the annual cap). If day 61 falls after Dec 31, accrual begins Jan 1 of the following year.</p>
      <p><strong>Full-Time Hourly:</strong></p>
      <ul class="list-disc pl-6">
        <li>1–4 years of service: up to 40 hours/year</li>
        <li>4+ years of service: up to 48 hours/year</li>
      </ul>
      <p><strong>Full-Time Salaried:</strong></p>
      <ul class="list-disc pl-6">
        <li>1–4 years of service: up to 50 hours/year</li>
        <li>4+ years of service: up to 60 hours/year</li>
      </ul>
    `
  },
  {
    code: "8.12",
    title: "Paid Time Off (PTO) — Full-Time Employees (≥30 hrs./wk.)",
    html: `
      <p><strong>Purpose.</strong> Provide a predictable, neutral PTO system while complying with TWC and FLSA. PTO is a Company policy benefit, not required by law.</p>
      <p><strong>At-will / non-contract.</strong> This policy does not create a contract or guarantee employment or hours; the Company may modify it consistent with law.</p>
      <p><strong>Eligibility.</strong></p>
      <ul class="list-disc pl-6">
        <li>Full-time status (regularly scheduled 30+ hours/week).</li>
        <li>Accrual begins after 60 calendar days of continuous employment and full-time status.</li>
        <li>Status drops below 30 hrs/week for a sustained period (e.g., 4 consecutive workweeks): future accrual stops until full-time resumes. Accrued balances already earned remain subject to availability/payout rules.</li>
      </ul>
      <p class="mt-2"><strong>Accrual Mechanics (Calendar-Year Cycle).</strong></p>
      <ul class="list-disc pl-6">
        <li>Accrual year: Jan 1 – Dec 31.</li>
        <li>Accrual start for new hires: day 61 (once full-time), at the service-tier rate below.</li>
        <li>Accrues on straight-time hours worked up to 40 hrs/week (not on OT, unpaid time, or PTO itself).</li>
        <li><strong>Rates:</strong> &lt; 4 yrs: 0.02 PTO hrs per straight-time hour worked; ≥ 4 yrs: 0.023 PTO hrs per straight-time hour worked.</li>
        <li><strong>Annual caps:</strong> &lt; 4 yrs: 40 hrs; ≥ 4 yrs: 48 hrs.</li>
      </ul>
    `
  },
  {
    code: "8.13",
    title: "Requesting & Scheduling PTO",
    html: `
      <ul class="list-disc pl-6">
        <li><strong>How to request:</strong> Submit via Sling (and Company form if required) with ≥ 21 days’ advance notice for vacation. Emergency/sick requests as soon as practicable.</li>
        <li><strong>Approval:</strong> Depends on business needs, coverage, blackout dates, and your Available PTO. Approval/denial recorded in Sling.</li>
        <li><strong>No advances/negatives:</strong> You may not take PTO in excess of Available balance.</li>
        <li><strong>Coordination with leave laws:</strong> We coordinate PTO with FMLA/ADA/PWFA when applicable and apply this policy uniformly and without retaliation.</li>
      </ul>
    `
  },
  {
    code: "8.14",
    title: "Pay, FLSA Guardrails, Year-End & Separation",
    html: `
      <p><strong>Pay & FLSA:</strong></p>
      <ul class="list-disc pl-6">
        <li>PTO is paid at base hourly rate (non-exempt) or salary equivalent (exempt), excluding tips/differences/OT.</li>
        <li>PTO hours do not count as “hours worked” for FLSA overtime.</li>
        <li>Tipped employees: PTO may be paid at base hourly wage (not tips). OT still applies on hours actually worked in the week.</li>
      </ul>
      <p><strong>Year-End Carry & Payout:</strong></p>
      <ul class="list-disc pl-6">
        <li><em>Available PTO</em> = prior-year balance carried into current year; must be used within the current year unless otherwise required by law/approved in writing.</li>
        <li>Any Available PTO not used by year-end is automatically paid on the year’s final payroll.</li>
        <li>Active status required on the final payroll to receive the automatic payout.</li>
      </ul>
      <p><strong>Separation from Employment (Texas Payday Law Alignment):</strong></p>
      <ul class="list-disc pl-6">
        <li>No payout at termination for unused PTO under this policy.</li>
        <li>Rehire: eligibility and accrual follow the eligibility/waiting-period rules above.</li>
      </ul>
      <p class="text-sm italic">TWC compliance note: Whether PTO is due at termination depends on the written policy. This policy states no payout at termination and an automatic year-end payout only for active employees, so payroll will follow this rule.</p>
    `
  }
];

const SECTION_VIII_CODES = SECTION_VIII.map(i => i.code);

/* If you maintain a master list, remember to include SECTION_VIII when you build or render:
   const ALL_SECTIONS = [...SECTION_I, ...SECTION_II, ...SECTION_III, ...SECTION_IV, ...SECTION_V, ...SECTION_VI, ...SECTION_VII, ...SECTION_VIII];
*/


    const SECTIONS = {
      I:    { title: "Section I – Introduction",                          store: "jc_section_i_",    items: SECTION_I },
      II:   { title: "Section II – Employment Policies",                  store: "jc_section_ii_",   items: SECTION_II },
      III:  { title: "Section III – Hours of Work & Payroll Practices",  store: "jc_section_iii_",  items: SECTION_III },
      IV:   { title: "Section IV – Standards of Conduct",                 store: "jc_section_iv_",   items: SECTION_IV },
      V:    { title: "Section V – Discipline & Corrective Action",        store: "jc_section_v_",    items: SECTION_V },
      VI:   { title: "Section VI – Family and Medical Leave (FMLA)",      store: "jc_section_vi_",   items: SECTION_VI }, /* FMLA content, retains old combined storage key for minimal data loss */
      VII:  { title: "Section VII – Doctor’s Notice & Medical Leave Documentation", store: "jc_section_vii_",  items: SECTION_VII }, /* Docs content, new storage key */
      VIII: { title: "Section VIII – Employee Benefits & Services",       store: "jc_section_viii_", items: SECTION_VIII },
      // Section IX removed as requested
      // IX:   { title: "Section IX – Docs/FFD",  store: "jc_section_ix_",   items: SECTION_VII } 
    };

    /* ========= RENDERING ========= */
    const tabButtons = document.querySelectorAll('.tabbtn');
    let currentTab = 'I';
    // Updated SECTION_ORDER to reflect the new, separate VI and VII tabs
    const SECTION_ORDER = ["I","II","III","IV","V","VI","VII","VIII"]; 
    
    // Add this helper
    function gotoSection(tabKey) {
      currentTab = tabKey;
      // remember last visited section per user
localStorage.setItem(nsKey('last_tab'), tabKey);

      renderSection(tabKey);
    }

    const policyCardTemplate = (def,item)=>{
      const inputId = `init_${item.code.replace('.','_')}`;
      const saved = localStorage.getItem(nsKey(def.store) + item.code);
      const val = saved ? (JSON.parse(saved)?.initials || '') : '';
      const isAcknowledged = !!val;
      const btnClass = isAcknowledged ? 'bg-jc-green hover:opacity-95' : 'bg-jc-gold hover:opacity-95';
      const btnText = isAcknowledged ? 'Acknowledged' : 'Acknowledge';
      const cleanHtml = DOMPurify.sanitize(item.html, {ADD_ATTR: ['target']});

      return `
        <article data-code="${item.code}" class="policy-card mb-6 last:mb-0 rounded-2xl border border-jc-border bg-white/80 backdrop-blur-sm shadow-soft">
          <div class="p-6">
            <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
              <div class="md:max-w-[70ch]">
                <h2 class="text-2xl font-serif-head text-jc-primary mb-1">${item.code} ${item.title}</h2>
              <div class="text-[15px] leading-7 text-slate-700 text-justify">${cleanHtml}</div>

              </div>
              <div class="min-w-[260px] md:w-[320px]">
                <div class="rounded-xl border border-jc-border bg-white p-4 shadow-sm">
                  <label class="block text-xs text-slate-500 mb-1">Your Initials</label>
                  <input id="${inputId}" class="w-full rounded-xl border border-jc-border px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-jc-gold/30" placeholder="Your initials" value="${val}">
                  <div class="mt-3 flex items-center gap-2">
                    <button data-code="${item.code}" 
                            data-input-id="${inputId}"
                            data-tab-store="${def.store}"
                            class="btnAcknowledge rounded-xl text-white px-3 py-2 text-sm w-full ${btnClass}"
                            ${isAcknowledged ? 'disabled' : ''}>
                        ${btnText}
                    </button>
                    <span id="msg_${inputId}" class="text-sm"></span>
                  </div>
                  <div class="mt-2 text-xs text-slate-500">Acknowledging saves your initials to your record.</div>
                </div>
              </div>
            </div>
          </div>
        </article>`;
    };
function sectionIsComplete(key) {
  const def = SECTIONS[key];
  return def.items.every(i => localStorage.getItem(nsKey(def.store) + i.code));
}

function findResumeSectionKey() {
  // 1) explicit last tab if present
  const saved = localStorage.getItem(nsKey('last_tab'));
  if (saved && SECTIONS[saved]) return saved;
  // 2) first incomplete section
  for (const k of SECTION_ORDER) {
    if (!sectionIsComplete(k)) return k;
  }
  // 3) everything complete → last section
  return SECTION_ORDER[SECTION_ORDER.length - 1];
}

    function renderSection(tabKey){
      const def = SECTIONS[tabKey];
      currentTab = tabKey;
      sectionTitle.textContent = def.title; // Use the section title from the SECTIONS object
      
      policiesEl.innerHTML = def.items.map(i => policyCardTemplate(def,i)).join('');
      
      wireSaveButtons();
      updateProgress();
      // Pre-fill initials from session if available
      const initials = getInitials();
      if(initials){
          document.querySelectorAll('input[placeholder="Your initials"]').forEach(input => {
              if(!input.value) input.value = initials;
          });
      }
      
      // === Tab styles + lock sequential nav ===
      const tabs = Array.from(tabButtons);
      const activeIdx = SECTION_ORDER.indexOf(tabKey);
      const lastIdx   = SECTION_ORDER.length - 1;

      tabs.forEach((tab, index) => {
        tab.classList.remove('bg-jc-primary','text-white', 'border-jc-primary');
        tab.classList.add('border');
        tab.disabled = true;                 // lock all
        if (index === activeIdx) {
          tab.classList.add('bg-jc-primary','text-white');
          tab.classList.remove('border');
          tab.disabled = false;              // only current is clickable
        }
      });
      
      // Back visible except on first section
      btnBack.disabled = (activeIdx === 0);
      btnBack.classList.toggle('opacity-50', (activeIdx === 0));

      // Finalize appears only on last section; otherwise show Next
      if (isLastSection(tabKey)) {
        btnFinalize.classList.remove('hidden');
        btnNext.classList.add('hidden');
      } else {
        btnFinalize.classList.add('hidden');
        btnNext.classList.remove('hidden');
      }
    }

    // Keep tab clicks for the current tab only (no change)
    tabButtons.forEach(b=>{
      b.addEventListener('click', (e)=>{
        if (e.currentTarget.classList.contains('bg-jc-primary') && !e.currentTarget.disabled) {
          renderSection(e.currentTarget.getAttribute('data-tab'));
        }
      });
    });
    
    // Function to get ALL acknowledged policies from local storage
    function getAllAcksFromLocalStorage() {
        const acks = [];
        Object.values(SECTIONS).forEach(def => {
            def.items.forEach(item => {
                const localStorageKey = nsKey(def.store) + item.code;
                const savedData = localStorage.getItem(localStorageKey);
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    acks.push({
                        policyCode: item.code,
                        policyTitle: item.title,
                        initials: data.initials,
                        ts: data.ts,
                        policyId: POLICY_META?.[item.code]?.id || null, // Include DB ID if available
                    });
                }
            });
        });
        return acks;
    }

    // Helper: Collects all saved policies organized by section for the PDF payload
    function collectPolicyRows() {
      // returns [{sectionKey, sectionTitle, rows:[{code,title,initials}]}]
      const out = [];
      for (const [key, def] of Object.entries(SECTIONS)) {
        const rows = def.items.map(item => {
          const k   = nsKey(def.store) + item.code;
          const sv  = localStorage.getItem(k);
          const ini = sv ? (JSON.parse(sv).initials || '') : '';
          return { code: item.code, title: item.title, initials: ini };
        });
        out.push({ sectionKey: key, sectionTitle: def.title, rows });
      }
      return out;
    }
    
    // Try to derive manager position (optional best-effort)
    async function enrichManagerPosition() {
      if (!empProfile?.reports_to) return;
      try {
        const { data } = await client
          .from('v_employee_card')
          .select('position')
          .ilike('full_name', empProfile.reports_to)
          .maybeSingle();
        if (data?.position) empProfile.reports_to_position = data.position;
      } catch {}
    }


    /* ========= DB POLICY MAP ========= */
    let POLICY_META = {};
    const wantedCodes = ()=> {
      const arr = [];
      Object.values(SECTIONS).forEach(d=> d.items.forEach(i=> arr.push(i.code)));
      return arr;
    };

    async function loadPoliciesMeta(){
      const { data, error } = await client
        .from('hb_policies')
        .select('id, title, is_active, sort_order, code') /* CRITICAL: added 'code' here */
        .eq('is_active', true)
        .order('sort_order', { ascending: true });

      const meta = {};
      (data||[]).forEach(r=>{
        // Check r.code first, then fallback to title extraction
        const code = r.code || extractCode(r.title);
        if(code) meta[code] = { id:r.id, title:r.title };
      });
      wantedCodes().forEach(c=>{ if(!meta[c]) meta[c] = { id:null, title:c }; });
      POLICY_META = meta;

      if (Object.keys(POLICY_META).length === 0) {
        console.warn('HB DEBUG — Policy metadata is empty. Assuming database connection error.');
        return false;
      }
      return true;
    }

    /* ========= SAVE / PREFILL ========= */
 async function prefillFromDB() {
  const initials   = getInitials();                 // e.g. "PG"
  const session_id = getSessionId();                // integer or null
  const s          = getSession();
  const employee_id = s?.employee_id || null;

  // Build a flexible OR filter: include whichever identifiers we actually have.
  const ors = [];
  if (employee_id) ors.push(`employee_id.eq.${employee_id}`);
  if (session_id)  ors.push(`session_id.eq.${session_id}`);
  if (initials)    ors.push(`employee_initials.ilike.${initials}`);

  if (ors.length === 0) return; // nothing to match on

  const { data, error } = await client
    .from('hb_acks')
    .select('policy_id, signed_initials, agreed, created_at')
    .or(ors.join(','));   // ← match ANY of them

  if (error) {
    console.warn('prefillFromDB error:', error);
    return;
  }

  const byId = new Map((data || []).map(r => [r.policy_id, r]));
  Object.values(SECTIONS).forEach(def => {
    def.items.forEach(item => {
      const pid = POLICY_META?.[item.code]?.id;
      if (!pid) return;
      const row = byId.get(pid);
      if (row && row.agreed) {
        localStorage.setItem(nsKey(def.store) + item.code, JSON.stringify({
          initials: (row.signed_initials || initials || '').toUpperCase(),
          ts: row.created_at
        }));
      }
    });
  });
}


async function saveAckToDB({ initials: typedInitials, policyCode }) {
  if (Object.keys(POLICY_META).length === 0) {
    if (!await loadPoliciesMeta()) {
      return { ok: false, message: `DB connection failed. Local save only.` };
    }
  }

  const meta = POLICY_META?.[policyCode];
  const policyId = meta?.id != null ? Number(meta.id) : null;
  const session_id = getSessionId() || null;
  const s = getSession();
  const ownerInitials = getInitials() || '';
  const employee_id = UUID_RE.test(String(s?.employee_id || '')) ? s.employee_id : null;

  if (!policyId) return { ok:false, message:`Policy ${policyCode} not registered in DB` };

  try {
    // 1) Preferred path: RPC
    const payload = {
      p_initials: ownerInitials,
      p_employee_id: employee_id,
      p_signed_initials: (typedInitials || ownerInitials),
      p_policy_id: policyId,
      p_session_id: session_id,
      p_agreed: true
    };
    const { error } = await client.rpc('hb_ack_policy_api', payload);
    if (!error) return { ok:true };
  } catch (_) { /* fall through to upsert */ }

  // 2) Fallback: UPSERT (no duplicates)
  try {
    const insertPayload = {
      policy_id: policyId,
      employee_initials: (typedInitials || ownerInitials),
      signed_initials: (typedInitials || ownerInitials),
      agreed: true,
      session_id,
      employee_id
    };

    let conflictCols = null;
    if (employee_id) conflictCols = 'policy_id,employee_id';
    else if (session_id) conflictCols = 'policy_id,session_id';
    else conflictCols = 'policy_id,employee_initials';

    const { error } = await client
      .from('hb_acks')
      .upsert(insertPayload, { onConflict: conflictCols });

    if (!error) return { ok:true };
  } catch (_) { /* swallow and report below */ }

  return { ok:false, message:'DB not ready' };
}


    function updateProgress(){
      let total = 0;
      let saved = 0;
      Object.values(SECTIONS).forEach(def => {
          total += def.items.length;
          def.items.forEach(i => {
              if(localStorage.getItem(nsKey(def.store) + i.code)) saved++;
          });
      });

      progTotalEl.textContent = total;
      progCountEl.textContent = saved;
      progBar.style.width = Math.round((saved/total)*100) + '%';
      
      const currentDef = SECTIONS[currentTab];
      const currentTotal = currentDef.items.length;
      let currentSaved = 0;
      currentDef.items.forEach(i => {
          if(localStorage.getItem(nsKey(currentDef.store) + i.code)) currentSaved++;
      });


      const allCurrentDone = currentSaved === currentTotal;
      btnNext.disabled = !allCurrentDone;
      if(allCurrentDone){
        btnNext.classList.remove('bg-slate-400','cursor-not-allowed','opacity-70');
        btnNext.classList.add('bg-jc-green');
      }else{
        btnNext.classList.add('bg-slate-400','cursor-not-allowed','opacity-70');
        btnNext.classList.remove('bg-jc-green');
      }
      
      // existing totals
      const allDone = saved === total;
      
      // Finalize button only becomes clickable if you're on the last section AND all sections are complete
      if (isLastSection(currentTab)) {
        btnFinalize.classList.remove('hidden');
        btnNext.classList.add('hidden');
        
        // Don't disable—allow click handler to show what's missing
        btnFinalize.disabled = false; // ⬅️ key change
        
        if (allDone) {
          btnFinalize.classList.remove('bg-slate-600','hover:bg-slate-700');
          btnFinalize.classList.add('bg-emerald-600','hover:bg-emerald-700');
        } else {
          btnFinalize.classList.add('bg-slate-600','hover:bg-slate-700');
          btnFinalize.classList.remove('bg-emerald-600','hover:bg-emerald-700');
        }
        
        // Optional: re-enable all tabs for free movement after completion
        document.querySelectorAll('.tabbtn').forEach((tab, i)=>{
          tab.disabled = !allDone && (i !== SECTION_ORDER.indexOf(currentTab));
        });
      } else {
        btnFinalize.classList.add('hidden');
        btnNext.classList.remove('hidden');
        // Keep sequential restriction active
        document.querySelectorAll('.tabbtn').forEach((tab, i)=>{
          tab.disabled = (i !== SECTION_ORDER.indexOf(currentTab));
        });
      }
    }

    function wireSaveButtons(){
      document.querySelectorAll('.btnAcknowledge').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const def = SECTIONS[currentTab];
          const code = btn.getAttribute('data-code');
          const inputId = btn.getAttribute('data-input-id');
          const input = document.getElementById(inputId);
          const msgEl = document.getElementById(`msg_${inputId}`);
          const typed = (input?.value || '').trim().toUpperCase();
          if(!typed){ toast(msgEl, 'Enter initials.'); return; }

          // --- UI Update (Acknowledge Button Styling) ---
          btn.disabled = true;
          btn.textContent = 'Saving...';
          btn.classList.remove('bg-jc-gold','bg-jc-green');
          btn.classList.add('bg-slate-500');

          // 1. Save locally (always)
          localStorage.setItem(nsKey(def.store) + code, JSON.stringify({ initials: typed, ts: new Date().toISOString() }));

          // 2. Attempt DB
          const res = await saveAckToDB({ initials: typed, policyCode: code });
          
          // 3. Final UI Update
          const msg = res.ok ? 'Saved to record.' : (res.message || 'Saved locally (DB not ready).');
          toast(msgEl, msg, res.ok);

          if(res.ok){
              btn.textContent = 'Acknowledged';
              btn.classList.remove('bg-slate-500');
              btn.classList.add('bg-jc-green');
              btn.disabled = true;
          } else {
              // Failed, allow retry
              btn.textContent = 'Acknowledge';
              btn.classList.remove('bg-slate-500');
              btn.classList.add('bg-jc-gold');
              btn.disabled = false;
          }
          
          updateProgress();
        });
      });
    }

    /* ========= NAV / FINALIZE (Moved into dedicated function) ========= */
    
    function goPrevSection() {
      const idx = SECTION_ORDER.indexOf(currentTab);
      const prevIdx = Math.max(0, idx - 1);
      gotoSection(SECTION_ORDER[prevIdx]);
    }
    
    function wireNavigationButtons() {
      
      // Back button logic
      btnBack?.addEventListener('click', goPrevSection); 

      // Next button logic
      btnNext.addEventListener('click', ()=>{
        if(btnNext.disabled) return;
        const idx = SECTION_ORDER.indexOf(currentTab);
        if(idx >=0 && idx < SECTION_ORDER.length-1){
          const nextTabKey = SECTION_ORDER[idx+1];
          gotoSection(nextTabKey);   // ← call directly
        }
      });

      // Finalize button logic (The logic that was broken)
      btnFinalize.addEventListener('click', async ()=>{
        // Count total vs saved
        const totalPolicies = Object.values(SECTIONS).reduce((s, d) => s + d.items.length, 0);
        const missing = [];
        for (const [key, def] of Object.entries(SECTIONS)) {
          for (const item of def.items) {
            const k = nsKey(def.store) + item.code;
            if (!localStorage.getItem(k)) missing.push({ key, code: item.code, title: item.title });
          }
        }

        if (missing.length) {
          const first = missing[0]; // show where to go
          toast(document.getElementById('finalizeMsg'),
              `Please acknowledge ALL policies before finalizing. Missing: ${missing.length}. First: ${first.code} ${first.title}`);
          // Jump the user to the first incomplete section so they can fix it
          gotoSection(findResumeSectionKey());
          return;
        }

        await enrichManagerPosition();

        // Build policy-by-section table for the PDF
        const sectionsPayload = collectPolicyRows();

        // Recipient routing from position - NOTE: This is for display/logging only on the client side
        const position  = empProfile.position || 'N/A';
        
        // Finalize button: send neutral data to Edge Function (no emails)
        const allAcks = getAllAcksFromLocalStorage();
        const s = getSession();
        const payload = {
          employee: {
            fullName: empProfile.full_name || s?.full_name || 'N/A',
            initials: getInitials(),
            position: empProfile.position || s?.position || 'N/A',
            department: empProfile.department || s?.department || 'N/A',
            reportsTo: empProfile.reports_to || s?.reports_to || 'N/A',
            email: empProfile.email || s?.email || '',
            phone: empProfile.phone || s?.phone || '',
            sessionId: getSessionId(),
            date: new Date().toISOString()
          },
          policies: allAcks, // send raw list of acknowledged policies
          card: { // snapshot of UI data for PDF layout
            user: document.getElementById('fi_user')?.textContent || '',
            name: document.getElementById('fi_name')?.textContent || '',
            position: document.getElementById('fi_position')?.textContent || '',
            department: document.getElementById('fi_department')?.textContent || '',
            reports_to: document.getElementById('fi_reports_to')?.textContent || '',
            email: document.getElementById('fi_email')?.textContent || '',
            phone: document.getElementById('fi_phone')?.textContent || '',
            session_started: document.getElementById('fi_session_started')?.textContent || ''
          }
        };


        // Log intent (best-effort)
        try {
          await client.from('hb_ack_forms').insert({
            initials: getInitials(),
            session_id: getSessionId() || null,
            employee_id: empProfile.employee_id || null,
            status: 'Finalized - Sending',
            position,
            manager_email_to: getFinalRecipient(position).to, // Log the intended recipient for debugging/admin viewing
          });
        } catch {}

        // === Call the Edge Function to build the PDF & send the email ===
        if (EMAIL_FUNCTION_URL) {
          try {
            btnFinalize.textContent = 'Sending...';
            btnFinalize.disabled = true;

   const { data, error } = await client.functions.invoke(
  'new-generate-ack-pdf-and-email',
  {
    body: payload
  }
);


            if (error) throw error;
            if (data?.error) throw new Error(data.error);

            // ✅ Visible success
            toast(document.getElementById('finalizeMsg'), 'EMAIL SENT — PDF delivered.', true);
            btnFinalize.textContent = 'SUBMITTED';
            btnFinalize.classList.remove('bg-slate-600','hover:bg-slate-700','bg-red-600');
            btnFinalize.classList.add('bg-jc-green','hover:bg-emerald-700');
            btnFinalize.disabled = true; // Lock after successful submit

            try {
              await client.from('hb_ack_forms')
                .update({ status: 'Finalized - Email Sent' })
                .eq('session_id', getSessionId() || null)
                .eq('initials', getInitials() || '');
            } catch {}
          } catch (e) {
            console.error(e);
            toast(document.getElementById('finalizeMsg'), `Email service failed: ${e.message}`, false);
            btnFinalize.textContent = 'SUBMITTED (Email Failed)';
            btnFinalize.classList.remove('bg-slate-600','hover:bg-slate-700','bg-jc-green','hover:bg-emerald-700');
            btnFinalize.classList.add('bg-red-600');
          }
        } else {
          toast(document.getElementById('finalizeMsg'), 'Finalized! (No email function URL configured)', true);
          btnFinalize.textContent = 'SUBMITTED (Mock)';
          btnFinalize.classList.add('bg-jc-green');
        }

      });
    }

    /* ========= BOOT ========= */
    async function bootApp(){
      await fillEmployeeCard();
      wireNavigationButtons();      // <-- WIRE HANDLERS ONCE AT BOOT
      
      // Load DB metadata and hydrate local state once
      await loadPoliciesMeta();
      await prefillFromDB();

      // ⬇️ choose where to land
      currentTab = findResumeSectionKey(); // last tab if saved, else first incomplete, else VIII
      renderSection(currentTab);

      // (optional debug)
      console.group('HB DEBUG — POLICY META');
      console.log('Wanted codes:', wantedCodes());
      console.log('Meta map:', POLICY_META);
      const missing = wantedCodes().filter(c => !POLICY_META?.[c]?.id);
      if (missing.length) {
        console.warn('These codes have NO policy_id in DB (UI will only save local):', missing);
      }
      console.groupEnd();
    }

    (async function init(){
      const s = getSession();
      if (s?.username) { showApp(); await bootApp(); }
      else { showLogin(); }
    })();
  </script>
</body>
</html>
