<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jeng Chi Check Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .tab-btn { padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent; transition: border-color 0.2s, color 0.2s; }
    .tab-btn.active { border-bottom-color: #3b82f6; color: #3b82f6; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center; }
    .modal-content { background-color: #fefefe; padding: 2rem; border-radius: 12px; width: 80%; max-width: 500px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); text-align: center; }
  </style>
</head>
<body class="bg-gray-100 p-8">

  <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-lg p-6">
    <header class="text-center mb-8">
      <img id="company-logo" alt="Jeng Chi Logo" class="mx-auto h-20 mb-4">
      <h1 class="text-3xl font-bold text-blue-600">Inventory Management System</h1>
      <h2 class="text-xl font-semibold text-gray-800">Check & Invoice Tracker</h2>
    </header>

    <div class="flex justify-center border-b border-gray-200 mb-6">
      <button id="invoice-management-tab" class="tab-btn active">Invoice Management</button>
      <button id="view-invoices-tab" class="tab-btn">View Invoices</button>
      <button id="generate-report-tab" class="tab-btn">Generate Report</button>
    </div>

    <!-- Invoice Management -->
    <div id="invoice-management-section" class="tab-content">
      <div class="bg-gray-50 rounded-lg p-4 mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Add New Vendor</h3>
        <div class="flex flex-col sm:flex-row gap-4">
          <input type="text" id="newVendorName" placeholder="Enter New Vendor Name" class="flex-grow p-2 border border-gray-300 rounded-md">
          <button id="btnAddVendor" class="bg-purple-600 text-white font-bold py-2 px-6 rounded-md">Add Vendor</button>
        </div>
      </div>
      <div class="bg-gray-50 rounded-lg p-4 mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Enter New Invoice Details</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div><label>Vendor</label><select id="addInvoiceVendor" class="w-full p-2 border border-gray-300 rounded-md"></select></div>
          <div><label>Invoice Date</label><input type="date" id="addInvoiceDate" class="w-full p-2 border border-gray-300 rounded-md"></div>
          <div><label>Invoice Number</label><input type="text" id="addInvoiceNumber" class="w-full p-2 border border-gray-300 rounded-md"></div>
          <div><label>Invoice Total ($)</label><input type="number" step="0.01" id="addInvoiceTotal" class="w-full p-2 border border-gray-300 rounded-md"></div>
          <div><label>Check Number</label><input type="text" id="addCheckNumber" class="w-full p-2 border border-gray-300 rounded-md"></div>
        </div>
        <div class="text-center mt-6">
          <button id="btnSaveNewInvoice" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-md">Save New Invoice</button>
        </div>
      </div>
    </div>

    <!-- View Invoices -->
    <div id="view-invoices-section" class="tab-content hidden">
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Invoice History</h3>
      <div class="flex gap-4 mb-4">
        <label class="font-medium">Filter by Vendor:</label>
        <select id="invoiceVendorFilter" class="p-2 border border-gray-300 rounded-md">
          <option value="">-- All Vendors --</option>
        </select>
        <label class="font-medium">Filter by Status:</label>
        <select id="invoiceStatusFilter" class="p-2 border border-gray-300 rounded-md">
          <option value="All">All</option>
          <option value="Paid">Paid</option>
          <option value="Unpaid">Unpaid</option>
        </select>
        <label class="font-medium">Filter by Month:</label>
        <select id="invoiceMonthFilter" class="p-2 border border-gray-300 rounded-md">
          <option value="">-- All Months --</option>
        </select>
        <label class="font-medium">Filter by Year:</label>
        <select id="invoiceYearFilter" class="p-2 border border-gray-300 rounded-md">
          <option value="">-- All Years --</option>
        </select>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-2 px-3 text-xs font-semibold">Invoice #</th>
              <th class="py-2 px-3 text-xs font-semibold">Vendor</th>
              <th class="py-2 px-3 text-xs font-semibold">Date</th>
              <th class="py-2 px-3 text-xs font-semibold">Amount</th>
              <th class="py-2 px-3 text-xs font-semibold">Check #</th>
              <th class="py-2 px-3 text-xs font-semibold">Status</th>
            </tr>
          </thead>
          <tbody id="dgvInvoices" class="bg-white divide-y divide-gray-200">
            <tr><td colspan="6" class="text-center py-4 text-gray-500">No invoices to display.</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Generate Report -->
    <div id="generate-report-section" class="tab-content hidden">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Generate Monthly Checks Report</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <div>
          <label class="block">Start Date</label>
          <input type="date" id="reportStartDate" class="w-full p-2 border border-gray-300 rounded-md">
        </div>
        <div>
          <label class="block">End Date</label>
          <input type="date" id="reportEndDate" class="w-full p-2 border border-gray-300 rounded-md">
        </div>
      </div>
      <div class="text-center">
        <button id="btnGenerateReport" class="bg-green-600 text-white font-bold py-2 px-8 rounded-md">Download PDF Report</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="custom-modal" class="modal">
    <div class="modal-content">
      <h3 id="modal-title" class="text-lg font-semibold"></h3>
      <p id="modal-message"></p>
      <button id="modal-close-btn" class="bg-blue-600 text-white py-2 px-6 rounded-md">OK</button>
    </div>
  </div>

  <script>
    window.jsPDF = window.jspdf.jsPDF;
    const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const companyLogoUrl = "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg";
    const vendorLogos = {
      "City of Richardson": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/richardson.jpg",
      "Eiland - Coffe": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/eliand.jpg",
      "Taiwanese Student Association": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/taiwanese.jpg",
      "Bakemark": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/bakemark.jpg",
      "Delta Office Products": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/delta.jpg",
      "Formosa Foods": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/formosa.jpg",
      "North Food Group": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/northfoodgroup.jpg",
      "Pacific Plus": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/pacific.jpg",
      "Fortune": "https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/fortune.jpg"
    };

    const logoDataUrls = {};

    async function preloadImages() {
      console.log("Preloading company logo...");
      try {
        const response = await fetch(companyLogoUrl);
        const blob = await response.blob();
        const reader = new FileReader();
        await new Promise(resolve => {
          reader.onloadend = () => {
            logoDataUrls['company'] = reader.result;
            resolve();
          };
          reader.readAsDataURL(blob);
        });
        console.log("Company logo preloaded.");
      } catch (e) {
        console.error("Failed to preload company logo:", e);
        showMessageModal("Image Error", "Failed to load company logo. Report will be generated without it.");
        logoDataUrls['company'] = null;
      }

      const vendorPromises = Object.keys(vendorLogos).map(async (vendorName) => {
        try {
          const response = await fetch(vendorLogos[vendorName]);
          const blob = await response.blob();
          const reader = new FileReader();
          await new Promise(resolve => {
            reader.onloadend = () => {
              logoDataUrls[vendorName] = reader.result;
              resolve();
            };
            reader.readAsDataURL(blob);
          });
          console.log(`Preloaded logo for ${vendorName}`);
        } catch (e) {
          console.error(`Failed to preload logo for ${vendorName}:`, e);
          logoDataUrls[vendorName] = null;
        }
      });
      await Promise.allSettled(vendorPromises);
      console.log("Vendor logos preload process completed.");
    }

    function showMessageModal(title, msg) {
      document.getElementById("modal-title").textContent = title;
      document.getElementById("modal-message").textContent = msg;
      document.getElementById("custom-modal").style.display = "flex";
    }

    function setupTabs() {
      const tabs = {
        'invoice-management-tab': 'invoice-management-section',
        'view-invoices-tab': 'view-invoices-section',
        'generate-report-tab': 'generate-report-section'
      };
      const tabButtons = document.querySelectorAll('.tab-btn');
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          for (const tabId in tabs) {
            document.getElementById(tabs[tabId]).classList.add('hidden');
          }
          document.getElementById(tabs[button.id]).classList.remove('hidden');
        });
      });
    }

    async function loadVendors() {
      const { data: vendors } = await supabase.from("public_vendors").select("vendor_name").order("vendor_name");
      const addVendor = document.getElementById("addInvoiceVendor");
      const invoiceVendorFilter = document.getElementById("invoiceVendorFilter");
      addVendor.innerHTML = "";
      invoiceVendorFilter.innerHTML = '<option value="">-- All Vendors --</option>';
      if (vendors) {
        vendors.forEach(v => {
          if (v.vendor_name !== "AutoChlor") {
            addVendor.add(new Option(v.vendor_name, v.vendor_name));
            invoiceVendorFilter.add(new Option(v.vendor_name, v.vendor_name));
          }
        });
      }
    }

    async function loadInvoices() {
      const selectedVendor = document.getElementById("invoiceVendorFilter").value;
      const selectedStatus = document.getElementById("invoiceStatusFilter").value;
      const selectedMonth = document.getElementById("invoiceMonthFilter").value;
      const selectedYear = document.getElementById("invoiceYearFilter").value;
      const tableBody = document.getElementById("dgvInvoices");
      tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">Loading...</td></tr>`;

      let query = supabase.from("public_invoices").select("*");

      if (selectedVendor) {
        query = query.eq("VendorName", selectedVendor);
      }
      
      if (selectedStatus !== "All") {
          query = query.eq("Status", selectedStatus);
      }

      // Filter by month and year on InvoiceDate
      if (selectedMonth && selectedYear) {
        const startOfMonth = new Date(selectedYear, selectedMonth - 1, 1).toISOString();
        const endOfMonth = new Date(selectedYear, selectedMonth, 0, 23, 59, 59).toISOString();
        query = query.gte("InvoiceDate", startOfMonth).lte("InvoiceDate", endOfMonth);
      } else if (selectedYear) {
        const startOfYear = new Date(selectedYear, 0, 1).toISOString();
        const endOfYear = new Date(selectedYear, 11, 31, 23, 59, 59).toISOString();
        query = query.gte("InvoiceDate", startOfYear).lte("InvoiceDate", endOfYear);
      }

      const { data: invoices, error } = await query.order("InvoiceDate", { ascending: false });

      if (error || !invoices) {
        console.error(error);
        tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-500">Error loading invoices.</td></tr>`;
        return;
      }
      
      if (invoices.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">No invoices found.</td></tr>`;
        return;
      }

      tableBody.innerHTML = "";
      invoices.forEach(inv => {
        const row = document.createElement("tr");
        const formattedDate = inv.InvoiceDate ? new Date(inv.InvoiceDate).toLocaleDateString("en-US") : "N/A";
        row.innerHTML = `
          <td class="py-2 px-3 text-sm text-gray-700">${inv.InvoiceNumber}</td>
          <td class="py-2 px-3 text-sm text-gray-700">${inv.VendorName}</td>
          <td class="py-2 px-3 text-sm text-gray-700">${formattedDate}</td>
          <td class="py-2 px-3 text-sm text-gray-700">$${Number(inv.InvoiceTotal).toFixed(2)}</td>
          <td class="py-2 px-3 text-sm text-gray-700">${inv.CheckNumber || 'N/A'}</td>
          <td class="py-2 px-3 text-sm text-gray-700">${inv.Status}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    async function saveNewInvoice() {
      const vendorName = document.getElementById("addInvoiceVendor").value;
      const invoiceDate = document.getElementById("addInvoiceDate").value;
      const invoiceNumber = document.getElementById("addInvoiceNumber").value;
      const invoiceTotal = parseFloat(document.getElementById("addInvoiceTotal").value);
      const checkNumber = document.getElementById("addCheckNumber").value;

      if (!vendorName || !invoiceDate || !invoiceNumber || isNaN(invoiceTotal) || !checkNumber) {
        showMessageModal("Validation Error", "Fill out all fields including check number.");
        return;
      }

      const { data: existing } = await supabase.from("public_invoices").select("Id").eq("CheckNumber", checkNumber);
      if (existing && existing.length > 0) {
        showMessageModal("Duplicate Check", `Check #${checkNumber} already exists.`);
        return;
      }

      const { error } = await supabase.from("public_invoices").insert([{
        VendorName: vendorName,
        InvoiceDate: invoiceDate,
        InvoiceNumber: invoiceNumber,
        InvoiceTotal: invoiceTotal,
        CheckNumber: checkNumber,
        CheckDate: invoiceDate,
        Status: "Paid"
      }]);

      if (error) {
        console.error(error);
        showMessageModal("Error", "Failed to save invoice.");
      } else {
        showMessageModal("Success", "Invoice saved and marked Paid.");
        loadInvoices();
      }
    }

    async function addVendor() {
      const newVendorName = document.getElementById("newVendorName").value.trim();
      if (!newVendorName) {
        showMessageModal('Error', 'Please enter a vendor name.');
        return;
      }
      const { error } = await supabase.from("public_vendors").insert([{ vendor_name: newVendorName }]);
      if (error) {
        console.error(error);
        showMessageModal('Error', 'Failed to add vendor.');
      } else {
        showMessageModal('Success', `${newVendorName} added.`);
        document.getElementById("newVendorName").value = "";
        await loadVendors();
      }
    }

    async function generateMonthlyChecksReport() {
      const startDate = document.getElementById('reportStartDate').value;
      const endDate = document.getElementById('reportEndDate').value;

      const { data: paidInvoices, error } = await supabase
        .from("public_invoices")
        .select("*")
        .gte("InvoiceDate", startDate)
        .lte("InvoiceDate", endDate)
        .order("VendorName", { ascending: true })
        .order("InvoiceDate", { ascending: true });

      if (error || !paidInvoices || paidInvoices.length === 0) {
        showMessageModal("No Data", "No paid invoices for this range.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "pt", "a4");
      const pageWidth = doc.internal.pageSize.getWidth();
      let y = 60;
      const margin = 40;
      const tableColumnWidth = (pageWidth - margin * 2) / 4;
      const tableHeaderColors = ['#F8E0E0', '#E0E8F8', '#E0F8E8', '#F8E8E0', '#E8F8E0'];

      // Header with logo and title
      if (logoDataUrls['company']) {
        doc.addImage(logoDataUrls['company'], "JPEG", pageWidth / 2 - 40, 10, 80, 60);
      }
      y = 90;
      doc.setFont("helvetica", "bold").setFontSize(18);
      doc.text("Jeng Chi - Inventory Management System", pageWidth / 2, y, { align: "center" });
      y += 20;
      doc.setFontSize(14);
      doc.text("Monthly Checks Report", pageWidth / 2, y, { align: "center" });
      y += 20;
      doc.setFontSize(12);
      doc.text(`Period: ${new Date(startDate).toLocaleDateString("en-US", { month: "long", day: "2-digit", year: "numeric", timeZone: 'UTC' })} to ${new Date(endDate).toLocaleDateString("en-US", { month: "long", day: "2-digit", year: "numeric", timeZone: 'UTC' })}`, pageWidth / 2, y, { align: "center" });
      y += 30;

      // Group invoices by vendor
      const grouped = paidInvoices.reduce((acc, inv) => {
        (acc[inv.VendorName] = acc[inv.VendorName] || []).push(inv);
        return acc;
      }, {});
      let grandTotal = 0;
      const vendorTotals = {};
      let colorIndex = 0;

      for (const vendor of Object.keys(grouped)) {
        if (y + 50 > doc.internal.pageSize.getHeight() - margin) {
            doc.addPage();
            y = margin;
        }
        let subtotal = 0;
        doc.setFillColor(tableHeaderColors[colorIndex % tableHeaderColors.length]);
        doc.rect(margin, y, pageWidth - margin * 2, 20, "F");
        doc.setFont("helvetica", "bold").setFontSize(12);
        doc.text(vendor, margin + 10, y + 14);
        y += 30;

        // Table headers
        doc.setFont("helvetica", "bold").setFontSize(10);
        doc.text("Invoice #", margin + 5, y);
        doc.text("Date", margin + tableColumnWidth + 5, y);
        doc.text("Amount", margin + tableColumnWidth * 2 + 5, y);
        doc.text("Check #", margin + tableColumnWidth * 3 + 5, y);
        y += 15;

        // Invoice data
        grouped[vendor].forEach(inv => {
            if (y + 15 > doc.internal.pageSize.getHeight() - margin) {
                doc.addPage();
                y = margin;
                doc.setFont("helvetica", "bold").setFontSize(10);
                doc.text("Invoice #", margin + 5, y);
                doc.text("Date", margin + tableColumnWidth + 5, y);
                doc.text("Amount", margin + tableColumnWidth * 2 + 5, y);
                doc.text("Check #", margin + tableColumnWidth * 3 + 5, y);
                y += 15;
            }
            
            let invTotal = Number(inv.InvoiceTotal);
            if (isNaN(invTotal)) invTotal = 0;
            let checkTotal = Number(inv.CheckAmount);
            if (isNaN(checkTotal)) checkTotal = 0;
            
            let invoiceAmount = invTotal > 0 ? invTotal : checkTotal;
            subtotal += invoiceAmount;
            doc.setFont("helvetica", "normal");
            doc.text(inv.InvoiceNumber, margin + 5, y);
            doc.text(new Date(inv.InvoiceDate).toLocaleDateString("en-US", { month: "2-digit", day: "2-digit", year: "numeric" }), margin + tableColumnWidth + 5, y);
            doc.text(`$${invoiceAmount.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, margin + tableColumnWidth * 2 + 5, y);
            doc.text(inv.CheckNumber, margin + tableColumnWidth * 3 + 5, y);
            y += 15;
        });

        grandTotal += subtotal;
        vendorTotals[vendor] = subtotal;

        doc.setFont("helvetica", "bold");
        doc.text(`Subtotal: $${subtotal.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, pageWidth - margin, y, { align: "right" });
        y += 25;
        colorIndex++;
      }

      // Grand total card at the end
      if (y + 100 > doc.internal.pageSize.getHeight()) {
          doc.addPage();
          y = margin;
      }
      y += 20;
      doc.setFillColor(200, 230, 200);
      doc.roundedRect(margin, y, pageWidth - margin * 2, 80, 8, 8, "F");
      
      if (logoDataUrls['company']) {
        doc.addImage(logoDataUrls['company'], "JPEG", margin + 10, y + 10, 60, 60);
      }
      
      doc.setFont("helvetica", "bold").setFontSize(14);
      doc.text("Grand Total", margin + 80, y + 30);
      doc.setFont("helvetica", "normal").setFontSize(14);
      doc.text(`$${grandTotal.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, pageWidth - margin - 10, y + 30, { align: "right" });

      y += 100;
      if (y > doc.internal.pageSize.getHeight() - 80) { doc.addPage(); y = 60; }

      // Summary cards section
      doc.setFont("helvetica", "bold").setFontSize(12);
      doc.text("Summary by Vendor", pageWidth / 2, y, { align: "center" });
      y += 20;

      const cardWidth = (pageWidth - margin * 3) / 2;
      let x = margin;
      let cardY = y;
      let cardCount = 0;

      for (const [vendor, total] of Object.entries(vendorTotals)) {
        doc.setFillColor(245, 245, 245);
        doc.roundedRect(x, cardY, cardWidth, 100, 8, 8, "F");
        
        if (logoDataUrls[vendor]) {
          doc.addImage(logoDataUrls[vendor], "JPEG", x + cardWidth / 2 - 25, cardY + 10, 50, 40);
        } else {
          // Fallback text if no logo exists
          doc.setFont("helvetica", "bold").setFontSize(10);
          doc.text("Logo", x + cardWidth / 2, cardY + 30, { align: "center" });
        }

        doc.setFont("helvetica", "bold").setFontSize(11);
        doc.text(vendor, x + cardWidth/2, cardY + 65, { align: "center" });
        doc.setFont("helvetica", "normal").setFontSize(11);
        doc.text(`$${total.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, x + cardWidth/2, cardY + 85, { align: "center" });

        x += cardWidth + margin;
        cardCount++;
        if (cardCount % 2 === 0) {
          x = margin;
          cardY += 120;
        }
      }

      doc.save(`JengChi_Checks_Report_${startDate}_to_${endDate}.pdf`);
      showMessageModal("Report Generated", "PDF downloaded.");
    }
    // --- DOMContentLoaded Listener ---
    document.addEventListener("DOMContentLoaded", async () => {
      document.getElementById("modal-close-btn").onclick = () => document.getElementById("custom-modal").style.display = "none";
      setupTabs();
      await preloadImages(); 
      document.getElementById('company-logo').src = logoDataUrls['company'];
      
      // Setup filters for Paid Invoices tab
      const invoiceMonthFilter = document.getElementById('invoiceMonthFilter');
      const invoiceYearFilter = document.getElementById('invoiceYearFilter');
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      const currentYear = new Date().getFullYear();
      
      months.forEach((month, index) => {
        const option = document.createElement('option');
        option.value = index + 1;
        option.textContent = month;
        invoiceMonthFilter.appendChild(option);
      });
      for (let i = currentYear; i >= 2020; i--) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        invoiceYearFilter.appendChild(option);
      }
      invoiceMonthFilter.value = "";
      invoiceYearFilter.value = "";

      loadVendors();
      loadInvoices(); 
      document.getElementById("invoiceVendorFilter").addEventListener("change", loadInvoices);
      document.getElementById("invoiceMonthFilter").addEventListener("change", loadInvoices);
      document.getElementById("invoiceYearFilter").addEventListener("change", loadInvoices);
      document.getElementById("invoiceStatusFilter").addEventListener("change", loadInvoices);

      document.getElementById("btnSaveNewInvoice").addEventListener("click", saveNewInvoice);
      document.getElementById("btnAddVendor").addEventListener("click", addVendor);
      document.getElementById("btnGenerateReport").addEventListener("click", generateMonthlyChecksReport);
      
      // Initialize report date inputs with current month/year
      const reportStartDate = document.getElementById('reportStartDate');
      const reportEndDate = document.getElementById('reportEndDate');
      const now = new Date();
      reportStartDate.value = new Date(now.getFullYear(), now.getMonth(), 1).toISOString().substring(0, 10);
      reportEndDate.value = new Date(now.getFullYear(), now.getMonth() + 1, 0).toISOString().substring(0, 10);
    });
  </script>
</body>
</html>
