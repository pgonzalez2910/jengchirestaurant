<!DOCTYPE html>
<html lang="en" class="h-full bg-[#FBF8F3]">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Jeng Chi â€” Employee Portal & Survey</title>

Â  <!-- Tailwind -->
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  <script>
Â  Â  tailwind.config = {
Â  Â  Â  theme: {
Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  fontFamily: { 'serif-head':['Playfair Display','serif'], sans:['Inter','system-ui','sans-serif'] },
Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  'jc-ink':'#0F172A',
Â  Â  Â  Â  Â  Â  'jc-muted':'#6B7280',
Â  Â  Â  Â  Â  Â  'jc-gold':'#C0A06D',
Â  Â  Â  Â  Â  Â  'jc-border':'#E5E7EB',
Â  Â  Â  Â  Â  Â  'jc-card':'#FFFFFF'
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  boxShadow: { 'elevated':'0 30px 80px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.06)' }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  </script>

Â  <!-- Supabase JS -->
Â  <script type="module" defer src="https://esm.sh/@supabase/supabase-js@2?bundle"></script>

Â  <style>
Â  Â  .card{ background:#FFF; border:1px solid #E5E7EB; border-radius:20px }
Â  Â  .gold-btn{ background:#C0A06D; color:#111; }
Â  Â  .gold-btn:hover{ filter:brightness(0.98) }
Â  Â  .gold-divider{ height:4px; background:linear-gradient(90deg,#C0A06D,#D7BF8F,#C0A06D); border-radius:999px }
Â  Â  .choice:hover{ background:#FAFAFA }
Â  Â  @media print{ .no-print{display:none!important} body{background:#FFF} }

Â  Â  /* Redesign for centered login */
Â  Â  #loginSection {
Â  Â  Â  min-height: 100vh;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  padding: 3rem 1rem;
Â  Â  }
Â  Â  /* Corporate Information Layout Styling - COMPACT HORIZONTAL */
Â  Â  .info-container {
Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  grid-template-columns: repeat(2, minmax(0, 1fr));
Â  Â  Â  Â  gap: 0 4rem; /* Horizontal gap is large, vertical is minimal */
Â  Â  }
Â  Â  .info-field {
Â  Â  Â  Â  padding: 0.5rem 0; /* Minimal vertical padding */
Â  Â  Â  Â  border-bottom: 1px solid #F3F4F6; /* Very light divider line for grouping */
Â  Â  }
Â  Â  /* Vertical separator for second column on desktop */
Â  Â  @media (min-width: 768px) {
Â  Â  Â  Â  .info-field:nth-child(2n) {
Â  Â  Â  Â  Â  Â  border-left: 1px solid #E5E7EB; /* Subtle vertical divider */
Â  Â  Â  Â  Â  Â  padding-left: 1.5rem;
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  /* Ensure the last two fields don't have bottom borders */
Â  Â  .info-container > div:nth-last-child(1),
Â  Â  .info-container > div:nth-last-child(2) {
Â  Â  Â  Â  border-bottom: none;
Â  Â  }
Â  Â Â 
Â  Â  .info-label {
Â  Â  Â  Â  font-size: 0.75rem; /* text-xs */
Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  color: #6B7280; /* jc-muted */
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  letter-spacing: 0.05em;
Â  Â  Â  Â  margin-bottom: 0.125rem;
Â  Â  }
Â  Â  .info-value {
Â  Â  Â  Â  font-weight: 600; /* font-semibold */
Â  Â  Â  Â  font-size: 1rem; /* text-base */
Â  Â  Â  Â  color: #0F172A; /* jc-ink */
Â  Â  }
Â  </style>
</head>

<body class="h-full font-sans text-jc-ink">
Â  <main class="min-h-screen">
Â  Â  <!-- ===== Login ===== -->
Â  Â  <section id="loginSection">
Â  Â  Â  <div class="w-full max-w-sm mx-auto card shadow-elevated p-8 relative overflow-hidden">
Â  Â  Â  Â  <div class="absolute inset-0 pointer-events-none" style="background:radial-gradient(1200px 400px at 50% -50%, rgba(192,160,109,0.15), transparent)"></div>

Â  Â  Â  Â  <div class="relative flex flex-col items-center gap-4 pt-4 pb-2">
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg" alt="Jeng Chi Logo" class="h-16 w-auto rounded-xl shadow-md" onerror="this.style.display='none'"/>
Â  Â  Â  Â  Â  <h1 class="font-serif-head text-3xl tracking-tight text-jc-ink">Employee Access</h1>
Â  Â  Â  Â  Â  <p class="text-jc-muted text-sm -mt-2">Sign in using your corporate credentials</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <form id="loginForm" class="mt-8 space-y-5">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-jc-muted mb-1" for="inUsername">Username</label>
Â  Â  Â  Â  Â  Â  <input id="inUsername" class="w-full rounded-lg border border-jc-border px-3.5 py-2.5 focus:outline-none focus:ring-2 focus:ring-jc-gold placeholder:text-slate-400" placeholder="" autocomplete="username" autofocus>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-jc-muted mb-1" for="inPIN">PIN</label>
Â  Â  Â  Â  Â  Â  <input id="inPIN"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type="password"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â inputmode="numeric"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pattern="[0-9]{4}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â maxlength="4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full rounded-lg border border-jc-border px-3.5 py-2.5 focus:outline-none focus:ring-2 focus:ring-jc-gold placeholder:text-slate-400 tracking-widest text-center"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="â€¢â€¢â€¢â€¢"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â autocomplete="one-time-code"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â aria-describedby="pinHelp">
Â  Â  Â  Â  Â  Â  <p id="pinHelp" class="text-xs text-jc-muted mt-1">Enter your 4-digit numeric PIN.</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button id="btnLogin" type="submit" class="w-full gold-btn rounded-lg py-3.5 font-semibold text-lg shadow-md hover:shadow-lg transition-shadow">Sign in to Portal</button>
Â  Â  Â  Â  Â  <p id="loginError" class="text-sm text-red-600 hidden text-center pt-2"></p>
Â  Â  Â  Â  </form>

Â  Â  Â  Â  <div class="text-center text-[10px] text-jc-muted mt-10 border-t border-jc-border pt-4">
Â  Â  Â  Â  Â  Need Assistance? Contact HR at (972) 669-9094
Â  Â  Â  Â  Â  <div class="mt-1">400 North Greenville Avenue Ste 11, Richardson TX 75091</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â Â 

Â  Â  <!-- ===== Already Submitted Message ===== -->
Â  Â  <section id="alreadySection" class="hidden">
Â  Â  Â  <div class="max-w-3xl mx-auto mt-10 card p-8 text-center">
Â  Â  Â  Â  <h2 class="font-serif-head text-2xl mb-2">Survey Submitted</h2>
Â  Â  Â  Â  <p class="text-jc-muted">Our records show you already completed this training survey. Thank you!</p>
Â  Â  Â  Â  <p class="text-jc-muted mt-1">If you believe this is a mistake, please contact your supervisor.</p>
Â  Â  Â  Â  <button class="mt-6 gold-btn px-5 py-3 rounded-lg" onclick="location.reload()">OK</button>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  <!-- ===== Post-login Content (Summary + Survey) -->
Â  Â  <section id="contentSection" class="hidden">
Â  Â  Â  <!-- Survey header with address -->
Â  Â  Â  <div class="bg-white border-t border-b border-jc-border no-print">
Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 md:px-8 py-4 text-sm text-jc-muted flex flex-col md:flex-row gap-2 md:gap-6 md:items-center">
Â  Â  Â  Â  Â  <div>400 North Greenville Avenue Ste 11, Richardson Texas 75091</div>
Â  Â  Â  Â  Â  <div class="hidden md:block">â€¢</div>
Â  Â  Â  Â  Â  <div>admin@jengchirestaurant.com</div>
Â  Â  Â  Â  Â  <div class="hidden md:block">â€¢</div>
Â  Â  Â  Â  Â  <div>Tel (972) 669-9094</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="max-w-6xl mx-auto px-4 md:px-8 py-8 space-y-8">
        
Â  Â  Â  Â  <!-- SIMPLE GREETING -->
Â  Â  Â  Â  <p class="text-xl font-semibold text-jc-ink mb-4" id="greetingMessage">Loading Employee Data...</p>

Â  Â  Â  Â  <!-- Survey -->
Â  Â  Â  Â  <div class="card p-6 md:p-8 shadow-elevated">
Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  <h2 class="font-serif-head text-2xl">Steps of Service â€” Training Survey</h2>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div id="surveyMessage" class="mt-4 hidden p-4 rounded-xl text-sm font-medium border border-red-200 bg-red-50 text-red-700"></div>

Â  Â  Â  Â  Â  <form id="surveyForm" class="mt-6 space-y-6 text-[15px]">
Â  Â  Â  Â  Â  Â  <!-- (Questions unchanged) -->
Â  Â  Â  Â  Â  Â  <!-- Q1 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q1. Shipley Donuts provided the kolaches. What was your favorite flavor? <span class="text-jc-muted">(Choose one)</span></legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q0" value="Sausage" required> Sausage</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q0" value="Sausage with Cheese"> Sausage with Cheese</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q0" value="Sausage with Cheese & JalapeÃ±o" required> Sausage with Cheese &amp; JalapeÃ±o</label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q2 (Choose 2) - required attribute removed from inputs -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q2. When do we place a black bev nap on the table? <span class="text-jc-muted">(Choose 2)</span></legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q1" value="When ordering dessert"> <span>When ordering dessert</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q1" value="When the appetizer arrives"> <span>When the appetizer arrives</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q1" value="When weâ€™re pre-bussing"> <span>When weâ€™re pre-bussing</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q1" value="When we greet the guest at the table"> <span>When we greet the guest at the table</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q1" value="When the bev nap is wet"> <span>When the bev nap is wet</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-jc-muted mt-2">Exactly 2 boxes must be selected.</p>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q3 (Choose 2) - required attribute removed from inputs -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q3. When do we bring tap water to the guest? <span class="text-jc-muted">(Choose 2)</span></legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q2" value="On Tuesday"> <span>On Tuesday</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q2" value="After offering an upsell to bottled water, tea, cocktails."> <span>After offering an upsell to bottled water, tea, cocktails.</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q2" value="We do not automatically bring water glasses to the table."> <span>We do not automatically bring water glasses to the table.</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q2" value="When the guest asks for tap water"> <span>When the guest asks for tap water</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-jc-muted mt-2">Exactly 2 boxes must be selected.</p>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q4 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q4. What is the rule of 2?</legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q3" value="Order 2 Traditional Fruit Cake at a time" required> <span>Order 2 Traditional Fruit Cake at a time</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q3" value="2 minute or 2 bite check back" required> <span>2 minute or 2 bite check back</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q3" value="Send 2 bowls of rice" required> <span>Send 2 bowls of rice</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q3" value="Greet the customer within the first 2 minutes of being seated" required> <span>Greet the customer within the first 2 minutes of being seated</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q5 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q5. What is the rule of 1?</legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q4" value="Order 1 Traditional Fruit Cake at a time" required> <span>Order 1 Traditional Fruit Cake at a time</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q4" value="There is no rule of 1" required> <span>There is no rule of 1</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q6 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q6. According to our Steps of Service, what is the correct order for service?</legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q5" value="Fire the orders for drinks and food, deliver food, deliver drinks" required> <span>Fire the orders for drinks and food, deliver food, deliver drinks</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q5" value="Place bev nap on the table, order drinks, deliver drinks, order food, deliver food, 2 minute check back, pre buss" required> <span>Place bev nap on the table, order drinks, deliver drinks, order food, deliver food, 2 minute check back, pre buss</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q5" value="Take tap water to the table, order food, deliver food, order drinks, deliver drinks" required> <span>Take tap water to the table, order food, deliver food, order drinks, deliver drinks</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q5" value="Serve water, order & serve appetizers and food, order drinks" required> <span>Serve water, order &amp; serve appetizers and food, order drinks</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q7 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q7. Which of these is <u>not</u> true when hosting?</legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q6" value="First (early) shift receives large table priority" required> <span>First (early) shift receives large table priority</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q6" value="Ask the customer what table they would like to sit" required> <span>Ask the customer what table they would like to sit </span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q6" value="Mark the table youâ€™re taking the guest to" required> <span>Mark the table youâ€™re taking the guest to</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q6" value="Always tap out table when the guest has left" required> <span>Always tap out table when the guest has left</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q8 -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q8. When handing the menu weâ€¦</legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q7" value="Drop a stack on the table" required> <span>Drop a stack on the table</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="radio" name="q7" value="Place the bar menu on the table then hand the menu to the guest" required> <span>Place the bar menu on the table then hand the menu to the guest</span></label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q9 (Choose 3) - required attribute removed from inputs -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q9. When do we wipe all menus? <span class="text-jc-muted">(Choose 3)</span></legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q8" value="11am"> 11am</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q8" value="2-4pm"> 2-4pm</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q8" value="8-8:30pm"> 8-8:30pm</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q8" value="Whenever they are dirty"> Whenever they are dirty</label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-jc-muted mt-2">Exactly 3 boxes must be selected.</p>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Q10 (Choose 2) - required attribute removed from inputs -->
Â  Â  Â  Â  Â  Â  <fieldset class="border border-jc-border rounded-xl p-4">
Â  Â  Â  Â  Â  Â  Â  <legend class="px-2 text-sm font-semibold">Q10. When do we fill the condiments on the table? <span class="text-jc-muted">(Choose 2)</span></legend>
Â  Â  Â  Â  Â  Â  Â  <div class="mt-3 grid gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q9" value="11am"> 11am</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q9" value="Before we take our break"> Before we take our break</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q9" value="Whenever they are used"> Whenever they are used</label>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="choice flex items-center gap-3 rounded-lg border border-jc-border px-3 py-2"><input type="checkbox" name="q9" value="Only at closing"> Only at closing</label>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-jc-muted mt-2">Exactly 2 boxes must be selected.</p>
Â  Â  Â  Â  Â  Â  </fieldset>

Â  Â  Â  Â  Â  Â  <!-- Progress -->
Â  Â  Â  Â  Â  Â  <div class="mb-2">
Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between text-sm text-jc-muted">
Â  Â  Â  Â  Â  Â  Â  Â  <span>Completion</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="progressPct">0%</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="progressBar" class="h-2 bg-[#C0A06D] w-0 rounded-full"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between pt-2">
Â  Â  Â  Â  Â  Â  Â  <button class="no-print gold-btn inline-flex items-center gap-2 rounded-lg px-6 py-3 font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id="btnSubmit" type="submit" disabled>Submit Survey</button>
Â  Â  Â  Â  Â  Â  Â  <span id="submitMsg" class="text-sm text-jc-muted"></span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Results (now displayed after submission) -->
Â  Â  Â  Â  <div id="reportCard" class="card p-6 md:p-8 shadow-elevated hidden">
Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  <h2 class="font-serif-head text-2xl">Your Results</h2>
Â  Â  Â  Â  Â  Â  <button class="no-print border border-jc-border px-4 py-2 rounded-lg hover:bg-slate-50" onclick="window.print()">Print</button>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div id="reportBody" class="mt-4 text-[15px]"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  <!-- Footer disclaimer -->
Â  Â  Â  <footer class="mt-8">
Â  Â  Â  Â  <div class="max-w-6xl mx-auto px-4 md:px-8">
Â  Â  Â  Â  Â  <div class="gold-divider mb-3"></div>
Â  Â  Â  Â  Â  <p class="text-xs text-jc-muted pb-8">
Â  Â  Â  Â  Â  Â  Disclaimer: This training survey is for internal use by Jeng Chi Restaurant employees. By submitting, you confirm that
Â  Â  Â  Â  Â  Â  answers represent your understanding of the Steps of Service. For questions, contact your supervisor or HR. The English
Â  Â  Â  Â  Â  Â  version controls in case of any translation differences.
Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  </div>
Â  Â  Â  </footer>
Â  Â  </section>
Â  </main>

Â  <script type="module">
Â  Â  import { createClient } from "https://esm.sh/@supabase/supabase-js@2?bundle";

Â  Â  // Supabase (your project)
Â  Â  const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
Â  Â  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
Â  Â  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

Â  Â  // Elements
Â  Â  const loginForm = document.getElementById('loginForm');
Â  Â  const loginSection = document.getElementById('loginSection');
Â  Â  const contentSection = document.getElementById('contentSection');
Â  Â  const alreadySection = document.getElementById('alreadySection');

Â  Â  const inUsername = document.getElementById('inUsername');
Â  Â  const inPIN = document.getElementById('inPIN');
Â  Â  const loginError = document.getElementById('loginError');

Â  Â  const surveyForm = document.getElementById('surveyForm');
Â  Â  const btnSubmit = document.getElementById('btnSubmit');
Â  Â  const submitMsg = document.getElementById('submitMsg');
Â  Â  const surveyMessage = document.getElementById('surveyMessage');

Â  Â  // Elements for results display
Â  Â  const reportCard = document.getElementById('reportCard');
Â  Â  const reportBody = document.getElementById('reportBody');

Â  Â  // SIMPLE GREETING ELEMENT
Â  Â  const greetingMessage = document.getElementById('greetingMessage');

Â  Â  let currentEmp = null;

Â  Â  // Correct answers for scoring (q6 fixed to remove trailing space)
Â  Â const correct = {
Â  Â  q1: ["When we greet the guest at the table", "When the bev nap is wet"], // Q2 (Choose 2)
Â  Â  q2: ["When the guest asks for tap water", "After offering an upsell to bottled water, tea, cocktails."], // Q3 (Choose 2)
Â  Â  q3: "2 minute or 2 bite check back",
Â  Â  q4: "There is no rule of 1",
Â  Â  q5: "Place bev nap on the table, order drinks, deliver drinks, order food, deliver food, 2 minute check back, pre buss",
Â  Â  q6: "Ask the customer what table they would like to sit", // Q7 (Which is NOT true when hosting)
Â  Â  q7: "Place the bar menu on the table then hand the menu to the guest", // Q8
Â  Â  q8: ["2-4pm","8-8:30pm","Whenever they are dirty"],Â  Â  Â  Â  Â  Â // Q9 Menus â€” (Choose 3)
Â  Â  q9: ["Before we take our break", "Whenever they are used"]Â  Â  Â  // Q10 Condiments â€” (Choose 2) **UPDATED**
Â  Â };

Â  Â // Question mapping for report card
Â  Â const QUESTIONS = [
Â  Â  { key: 'q0', text: 'Q1. Shipley Donuts provided the kolaches. What was your favorite flavor?' },
Â  Â  { key: 'q1', text: 'Q2. When do we place a black bev nap on the table?' },
Â  Â  { key: 'q2', text: 'Q3. When do we bring tap water to the guest?' },
Â  Â  { key: 'q3', text: 'Q4. What is the rule of 2?' },
Â  Â  { key: 'q4', text: 'Q5. What is the rule of 1?' },
Â  Â  { key: 'q5', text: 'Q6. According to our Steps of Service, what is the correct order for service?' },
Â  Â  { key: 'q6', text: 'Q7. Which of these is not true when hosting?' },
Â  Â  { key: 'q7', text: 'Q8. When handing the menu weâ€¦' },
Â  Â  { key: 'q8', text: 'Q9. When do we wipe all menus?' },
Â  Â  { key: 'q9', text: 'Q10. When do we fill the condiments on the table?' }
Â  Â ];

Â  Â  // Utils
Â  Â  const $$ = (s) => Array.from(document.querySelectorAll(s));
Â  Â  const getChecked = (name) => $$( 'input[name="'+name+'"]:checked' ).map(i => i.value);
Â  Â  const arraysEqualSet = (a,b) => {
Â  Â  Â  const A = new Set(a), B = new Set(b);
Â  Â  Â  if (A.size !== B.size) return false;
Â  Â  Â  for (const v of A) if (!B.has(v)) return false;
Â  Â  Â  return true;
Â  Â  };

Â  Â  // Progress tracking (Q0..Q9 must be complete => 100%)
Â  Â  const progressBar = document.getElementById('progressBar');
Â  Â  const progressPct = document.getElementById('progressPct');
Â  Â  // REQUIRED COUNT: q1, q2, q9 need 2 selections; q8 needs 3 selections. The rest need 1.
Â  Â  const REQUIRED = { q0:1,q1:2,q2:2,q3:1,q4:1,q5:1,q6:1,q7:1,q8:3,q9:2 };
Â  Â  const KNOWLEDGE_KEYS = ['q1','q2','q3','q4','q5','q6','q7','q8','q9'];
Â  Â  const ALL_FORM_FIELDS = Object.keys(REQUIRED);

Â  Â  function isComplete(name){
Â  Â  Â  // For radio buttons (where required is 1 and input type is radio)
Â  Â  Â  if (REQUIRED[name]===1 && document.querySelector(`input[name="${name}"]`)?.type === 'radio') {
Â  Â  Â  Â  return !!document.querySelector(`input[name="${name}"]:checked`);
Â  Â  Â  }
Â  Â  Â  // For checkboxes (q1, q2, q8, q9)
Â  Â  Â  return getChecked(name).length === REQUIRED[name];
Â  Â  }
Â  Â  function computeProgress(){
Â  Â  Â  const done = ALL_FORM_FIELDS.filter(isComplete).length;
Â  Â  Â  const pct = Math.round((done / ALL_FORM_FIELDS.length) * 100);
Â  Â  Â  progressBar.style.width = pct + '%';
Â  Â  Â  progressPct.textContent = pct + '%';
Â  Â  Â  btnSubmit.disabled = (pct < 100);
Â  Â  }
Â  Â  ALL_FORM_FIELDS.forEach(name=>{
Â  Â  Â  document.querySelectorAll(`input[name="${name}"]`).forEach(el=>el.addEventListener('change', computeProgress));
Â  Â  });

Â  Â  // Multi-select validation (limit to required number)
Â  Â  $$('input[name="q1"]').forEach(cb => cb.addEventListener('change', ()=>{ const a=getChecked('q1'); if(a.length>2) cb.checked=false; computeProgress(); }));
Â  Â  $$('input[name="q2"]').forEach(cb => cb.addEventListener('change', ()=>{ const a=getChecked('q2'); if(a.length>2) cb.checked=false; computeProgress(); }));
Â  Â  $$('input[name="q8"]').forEach(cb => cb.addEventListener('change', ()=>{ const a=getChecked('q8'); if(a.length>3) cb.checked=false; computeProgress(); }));
Â  Â  $$('input[name="q9"]').forEach(cb => cb.addEventListener('change', ()=>{ const a=getChecked('q9'); if(a.length>2) cb.checked=false; computeProgress(); }));

Â  Â  function disableSurvey(message, success=false){
Â  Â  Â  surveyMessage.textContent = message;
Â  Â  Â  surveyMessage.classList.remove('hidden','border-red-200','bg-red-50','text-red-700','border-green-200','bg-green-50','text-green-700');
Â  Â  Â  surveyMessage.classList.add(success ? 'border-green-200':'border-red-200', success ? 'bg-green-50':'bg-red-50', success ? 'text-green-700':'text-red-700');
Â  Â  Â  $$('#surveyForm input').forEach(el=>el.disabled=true);
Â  Â  Â  btnSubmit.classList.add('hidden');
Â  Â  }
Â  Â Â 
Â  Â  // Utility to safely format answers for display
Â  Â  function formatAnswer(answer) {
Â  Â  Â  if (Array.isArray(answer)) {
Â  Â  Â  Â  // Handle array of answers (checkboxes)
Â  Â  Â  Â  if (answer.length === 0) return '<span class="text-red-500 font-semibold italic">No answer selected</span>';
Â  Â  Â  Â  return answer.map(a => `<span>${a}</span>`).join('<br/>');
Â  Â  Â  }
Â  Â  Â  // Handle single string answer (radio buttons)
Â  Â  Â  return answer || '<span class="text-red-500 font-semibold italic">No answer selected</span>';
Â  Â  }

Â  Â  // Function to display results after submission
Â  Â  function displayResults(answers, score, total) {
Â  Â  Â  Â  // Hide the survey form/content
Â  Â  Â  Â  surveyForm.classList.add('hidden');

Â  Â  Â  Â  let reportHtml = `<div class="mb-6 pb-4 border-b border-jc-border">
Â  Â  Â  Â  Â  Â  <h3 class="text-4xl font-serif-head mb-1 text-jc-ink">${score}/${total}</h3>
Â  Â  Â  Â  Â  Â  <p class="text-lg text-jc-muted font-medium">Knowledge Score (Q2 - Q10)</p>
Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  // Only iterate over the knowledge questions (q1-q9), skip q0 (kolache flavor)
Â  Â  Â  Â  const knowledgeQuestions = QUESTIONS.filter(q => KNOWLEDGE_KEYS.includes(q.key));

Â  Â  Â  Â  knowledgeQuestions.forEach((q) => {
Â  Â  Â  Â  Â  Â  const key = q.key;
Â  Â  Â  Â  Â  Â  const userAnswer = answers[key];
Â  Â  Â  Â  Â  Â  const correctAnswer = correct[key];

Â  Â  Â  Â  Â  Â  const isCorrect = Array.isArray(correctAnswer)
Â  Â  Â  Â  Â  Â  Â  Â  ? arraysEqualSet(userAnswer, correctAnswer)
Â  Â  Â  Â  Â  Â  Â  Â  : (userAnswer === correctAnswer);

Â  Â  Â  Â  Â  Â  const statusClass = isCorrect ? 'text-green-600' : 'text-red-600';

Â  Â  Â  Â  Â  Â  reportHtml += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="py-4 border-b border-jc-border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-semibold text-jc-ink">${q.text}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-2 pl-4 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-medium ${isCorrect ? 'text-green-600' : 'text-red-600'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Your Answer: ${formatAnswer(userAnswer)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${!isCorrect ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm font-medium text-green-600">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Correct Answer: ${formatAnswer(correctAnswer)}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  });

Â  Â  Â  Â  reportBody.innerHTML = reportHtml;
Â  Â  Â  Â  // Show the report card
Â  Â  Â  Â  reportCard.classList.remove('hidden');
Â  Â  Â  Â  // Scroll to the results for visibility
Â  Â  Â  Â  reportCard.scrollIntoView({ behavior: 'smooth' });
Â  Â  }

Â  Â  // ===== Login flow (using RPC) =====
Â  Â  loginForm.addEventListener('submit', async (ev)=>{
Â  Â  Â  ev.preventDefault();
Â  Â  Â  loginError.classList.add('hidden');

Â  Â  Â  const u = inUsername.value.trim();
Â  Â  Â  const p = inPIN.value.trim();

Â  Â  Â  if(!u || !p){
Â  Â  Â  Â  loginError.textContent="Enter username and PIN.";
Â  Â  Â  Â  loginError.classList.remove('hidden');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  // EXACTLY 4 DIGITS
Â  Â  Â  if(!/^\d{4}$/.test(p)){
Â  Â  Â  Â  loginError.textContent="PIN must be exactly 4 digits.";
Â  Â  Â  Â  loginError.classList.remove('hidden');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  try{
Â  Â  Â  Â  // Attempt login using the hb_auth_employee RPC
Â  Â  Â  Â  const { data, error } = await sb.rpc('hb_auth_employee', { in_username: u, in_pin: p });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // For debugging login issues:
Â  Â  Â  Â  console.log('Login RPC Data:', data);
Â  Â  Â  Â  console.log('Login RPC Error:', error);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(error) throw error;
Â  Â  Â  Â  if(!data || !data.length){
Â  Â  Â  Â  Â  loginError.textContent="Invalid credentials.";
Â  Â  Â  Â  Â  loginError.classList.remove('hidden');
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const e = data[0];
Â  Â  Â  Â  currentEmp = {
Â  Â  Â  Â  Â  employee_id: e.id,
Â  Â  Â  Â  Â  username: e.username,
Â  Â  Â  Â  Â  full_name: e.full_name || '',
Â  Â  Â  Â  Â  email: e.email || '',
Â  Â  Â  Â  Â  phone: e.phone || '',
Â  Â  Â  Â  Â  position: e.position || e["position"] || '',
Â  Â  Â  Â  Â  department: e.department || '',
Â  Â  Â  Â  Â  reports_to: e.reports_to || '',
Â  Â  Â  Â  Â  is_owner: !!e.is_owner
Â  Â  Â  Â  };

Â  Â  Â  Â  // NEW: Populate the simple greeting message
Â  Â  Â  Â  const names = currentEmp.full_name.split(' ');
Â  Â  Â  Â  const firstName = names[0] || currentEmp.username;
Â  Â  Â  Â  greetingMessage.textContent = `Hello, ${firstName}! Please complete the training survey below.`;


Â  Â  Â  Â  // Check already submitted
Â  Â  Â  Â  const { data: already, error: alreadyErr } = await sb.rpc('hb_ts_already_submitted', { p_employee_id: currentEmp.employee_id });
Â  Â  Â  Â  if(alreadyErr){
Â  Â  Â  Â  Â  console.error('already-submitted RPC error:', alreadyErr);
Â  Â  Â  Â  }

Â  Â  Â  Â  loginSection.classList.add('hidden');
Â  Â  Â  Â  if (already === true) {
Â  Â  Â  Â  Â  contentSection.classList.add('hidden');
Â  Â  Â  Â  Â  alreadySection.classList.remove('hidden');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alreadySection.classList.add('hidden');
Â  Â  Â  Â  Â  contentSection.classList.remove('hidden');
Â  Â  Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  Â  Â  Â  computeProgress();
Â  Â  Â  Â  }
Â  Â  Â  }catch(err){
Â  Â  Â  Â  console.error('Login error:', err);
Â  Â  Â  Â  loginError.textContent = `Sign-in failed. Error: ${err.message || "Try again."}`;
Â  Â  Â  Â  loginError.classList.remove('hidden');
Â  Â  Â  }
Â  Â  });


Â  Â // ===== Submit survey =====
surveyForm.addEventListener('submit', async (e) => {
Â  e.preventDefault();
Â  if (!currentEmp) {
Â  Â  submitMsg.textContent = "Sign in first.";
Â  Â  submitMsg.classList.add('text-red-600');
Â  Â  return;
Â  }

Â  btnSubmit.disabled = true;
Â  submitMsg.textContent = "";

Â  try {
Â  Â  // Build answers
Â  Â  const fd = new FormData(surveyForm);
Â  Â  const a = {
Â  Â  Â  q0: (fd.get('q0') || "").toString(),
Â  Â  Â  q1: getChecked('q1'), // Now an array of strings
Â  Â  Â  q2: getChecked('q2'), // Now an array of strings
Â  Â  Â  q3: (fd.get('q3') || "").toString(),
Â  Â  Â  q4: (fd.get('q4') || "").toString(),
Â  Â  Â  q5: (fd.get('q5') || "").toString(),
Â  Â  Â  q6: (fd.get('q6') || "").toString().trim(), // Ensure trailing space is trimmed from input
Â  Â  Â  q7: (fd.get('q7') || "").toString(),
Â  Â  Â  q8: getChecked('q8'),
Â  Â  Â  q9: getChecked('q9')
Â  Â  };

Â  Â  // New validation check for multi-select questions
Â  Â  if (a.q1.length !== 2) {
Â  Â  Â  submitMsg.textContent = "Q2: Pick exactly 2 options.";
Â  Â  Â  submitMsg.classList.add('text-red-600');
Â  Â  Â  btnSubmit.disabled = false;
Â  Â  Â  return;
Â  Â  }
Â  Â  if (a.q2.length !== 2) {
Â  Â  Â  submitMsg.textContent = "Q3: Pick exactly 2 options.";
Â  Â  Â  submitMsg.classList.add('text-red-600');
Â  Â  Â  btnSubmit.disabled = false;
Â  Â  Â  return;
Â  Â  }
Â  Â  if (a.q8.length !== 3 || a.q9.length !== 2) {
Â  Â  Â  submitMsg.textContent = "Q9 & Q10: Check the number of selections required.";
Â  Â  Â  submitMsg.classList.add('text-red-600');
Â  Â  Â  btnSubmit.disabled = false;
Â  Â  Â  return;
Â  Â  }

Â  Â  // Calculate score
Â  Â  let score = 0;
Â  Â  for (const k of KNOWLEDGE_KEYS) {
Â  Â  Â  // If the correct answer is an array (multi-select), use arraysEqualSet
Â  Â  Â  score += Array.isArray(correct[k])
Â  Â  Â  Â  ? (arraysEqualSet(a[k], correct[k]) ? 1 : 0)
Â  Â  Â  Â  : (a[k] === correct[k] ? 1 : 0);
Â  Â  }
Â  Â  const total = KNOWLEDGE_KEYS.length;

Â  Â  submitMsg.textContent = "Submittingâ€¦";
Â  Â  submitMsg.classList.remove('text-red-600', 'text-green-600');

Â  Â  // ðŸ”¥ Call the new RPC that writes to hb_ts_submissions
Â  Â  const { error } = await sb.rpc('hb_ts_submit', {
Â  Â  Â  p_employee_id: currentEmp.employee_id,
Â  Â  Â  p_username: currentEmp.username,
Â  Â  Â  p_full_name: currentEmp.full_name,
Â  Â  Â  p_phone: currentEmp.phone,
Â  Â  Â  p_position: currentEmp.position,
Â  Â  Â  p_department: currentEmp.department,
Â  Â  Â  p_is_owner: currentEmp.is_owner,
Â  Â  Â  p_score: score,
Â  Â  Â  p_total: total,
Â  Â  Â  p_answers: a
Â  Â  });

Â  Â  if (error) throw error;

Â  Â  submitMsg.textContent = "âœ… Submitted successfully! Thank you for completing the survey.";
Â  Â  submitMsg.classList.remove('text-red-600');
Â  Â  submitMsg.classList.add('text-green-600');
Â  Â  disableSurvey("Your survey has been recorded successfully.", true);

Â  Â  // NEW: Display the results
Â  Â  displayResults(a, score, total);

Â  } catch (err) {
Â  Â  console.error("Submission error:", err);
Â  Â  submitMsg.textContent = `Save failed: ${err.message || "Unexpected error"}`;
Â  Â  submitMsg.classList.add('text-red-600');
Â  } finally {
Â  Â  btnSubmit.disabled = false;
Â  }
});


Â  Â  // Removed: Owner CSV export functionality
Â  Â  // btnExportCsv.addEventListener('click', ... ) was here

Â  Â  // Initialize progress UI
Â  Â  computeProgress();
Â  </script>
</body>
</html>
