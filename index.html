<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jeng Chi — Executive Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --jc-brand: #7A3D36;
      --jc-brand-deep: #5A2B26;
      --jc-accent: #10B981;
      --jc-accent-deep: #059669;
    }
    body {
      font-family: 'Inter', system-ui, Arial, sans-serif;
      background: #fff;
      color: #111;
    }
    .card-light {
      background: #fff;
      border: 1px solid #d1d5db;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .1);
      border-radius: 18px;
    }
    .glass {
      background: rgba(0, 0, 0, 0.04);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 0, 0, 0.12);
    }
    .glass-soft {
      background: rgba(0, 0, 0, 0.02);
      border: 1px solid rgba(0, 0, 0, 0.08);
    }
    .ring-focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, .25);
    }
    .btn-brand {
      background: linear-gradient(135deg, var(--jc-brand), var(--jc-brand-deep));
      color: #fff;
    }
    .btn-brand:hover {
      filter: brightness(1.05);
    }
    .btn-accent {
      background: linear-gradient(135deg, var(--jc-accent), var(--jc-accent-deep));
      color: #fff;
    }
    .btn-accent:hover {
      filter: brightness(1.06);
    }
    .sh {
      box-shadow: 0 8px 24px rgba(0, 0, 0, .1);
    }
    .sep {
      border-top: 1px solid rgba(0, 0, 0, 0.08);
    }
    .muted {
      color: #6b7280;
    }
    .muted-2 {
      color: #9aa3b2;
    }
    .caps {
      letter-spacing: .12em;
      text-transform: uppercase;
    }
    .tab-active {
      background: rgba(0, 0, 0, .05);
      border-color: rgba(0, 0, 0, .15);
    }
    .badge-light {
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #374151;
    }
    .pill {
      border-radius: 999px;
    }
    .shadow-inner-1 {
      box-shadow: inset 0 1px 0 rgba(0, 0, 0, .08);
    }
    .text-glossy {
      background: linear-gradient(180deg, #111 0%, #a0a0a0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.15));
    }
    /* Custom styles for the order list section */
    .product-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    }
    .product-card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, .08);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      color: #111;
      transition: all 0.2s ease-in-out;
    }
    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 18px rgba(0, 0, 0, .12);
    }
    .product-details img {
      width: 120px;
      height: 120px;
      object-fit: contain;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: linear-gradient(145deg, rgba(255, 255, 255, .45), rgba(255, 255, 255, .1));
    }
    .product-name {
      font-weight: 700;
      font-size: 14px;
      margin-top: 10px;
      line-height: 1.25;
      color: #111;
    }
    .counter {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
    }
    .counter button {
      background: #3b82f6;
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .counter button:hover {
      background: #2563eb;
    }
    .counter input {
      width: 64px;
      text-align: center;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 8px 10px;
      font-size: 14px;
      color: #111;
    }
    .footer-history {
      max-width: 1100px;
      margin: 22px auto;
      padding: 18px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
      color: #111;
    }
    .order-summary-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .order-summary-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .fab {
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 50;
    }
    .fab img {
      width: 92px;
      height: 92px;
      border-radius: 50%;
      box-shadow: 0 6px 16px rgba(0, 0, 0, .25);
      cursor: pointer;
    }
    .fab img:hover {
      transform: scale(1.06);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, .4);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 22px;
      border-radius: 12px;
      max-width: 420px;
      width: 92%;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .3);
      border: 1px solid #e5e7eb;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="min-h-full">
  <!-- ===== EXECUTIVE LOGIN ===== -->
  <main id="loginView" class="min-h-screen flex items-center justify-center p-4">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 w-full max-w-6xl items-center">
      <!-- Left: Brand panel -->
      <div class="flex flex-col items-center text-center space-y-2 mb-8 lg:mb-0">
        <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg" class="h-64 rounded-xl" alt="Jeng Chi" />
        <h1 class="text-2xl font-extrabold tracking-tight text-glossy text-center text-black">Jeng Chi Enterprise Portal</h1>
        <p class="muted text-glossy text-center text-black">Executive Access</p>
      </div>
      <!-- Right: Form card -->
      <div class="card-light p-8 w-full">
        <div class="flex flex-col gap-3 text-center">
          <div>
            <p class="caps text-xs muted-2 font-bold text-glossy text-black">Secure Access</p>
          </div>
        </div>
        <form id="loginForm" class="mt-6 space-y-5">
          <div>
            <label class="block text-sm mb-1 text-black">Username</label>
            <input id="username" type="text" autocomplete="off" class="w-full pill px-4 py-3 text-black shadow-inner-1 border border-gray-300 focus:ring-focus" placeholder="e.g., PG, RC, JM" required>
          </div>
          <div>
            <label class="block text-sm mb-1 text-black">PIN (4–6 digits)</label>
            <input id="password" type="password" inputmode="numeric" pattern="[0-9]*" autocomplete="new-password" class="w-full pill px-4 py-3 text-black shadow-inner-1 border border-gray-300 focus:ring-focus" placeholder="••••" required>
          </div>
          <p id="loginError" class="hidden text-rose-400 text-sm"></p>
          <button type="submit" class="btn-brand pill px-5 py-3 font-bold w-full">Enter</button>
          <div class="flex items-center justify-between mt-4">
            <span class="text-xs muted-2 text-black">Authorized use only</span>
            <span id="yr" class="text-xs muted-2 text-black"></span>
            <span class="text-xs badge-light pill px-2 py-1">v1.2 Executive</span>
          </div>
        </form>
      </div>
    </div>
  </main>
  <!-- ===== EXECUTIVE DASHBOARD (SINGLE‑PAGE) ===== -->
  <section id="appView" class="hidden min-h-screen">
    <!-- Topbar -->
    <header class="card-light px-5 py-3 sticky top-0 z-20">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg" class="h-10 rounded-xl sh" alt="logo" />
          <div>
            <p class="caps text-[11px] muted-2 text-black">Jeng Chi Enterprise Portal</p>
            <h1 class="font-extrabold tracking-tight text-black">Executive Dashboard</h1>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span id="userBadge" class="badge-light pill px-3 py-1 text-sm text-black"></span>
          <button id="logoutBtn" class="pill px-3 py-2 btn-accent font-bold">Logout</button>
        </div>
      </div>
      <div class="mt-3 flex flex-wrap gap-2">
        <!-- Tab buttons -->
        <button data-tab="order-management" class="tabBtn pill px-3 py-2 border glass-soft">Order Management</button>
        <button data-tab="invoice-management" class="tabBtn pill px-3 py-2 border glass-soft">Invoice Management</button>
        <button data-tab="general-order-list" class="tabBtn pill px-3 py-2 border glass-soft">General Order List</button>
        <button data-tab="kitchen-prep-list" class="tabBtn pill px-3 py-2 border glass-soft">Kitchen Prep List</button>
        <button data-tab="check-management" class="tabBtn pill px-3 py-2 border glass-soft">Check Management</button>
        <button data-tab="mooncake-management" class="tabBtn pill px-3 py-2 border glass-soft">Mooncake Management</button>
      </div>
    </header>
    <!-- Content -->
    <div id="tab-content" class="p-4 grid gap-4">
      <!-- Tabs content is not needed in this file anymore as each tab is a new page. -->
    </div>
  </section>
  <!-- Toast / Modal -->
  <div id="toast" class="fixed bottom-4 right-4 hidden">
    <div class="card-light rounded-xl px-4 py-3 flex items-center gap-3">
      <div class="h-2 w-2 rounded-full bg-emerald-400"></div>
      <div id="toastMsg" class="text-sm text-black">Signed in</div>
    </div>
  </div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ===== Supabase setup =====
    const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const ACL = {
      PG: {
        tabs: ['order-management', 'invoice-management', 'general-order-list', 'kitchen-prep-list', 'check-management', 'mooncake-management'],
        defaultPage: 'order-management'
      },
      JT: {
        tabs: ['order-management', 'invoice-management', 'general-order-list', 'kitchen-prep-list', 'check-management', 'mooncake-management'],
        defaultPage: 'order-management'
      },
      FT: {
        tabs: ['order-management', 'invoice-management', 'general-order-list', 'kitchen-prep-list', 'check-management', 'mooncake-management'],
        defaultPage: 'order-management'
      },
      RC: {
        tabs: ['general-order-list'],
        defaultPage: 'general-order-list'
      },
      JM: {
        tabs: ['kitchen-prep-list'],
        defaultPage: 'kitchen-prep-list'
      },
    };
    const loginView = document.getElementById('loginView');
    const appView = document.getElementById('appView');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const userBadge = document.getElementById('userBadge');
    const yr = document.getElementById('yr');
    if (yr) {
      yr.textContent = new Date().getFullYear();
    }

    // Tab Content Loading Logic
    const TAB_URLS = {
      'order-management': 'https://portal.jengchirestaurant.com/placeorder.html',
      'invoice-management': 'https://portal.jengchirestaurant.com/invoices.html',
      'general-order-list': 'https://portal.jengchirestaurant.com/rony.html',
      'kitchen-prep-list': 'https://portal.jengchirestaurant.com/julio.html',
      'check-management': 'https://portal.jengchirestaurant.com/check.html',
      'mooncake-management': 'https://portal.jengchirestaurant.com/mooncakeorder.html'
    };

    // Tab switching now handles both local and external content
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('.tabBtn');
      if (!btn) return;

      const tab = btn.getAttribute('data-tab');

      // Remove active class from all tabs
      document.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('tab-active'));
      
      // Add active class to clicked tab
      btn.classList.add('tab-active');
      
      // Show loading message inside the main content container
      const tabContentContainer = document.getElementById('tab-content');
      tabContentContainer.innerHTML = `<div class="flex items-center justify-center h-40">
                                       <p class="text-xl text-gray-400">Loading...</p>
                                     </div>`;

      // Set the last active tab in localStorage
      localStorage.setItem('lastTab', tab);

      // Simulate network delay for a better user experience
      await new Promise(resolve => setTimeout(resolve, 500));

      const url = TAB_URLS[tab];

      // If it's an external tab, load it inside an iframe
      if (url) {
        const iframe = document.createElement('iframe');
        iframe.src = url;
        iframe.title = tab + ' — Jeng Chi';
        iframe.style.width = '100%';
        iframe.style.height = 'calc(100vh - 190px)';
        iframe.style.border = '0';
        iframe.style.borderRadius = '12px';
        iframe.loading = 'eager';
        iframe.referrerPolicy = 'no-referrer-when-downgrade';
        
        tabContentContainer.innerHTML = '';
        tabContentContainer.appendChild(iframe);
      } else {
        // Local content for non-iframe tabs
        switch (tab) {
          case 'general-order-list':
            tabContentContainer.innerHTML = `
              <h2 class="font-bold tracking-tight text-black">General Order List</h2>
              <div class="flex flex-col gap-4">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                  <input type="date" id="order-date" class="bg-gray-100 text-black border border-gray-300 rounded-lg p-2 text-sm" />
                </div>
                <section id="inventory-list" class="flex flex-col gap-8">
                  <p class="text-center text-gray-400">Loading inventory...</p>
                </section>
              </div>
            `;
            // Note: The original local functions like loadInventory() would need to be re-added here if you want to use them.
            // These functions are currently commented out to avoid errors.
            // loadInventory();
            break;
          case 'order-management':
            tabContentContainer.innerHTML = `<h2 class="font-bold tracking-tight text-black">Order Management</h2><div class="mt-3 text-sm muted text-black">Your <strong>Place Order</strong> experience will live here.</div>`;
            break;
          case 'invoice-management':
            tabContentContainer.innerHTML = `<h2 class="font-bold tracking-tight text-black">Invoice Management</h2><div class="mt-3 text-sm muted text-black">This section will contain the UI for managing invoices.</div>`;
            break;
          case 'kitchen-prep-list':
            tabContentContainer.innerHTML = `<h2 class="font-bold tracking-tight text-black">Kitchen Prep List</h2><div class="mt-3 text-sm muted text-black">This section will contain the UI for the kitchen prep workflow.</div>`;
            break;
          case 'check-management':
            tabContentContainer.innerHTML = `<h2 class="font-bold tracking-tight text-black">Check Management</h2><div class="mt-3 text-sm muted text-black">This section will contain the UI for managing checks.</div>`;
            break;
          case 'mooncake-management':
            tabContentContainer.innerHTML = `<h2 class="font-bold tracking-tight text-black">Mooncake Management</h2><div class="mt-3 text-sm muted text-black">This section will contain the UI for managing mooncake orders and shipping.</div>`;
            break;
          default:
            tabContentContainer.innerHTML = `<div class="text-xl text-gray-400">Invalid tab selected.</div>`;
        }
      }
    });

    // Toast helper
    function toast(msg) {
      const t = document.getElementById('toast');
      const m = document.getElementById('toastMsg');
      if (m) m.textContent = msg;
      if (t) {
          t.classList.remove('hidden');
          setTimeout(() => t.classList.add('hidden'), 1800);
      }
    }
    
    // Render dashboard shell
    function showApp(username) {
      loginView.classList.add('hidden');
      appView.classList.remove('hidden');
      const U = (username || '').toUpperCase();
      const acl = ACL[U] || {
        tabs: ['order-management'],
        defaultPage: 'order-management'
      };
      if (userBadge) userBadge.textContent = `User: ${U}`;
      // enable/disable tab buttons by ACL
      document.querySelectorAll('.tabBtn').forEach(b => {
        const key = b.getAttribute('data-tab');
        b.classList.toggle('hidden', !acl.tabs.includes(key));
      });
      toast('Signed in');
    }

    function showLogin() {
      appView.classList.add('hidden');
      loginView.classList.remove('hidden');
    }

    // Restore session
    (function init() {
      const saved = JSON.parse(localStorage.getItem('userPermissions') || 'null');
      if (saved?.username) {
        showApp(saved.username);
      }
    })();
    
    // Login flow (users table: username + password)
    let busy = false;
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (busy) return;
      busy = true;
      if (loginError) loginError.classList.add('hidden');
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value;
      try {
        if (!u || !p) throw new Error('Please enter both fields.');
        const variants = Array.from(new Set([u, u.toUpperCase(), u.toLowerCase()]));
        const {
          data,
          error
        } = await sb.from('users').select('username,password,role,departments').in('username', variants).maybeSingle();
        if (error) throw error;
        if (!data || data.password !== p) throw new Error('Invalid credentials.');
        const username = (data.username || u).toUpperCase();
        const acl = ACL[username] || {
          tabs: ['order-management'],
          defaultPage: 'order-management'
        };
        localStorage.setItem('userPermissions', JSON.stringify({
          username,
          role: data.role,
          departments: data.departments,
          tabs: acl.tabs
        }));
        showApp(username);
      } catch (err) {
        if (loginError) {
            loginError.textContent = err.message || 'Unexpected error.';
            loginError.classList.remove('hidden');
        }
      } finally {
        busy = false;
      }
    });
    
    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.clear();
      showLogin();
      toast('Signed out');
    });
  });
</script>
</body>
</html>

