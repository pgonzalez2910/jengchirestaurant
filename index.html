<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Management System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Montserrat',sans-serif; margin:0; display:flex; flex-direction:column; height:100vh; background:#F3F4F6; }
    .main-border { border:8px solid #7A3D36; display:flex; flex-direction:column; flex:1; }
    .main-content { display:flex; flex:1; }
    .left-section, .right-section { flex:1; display:flex; justify-content:center; align-items:center; background:#fff; padding:2rem; flex-direction:column; text-align:center; }
    .logo-container { display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .system-title { color:#7A3D36; font-weight:700; font-size:clamp(1rem,2.5vw,1.5rem); margin-top:1rem; }
    .login-container { width:90%; max-width:400px; }
    .form-group { margin-bottom:1.5rem; text-align:left; }
    .form-group label { display:block; margin-bottom:.5rem; font-weight:600; color:#1f2937; }
    .form-group input { width:100%; padding:.75rem; border:1px solid #e5e7eb; border-radius:8px; font-size:1rem; }
    .form-group input:focus { outline:none; border-color:#7A3D36; box-shadow:0 0 0 3px rgba(122,61,54,.1); }
    .login-btn { width:100%; background:linear-gradient(to right,#6EE7B7,#34D399); color:#fff; padding:.75rem; border:none; border-radius:8px; font-size:1.1rem; font-weight:700; cursor:pointer; }
    .login-btn:hover { background:linear-gradient(to right,#34D399,#10B981); }
    .error-message { color:#DC2626; margin-top:1rem; font-weight:600; display:none; }
    .navbar { background:#fff; padding:.8rem 1.25rem; box-shadow:0 2px 4px rgba(0,0,0,.08); display:flex; justify-content:space-between; align-items:center; }
    .nav-links a { font-weight:700; color:#4B5563; padding:.45rem .9rem; border-radius:10px; }
    .nav-links a:hover { background:#F3F4F6; color:#111827; }
    .nav-links a.active { background:linear-gradient(90deg,#7A3D36,#5f302b); color:#fff; }
    .frame-wrap { flex:1; display:flex; position:relative; }
    .loader { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
    .spinner { width:42px; height:42px; border:4px solid #e5e7eb; border-top-color:#7A3D36; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to{ transform:rotate(360deg) } }
    iframe { flex:1; border:none; }
    footer { padding:.5rem 1rem; background:linear-gradient(135deg,#1f2937 0%,#000 100%); color:#fff; text-align:center; font-size:.8rem; }
    #dashboard { display:none; flex:1; flex-direction:column; }
  </style>
</head>
<body class="main-border">
  <div id="login-section" class="main-content">
    <div class="left-section">
      <div class="logo-container">
        <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg" class="w-full max-w-[450px]" />
        <h1 class="system-title">INVENTORY MANAGEMENT SYSTEM</h1>
        <h2 class="system-title">2025</h2>
      </div>
    </div>
    <div class="right-section">
      <div class="login-container">
        <form id="login-form">
          <div class="form-group">
            <label for="username">Username</label>
            <input id="username" name="username" type="text" required autocomplete="off" />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" required autocomplete="new-password" />
          </div>
          <p id="error-message" class="error-message"></p>
          <button type="submit" class="login-btn">Login</button>
        </form>
      </div>
    </div>
  </div>

  <div id="dashboard">
    <div class="navbar">
      <div class="flex items-center gap-3">
        <img src="https://raw.githubusercontent.com/pgonzalez2910/jengchi-product-images/main/jengchilogo.jpg" alt="Logo" class="h-10 rounded">
        <h1 class="text-xl font-extrabold text-gray-800">Inventory Management</h1>
      </div>
      <nav id="tabs" class="nav-links space-x-2"></nav>
      <button id="logoutBtn" class="px-4 py-2 rounded-md text-white font-bold" style="background:#DC2626">Logout</button>
    </div>
    <div class="frame-wrap">
      <div id="frameLoader" class="loader"><div class="spinner"></div></div>
      <iframe id="moduleFrame"></iframe>
    </div>
  </div>

  <footer>Â© <span id="year"></span> Jeng Chi</footer>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const ACL = {
      PG:['check','invoices','order','rony','julio','employeetrack'],
      JT:['check','invoices','order','rony','julio','employeetrack'],
      FT:['check','invoices','order','rony','julio','employeetrack'],
      RC:['rony'],
      JM:['julio']
    };
    const TAB_MAP = {
      check:'check.html', invoices:'invoices.html', order:'placeorder.html',
      rony:'rony.html', julio:'julio.html', employeetrack:'employeetrack.html'
    };
    const TAB_LABELS = {
      check:'Check Management', invoices:'Invoice Management', order:'Order Management',
      rony:'General List', julio:'Kitchen Prep List', employeetrack:'Employee Track Management'
    };

    const loginForm=document.getElementById('login-form');
    const usernameInput=document.getElementById('username');
    const passwordInput=document.getElementById('password');
    const errorMessage=document.getElementById('error-message');

    loginForm.addEventListener('submit',async e=>{
      e.preventDefault();
      errorMessage.style.display='none';
      const user=(usernameInput.value||'').trim().toUpperCase();
      const pass=passwordInput.value;
      if(!user||!pass){errorMessage.textContent='Enter credentials';errorMessage.style.display='block';return;}
      try{
        const {data,error}=await supabaseClient.from('users').select('username,password').eq('username',user).maybeSingle();
        if(error||!data||data.password!==pass){errorMessage.textContent='Invalid login';errorMessage.style.display='block';return;}
        localStorage.setItem('currentUser',user);
        startDashboard(user);
      }catch(err){errorMessage.textContent='Unexpected error';errorMessage.style.display='block';}
    });

    function startDashboard(user){
      document.getElementById('login-section').style.display='none';
      document.getElementById('dashboard').style.display='flex';
      const allowed=ACL[user]||[];
      const tabsEl=document.getElementById('tabs');
      const frame=document.getElementById('moduleFrame');
      const loader=document.getElementById('frameLoader');

      function renderTabs(active){
        tabsEl.innerHTML=allowed.map(k=>`<a href="#" data-key="${k}" class="${active===k?'active':''}">${TAB_LABELS[k]}</a>`).join('');
        tabsEl.querySelectorAll('a').forEach(a=>a.addEventListener('click',e=>{e.preventDefault();mount(a.dataset.key);}));
      }
      function mount(k){
        renderTabs(k);
        frame.src=TAB_MAP[k];
        loader.style.display='flex';
        frame.onload=()=>loader.style.display='none';
      }
      mount(allowed[0]);

      document.getElementById('logoutBtn').onclick=()=>{localStorage.clear();location.reload();};
    }
  </script>
</body>
</html>
