<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Inventory Intelligence Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-900: #0a1628;
            --primary-800: #132540;
            --primary-700: #1a3558;
            --primary-600: #234670;
            --primary-500: #2c5688;
            --primary-400: #4a7aae;
            --primary-300: #6b9dd4;
            --primary-200: #a5c7f0;
            --primary-100: #d4e7ff;
            
            --accent-600: #d97706;
            --accent-500: #f59e0b;
            --accent-400: #fbbf24;
            
            --success-600: #059669;
            --success-500: #10b981;
            --warning-600: #dc2626;
            
            --neutral-950: #0a0a0a;
            --neutral-900: #171717;
            --neutral-800: #262626;
            --neutral-700: #404040;
            --neutral-600: #525252;
            --neutral-500: #737373;
            --neutral-400: #a3a3a3;
            --neutral-300: #d4d4d4;
            --neutral-200: #e5e5e5;
            --neutral-100: #f5f5f5;
            --neutral-50: #fafafa;
            
            --font-display: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-display);
            background: linear-gradient(135deg, var(--neutral-50) 0%, var(--neutral-100) 100%);
            color: var(--neutral-900);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Header & Navigation */
        .app-header {
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-800) 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-xl);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--accent-500);
        }
        
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .app-title h1 {
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }
        
        .app-title .subtitle {
            font-size: 0.875rem;
            opacity: 0.8;
            font-weight: 400;
            margin-top: 0.25rem;
            font-family: var(--font-mono);
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-500);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Main Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: white;
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }
        
        .nav-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--font-display);
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--neutral-600);
            transition: all var(--transition-base);
            position: relative;
        }
        
        .nav-tab:hover {
            background: var(--neutral-100);
            color: var(--primary-700);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-600) 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--primary-600);
        }
        
        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn var(--transition-slow);
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Search & Filter Bar */
        .search-filter-bar {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .search-group {
            flex: 1;
            min-width: 300px;
        }
        
        .search-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--neutral-700);
            margin-bottom: 0.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--neutral-300);
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 0.9375rem;
            transition: all var(--transition-base);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(44, 86, 136, 0.1);
        }
        
        .filter-group {
            min-width: 200px;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 0.9375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-700) 0%, var(--primary-600) 100%);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary-700);
            border: 2px solid var(--primary-700);
        }
        
        .btn-secondary:hover {
            background: var(--primary-700);
            color: white;
        }
        
        .btn-success {
            background: var(--success-600);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--success-500);
        }
        
        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Data Table */
        .data-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }
        
        .table-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--neutral-100) 0%, var(--neutral-50) 100%);
            border-bottom: 2px solid var(--neutral-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--neutral-900);
        }
        
        .table-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .data-table thead {
            background: var(--neutral-100);
        }
        
        .data-table th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--neutral-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid var(--neutral-300);
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .data-table th:hover {
            background: var(--neutral-200);
        }
        
        .data-table th.sortable::after {
            content: '‚áÖ';
            position: absolute;
            right: 0.5rem;
            opacity: 0.3;
        }
        
        .data-table th.sorted-asc::after {
            content: '‚Üë';
            opacity: 1;
            color: var(--primary-600);
        }
        
        .data-table th.sorted-desc::after {
            content: '‚Üì';
            opacity: 1;
            color: var(--primary-600);
        }
        
        .data-table tbody tr {
            transition: all var(--transition-fast);
        }
        
        .data-table tbody tr:hover {
            background: var(--primary-100);
        }
        
        .data-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--neutral-200);
            font-size: 0.9375rem;
        }
        
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .vendor-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--neutral-200);
            color: var(--neutral-800);
            border-radius: 6px;
            font-size: 0.8125rem;
            font-weight: 600;
            font-family: var(--font-mono);
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8125rem;
            font-weight: 600;
        }
        
        .status-badge.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
        }
        
        .status-badge.inactive {
            background: rgba(220, 38, 38, 0.1);
            color: var(--warning-600);
        }
        
        .price-cell {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--primary-700);
            font-size: 1rem;
        }
        
        .item-number {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--neutral-600);
        }
        
        /* Analytics Dashboard */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-600);
            transition: all var(--transition-base);
        }
        
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .metric-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--neutral-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-900);
            font-family: var(--font-mono);
        }
        
        .metric-subtitle {
            font-size: 0.8125rem;
            color: var(--neutral-500);
            margin-top: 0.5rem;
        }
        
        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }
        
        .chart-container h3 {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: 1.5rem;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp var(--transition-slow);
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary-900) 0%, var(--primary-800) 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--neutral-700);
            margin-bottom: 0.5rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--neutral-300);
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 0.9375rem;
            transition: all var(--transition-base);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(44, 86, 136, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--neutral-200);
        }
        
        /* Alert Messages */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideDown var(--transition-base);
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-600);
            border-left: 4px solid var(--success-600);
        }
        
        .alert-error {
            background: rgba(220, 38, 38, 0.1);
            color: var(--warning-600);
            border-left: 4px solid var(--warning-600);
        }
        
        .alert-info {
            background: rgba(44, 86, 136, 0.1);
            color: var(--primary-700);
            border-left: 4px solid var(--primary-700);
        }
        
        /* Loading State */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--neutral-200);
            border-top-color: var(--primary-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .search-filter-bar {
                flex-direction: column;
            }
            
            .search-group,
            .filter-group {
                width: 100%;
                min-width: auto;
            }
            
            .data-table {
                font-size: 0.875rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.75rem 0.5rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--neutral-500);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--neutral-700);
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            font-size: 0.9375rem;
            color: var(--neutral-500);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- App Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="app-title">
                <div>
                    <h1>Enterprise Inventory Intelligence Platform</h1>
                    <div class="subtitle">Multi-Vendor Product Management & Analytics</div>
                </div>
            </div>
            <div class="header-actions">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>System Online</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('inventory')">üì¶ Inventory View</button>
            <button class="nav-tab" onclick="switchTab('analytics')">üìä Analytics & Insights</button>
            <button class="nav-tab" onclick="switchTab('products')">üè∑Ô∏è Product Management</button>
            <button class="nav-tab" onclick="switchTab('vendors')">üè¢ Vendor Management</button>
        </div>

        <!-- Inventory View Section -->
        <div id="inventory" class="content-section active">
            <!-- Search & Filter Bar -->
            <div class="search-filter-bar">
                <div class="search-group">
                    <label>Search Products</label>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search by product name, item number, or description..." oninput="performSearch()">
                </div>
                <div class="filter-group">
                    <label>Vendor Filter</label>
                    <select id="vendorFilter" class="search-input" onchange="applyFilters()">
                        <option value="">All Vendors</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Status Filter</label>
                    <select id="statusFilter" class="search-input" onchange="applyFilters()">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div style="display: flex; gap: 0.5rem; align-items: flex-end;">
                    <button class="btn btn-primary" onclick="exportToCSV()">üì• Export CSV</button>
                    <button class="btn btn-success" onclick="openAddItemModal()">+ Add Item</button>
                </div>
            </div>

            <!-- Data Table -->
            <div class="data-table-container">
                <div class="table-header">
                    <h2>Product Inventory</h2>
                    <div class="table-actions">
                        <span id="recordCount" style="color: var(--neutral-600); font-size: 0.875rem;">Loading...</span>
                    </div>
                </div>
                <table class="data-table" id="inventoryTable">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th class="sortable" onclick="sortTable('vendor')">Vendor</th>
                            <th class="sortable" onclick="sortTable('item_number')">Item No.</th>
                            <th class="sortable" onclick="sortTable('description')">Description</th>
                            <th class="sortable" onclick="sortTable('category')">Category</th>
                            <th class="sortable" onclick="sortTable('price')">Price</th>
                            <th class="sortable" onclick="sortTable('effective_date')">Effective Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics" class="content-section">
            <!-- Executive Metrics -->
            <div class="analytics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total Products</div>
                    <div class="metric-value" id="metricTotalProducts">-</div>
                    <div class="metric-subtitle">Canonical products across all vendors</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Active Vendors</div>
                    <div class="metric-value" id="metricActiveVendors">-</div>
                    <div class="metric-subtitle">Vendors with active inventory</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Average Price Variance</div>
                    <div class="metric-value" id="metricPriceVariance">-</div>
                    <div class="metric-subtitle">Across multi-vendor products</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Price Trend</div>
                    <div class="metric-value" id="metricPriceTrend">-</div>
                    <div class="metric-subtitle">Last 90 days</div>
                </div>
            </div>

            <!-- Product Selection for Analytics -->
            <div class="search-filter-bar">
                <div class="search-group">
                    <label>Select Product for Analysis</label>
                    <select id="analyticsProductSelect" class="search-input" onchange="loadProductAnalytics()">
                        <option value="">Choose a product...</option>
                    </select>
                </div>
            </div>

            <!-- Charts -->
            <div class="chart-container">
                <h3>üìà Price Comparison by Vendor</h3>
                <div class="chart-wrapper">
                    <canvas id="priceComparisonChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>üìä Market Price Analysis</h3>
                <div class="chart-wrapper">
                    <canvas id="marketAnalysisChart"></canvas>
                </div>
            </div>

            <!-- Executive Insights -->
            <div class="data-table-container" id="executiveInsights">
                <div class="table-header">
                    <h2>üí° Executive Insights</h2>
                </div>
                <div style="padding: 2rem;" id="insightsContent">
                    <p style="color: var(--neutral-500);">Select a product to view insights.</p>
                </div>
            </div>
        </div>

        <!-- Product Management Section -->
        <div id="products" class="content-section">
            <div class="search-filter-bar">
                <div class="search-group">
                    <label>Search Canonical Products</label>
                    <input type="text" id="productSearchInput" class="search-input" placeholder="Search products..." oninput="searchProducts()">
                </div>
                <button class="btn btn-success" onclick="openAddProductModal()">+ Add Canonical Product</button>
            </div>

            <div class="data-table-container">
                <div class="table-header">
                    <h2>Canonical Products</h2>
                    <div class="table-actions">
                        <span id="productCount" style="color: var(--neutral-600); font-size: 0.875rem;">Loading...</span>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Product Name</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Unit</th>
                            <th>Vendor Count</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Vendor Management Section -->
        <div id="vendors" class="content-section">
            <div class="search-filter-bar">
                <button class="btn btn-success" onclick="openAddVendorModal()">+ Add Vendor</button>
            </div>

            <div class="data-table-container">
                <div class="table-header">
                    <h2>Vendor Directory</h2>
                    <div class="table-actions">
                        <span id="vendorCount" style="color: var(--neutral-600); font-size: 0.875rem;">Loading...</span>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Vendor Name</th>
                            <th>Contact Email</th>
                            <th>Contact Phone</th>
                            <th>Product Count</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendorsTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal-overlay" id="itemModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="itemModalTitle">Add Vendor Item</h2>
                <button class="modal-close" onclick="closeModal('itemModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="itemForm" onsubmit="saveVendorItem(event)">
                    <div class="form-group">
                        <label>Canonical Product *</label>
                        <select id="itemCanonicalProduct" required class="search-input">
                            <option value="">Select a product...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Vendor *</label>
                        <select id="itemVendor" required class="search-input">
                            <option value="">Select a vendor...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Item Number *</label>
                        <input type="text" id="itemNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Price *</label>
                        <input type="number" id="itemPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Effective Date *</label>
                        <input type="date" id="itemEffectiveDate" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="itemStatus" required class="search-input">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('itemModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Item</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Canonical Product</h2>
                <button class="modal-close" onclick="closeModal('productModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="productForm" onsubmit="saveProduct(event)">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="productDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <input type="text" id="productCategory" required>
                    </div>
                    <div class="form-group">
                        <label>Unit of Measure *</label>
                        <input type="text" id="productUnit" required placeholder="e.g., lb, kg, each">
                    </div>
                    <div class="form-group">
                        <label>Image File Name (in jengchi bucket)</label>
                        <input type="text" id="productImage" placeholder="e.g., lemon.jpg">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Product</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Vendor Modal -->
    <div class="modal-overlay" id="vendorModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Vendor</h2>
                <button class="modal-close" onclick="closeModal('vendorModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="vendorForm" onsubmit="saveVendor(event)">
                    <div class="form-group">
                        <label>Vendor Name *</label>
                        <input type="text" id="vendorName" required>
                    </div>
                    <div class="form-group">
                        <label>Contact Email</label>
                        <input type="email" id="vendorEmail">
                    </div>
                    <div class="form-group">
                        <label>Contact Phone</label>
                        <input type="tel" id="vendorPhone">
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="vendorStatus" required class="search-input">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('vendorModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Vendor</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Global State
        let currentTab = 'inventory';
        let inventoryData = [];
        let filteredData = [];
        let sortColumn = null;
        let sortDirection = 'asc';
        let priceComparisonChart = null;
        let marketAnalysisChart = null;

        // Initialize Application
        async function initializeApp() {
            showLoading(true);
            try {
                await checkDatabase();
                await loadAllData();
                showAlert('System initialized successfully', 'success');
            } catch (error) {
                console.error('Initialization error:', error);
                showAlert('Error initializing system: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Database Setup and Verification
        async function checkDatabase() {
            // Note: In production, tables should be created via migrations
            // This is a verification check only
            try {
                const { data, error } = await supabaseClient
                    .from('canonical_products')
                    .select('count')
                    .limit(1);
                
                if (error && error.code === '42P01') {
                    throw new Error('Database tables not found. Please run migrations first.');
                }
            } catch (error) {
                console.error('Database check:', error);
            }
        }

        // Data Loading Functions
        async function loadAllData() {
            await Promise.all([
                loadInventoryData(),
                loadVendors(),
                loadProducts(),
                loadAnalytics()
            ]);
        }

        async function loadInventoryData() {
            try {
                // Load vendor items with canonical product and vendor data
                const { data, error } = await supabaseClient
                    .from('vendor_items')
                    .select(`
                        *,
                        canonical_product:canonical_products!vendor_items_canonical_product_id_fkey(*),
                        vendor:vendors!vendor_items_vendor_id_fkey(*)
                    `)
                    .order('effective_date', { ascending: false });

                if (error) throw error;

                inventoryData = data || [];
                filteredData = [...inventoryData];
                renderInventoryTable();
                updateRecordCount();
            } catch (error) {
                console.error('Error loading inventory:', error);
                showAlert('Error loading inventory data', 'error');
            }
        }

        async function loadVendors() {
            try {
                const { data, error } = await supabaseClient
                    .from('vendors')
                    .select('*')
                    .order('name');

                if (error) throw error;

                populateVendorSelects(data || []);
                renderVendorsTable(data || []);
            } catch (error) {
                console.error('Error loading vendors:', error);
            }
        }

        async function loadProducts() {
            try {
                const { data, error } = await supabaseClient
                    .from('canonical_products')
                    .select('*')
                    .order('name');

                if (error) throw error;

                populateProductSelects(data || []);
                renderProductsTable(data || []);
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        async function loadAnalytics() {
            try {
                // Calculate metrics
                const uniqueProducts = new Set(inventoryData.map(item => item.canonical_product_id)).size;
                const activeVendors = new Set(
                    inventoryData
                        .filter(item => item.status === 'active')
                        .map(item => item.vendor_id)
                ).size;

                document.getElementById('metricTotalProducts').textContent = uniqueProducts;
                document.getElementById('metricActiveVendors').textContent = activeVendors;

                // Calculate price variance
                const priceVariance = calculatePriceVariance();
                document.getElementById('metricPriceVariance').textContent = priceVariance;

                // Calculate price trend
                const priceTrend = calculatePriceTrend();
                document.getElementById('metricPriceTrend').textContent = priceTrend;

            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        function calculatePriceVariance() {
            // Group by canonical product and calculate variance
            const productGroups = {};
            inventoryData.forEach(item => {
                if (!productGroups[item.canonical_product_id]) {
                    productGroups[item.canonical_product_id] = [];
                }
                productGroups[item.canonical_product_id].push(parseFloat(item.price));
            });

            let totalVariance = 0;
            let productCount = 0;

            Object.values(productGroups).forEach(prices => {
                if (prices.length > 1) {
                    const max = Math.max(...prices);
                    const min = Math.min(...prices);
                    const variance = ((max - min) / min * 100);
                    totalVariance += variance;
                    productCount++;
                }
            });

            return productCount > 0 ? (totalVariance / productCount).toFixed(1) + '%' : 'N/A';
        }

        function calculatePriceTrend() {
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);

            const recentPrices = inventoryData
                .filter(item => new Date(item.effective_date) >= ninetyDaysAgo)
                .map(item => parseFloat(item.price));

            if (recentPrices.length < 2) return 'Insufficient Data';

            const oldPrices = recentPrices.slice(0, Math.floor(recentPrices.length / 2));
            const newPrices = recentPrices.slice(Math.floor(recentPrices.length / 2));

            const oldAvg = oldPrices.reduce((a, b) => a + b, 0) / oldPrices.length;
            const newAvg = newPrices.reduce((a, b) => a + b, 0) / newPrices.length;

            const change = ((newAvg - oldAvg) / oldAvg * 100).toFixed(1);

            return change > 0 ? `‚Üë ${change}%` : change < 0 ? `‚Üì ${Math.abs(change)}%` : 'Stable';
        }

        // Rendering Functions
        function renderInventoryTable() {
            const tbody = document.getElementById('inventoryTableBody');
            
            if (filteredData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì¶</div>
                                <h3>No Items Found</h3>
                                <p>Try adjusting your search or filters</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filteredData.map(item => {
                const imageUrl = item.canonical_product?.image_path 
                    ? `${SUPABASE_URL}/storage/v1/object/public/jengchi/${item.canonical_product.image_path}`
                    : 'https://via.placeholder.com/60';

                return `
                    <tr>
                        <td><img src="${imageUrl}" alt="${item.canonical_product?.name || 'Product'}" class="product-image"></td>
                        <td><span class="vendor-badge">${item.vendor?.name || 'Unknown'}</span></td>
                        <td><span class="item-number">${item.item_number}</span></td>
                        <td>${item.canonical_product?.name || 'N/A'}</td>
                        <td>${item.canonical_product?.category || 'N/A'}</td>
                        <td><span class="price-cell">$${parseFloat(item.price).toFixed(2)}</span></td>
                        <td>${formatDate(item.effective_date)}</td>
                        <td><span class="status-badge ${item.status}">${item.status}</span></td>
                        <td>
                            <button class="btn btn-icon btn-secondary" onclick="editItem('${item.id}')" title="Edit">‚úèÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderProductsTable(products) {
            const tbody = document.getElementById('productsTableBody');
            document.getElementById('productCount').textContent = `${products.length} products`;

            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon">üè∑Ô∏è</div>
                                <h3>No Products Found</h3>
                                <p>Add your first canonical product to get started</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = products.map(product => {
                const imageUrl = product.image_path 
                    ? `${SUPABASE_URL}/storage/v1/object/public/jengchi/${product.image_path}`
                    : 'https://via.placeholder.com/60';

                const vendorCount = inventoryData.filter(item => item.canonical_product_id === product.id).length;

                return `
                    <tr>
                        <td><img src="${imageUrl}" alt="${product.name}" class="product-image"></td>
                        <td>${product.name}</td>
                        <td>${product.description || 'N/A'}</td>
                        <td>${product.category}</td>
                        <td>${product.unit_of_measure}</td>
                        <td>${vendorCount}</td>
                        <td>
                            <button class="btn btn-icon btn-secondary" onclick="editProduct('${product.id}')" title="Edit">‚úèÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderVendorsTable(vendors) {
            const tbody = document.getElementById('vendorsTableBody');
            document.getElementById('vendorCount').textContent = `${vendors.length} vendors`;

            if (vendors.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-state-icon">üè¢</div>
                                <h3>No Vendors Found</h3>
                                <p>Add your first vendor to get started</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = vendors.map(vendor => {
                const productCount = inventoryData.filter(item => item.vendor_id === vendor.id).length;

                return `
                    <tr>
                        <td>${vendor.name}</td>
                        <td>${vendor.contact_email || 'N/A'}</td>
                        <td>${vendor.contact_phone || 'N/A'}</td>
                        <td>${productCount}</td>
                        <td><span class="status-badge ${vendor.status}">${vendor.status}</span></td>
                        <td>
                            <button class="btn btn-icon btn-secondary" onclick="editVendor('${vendor.id}')" title="Edit">‚úèÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Search and Filter Functions
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            filteredData = inventoryData.filter(item => {
                const productName = item.canonical_product?.name?.toLowerCase() || '';
                const description = item.canonical_product?.description?.toLowerCase() || '';
                const itemNumber = item.item_number?.toLowerCase() || '';
                const vendorName = item.vendor?.name?.toLowerCase() || '';
                
                return productName.includes(searchTerm) ||
                       description.includes(searchTerm) ||
                       itemNumber.includes(searchTerm) ||
                       vendorName.includes(searchTerm);
            });

            applyFilters();
        }

        function applyFilters() {
            const vendorFilter = document.getElementById('vendorFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            let data = [...filteredData];

            if (vendorFilter) {
                data = data.filter(item => item.vendor_id === vendorFilter);
            }

            if (statusFilter) {
                data = data.filter(item => item.status === statusFilter);
            }

            filteredData = data;
            renderInventoryTable();
            updateRecordCount();
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearchInput').value.toLowerCase();
            
            supabaseClient
                .from('canonical_products')
                .select('*')
                .or(`name.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%`)
                .then(({ data, error }) => {
                    if (!error) {
                        renderProductsTable(data || []);
                    }
                });
        }

        // Table Sorting
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            filteredData.sort((a, b) => {
                let aVal, bVal;

                switch(column) {
                    case 'vendor':
                        aVal = a.vendor?.name || '';
                        bVal = b.vendor?.name || '';
                        break;
                    case 'item_number':
                        aVal = a.item_number || '';
                        bVal = b.item_number || '';
                        break;
                    case 'description':
                        aVal = a.canonical_product?.name || '';
                        bVal = b.canonical_product?.name || '';
                        break;
                    case 'category':
                        aVal = a.canonical_product?.category || '';
                        bVal = b.canonical_product?.category || '';
                        break;
                    case 'price':
                        aVal = parseFloat(a.price) || 0;
                        bVal = parseFloat(b.price) || 0;
                        break;
                    case 'effective_date':
                        aVal = new Date(a.effective_date);
                        bVal = new Date(b.effective_date);
                        break;
                    default:
                        return 0;
                }

                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            updateSortIndicators(column);
            renderInventoryTable();
        }

        function updateSortIndicators(column) {
            document.querySelectorAll('.data-table th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            const header = document.querySelector(`.data-table th[onclick*="${column}"]`);
            if (header) {
                header.classList.add(sortDirection === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }
        }

        // Modal Functions
        function openAddItemModal() {
            document.getElementById('itemModalTitle').textContent = 'Add Vendor Item';
            document.getElementById('itemForm').reset();
            document.getElementById('itemEffectiveDate').valueAsDate = new Date();
            openModal('itemModal');
        }

        function openAddProductModal() {
            document.getElementById('productForm').reset();
            openModal('productModal');
        }

        function openAddVendorModal() {
            document.getElementById('vendorForm').reset();
            openModal('vendorModal');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Save Functions
        async function saveVendorItem(event) {
            event.preventDefault();
            showLoading(true);

            try {
                const itemData = {
                    canonical_product_id: document.getElementById('itemCanonicalProduct').value,
                    vendor_id: document.getElementById('itemVendor').value,
                    item_number: document.getElementById('itemNumber').value,
                    price: parseFloat(document.getElementById('itemPrice').value),
                    effective_date: document.getElementById('itemEffectiveDate').value,
                    status: document.getElementById('itemStatus').value
                };

                const { data, error } = await supabaseClient
                    .from('vendor_items')
                    .insert([itemData])
                    .select();

                if (error) throw error;

                showAlert('Vendor item added successfully', 'success');
                closeModal('itemModal');
                await loadInventoryData();

            } catch (error) {
                console.error('Error saving item:', error);
                showAlert('Error saving item: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveProduct(event) {
            event.preventDefault();
            showLoading(true);

            try {
                const productData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    category: document.getElementById('productCategory').value,
                    unit_of_measure: document.getElementById('productUnit').value,
                    image_path: document.getElementById('productImage').value || null
                };

                const { data, error } = await supabaseClient
                    .from('canonical_products')
                    .insert([productData])
                    .select();

                if (error) throw error;

                showAlert('Product added successfully', 'success');
                closeModal('productModal');
                await loadProducts();

            } catch (error) {
                console.error('Error saving product:', error);
                showAlert('Error saving product: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function saveVendor(event) {
            event.preventDefault();
            showLoading(true);

            try {
                const vendorData = {
                    name: document.getElementById('vendorName').value,
                    contact_email: document.getElementById('vendorEmail').value || null,
                    contact_phone: document.getElementById('vendorPhone').value || null,
                    status: document.getElementById('vendorStatus').value
                };

                const { data, error } = await supabaseClient
                    .from('vendors')
                    .insert([vendorData])
                    .select();

                if (error) throw error;

                showAlert('Vendor added successfully', 'success');
                closeModal('vendorModal');
                await loadVendors();

            } catch (error) {
                console.error('Error saving vendor:', error);
                showAlert('Error saving vendor: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Analytics Functions
        async function loadProductAnalytics() {
            const productId = document.getElementById('analyticsProductSelect').value;
            if (!productId) return;

            showLoading(true);

            try {
                // Get all price history for this product
                const { data, error } = await supabaseClient
                    .from('vendor_items')
                    .select(`
                        *,
                        vendor:vendors!vendor_items_vendor_id_fkey(name)
                    `)
                    .eq('canonical_product_id', productId)
                    .order('effective_date');

                if (error) throw error;

                renderPriceComparisonChart(data);
                renderMarketAnalysisChart(data);
                generateExecutiveInsights(data);

            } catch (error) {
                console.error('Error loading analytics:', error);
                showAlert('Error loading analytics', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderPriceComparisonChart(data) {
            const ctx = document.getElementById('priceComparisonChart');
            
            // Group by vendor
            const vendorData = {};
            data.forEach(item => {
                const vendorName = item.vendor?.name || 'Unknown';
                if (!vendorData[vendorName]) {
                    vendorData[vendorName] = [];
                }
                vendorData[vendorName].push({
                    x: item.effective_date,
                    y: parseFloat(item.price)
                });
            });

            const datasets = Object.keys(vendorData).map((vendorName, index) => {
                const colors = [
                    '#2c5688', '#f59e0b', '#10b981', '#dc2626', '#8b5cf6', '#ec4899'
                ];
                return {
                    label: vendorName,
                    data: vendorData[vendorName],
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4
                };
            });

            if (priceComparisonChart) {
                priceComparisonChart.destroy();
            }

            priceComparisonChart = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Price ($)'
                            },
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function renderMarketAnalysisChart(data) {
            const ctx = document.getElementById('marketAnalysisChart');
            
            // Calculate min, max, avg by month
            const monthlyData = {};
            data.forEach(item => {
                const month = item.effective_date.substring(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = [];
                }
                monthlyData[month].push(parseFloat(item.price));
            });

            const labels = Object.keys(monthlyData).sort();
            const minPrices = labels.map(month => Math.min(...monthlyData[month]));
            const maxPrices = labels.map(month => Math.max(...monthlyData[month]));
            const avgPrices = labels.map(month => {
                const sum = monthlyData[month].reduce((a, b) => a + b, 0);
                return sum / monthlyData[month].length;
            });

            if (marketAnalysisChart) {
                marketAnalysisChart.destroy();
            }

            marketAnalysisChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'Maximum',
                            data: maxPrices,
                            borderColor: '#dc2626',
                            backgroundColor: '#dc262620',
                            borderWidth: 2,
                            fill: false
                        },
                        {
                            label: 'Average',
                            data: avgPrices,
                            borderColor: '#2c5688',
                            backgroundColor: '#2c568820',
                            borderWidth: 3,
                            fill: true
                        },
                        {
                            label: 'Minimum',
                            data: minPrices,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            borderWidth: 2,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Price ($)'
                            },
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function generateExecutiveInsights(data) {
            const insightsContainer = document.getElementById('insightsContent');
            
            if (data.length === 0) {
                insightsContainer.innerHTML = '<p style="color: var(--neutral-500);">No data available for insights.</p>';
                return;
            }

            // Calculate insights
            const prices = data.map(item => parseFloat(item.price));
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            
            const minPriceItem = data.find(item => parseFloat(item.price) === minPrice);
            const maxPriceItem = data.find(item => parseFloat(item.price) === maxPrice);

            // Group by vendor
            const vendorPrices = {};
            data.forEach(item => {
                const vendorName = item.vendor?.name || 'Unknown';
                if (!vendorPrices[vendorName]) {
                    vendorPrices[vendorName] = [];
                }
                vendorPrices[vendorName].push(parseFloat(item.price));
            });

            const vendorAverages = {};
            Object.keys(vendorPrices).forEach(vendor => {
                const sum = vendorPrices[vendor].reduce((a, b) => a + b, 0);
                vendorAverages[vendor] = sum / vendorPrices[vendor].length;
            });

            const lowestAvgVendor = Object.keys(vendorAverages).reduce((a, b) => 
                vendorAverages[a] < vendorAverages[b] ? a : b
            );

            insightsContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div>
                        <h4 style="color: var(--success-600); margin-bottom: 0.5rem;">üí∞ Lowest Price</h4>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-900);">$${minPrice.toFixed(2)}</p>
                        <p style="font-size: 0.875rem; color: var(--neutral-600);">${minPriceItem.vendor?.name} on ${formatDate(minPriceItem.effective_date)}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--warning-600); margin-bottom: 0.5rem;">üìà Highest Price</h4>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-900);">$${maxPrice.toFixed(2)}</p>
                        <p style="font-size: 0.875rem; color: var(--neutral-600);">${maxPriceItem.vendor?.name} on ${formatDate(maxPriceItem.effective_date)}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--primary-600); margin-bottom: 0.5rem;">üèÜ Best Long-Term Value</h4>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-900);">${lowestAvgVendor}</p>
                        <p style="font-size: 0.875rem; color: var(--neutral-600);">Avg: $${vendorAverages[lowestAvgVendor].toFixed(2)}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--accent-500); margin-bottom: 0.5rem;">üìä Price Range</h4>
                        <p style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-900);">${((maxPrice - minPrice) / minPrice * 100).toFixed(1)}%</p>
                        <p style="font-size: 0.875rem; color: var(--neutral-600);">Variance across vendors</p>
                    </div>
                </div>
            `;
        }

        // Utility Functions
        function populateVendorSelects(vendors) {
            const selects = [
                document.getElementById('vendorFilter'),
                document.getElementById('itemVendor')
            ];

            selects.forEach(select => {
                const currentValue = select.value;
                const isFilter = select.id === 'vendorFilter';
                
                select.innerHTML = isFilter ? '<option value="">All Vendors</option>' : '<option value="">Select a vendor...</option>';
                
                vendors.forEach(vendor => {
                    const option = document.createElement('option');
                    option.value = vendor.id;
                    option.textContent = vendor.name;
                    select.appendChild(option);
                });

                if (currentValue) {
                    select.value = currentValue;
                }
            });
        }

        function populateProductSelects(products) {
            const selects = [
                document.getElementById('itemCanonicalProduct'),
                document.getElementById('analyticsProductSelect')
            ];

            selects.forEach(select => {
                const currentValue = select.value;
                const isAnalytics = select.id === 'analyticsProductSelect';
                
                select.innerHTML = isAnalytics ? '<option value="">Choose a product...</option>' : '<option value="">Select a product...</option>';
                
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    select.appendChild(option);
                });

                if (currentValue) {
                    select.value = currentValue;
                }
            });
        }

        function updateRecordCount() {
            document.getElementById('recordCount').textContent = `${filteredData.length} of ${inventoryData.length} items`;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function showAlert(message, type = 'info') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('active', show);
        }

        function switchTab(tabName) {
            currentTab = tabName;
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Export Functions
        function exportToCSV() {
            const headers = ['Vendor', 'Item No.', 'Description', 'Category', 'Price', 'Effective Date', 'Status'];
            const rows = filteredData.map(item => [
                item.vendor?.name || 'Unknown',
                item.item_number,
                item.canonical_product?.name || 'N/A',
                item.canonical_product?.category || 'N/A',
                item.price,
                item.effective_date,
                item.status
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.map(cell => `"${cell}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory-export-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert('Data exported successfully', 'success');
        }

        // Edit Functions (Placeholder - to be implemented)
        function editItem(id) {
            showAlert('Edit functionality: Select item to modify vendor-specific data only', 'info');
        }

        function editProduct(id) {
            showAlert('Edit functionality: Modify canonical product affects all vendors', 'info');
        }

        function editVendor(id) {
            showAlert('Edit functionality: Update vendor information', 'info');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>