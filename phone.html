<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Employee Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    // Corporate Color Palette (Deep Navy/Gold Accent - used for highlights)
                    colors: {
                        'corp-main': '#003366',     // Deep Navy Blue (Primary Button, Text)
                        'corp-accent': '#FFC300',   // Gold/Yellow Accent (Highlight, Focus)
                        'corp-text-dark': '#1F2937', // Dark Gray Text
                        'corp-bg-light': '#F3F4F6', // Light Gray Background
                        'corp-white': '#FFFFFF',    // Pure White Card Background
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            /* Subtle Light Background Gradient */
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%); 
        }
        /* Clean, Elevated Card Style */
        .card { 
            background-color: #FFFFFF;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.1); 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 1.5rem; 
            border: 1px solid #E5E7EB; /* Subtle light border */
        }
        .card:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        .suggestion { 
            background: #FFFFFF; 
            border-bottom: 1px solid #F3F4F6;
            transition: background-color 0.1s ease;
        }
        /* Highlight suggestions with a light blue hover */
        .suggestion:hover { 
            background-color: #E5F3FF; 
            color: #003366; 
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-10">
    <div class="max-w-4xl mx-auto">
        <!-- Header & Logo -->
        <header class="text-center mb-12 py-8 bg-corp-white rounded-[2rem] card">
            <img src="https://github.com/pgonzalez2910/jengchi-product-images/blob/main/jengchilogo.jpg?raw=true" alt="Logo" class="h-24 mx-auto mb-5 rounded-2xl shadow-lg" onerror="this.src='https://placehold.co/180x96/003366/FFC300?text=JENGCHI+HR';">
            <h1 class="text-5xl font-black text-corp-main tracking-wide">Executive Directory</h1>
            <p class="text-corp-text-dark text-lg font-medium mt-3">Secure Contact Management Portal</p>
            <p id="status" class="text-sm text-green-500 mt-3 font-semibold">Ready</p>
        </header>

        <!-- Search Section with Autocomplete -->
        <div class="card p-8 mb-12">
            <h2 class="text-2xl font-bold text-corp-text-dark mb-6 border-b border-gray-200 pb-4">Employee Lookup</h2>
            <p class="text-gray-500 mb-4 text-sm">Type a full name or username. Suggestions appear after 3 characters.</p>
            <div class="relative">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search employee name or username..." 
                    class="w-full p-4 border border-gray-300 rounded-2xl bg-corp-bg-light text-corp-text-dark placeholder-gray-400 focus:ring-2 focus:ring-corp-accent focus:border-corp-accent text-lg transition duration-200"
                    oninput="handleInput()"
                >
                <div id="suggestions" class="absolute top-full left-0 right-0 mt-3 max-h-72 overflow-y-auto rounded-2xl z-10 shadow-xl hidden border border-gray-200 bg-white">
                    <!-- Suggestions populated by JS -->
                </div>
            </div>
            

        <!-- Employee Details and Update Form -->
        <div id="employeeCard" class="card p-8 hidden">
            <h2 class="text-3xl font-bold text-corp-text-dark mb-8 flex justify-between items-center border-b border-gray-200 pb-4">
                <span>Employee Profile</span>
                <span id="deptBadge" class="text-sm px-4 py-2 rounded-full text-corp-dark font-bold shadow-md bg-corp-accent">N/A</span>
            </h2>
            <div class="space-y-8 text-corp-text-dark">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Full Name Card -->
                    <div class="bg-corp-bg-light p-6 rounded-2xl border border-gray-200">
                        <p class="text-xs font-medium text-gray-500 mb-2">Full Name</p>
                        <p id="employeeName" class="text-3xl font-bold text-corp-main"></p>
                    </div>
                    <!-- Username/ID Card -->
                    <div class="bg-corp-bg-light p-6 rounded-2xl border border-gray-200">
                        <p class="text-xs font-medium text-gray-500 mb-2">Username / Employee ID</p>
                        <p id="employeeUsername" class="text-xl font-semibold"></p>
                    </div>
                </div>
                
                <!-- Editable Fields Section -->
                <div class="space-y-6 pt-4">
                    <!-- Phone Input -->
                    <div class="bg-corp-bg-light p-6 rounded-2xl border border-gray-200">
                        <label for="phoneInput" class="block text-sm font-medium text-corp-text-dark mb-3">
                            <span class="text-corp-main mr-1">•</span> PRIMARY PHONE NUMBER
                        </label>
                        <input type="tel" id="phoneInput" class="w-full p-4 border border-gray-300 rounded-xl bg-white text-corp-text-dark focus:ring-corp-accent focus:border-corp-accent transition duration-150" placeholder="Enter new primary phone number">
                    </div>
                    <!-- Email Input -->
                    <div class="bg-corp-bg-light p-6 rounded-2xl border border-gray-200">
                        <label for="emailInput" class="block text-sm font-medium text-corp-text-dark mb-3">
                            <span class="text-corp-main mr-1">•</span> EMAIL ADDRESS
                        </label>
                        <input type="email" id="emailInput" class="w-full p-4 border border-gray-300 rounded-xl bg-white text-corp-text-dark focus:ring-corp-accent focus:border-corp-accent transition duration-150" placeholder="Enter new corporate email address">
                    </div>
                </div>
                
                <!-- Update Button -->
                <button onclick="updateEmployeeData()" id="updateBtn" class="w-full px-8 py-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-2xl transition duration-300 shadow-lg mt-6">
                    <span class="flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                        COMMIT CONTACT UPDATE
                    </span>
                </button>
            </div>
            <p id="updateMsg" class="mt-4 text-center text-sm font-medium hidden"></p>
        </div>

        <!-- Custom Modal for Messages -->
        <div id="modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center p-4 z-50">
            <div class="bg-corp-white p-8 rounded-3xl max-w-md w-full card border-corp-main/50">
                <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-corp-main"></h3>
                <p id="modalBody" class="text-corp-text-dark/80 mb-6"></p>
                <button onclick="closeModal()" class="w-full py-4 bg-corp-main text-corp-white font-black rounded-2xl hover:bg-blue-800">Close</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        
        // Supabase Configuration (Using provided keys)
        const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";
        const EMPLOYEE_TABLE = 'employees2025';
        
        const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentEmployeeId = null;

        // --- Utility Functions ---

        function showModal(title, body) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').textContent = body;
            document.getElementById('modal').classList.remove('hidden');
        }
        window.closeModal = () => document.getElementById('modal').classList.add('hidden');

        function capitalize(str) {
            return str ? str.charAt(0).toUpperCase() + str.slice(1).toLowerCase() : '';
        }

        // --- Initialization and Seeding ---
        
        async function initializeSupabase() {
            try {
                // Initial check and status update
                await sb.from(EMPLOYEE_TABLE).select('id', { head: true });
                document.getElementById('status').textContent = 'System Operational';
                document.getElementById('status').className = 'text-green-600 font-semibold';
            
            } catch (error) {
                console.error("Initialization error:", error);
                showModal("Database Connection Error", "Could not connect to Supabase. Check the console for details.");
                document.getElementById('status').textContent = 'Connection Error';
                document.getElementById('status').className = 'text-red-500 font-semibold';
            }
        }

        const mockEmployees = [
            { first_name: "Jane", last_name: "Doe", username: "jdoe", department: "FOH", primary_phone: "555-123-4567", email: "jane.doe@jengchi.com" },
            { first_name: "John", last_name: "Smith", username: "jsmith", department: "BOH", primary_phone: "555-987-6543", email: "john.smith@jengchi.com" },
            { first_name: "Alex", last_name: "Chen", username: "achen", department: "FOH", primary_phone: "555-555-1212", email: "alex.chen@jengchi.com" },
            { first_name: "Maria", last_name: "Garcia", username: "mgarcia", department: "BOH", primary_phone: "555-333-7777", email: "maria.g@jengchi.com" },
        ];

       

        // --- Autocomplete Logic ---

        window.handleInput = async function() {
            const input = document.getElementById('searchInput');
            const value = input.value.trim();
            const suggestionsDiv = document.getElementById('suggestions');
            
            // Hide if less than 3 characters
            if (value.length < 3) {
                suggestionsDiv.classList.add('hidden');
                return;
            }

            try {
                const lowerValue = value.toLowerCase();
                // Use ilike for partial, case-insensitive matching across fields
                const { data } = await sb
                    .from(EMPLOYEE_TABLE)
                    .select('id, first_name, last_name, username')
                    .or(`first_name.ilike.%${lowerValue}%,last_name.ilike.%${lowerValue}%,username.ilike.%${lowerValue}%`)
                    .limit(7); // Limit to 7 suggestions

                if (data && data.length > 0) {
                    suggestionsDiv.innerHTML = data.map(emp => 
                        `<div class="suggestion p-3 cursor-pointer text-corp-text-dark hover:text-corp-main rounded-xl m-1" onclick="selectSuggestion('${capitalize(emp.first_name)} ${capitalize(emp.last_name)}', ${emp.id})">
                            <span class="font-semibold">${capitalize(emp.first_name)} ${capitalize(emp.last_name)}</span> 
                            <span class="text-sm text-gray-500">(${emp.username})</span>
                        </div>`
                    ).join('');
                    suggestionsDiv.classList.remove('hidden');
                } else {
                    suggestionsDiv.classList.add('hidden');
                }
            } catch (e) {
                console.error("Suggestion fetching error:", e);
                suggestionsDiv.classList.add('hidden');
            }
        };

        window.selectSuggestion = function(name, id) {
            document.getElementById('searchInput').value = name;
            document.getElementById('suggestions').classList.add('hidden');
            currentEmployeeId = id;
            loadEmployee(id);
        };

        // --- Search and Update Logic ---
async function loadEmployee(id) {
    try {
        const { data, error } = await sb
            .from(EMPLOYEE_TABLE)
            .select('id, first_name, last_name, username, primary_phone, email, department')
            .eq('id', id)
            .single();

        if (error) throw error;
        if (data) displayEmployee(data);

    } catch (e) {
        console.error("Load employee error:", e);
        showModal("Error", "Failed to load employee details.");
    }
}

window.searchEmployee = async function() {
    const searchValue = document.getElementById('searchInput').value.trim();
    const lowerSearch = searchValue.toLowerCase();
    const searchMsg = document.getElementById('searchMsg');
    const employeeCard = document.getElementById('employeeCard');

    if (searchMsg) searchMsg.classList.add('hidden');
    if (employeeCard) employeeCard.classList.add('hidden');
    document.getElementById('suggestions').classList.add('hidden');

    if (!searchValue) {
        showModal("Required", "Please enter a name to search.");
        return;
    }

    try {
        const { data: employees, error } = await sb
            .from(EMPLOYEE_TABLE)
            .select('id, first_name, last_name, username, primary_phone, email, department')
            .or(
                `first_name.ilike.%${lowerSearch}%,` +
                `last_name.ilike.%${lowerSearch}%,` +
                `username.ilike.%${lowerSearch}%`
            );

        if (error) throw error;
        
        if (employees?.length > 0) {
            const employeeData = employees[0];
            currentEmployeeId = employeeData.id;
            displayEmployee(employeeData);
        } else if (searchMsg) {
            searchMsg.textContent = 'No employee found matching the exact name/username.';
            searchMsg.classList.remove('hidden');
        }
    } catch (e) {
        console.error("Search failed:", e);
        showModal("Error", "Search failed. Check console for database issues.");
    }
};

        function displayEmployee(data) {
            document.getElementById('employeeName').textContent = `${data.first_name || 'N/A'} ${data.last_name || ''}`;
            document.getElementById('employeeUsername').textContent = `${data.username || 'N/A'} (ID: ${data.id})`;
            document.getElementById('phoneInput').value = data.primary_phone || '';
            document.getElementById('emailInput').value = data.email || '';

            const badge = document.getElementById('deptBadge');
            const dept = data.department ? data.department.toUpperCase() : 'N/A';
            badge.textContent = dept;
            
            // Set colors based on department
            let badgeClass = 'text-sm px-4 py-2 rounded-full font-bold shadow-md ';
            if (dept === 'FOH') {
                badgeClass += 'bg-blue-200 text-corp-main'; // Light Blue background, Navy text
            } else if (dept === 'BOH') {
                badgeClass += 'bg-yellow-200 text-corp-text-dark'; // Light Yellow background, Dark text
            } else {
                badgeClass += 'bg-gray-200 text-gray-600';
            }
            badge.className = badgeClass;

            document.getElementById('employeeCard').classList.remove('hidden');
        }

        window.updateEmployeeData = async function() {
            if (!currentEmployeeId) {
                showModal("Error", "No employee selected for update.");
                return;
            }

            const phone = document.getElementById('phoneInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();
            const updateMsg = document.getElementById('updateMsg');
            updateMsg.classList.add('hidden');

            if (!phone && !email) {
                showModal("Required", "Please enter a phone number and/or an email address to update.");
                return;
            }

            document.getElementById('updateBtn').disabled = true;

            try {
                const updates = {};
                // Only include fields that have non-empty values
                if (phone) updates.primary_phone = phone;
                if (email) updates.email = email;
                
                const { error } = await sb.from(EMPLOYEE_TABLE).update(updates).eq('id', currentEmployeeId);

                if (error) throw error;

                updateMsg.textContent = 'Update successful!';
                updateMsg.classList.add('text-green-600');
                updateMsg.classList.remove('hidden');
                showModal("Success", "Employee contact information has been successfully updated.");
            } catch (e) {
                console.error("Update failed:", e);
                updateMsg.textContent = 'Update failed. Check database permissions.';
                updateMsg.classList.add('text-red-500');
                updateMsg.classList.remove('hidden');
                showModal("Database Error", "The contact update failed. Please verify your permissions or try again.");
            } finally {
                document.getElementById('updateBtn').disabled = false;
            }
        }

        window.onload = initializeSupabase;
    </script>
</body>

</html>
