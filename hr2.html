<!-- FIXED FILE ‚Äì PART 1/5: DOCTYPE, HEAD, HEADER, NAVIGATION -->
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jeng Chi HR Discipline ‚Ä¢ Compliance ‚Ä¢ Corrective Action Management</title>

  <!-- Google Fonts: Inter + Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet" />

  <!-- Tailwind Configuration (must come before CDN script) -->
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = {
      corePlugins: {
        container: false,
      },
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            heading: ['Poppins', 'Inter', 'system-ui', 'sans-serif'],
          },
          fontSize: {
            'xs': ['0.96rem', { lineHeight: '1.5' }],
            'sm': ['1.12rem', { lineHeight: '1.5' }],
            'base': ['1.28rem', { lineHeight: '1.6' }],
            'lg': ['1.44rem', { lineHeight: '1.6' }],
            'xl': ['1.6rem', { lineHeight: '1.6' }],
            '2xl': ['1.92rem', { lineHeight: '1.4' }],
            '3xl': ['2.4rem', { lineHeight: '1.3' }],
          },
          colors: {
            brand: {
              50: '#f1f8ff',
              100: '#e0f0ff',
              200: '#b9ddff',
              300: '#80c3ff',
              400: '#4aa7f5',
              500: '#1d8fe3',
              600: '#136fbc',
              700: '#0b5694',
              800: '#083b66',
              900: '#062847',
            },
          },
          boxShadow: {
            subtle: '0 10px 25px rgba(15, 23, 42, 0.06)',
          },
        },
      },
    };
  </script>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase JS v2 UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.1/dist/umd/supabase.js"></script>

  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" 
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Custom CSS -->
  <style>
  /* ===== SCROLLBAR STYLES ===== */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #f1f5f9;
  }
  ::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 9999px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #a5b4fc;
  }

  /* ===== MAKE ALL IMPORTANT TEXT BOLD ===== */
  
  /* Navigation tabs */
  .tab-trigger span,
  nav button span,
  nav a span {
    font-weight: 700 !important;
  }

  /* All uppercase labels (KPIs, section headers) */
  .uppercase,
  .uppercase.tracking-wide {
    font-weight: 700 !important;
  }

  /* Table headers */
  th,
  thead th,
  thead tr th {
    font-weight: 700 !important;
    color: #475569 !important;
  }

  /* Section titles and subtitles */
  h1, h2, h3, h4, h5, h6 {
    font-weight: 700 !important;
  }

  /* Subtitle text and descriptions */
  p.text-xs.text-slate-500,
  p.text-sm.text-slate-500 {
    font-weight: 600 !important;
  }

  /* Form labels */
  label {
    font-weight: 700 !important;
  }

  /* Filter chips and buttons */
  .policy-filter-chip,
  .employee-filter-chip,
  button[data-policy-category],
  button[data-employee-filter] {
    font-weight: 700 !important;
  }

  /* All button text */
  button {
    font-weight: 700 !important;
  }

  /* Badge and chip text */
  .rounded-full {
    font-weight: 700 !important;
  }

  /* Card titles */
  .font-heading {
    font-weight: 700 !important;
  }

  /* KPI values */
  .text-2xl,
  .text-xl,
  .text-lg {
    font-weight: 700 !important;
  }

  /* Table cell labels in Permission matrix */
  td {
    font-weight: 600 !important;
  }

  /* Specific for "Feature / Tab" and similar headers */
  .font-bold,
  [class*="font-bold"] {
    font-weight: 700 !important;
  }

  /* Make all span elements inside headers bold */
  h1 span, h2 span, h3 span, h4 span, h5 span, h6 span {
    font-weight: 700 !important;
  }

  /* Policy library button text */
  .inline-flex.items-center.gap-1,
  .inline-flex.items-center.gap-2 {
    font-weight: 700 !important;
  }

  /* Section descriptions that appear under titles */
  .text-xs.text-slate-500.mt-1,
  .text-xs.text-slate-600 {
    font-weight: 600 !important;
  }

  /* ===== TIMELINE STYLES ===== */
  .timeline-line {
    position: absolute;
    left: 1.25rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, #bfdbfe, #1d8fe3);
    opacity: 0.75;
  }

  /* ===== PRINT STYLES ===== */
  @media print {
    .no-print {
      display: none !important;
    }
  }



/* Responsive header adjustments */
@media (max-width: 768px) {
  header h1 span {
    font-size: 0.75rem !important;
    line-height: 1.2;
  }
  
  header h1 i {
    font-size: 0.75rem !important;
  }
  
  header p {
    font-size: 0.65rem !important;
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  header h1 span {
    font-size: 0.9rem !important;
  }
}

/* Ensure navigation wraps properly on smaller screens */
@media (max-width: 1280px) {
  nav.flex {
    flex-wrap: wrap;
  }
}
/* Professional Tab Hover Effects */
.tab-trigger {
  transition: all 0.2s ease-in-out;
}

.tab-trigger:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.tab-trigger.active {
  background: linear-gradient(135deg, #7a1f1f 0%, #991b1b 100%);
  border-color: #7a1f1f;
  box-shadow: 0 4px 12px rgba(122, 31, 31, 0.3);
}

/* Professional Font Stack */
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Enhanced Header Shadow */
header {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Professional HR Badge Pulse Effect */
@keyframes subtle-pulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(122, 31, 31, 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(122, 31, 31, 0);
  }
}

header .rounded-full:hover {
  animation: subtle-pulse 2s infinite;
}
</style>
</head>

<body class="h-full bg-slate-50 text-slate-900 font-sans" style="max-width: 100vw !important; width: 100vw !important; margin: 0 !important; padding: 0 !important;">

  <!-- Root App Container -->
  <div id="app-root" class="min-h-screen flex flex-col" style="max-width: 100vw !important; width: 100vw !important; margin: 0 !important; padding: 0 !important;">
  <!-- Top Navigation / Header -->


<!-- PROFESSIONAL ENTERPRISE HEADER - UPGRADED VERSION -->

<header class="no-print bg-white shadow-lg border-b-2 border-slate-200">
  <div class="w-full px-4 md:px-6 lg:px-8" style="max-width: 100% !important;">

    <!-- Top Row: Logo ‚Ä¢ Title ‚Ä¢ User Badge -->
    <div class="grid grid-cols-[auto_1fr_auto] items-center gap-4 md:gap-6 lg:gap-8 py-4 md:py-5">
      
      <!-- LEFT: Logo -->
      <div class="flex items-center justify-start">
        <img
          src="https://github.com/pgonzalez2910/jengchi-product-images/blob/main/jengchilogo.jpg?raw=1"
          alt="Jeng Chi Restaurant Logo"
          class="h-20 md:h-24 lg:h-28 w-auto rounded-xl bg-white/95 backdrop-blur-sm object-contain shadow-md border border-slate-200"
        />
      </div>

      <!-- CENTER: Title + Subtitle (TRUE CENTER) -->
      <div class="flex flex-col items-center justify-center text-center gap-2 px-2">
        <!-- Main Title with Shield Icon -->
        <h1 class="flex items-center justify-center gap-3 font-heading text-base sm:text-lg md:text-xl lg:text-2xl tracking-tight text-slate-900 font-black">
          <i class="fa-solid fa-shield-halved text-brand-600 text-lg md:text-xl lg:text-3xl drop-shadow-sm"></i>
          <span class="whitespace-nowrap">Discipline ‚Ä¢ Compliance ‚Ä¢ Corrective Action Management</span>
        </h1>
        
        <!-- Subtitle with Building Icon -->
        <p class="flex items-center justify-center gap-2 text-xs sm:text-sm md:text-base text-slate-700 font-semibold">
          <i class="fa-solid fa-building text-brand-500 text-xs md:text-sm"></i>
          <span class="hidden sm:inline">
            Jeng Chi Restaurant ‚Äî Internal HR Discipline, Compliance, and Risk Governance Portal
          </span>
          <span class="sm:hidden">
            Jeng Chi Restaurant ‚Äî HR Portal
          </span>
        </p>
      </div>

      <!-- RIGHT: Professional HR Badge -->
      <div class="flex items-center justify-end">
        <div class="flex items-center justify-center rounded-full bg-gradient-to-br from-brand-500 to-brand-700 text-white w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 font-heading text-base md:text-lg lg:text-xl font-black shadow-lg border-2 border-white">
          HR
        </div>
      </div>
    </div>

    <!-- Desktop Navigation Tabs - PROFESSIONAL VERSION -->
    <div class="no-print hidden md:flex items-center justify-center py-3 border-t border-slate-200 relative">
      <!-- Centered Navigation -->
      <nav class="flex items-center gap-2 lg:gap-3 text-sm font-bold" aria-label="Primary navigation">
        
        <!-- Dashboard Tab -->
      <button
  data-tab-target="dashboard"
  class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
>
  <i class="fa-solid fa-chart-line text-sm lg:text-base"></i>
  <span>Dashboard</span>
</button>
        
        <!-- Discipline Cases Tab -->
        <button
          data-tab-target="discipline"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-gavel text-sm lg:text-base"></i>
          <span>Discipline Cases</span>
        </button>
        
        <!-- Employees 360 Tab -->
        <button
          data-tab-target="employees"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-users text-sm lg:text-base"></i>
          <span>Employees 360</span>
        </button>
        
        <!-- Policy Library Tab -->
        <button
          data-tab-target="policy"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-scale-balanced text-sm lg:text-base"></i>
          <span>Policy Library</span>
        </button>
        
        <!-- Reports & Analytics Tab -->
        <button
          data-tab-target="reports"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-chart-bar text-sm lg:text-base"></i>
          <span>Reports &amp; Analytics</span>
        </button>
        
        <!-- Admin & Settings Tab -->
        <button
          data-tab-target="admin"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-gear text-sm lg:text-base"></i>
          <span>Admin &amp; Settings</span>
        </button>
        
        <!-- Permissions Tab -->
        <button
          data-tab-target="permissions"
          class="tab-trigger inline-flex items-center gap-2 px-4 lg:px-5 py-2.5 rounded-lg text-slate-700 hover:text-brand-700 hover:bg-brand-50 border-2 border-transparent hover:border-brand-200 transition-all text-xs lg:text-sm font-black"
        >
          <i class="fa-solid fa-shield-halved text-sm lg:text-base"></i>
          <span>Permissions</span>
        </button>
      </nav>
      
      <!-- Timestamp - Professional Badge Style -->
      <div class="absolute right-0 top-1/2 -translate-y-1/2 hidden lg:flex items-center gap-2 bg-slate-100 border border-slate-300 rounded-lg px-3 py-1.5 text-xs font-bold text-slate-700">
        <i class="fa-regular fa-clock text-brand-600"></i>
        <span class="uppercase tracking-wide">Last refreshed:</span>
        <span id="header-last-refreshed" class="text-brand-700">--</span>
      </div>
    </div>

    <!-- Mobile Navigation Tabs -->
    <div class="no-print md:hidden border-t border-slate-200 py-3">
      <div class="flex items-center justify-between gap-2">
        <label for="mobile-tab-select" class="text-xs font-black text-slate-700 uppercase tracking-wide">
          <i class="fa-solid fa-bars mr-1"></i>
          Navigate
        </label>
        <select
          id="mobile-tab-select"
          class="flex-1 text-xs font-bold rounded-lg border-2 border-slate-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
        >
          <option value="dashboard">üìä Dashboard</option>
          <option value="discipline">‚öñÔ∏è Discipline Cases</option>
          <option value="employees">üë• Employees 360</option>
          <option value="policy">üìã Policy Library</option>
          <option value="reports">üìà Reports &amp; Analytics</option>
          <option value="admin">‚öôÔ∏è Admin &amp; Settings</option>
          <option value="permissions">üõ°Ô∏è Permissions</option>
        </select>
      </div>
    </div>
  </div>
</header>



 <!-- Toast Notification Container - REQUIRED FOR showToast() -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2" aria-live="polite"></div>

    <!-- Toast / Status Banner -->
    <!-- Toast / Status Banner -->
    <div
      id="global-toast"
      class="no-print fixed z-40 inset-x-0 top-0 flex justify-center pointer-events-none opacity-0 transition-opacity duration-300"
      aria-live="polite"
    >
      <div
        id="global-toast-inner"
        class="mt-20 max-w-xl w-full mx-4 flex items-start gap-3 rounded-2xl border border-emerald-100 bg-white shadow-subtle px-4 py-3 text-sm text-emerald-800 pointer-events-auto"
      >
        <div class="mt-0.5">
          <i class="fa-solid fa-circle-check"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p id="global-toast-message" class="font-medium truncate">
            Action saved successfully.
          </p>
          <p id="global-toast-subtext" class="text-xs text-emerald-700 mt-0.5">
            Employee record updated in employees2025 and risk scoring recalculated.
          </p>
        </div>
        <button
          type="button"
          id="global-toast-close"
          class="ml-2 text-xs text-emerald-600 hover:text-emerald-800"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 w-full" style="max-width: 100% !important; overflow-x: visible;">
      <div class="w-full px-2 py-6 md:py-8 space-y-8" style="max-width: 100% !important; width: 100% !important; overflow-x: visible;">

        <!-- FIXED FILE ‚Äì PART 2/5: DASHBOARD TAB + DISCIPLINE CASES TAB -->

       <!-- Dashboard Tab -->
<section id="tab-dashboard" class="tab-panel space-y-8">
 <!-- Executive Summary & KPIs -->
<div class="grid grid-cols-1 lg:grid-cols-7 gap-4">
  
  <!-- KPI: Total Active Employees -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          Total Employees
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-total-employees">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-brand-50 flex items-center justify-center">
        <i class="fa-solid fa-users text-brand-500 text-lg"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500 leading-relaxed">
      Total headcount across all positions
    </p>
  </div>

  <!-- KPI: FOH (Front of House) -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          Front of House (FOH)
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-foh-total">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-emerald-50 flex items-center justify-center">
        <i class="fa-solid fa-utensils text-emerald-500 text-lg"></i>
      </div>
    </div>
    
    <!-- Detailed Breakdown -->
    <div class="text-[0.70rem] text-slate-600 space-y-1">
      <div class="flex justify-between">
        <span>FOH Manager:</span>
        <span id="kpi-foh-manager" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Server:</span>
        <span id="kpi-server" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Bartender:</span>
        <span id="kpi-bartender" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Host:</span>
        <span id="kpi-host" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Cashier:</span>
        <span id="kpi-cashier" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Busser:</span>
        <span id="kpi-busser" class="font-bold">0</span>
      </div>
    </div>
  </div>

  <!-- KPI: BOH (Back of House) -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          Back of House (BOH)
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-boh-total">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-amber-50 flex items-center justify-center">
        <i class="fa-solid fa-fire-burner text-amber-500 text-lg"></i>
      </div>
    </div>
    
    <!-- Detailed Breakdown -->
    <div class="text-[0.70rem] text-slate-600 space-y-1">
      <div class="flex justify-between">
        <span>Line Cook:</span>
        <span id="kpi-line-cook" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Wok Chef:</span>
        <span id="kpi-wok-chef" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Dumpling Maker:</span>
        <span id="kpi-dumpling-maker" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Prep Cook:</span>
        <span id="kpi-prep-cook" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Pastry Chef:</span>
        <span id="kpi-pastry-chef" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Dishwasher:</span>
        <span id="kpi-dishwasher" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Production Mgr:</span>
        <span id="kpi-production-manager" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span>Logistic Coord:</span>
        <span id="kpi-logistic-coordinator" class="font-bold">0</span>
      </div>
    </div>
  </div>

  <!-- üÜï NEW: FOH Disciplines -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          FOH Disciplines
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-foh-total-disciplines">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-emerald-50 flex items-center justify-center">
        <i class="fa-solid fa-gavel text-emerald-500 text-lg"></i>
      </div>
    </div>
    
    <!-- Discipline Breakdown -->
    <div class="text-[0.70rem] text-slate-600 space-y-1">
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-comments text-emerald-600 text-[0.65rem]"></i>
          <span>Verbal:</span>
        </span>
        <span id="kpi-foh-verbal" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-file-pen text-amber-600 text-[0.65rem]"></i>
          <span>Written:</span>
        </span>
        <span id="kpi-foh-written" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-triangle-exclamation text-orange-600 text-[0.65rem]"></i>
          <span>Final:</span>
        </span>
        <span id="kpi-foh-final" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-user-slash text-rose-600 text-[0.65rem]"></i>
          <span>Termination:</span>
        </span>
        <span id="kpi-foh-termination" class="font-bold">0</span>
      </div>
    </div>
  </div>

  <!-- üÜï NEW: BOH Disciplines -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          BOH Disciplines
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-boh-total-disciplines">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-amber-50 flex items-center justify-center">
        <i class="fa-solid fa-gavel text-amber-500 text-lg"></i>
      </div>
    </div>
    
    <!-- Discipline Breakdown -->
    <div class="text-[0.70rem] text-slate-600 space-y-1">
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-comments text-emerald-600 text-[0.65rem]"></i>
          <span>Verbal:</span>
        </span>
        <span id="kpi-boh-verbal" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-file-pen text-amber-600 text-[0.65rem]"></i>
          <span>Written:</span>
        </span>
        <span id="kpi-boh-written" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-triangle-exclamation text-orange-600 text-[0.65rem]"></i>
          <span>Final:</span>
        </span>
        <span id="kpi-boh-final" class="font-bold">0</span>
      </div>
      <div class="flex justify-between">
        <span class="flex items-center gap-1">
          <i class="fa-solid fa-user-slash text-rose-600 text-[0.65rem]"></i>
          <span>Termination:</span>
        </span>
        <span id="kpi-boh-termination" class="font-bold">0</span>
      </div>
    </div>
  </div>

  <!-- KPI: High-Risk Employees -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          High-Risk Employees
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-high-risk-employees">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-rose-50 flex items-center justify-center">
        <i class="fa-solid fa-fire-flame-curved text-rose-500 text-lg"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500 leading-relaxed">
      Employees with calculated risk level flagged as <span class="font-semibold text-rose-600">HIGH</span>.
    </p>
  </div>

  <!-- KPI: Terminated Employees -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col gap-3">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">
          Terminated Employees
        </p>
        <p class="mt-1 font-heading text-2xl text-slate-900" id="kpi-terminated-employees">
          --
        </p>
      </div>
      <div class="h-10 w-10 rounded-xl bg-slate-50 flex items-center justify-center">
        <i class="fa-solid fa-user-xmark text-slate-500 text-lg"></i>
      </div>
    </div>
    <p class="text-xs text-slate-500 leading-relaxed">
      Employees with employment status <span class="font-semibold text-slate-600">Terminated</span>.
    </p>
  </div>

</div>
<!-- End of KPI Grid -->
<!-- End of KPI Grid -->
  <!-- End of KPI Grid -->

  <!-- Trends and Compliance Snapshot -->
<div class="space-y-6">
  <!-- Top Row: Employees with Actions + Warnings by Dept -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- LEFT: Employees with Disciplinary Actions (2/3 width) -->
    <div class="lg:col-span-2 bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <h2 class="font-heading text-lg text-slate-900">
            All Disciplinary Actions
          </h2>
          <p class="text-xs text-slate-500 mt-1">
            Click any row to view full details
          </p>
        </div>
        <span class="inline-flex items-center gap-2 rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[0.65rem] text-slate-600">
          <i class="fa-solid fa-gavel text-[0.60rem]"></i>
          <span id="discipline-count-badge">--</span> total actions
        </span>
      </div>
      
      <!-- TABLE with individual warnings -->
      <div class="overflow-x-auto max-h-96">
        <table class="w-full text-xs">
          <thead class="sticky top-0 bg-white">
            <tr class="border-b border-slate-200">
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Date &amp; Time</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Employee</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Position</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Action Type</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Severity</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Issued By</th>
              <th class="px-3 py-2 text-left font-semibold text-slate-700">Department</th>
            </tr>
          </thead>
          <tbody id="dashboard-discipline-table-body" class="divide-y divide-slate-100">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- RIGHT: Warnings by Department (1/3 width - NARROWER) -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col">
      <div class="flex items-start justify-between mb-3 gap-4">
        <div>
          <h2 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
            <i class="fa-solid fa-building-columns text-slate-900 text-sm"></i>
            <span>Warnings by Dept</span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">
            Snapshot by area
          </p>
        </div>
      </div>
      <div class="overflow-x-auto flex-1">
        <table class="min-w-full text-xs border-separate border-spacing-y-1">
          <thead>
            <tr class="text-left text-[0.70rem] text-slate-900">
              <!-- Dept -->
              <th class="px-2 py-2 font-bold">
                <span class="inline-flex items-center gap-1">
                  <i class="fa-solid fa-building-user text-[0.70rem]"></i>
                  <span>Dept</span>
                </span>
              </th>

              <!-- V = Verbal -->
              <th class="px-2 py-2 font-bold text-center">
                <span class="inline-flex items-center justify-center gap-1">
                  <i class="fa-solid fa-comments text-[0.70rem]"></i>
                  <span>V</span>
                </span>
              </th>

              <!-- W = Written -->
              <th class="px-2 py-2 font-bold text-center">
                <span class="inline-flex items-center justify-center gap-1">
                  <i class="fa-solid fa-file-pen text-[0.70rem]"></i>
                  <span>W</span>
                </span>
              </th>

              <!-- F = Final -->
              <th class="px-2 py-2 font-bold text-center">
                <span class="inline-flex items-center justify-center gap-1">
                  <i class="fa-solid fa-triangle-exclamation text-[0.70rem]"></i>
                  <span>F</span>
                </span>
              </th>

              <!-- T = Termination -->
              <th class="px-2 py-2 font-bold text-center">
                <span class="inline-flex items-center justify-center gap-1">
                  <i class="fa-solid fa-user-slash text-[0.70rem]"></i>
                  <span>T</span>
                </span>
              </th>
            </tr>
          </thead>
          <tbody
            id="table-dashboard-warnings-by-dept"
            class="align-middle font-bold text-slate-900"
          >
            <!-- Data will be populated dynamically -->
          </tbody>
        </table>
      </div>
    </div>
  </div> <!-- ‚úÖ CLOSE THE GRID HERE -->

  <!-- Bottom Row: Chart (full width) -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 flex flex-col">
    <div class="flex items-center justify-between mb-3">
      <div>
        <h2 class="font-heading text-lg text-slate-900">
          <span id="chart-title-text">Disciplinary Actions Trend</span>
        </h2>
        <p class="text-xs text-slate-500 mt-1">
          Track discipline patterns over time across different timeframes
        </p>
      </div>
      <div class="flex items-center gap-2">
        <label for="chart-timeframe-selector" class="text-xs text-slate-500 font-medium">
          View:
        </label>
        <select 
          id="chart-timeframe-selector" 
          class="text-xs rounded-full border-slate-200 bg-white px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
        >
          <option value="monthly">Monthly (This Year)</option>
          <option value="yearly">Yearly (Last 5 Years)</option>
          <option value="weekly">Weekly (Last 12 Weeks)</option>
        </select>
      </div>
    </div>

    <!-- Chart Container -->
    <div style="width: 100%; overflow-x: auto; overflow-y: visible; margin-bottom: 20px;">
      <div style="position: relative; height: 500px; min-width: 1400px; width: 100%;">
        <canvas id="discipline-trend-chart"></canvas>
      </div>
    </div>

    <!-- Legend -->
    <div class="mt-4 flex flex-wrap items-center gap-3 text-[0.70rem] text-slate-500">
      <div class="flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
        Verbal Warnings
      </div>
      <div class="flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-amber-500"></span>
        Written Warnings
      </div>
      <div class="flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-orange-500"></span>
        Final Warnings
      </div>
      <div class="flex items-center gap-2">
        <span class="w-3 h-3 rounded-full bg-rose-500"></span>
        Terminations
      </div>
    </div>
  </div>
</div>

    
</section>

        <!-- Discipline Cases Tab -->
        <section id="tab-discipline" class="tab-panel hidden space-y-6">
          <!-- Discipline Intro + Status Banner -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Overview -->
            <div class="lg:col-span-2 bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
              <div class="flex items-start justify-between gap-3">
                <div>
                  <h2 class="font-heading text-xl text-slate-900">
                    Discipline Cases &amp; Corrective Actions
                  </h2>
                  <p class="mt-1 text-xs text-slate-500 leading-relaxed">
                    Use this workspace to issue <span class="font-medium">verbal, written, final warnings</span> and
                    <span class="font-medium">termination notices</span>. Actions taken here will update the source-of-truth
                    table <span class="font-semibold text-slate-800">employees2025</span>, recalculate risk scoring, and
                    support PDF documentation for signatures and record keeping aligned with TWC/DOL guidance.
                  </p>
                </div>
                <div class="flex flex-col items-end gap-2 text-[0.70rem]">
                  <span class="inline-flex items-center gap-2 rounded-full bg-brand-50 border border-brand-100 px-2 py-0.5 text-brand-700 font-medium">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                    Live Record Updates
                  </span>
                  <span id="discipline-selected-employee-chip" class="hidden inline-flex items-center gap-2 rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-slate-600">
                    <i class="fa-solid fa-id-badge text-[0.70rem]"></i>
                    <span id="discipline-selected-employee-name" class="font-medium"></span>
                  </span>
                </div>
              </div>
            </div>

            <!-- Status Banner -->
            <div class="lg:col-span-3 bg-slate-50 border border-dashed border-slate-300 rounded-2xl px-4 py-3 flex items-start gap-3">
              <div class="mt-0.5">
                <i class="fa-solid fa-circle-info text-brand-500"></i>
              </div>
              <div class="text-xs text-slate-600">
                <p class="font-medium text-slate-800">
                  Discipline Workflow Guidance
                </p>
                <p class="mt-1 leading-relaxed">
                  Before issuing any corrective action, confirm the employee's identity in
                  <span class="font-semibold text-slate-800">Employees 360</span>, validate the facts of the incident, and consult current
                  <span class="font-semibold text-slate-800">Jeng Chi Restaurant policies</span>.
                  All actions must be applied consistently, free from discrimination or retaliation, and aligned with applicable
                  <span class="font-semibold text-slate-800">TWC / DOL</span> standards.
                </p>
              </div>
            </div>
          </div>

          <!-- Discipline Layout: Employee Selector + Form + History -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 items-start">
            <!-- Left: Quick Employee Picker -->
            <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-4">
              <div class="flex items-center justify-between gap-2">
                <h3 class="font-heading text-base text-slate-900">
                  Quick Employee Selector
                </h3>
                <button
                  id="discipline-refresh-employees"
                  type="button"
                  class="inline-flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 px-2 py-1 text-[0.70rem] text-slate-600 hover:border-brand-200 hover:bg-brand-50 hover:text-brand-700 transition-colors"
                >
                  <i class="fa-solid fa-rotate-right text-[0.60rem]"></i>
                  <span>Refresh</span>
                </button>
              </div>
              <p class="text-xs text-slate-500">
                Search for an employee and click to load their profile into the discipline form. This ensures the action is tied to the
                correct <span class="font-semibold text-slate-700">employees2025</span> record.
              </p>

              <!-- Search with Autocomplete -->
              <div class="relative flex-1">
                <input
                  id="discipline-employee-search"
                  type="text"
                  placeholder="Search by name or Employee ID (type 3+ letters)"
                  class="w-full rounded-full border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                  autocomplete="off"
                />
                <!-- Autocomplete dropdown -->
                <div
                  id="discipline-search-dropdown"
                  class="hidden absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-xl shadow-lg max-h-64 overflow-y-auto"
                >
                  <!-- Suggestions will appear here -->
                </div>
              </div>

              <div id="discipline-employee-results" class="mt-3 max-h-64 overflow-y-auto space-y-2">
                <!-- Populated dynamically with small employee cards -->
              </div>
            </div>

            <!-- Middle: New Disciplinary Action Form -->
            <div class="xl:col-span-2 bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-4">
              <div class="flex items-center justify-between gap-2">
                <h3 class="font-heading text-base text-slate-900">
                  New Disciplinary Action
                </h3>
                <span class="inline-flex items-center gap-2 rounded-full bg-slate-50 border border-slate-200 px-3 py-1 text-[0.70rem] text-slate-600">
                  <i class="fa-solid fa-lock text-[0.60rem]"></i>
                  <span>Confidential HR Record</span>
                </span>
              </div>

              <form id="discipline-form" class="space-y-4">
                <!-- Hidden field for employee id -->
                <input type="hidden" id="discipline-employee-id" />

                <!-- Type + Date -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <div class="sm:col-span-2">
                    <label for="discipline-action-type" class="block text-xs font-heading text-slate-800 mb-1">
                      Type of Corrective Action <span class="text-rose-500">*</span>
                    </label>
                    <select
                      id="discipline-action-type"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                      required
                    >
                      <option value="">Select action type</option>
                      <option value="VERBAL_WARNING">Verbal Warning</option>
                      <option value="WRITTEN_WARNING">Written Warning</option>
                      <option value="FINAL_WARNING">Final Warning</option>
                      <option value="TERMINATION">Termination</option>
                    </select>
                  </div>
                  <div>
                    <label for="discipline-action-date" class="block text-xs font-heading text-slate-800 mb-1">
                      Action Date <span class="text-rose-500">*</span>
                    </label>
                    <input
                      type="date"
                      id="discipline-action-date"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                      required
                    />
                  </div>
                </div>


                <!-- NEW: Category Selection -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
  <div>
    <label for="discipline-main-category" class="block text-xs font-heading text-slate-800 mb-1">
      Main Category <span class="text-rose-500">*</span>
    </label>
    <select
      id="discipline-main-category"
      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
      required
    >
      <option value="">Select main category...</option>
      <option value="attendance">Attendance & Punctuality</option>
      <option value="performance">Performance Issues</option>
      <option value="conduct">Conduct & Behavior</option>
      <option value="policy">Policy Violations</option>
      <option value="safety">Safety & Health</option>
      <option value="customer">Customer Service</option>
      <option value="integrity">Integrity & Honesty</option>
    </select>
  </div>
  
  <div>
    <label for="discipline-sub-category" class="block text-xs font-heading text-slate-800 mb-1">
      Sub-Category / Specific Issue <span class="text-rose-500">*</span>
    </label>
    <select
      id="discipline-sub-category"
      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
      required
      disabled
    >
      <option value="">Select main category first...</option>
    </select>
  </div>
</div>

                <!-- Severity + Reference -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                  <div>
                    <label for="discipline-severity" class="block text-xs font-heading text-slate-800 mb-1">
                      Severity <span class="text-rose-500">*</span>
                    </label>
                    <select
                      id="discipline-severity"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                      required
                    >
                      <option value="">Select severity</option>
                      <option value="LOW">Low</option>
                      <option value="MEDIUM">Medium</option>
                      <option value="HIGH">High</option>
                    </select>
                  </div>
                  <div class="sm:col-span-2">
                    <label for="discipline-reference" class="block text-xs font-heading text-slate-800 mb-1">
                      Internal Reference / Incident ID
                    </label>
                    <input
                      type="text"
                      id="discipline-reference"
                      placeholder="Optional reference to incident report, video log, or complaint ticket"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                    />
                  </div>
                </div>

                <!-- Reason -->
                <div>
                  <label for="discipline-reason" class="block text-xs font-heading text-slate-800 mb-1">
                    Reason / Policy Violations <span class="text-rose-500">*</span>
                  </label>
                  <textarea
                    id="discipline-reason"
                    rows="4"
                    placeholder="Describe the incident, including dates, facts, witnesses, and specific Jeng Chi policy sections and TWC/DOL standards implicated."
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                    required
                  ></textarea>
                </div>

                <!-- Corrective Plan -->
                <div>
                  <label for="discipline-plan" class="block text-xs font-heading text-slate-800 mb-1">
                    Corrective Action Plan / Notes
                  </label>
                  <textarea
                    id="discipline-plan"
                    rows="4"
                    placeholder="Outline expectations, timelines, coaching, retraining, or final performance thresholds for the employee."
                    class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                  ></textarea>
                </div>

                <!-- Signatures -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                  <div>
                    <label for="discipline-manager-signature" class="block text-xs font-heading text-slate-800 mb-1">
                      Manager Typed Signature <span class="text-rose-500">*</span>
                    </label>
                    <input
                      type="text"
                      id="discipline-manager-signature"
                      placeholder="Manager full name"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                      required
                    />
                  </div>
                  <div>
                    <label for="discipline-hr-signature" class="block text-xs font-heading text-slate-800 mb-1">
                      HR Typed Signature
                    </label>
                    <input
                      type="text"
                      id="discipline-hr-signature"
                      placeholder="HR representative (optional)"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                    />
                  </div>
                  <div>
                    <label for="discipline-employee-signature" class="block text-xs font-heading text-slate-800 mb-1">
                      Employee Typed Signature
                    </label>
                    <input
                      type="text"
                      id="discipline-employee-signature"
                      placeholder="Employee full name (if signing)"
                      class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
                    />
                  </div>
                </div>

                <!-- Acknowledgment -->
                <div class="flex flex-col sm:flex-row sm:items-center gap-2 text-xs">
                  <label class="inline-flex items-start gap-2 cursor-pointer">
                    <input
                      type="checkbox"
                      id="discipline-employee-declined"
                      class="mt-0.5 rounded border-slate-300 text-brand-600 focus:ring-brand-500"
                    />
                    <span class="text-slate-600">
                      Employee declined to sign. Action is acknowledged only, and a signed copy will be provided per JCR policy.
                    </span>
                  </label>
                </div>

                <!-- Actions -->
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                  <div class="flex items-center gap-2 text-[0.70rem] text-slate-500">
                    <i class="fa-solid fa-scale-balanced text-brand-500"></i>
                    <span>
                      By submitting, you confirm this action is consistent, non-retaliatory, and based solely on documented facts.
                    </span>
                  </div>
                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      id="discipline-form-reset"
                      class="inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-2 text-xs font-medium text-slate-600 hover:bg-slate-50"
                    >
                      <i class="fa-solid fa-eraser text-[0.70rem]"></i>
                      <span>Reset Form</span>
                    </button>
                   <button
  type="submit"
  id="discipline-form-submit"
  class="inline-flex items-center gap-2 rounded-full bg-brand-500 px-4 py-2 text-xs font-bold text-black shadow-sm hover:bg-brand-600 disabled:opacity-60 disabled:cursor-not-allowed"
>
  <!-- Spinner while saving -->
  <span id="discipline-form-submit-spinner" class="hidden">
    <i class="fa-solid fa-spinner fa-spin text-[0.80rem]"></i>
  </span>

  <!-- Default state: Save icon + text -->
  <span id="discipline-form-submit-text" class="flex items-center gap-2">
    <i class="fa-solid fa-floppy-disk text-[0.90rem] text-black"></i>
    <span>Record Action &amp; Generate PDF</span>
  </span>
</button>
                  </div>
                </div>

                <!-- Inline form status -->
                <div id="discipline-form-status" class="hidden rounded-xl border px-3 py-2 text-[0.70rem] mt-2">
                  <!-- Populated dynamically -->
                </div>
              </form>
            </div>
          </div>

          <!-- Discipline History & Audit Trail -->
          <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 items-start">
            <!-- History Timeline -->
            <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 relative">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="font-heading text-base text-slate-900">
                    Disciplinary History Timeline
                  </h3>
                  <p class="mt-1 text-xs text-slate-500">
                    Chronological view of all corrective actions applied to the selected employee.
                  </p>
                </div>
                <span class="inline-flex items-center gap-2 rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-[0.65rem] text-slate-600">
                  <i class="fa-solid fa-timeline text-[0.60rem]"></i>
                  <span>Most Recent First</span>
                </span>
              </div>

              <div class="mt-4 relative">
                <div class="timeline-line"></div>
                <div id="discipline-history-timeline" class="space-y-4 pl-8">
                  <!-- Timeline entries will be rendered here -->
                  <p class="text-xs text-slate-400">
                    Select an employee in <span class="font-medium text-slate-700">Employees 360</span> or in the
                    <span class="font-medium text-slate-700">Quick Employee Selector</span> to view their discipline history.
                  </p>
                </div>
              </div>
            </div>

            <!-- Audit Trail (Tabular) -->
            <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="font-heading text-base text-slate-900">
                    Discipline Audit Trail
                  </h3>
                  <p class="mt-1 text-xs text-slate-500">
                    Evidence-ready list of actions, suitable for TWC hearings, DOL audits, or internal investigations.
                  </p>
                </div>
                <button
                  type="button"
                  id="discipline-audit-export"
                  class="inline-flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 px-3 py-1.5 text-[0.70rem] text-slate-600 hover:bg-brand-50 hover:border-brand-200 hover:text-brand-700"
                >
                  <i class="fa-solid fa-file-pdf text-[0.70rem]"></i>
                  <span>Export Timeline PDF</span>
                </button>
              </div>

              <div class="mt-3 overflow-x-auto">
                <table class="min-w-full text-xs border-separate border-spacing-y-1">
                  <thead>
                    <tr class="text-[0.70rem] text-slate-500 text-left">
                      <th class="px-3 py-2 font-semibold">Timestamp</th>
                      <th class="px-3 py-2 font-semibold">Action</th>
                      <th class="px-3 py-2 font-semibold">Severity</th>
                      <th class="px-3 py-2 font-semibold">User</th>
                      <th class="px-3 py-2 font-semibold">Reference</th>
                    </tr>
                  </thead>
                  <tbody id="discipline-audit-table-body">
                    <!-- Populated with discipline_history entries -->
                    <tr class="bg-slate-50/60">
                      <td class="px-3 py-2 text-slate-400" colspan="5">
                        Audit entries will appear here when an employee with history is selected.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <p class="mt-4 text-[0.70rem] text-slate-500 leading-relaxed">
                For each corrective action, this table references data persisted in
                <span class="font-semibold text-slate-800">employees2025.discipline_history</span>,
                combined with front-end context such as the acting user (e.g., "HR Admin" or "Manager").
                Together with PostgreSQL triggers
                <span class="font-semibold text-slate-800">set_employees_last_modified</span> and
                <span class="font-semibold text-slate-800">trg_log_employee_changes</span>,
                this creates a layered, defensible audit model.
              </p>
            </div>
          </div>
        </section>

        <!-- FIXED FILE ‚Äì PART 3/5: EMPLOYEES 360 TAB + POLICY LIBRARY TAB -->

        <!-- Employees 360 Tab -->
        <!-- ============================================================================ -->
<!-- EMPLOYEES 360 TAB - ENTERPRISE EXECUTIVE LAYOUT -->
<!-- ============================================================================ -->
<section id="tab-employees" class="tab-panel hidden space-y-6">
  
  <!-- Hidden field to store current employee ID -->
  <input type="hidden" id="current-employee-360-id" value="" />

  <!-- üéØ TOP ROW: Search Panel + Selected Employee Header with KPI Dashboard -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <!-- LEFT: Search & Filter Panel (1/3 width) -->
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <div class="bg-white rounded-xl shadow-lg border-2 border-slate-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-heading text-base font-black text-slate-900 flex items-center gap-2">
          <i class="fa-solid fa-magnifying-glass text-brand-600"></i>
          Search Employees
        </h3>
        <button
          id="employees-refresh-button"
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border-2 border-slate-300 bg-white px-3 py-2 text-xs font-bold text-slate-700 hover:bg-slate-50 transition-all"
        >
          <i class="fa-solid fa-arrows-rotate"></i>
          Refresh
        </button>
      </div>
      
      <p class="text-xs text-slate-500 mb-4 leading-relaxed font-semibold">
        Search by name, employee ID, or department to view complete employee profile and discipline history.
      </p>

      <!-- Search Input -->
      <div class="relative mb-4">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <i class="fa-solid fa-search text-slate-400"></i>
        </div>
        <input
          id="employees-search-input"
          type="text"
          placeholder="Type 3+ letters to search..."
          class="w-full pl-10 pr-3 py-3 rounded-xl border-2 border-slate-300 bg-slate-50 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-all"
          autocomplete="off"
        />
        <div
          id="employees-search-dropdown"
          class="hidden absolute z-50 w-full mt-2 bg-white border-2 border-slate-200 rounded-xl shadow-xl max-h-64 overflow-y-auto"
        ></div>
      </div>

      <!-- Filter Chips -->
      <div class="flex flex-wrap gap-2 mb-4">
        <button
          type="button"
          data-employee-filter="all"
          class="employee-filter-chip inline-flex items-center gap-2 rounded-full border-2 border-brand-500 bg-brand-50 px-4 py-2 text-xs font-black text-brand-700 transition-all hover:bg-brand-100"
        >
          <i class="fa-solid fa-users"></i>
          All
        </button>
        <button
          type="button"
          data-employee-filter="Active"
          class="employee-filter-chip inline-flex items-center gap-2 rounded-full border-2 border-slate-300 bg-white px-4 py-2 text-xs font-black text-slate-600 transition-all hover:bg-slate-50"
        >
          <i class="fa-solid fa-circle-check"></i>
          Active
        </button>
        <button
          type="button"
          data-employee-filter="Terminated"
          class="employee-filter-chip inline-flex items-center gap-2 rounded-full border-2 border-slate-300 bg-white px-4 py-2 text-xs font-black text-slate-600 transition-all hover:bg-slate-50"
        >
          <i class="fa-solid fa-user-xmark"></i>
          Terminated
        </button>
        <button
          type="button"
          data-employee-filter="HighRisk"
          class="employee-filter-chip inline-flex items-center gap-2 rounded-full border-2 border-rose-300 bg-rose-50 px-4 py-2 text-xs font-black text-rose-600 transition-all hover:bg-rose-100"
        >
          <i class="fa-solid fa-fire"></i>
          High Risk
        </button>
      </div>

      <!-- Employee List -->
      <div id="employee-list" class="space-y-2 max-h-[500px] overflow-y-auto">
        <div class="rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 px-4 py-8 text-center">
          <i class="fa-solid fa-user-group text-4xl text-slate-300 mb-3"></i>
          <p class="text-sm text-slate-400 font-semibold">Search or refresh to load employees</p>
        </div>
      </div>
    </div>

    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <!-- RIGHT: Selected Employee Header + KPI Dashboard (2/3 width) -->
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <div class="lg:col-span-2 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl shadow-lg border-2 border-slate-200 p-6">
      
      <!-- Save Button - Top Right -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div id="save-status-indicator" class="w-3 h-3 rounded-full bg-emerald-500 animate-pulse"></div>
          <span id="save-status-text" class="text-sm font-bold text-slate-700">Ready to edit</span>
        </div>
        <button
          type="button"
          id="btn-save-employee-360"
          class="inline-flex items-center gap-3 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-600 px-6 py-3 text-sm font-black text-white shadow-lg hover:from-emerald-600 hover:to-emerald-700 disabled:opacity-60 disabled:cursor-not-allowed transition-all transform hover:scale-105"
        >
          <i class="fa-solid fa-floppy-disk text-lg"></i>
          üíæ SAVE ALL CHANGES
        </button>
      </div>

      <!-- Employee Header Card -->
      <div class="bg-white rounded-xl border-2 border-slate-200 p-6 mb-6 shadow-sm">
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <h2 id="employee-profile-name" class="font-heading text-2xl font-black text-slate-900 mb-2">
              Select an employee
            </h2>
            <p id="employee-profile-title" class="text-sm text-slate-600 font-semibold mb-1">
              Job title ‚Ä¢ Department
            </p>
            <p id="employee-profile-status" class="text-xs text-slate-500 font-semibold">
              Employment status, hire dates, and reporting structure will appear here.
            </p>
          </div>
          <div class="flex flex-col items-end gap-2">
            <div id="employee-profile-risk-badge" class="inline-flex items-center gap-2 rounded-full bg-slate-100 border-2 border-slate-300 px-4 py-2 text-xs font-black text-slate-600">
              <span class="w-2 h-2 rounded-full bg-slate-400"></span>
              Risk Score: ‚Äî
            </div>
            <div class="flex gap-2">
              <span id="employee-profile-employee-id" class="inline-flex items-center gap-1 rounded-lg bg-slate-100 border border-slate-300 px-3 py-1 text-xs font-bold text-slate-700">
                <i class="fa-solid fa-hashtag"></i>
                ID: --
              </span>
              <span id="employee-profile-username" class="inline-flex items-center gap-1 rounded-lg bg-slate-100 border border-slate-300 px-3 py-1 text-xs font-bold text-slate-700">
                <i class="fa-solid fa-user"></i>
                --
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- KPI Dashboard Grid -->
      <div class="grid grid-cols-4 gap-4">
        <!-- Verbal Warnings -->
        <div class="bg-white rounded-xl border-2 border-emerald-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
          <i class="fa-solid fa-comments text-2xl text-emerald-600 mb-2"></i>
          <p class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-1">Verbal</p>
          <p id="employee-kpi-verbal" class="font-heading text-3xl font-black text-emerald-700">--</p>
        </div>

        <!-- Written Warnings -->
        <div class="bg-white rounded-xl border-2 border-amber-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
          <i class="fa-solid fa-file-pen text-2xl text-amber-600 mb-2"></i>
          <p class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-1">Written</p>
          <p id="employee-kpi-written" class="font-heading text-3xl font-black text-amber-700">--</p>
        </div>

        <!-- Final Warnings -->
        <div class="bg-white rounded-xl border-2 border-orange-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
          <i class="fa-solid fa-triangle-exclamation text-2xl text-orange-600 mb-2"></i>
          <p class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-1">Final</p>
          <p id="employee-kpi-final" class="font-heading text-3xl font-black text-orange-700">--</p>
        </div>

        <!-- Termination Letters -->
        <div class="bg-white rounded-xl border-2 border-rose-200 p-4 text-center shadow-sm hover:shadow-md transition-shadow">
          <i class="fa-solid fa-user-slash text-2xl text-rose-600 mb-2"></i>
          <p class="text-xs font-bold text-slate-600 uppercase tracking-wide mb-1">Termination</p>
          <p id="employee-kpi-termination" class="font-heading text-3xl font-black text-rose-700">--</p>
        </div>
      </div>

    </div>
  </div>

  <!-- ============================================================================ -->
  <!-- BOTTOM SECTION: Employee Details in Professional 3-Column Layout -->
  <!-- ============================================================================ -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <!-- COLUMN 1: Employment & Contact Information -->
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <div class="bg-white rounded-xl shadow-lg border-2 border-slate-200 p-6">
      <h3 class="font-heading text-lg font-black text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-slate-200 pb-3">
        <i class="fa-solid fa-id-card text-brand-600"></i>
        Employment & Contact
      </h3>

      <div class="space-y-4">
        <!-- Employment Status -->
        <div>
          <label for="edit-employment-status" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-user-check text-brand-600"></i>
            Employment Status
          </label>
          <select
            id="edit-employment-status"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
          >
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
            <option value="Terminated">Terminated</option>
            <option value="On Leave">On Leave</option>
            <option value="Suspended">Suspended</option>
          </select>
        </div>

        <!-- First Name -->
        <div>
          <label for="edit-first-name" class="block text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            First Name
          </label>
          <input
            type="text"
            id="edit-first-name"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="First name"
          />
        </div>

        <!-- Last Name -->
        <div>
          <label for="edit-last-name" class="block text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            Last Name
          </label>
          <input
            type="text"
            id="edit-last-name"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="Last name"
          />
        </div>

        <!-- Department -->
        <div>
          <label for="edit-department" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-building-user text-brand-600"></i>
            Department
          </label>
          <select
            id="edit-department"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
          >
            <option value="">Select department</option>
            <option value="BOH">BOH (Back of House)</option>
            <option value="FOH">FOH (Front of House)</option>
          </select>
        </div>

        <!-- Job Title -->
        <div>
          <label for="edit-job-title" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-id-badge text-brand-600"></i>
            Job Title
          </label>
          <select
            id="edit-job-title"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            disabled
          >
            <option value="">Select department first...</option>
          </select>
        </div>

        <!-- Manager -->
        <div>
          <label for="edit-report-to" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-user-tie text-brand-600"></i>
            Manager / Reports To
          </label>
          <select
            id="edit-report-to"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
          >
            <option value="">Select manager</option>
            <option value="Shoko Teng">Shoko Teng</option>
            <option value="Pablo Gonzalez">Pablo Gonzalez</option>
            <option value="Janelle Teng">Janelle Teng</option>
            <option value="Craig Reeves">Craig Reeves</option>
            <option value="Ahn Mai Vu">Ahn Mai Vu</option>
          </select>
        </div>

        <!-- Email -->
        <div>
          <label for="edit-email" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-envelope text-brand-600"></i>
            Email
          </label>
          <input
            type="email"
            id="edit-email"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="email@example.com"
          />
        </div>

        <!-- Phone -->
        <div>
          <label for="edit-phone" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-phone text-brand-600"></i>
            Phone
          </label>
          <input
            type="tel"
            id="edit-phone"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="(555) 123-4567"
          />
        </div>
      </div>
    </div>

    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <!-- COLUMN 2: Address & Compensation -->
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <div class="bg-white rounded-xl shadow-lg border-2 border-slate-200 p-6">
      <h3 class="font-heading text-lg font-black text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-slate-200 pb-3">
        <i class="fa-solid fa-location-dot text-brand-600"></i>
        Address & Compensation
      </h3>

      <div class="space-y-4">
        <!-- Address Line 1 -->
        <div>
          <label for="edit-address-line-1" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-map-marker-alt text-brand-600"></i>
            Address Line 1
          </label>
          <input
            type="text"
            id="edit-address-line-1"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="Street address"
          />
        </div>

        <!-- Address Line 2 -->
        <div>
          <label for="edit-address-line-2" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-building text-brand-600"></i>
            Address Line 2
          </label>
          <input
            type="text"
            id="edit-address-line-2"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="Apt, suite (optional)"
          />
        </div>

        <!-- City -->
        <div>
          <label for="edit-city" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-city text-brand-600"></i>
            City
          </label>
          <input
            type="text"
            id="edit-city"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            placeholder="City"
          />
        </div>

        <!-- State + Zip (side by side) -->
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label for="edit-state" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-map text-brand-600"></i>
              State
            </label>
            <input
              type="text"
              id="edit-state"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="TX"
              maxlength="2"
            />
          </div>

          <div>
            <label for="edit-zip-code" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-mailbox text-brand-600"></i>
              Zip Code
            </label>
            <input
              type="text"
              id="edit-zip-code"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="12345"
            />
          </div>
        </div>

        <!-- COMPENSATION SECTION -->
        <div class="pt-4 border-t-2 border-slate-200">
          <h4 class="text-sm font-black text-slate-700 uppercase tracking-wide mb-3 flex items-center gap-2">
            <i class="fa-solid fa-dollar-sign text-emerald-600"></i>
            Compensation
          </h4>

          <!-- Original Hire Date -->
          <div class="mb-4">
            <label for="edit-original-hire-date" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-calendar-check text-brand-600"></i>
              Original Hire Date
            </label>
            <input
              type="date"
              id="edit-original-hire-date"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            />
          </div>

          <!-- Compensation Type -->
          <div class="mb-4">
            <label for="edit-compensation-type" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-money-bill-wave text-emerald-600"></i>
              Compensation Type
            </label>
            <select
              id="edit-compensation-type"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
            >
              <option value="hourly">Hourly</option>
              <option value="salary">Salary</option>
            </select>
          </div>

          <!-- Hourly Rate -->
          <div id="hourly-rate-container" class="mb-4">
            <label for="edit-hourly-rate" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-clock text-emerald-600"></i>
              Hourly Rate
            </label>
            <input
              type="number"
              id="edit-hourly-rate"
              step="0.01"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="0.00"
            />
          </div>

          <!-- Annual Salary -->
          <div id="annual-salary-container" class="mb-4">
            <label for="edit-annual-salary" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-hand-holding-dollar text-emerald-600"></i>
              Annual Salary
            </label>
            <input
              type="number"
              id="edit-annual-salary"
              step="0.01"
              class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="0.00"
            />
          </div>

          <!-- Calculated Hourly (Display Only) -->
          <div>
            <label class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
              <i class="fa-solid fa-calculator text-slate-600"></i>
              Calculated Hourly Rate
            </label>
            <div id="display-calculated-hourly" class="w-full rounded-lg border-2 border-slate-200 bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600">
              --
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <!-- COLUMN 3: Risk, Tenure & Discipline Summary -->
    <!-- ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ -->
    <div class="bg-white rounded-xl shadow-lg border-2 border-slate-200 p-6">
      <h3 class="font-heading text-lg font-black text-slate-900 mb-4 flex items-center gap-2 border-b-2 border-slate-200 pb-3">
        <i class="fa-solid fa-chart-line text-brand-600"></i>
        Risk & Compliance
      </h3>

      <div class="space-y-4">
        <!-- Tenure (Calculated) -->
        <div>
          <label class="block text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            Tenure (Calculated)
          </label>
          <div id="display-tenure" class="w-full rounded-lg border-2 border-slate-200 bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600">
            --
          </div>
        </div>

        <!-- Risk Score (Calculated) -->
        <div>
          <label class="block text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            Risk Score (Calculated)
          </label>
          <div id="display-risk-score" class="w-full rounded-lg border-2 border-slate-200 bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600">
            --
          </div>
        </div>

        <!-- Risk Level -->
        <div>
          <label for="edit-risk-level" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-triangle-exclamation text-rose-600"></i>
            Risk Level
          </label>
          <select
            id="edit-risk-level"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
          >
            <option value="LOW">LOW</option>
            <option value="MEDIUM">MEDIUM</option>
            <option value="HIGH">HIGH</option>
          </select>
        </div>

        <!-- HR Witness -->
        <div>
          <label for="edit-hr-witness" class="flex items-center gap-2 text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            <i class="fa-solid fa-user-shield text-brand-600"></i>
            HR Witness
          </label>
          <select
            id="edit-hr-witness"
            class="w-full rounded-lg border-2 border-slate-300 bg-slate-50 px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500"
          >
            <option value="">Select HR witness</option>
            <option value="Shoko Teng">Shoko Teng</option>
            <option value="Pablo Gonzalez">Pablo Gonzalez</option>
            <option value="Janelle Teng">Janelle Teng</option>
            <option value="Craig Reeves">Craig Reeves</option>
            <option value="Ahn Mai Vu">Ahn Mai Vu</option>
          </select>
        </div>

        <!-- Last Disciplinary Action (Read-only) -->
        <div>
          <label class="block text-xs font-black text-slate-700 uppercase tracking-wide mb-2">
            Last Disciplinary Action
          </label>
          <div id="display-last-action" class="w-full rounded-lg border-2 border-slate-200 bg-slate-100 px-3 py-2 text-sm font-bold text-slate-600">
            --
          </div>
        </div>

        <!-- Discipline Summary Card -->
        <div class="pt-4 border-t-2 border-slate-200">
          <h4 class="text-sm font-black text-slate-700 uppercase tracking-wide mb-3 flex items-center gap-2">
            <i class="fa-solid fa-gavel text-rose-600"></i>
            Discipline Summary
          </h4>

          <div id="employee-summary-history" class="text-xs text-slate-600 leading-relaxed">
            <p>Once an employee is selected, a concise narrative summary of their discipline history and risk posture will be generated here.</p>
          </div>

          <!-- Download PDF Button -->
          <button
            type="button"
            id="employee-summary-pdf"
            class="mt-4 w-full inline-flex items-center justify-center gap-2 rounded-lg border-2 border-brand-300 bg-brand-50 px-4 py-3 text-sm font-black text-brand-700 hover:bg-brand-100 transition-all"
          >
            <i class="fa-solid fa-file-pdf text-lg"></i>
            Download 360 PDF
          </button>
        </div>

        <!-- Risk Scoring Info -->
        <div class="rounded-lg bg-slate-50 border-2 border-slate-200 p-3">
          <p class="text-xs text-slate-600 leading-relaxed font-semibold">
            <i class="fa-solid fa-info-circle text-brand-600 mr-1"></i>
            Risk scoring: 1pt per verbal, 2pts per written, 3pts per final, 4pts per termination letter.
          </p>
        </div>
      </div>
    </div>

  </div>
  <!-- End of 3-column grid -->

</section>
<!-- ============================================================================ -->
<!-- END OF EMPLOYEES 360 TAB -->
<!-- ============================================================================ -->
















        <!-- Policy Library Tab -->
        <section id="tab-policy" class="tab-panel hidden space-y-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h2 class="font-heading text-xl text-slate-900">
                Policy Library &amp; Reference
              </h2>
              <p class="text-xs text-slate-500 mt-1">
                Centralized view of external guidance and internal Jeng Chi Restaurant discipline policies used to inform corrective actions.
              </p>
            </div>
          </div>

          <!-- Filter Pills -->
          <div class="flex flex-wrap gap-2 text-[0.70rem]">
            <button
              type="button"
              data-policy-category="twc-dol"
              class="policy-filter-chip inline-flex items-center gap-1 rounded-full bg-brand-50 border border-brand-100 px-3 py-1 text-brand-700 font-medium"
            >
              <i class="fa-solid fa-scale-balanced text-[0.70rem]"></i>
              <span>TWC / DOL Guidance</span>
            </button>
            <button
              type="button"
              data-policy-category="internal"
              class="policy-filter-chip inline-flex items-center gap-1 rounded-full bg-slate-50 border border-slate-200 px-3 py-1 text-slate-600"
            >
              <i class="fa-solid fa-building text-[0.70rem]"></i>
              <span>Internal JCR Policies</span>
            </button>
            <button
              type="button"
              data-policy-category="discipline"
              class="policy-filter-chip inline-flex items-center gap-1 rounded-full bg-slate-50 border border-slate-200 px-3 py-1 text-slate-600"
            >
              <i class="fa-solid fa-gavel text-[0.70rem]"></i>
              <span>Discipline &amp; Corrective Action</span>
            </button>
            <button
              type="button"
              data-policy-category="complaint"
              class="policy-filter-chip inline-flex items-center gap-1 rounded-full bg-slate-50 border border-slate-200 px-3 py-1 text-slate-600"
            >
              <i class="fa-solid fa-comments text-[0.70rem]"></i>
              <span>Complaint &amp; Investigation Procedures</span>
            </button>
          </div>

          <!-- Policies Accordion -->
          <div id="policy-accordion" class="space-y-4 text-xs">
            <!-- TWC / DOL Guidance -->
            <article
              data-policy-category-panel="twc-dol"
              class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-3"
            >
              <header class="flex items-start justify-between gap-3 cursor-pointer policy-accordion-header">
    <div>
      <h3 class="font-heading text-sm text-slate-900 font-bold flex items-center gap-2">
        <i class="fa-solid fa-scale-balanced text-brand-600 text-sm"></i>
        <span>TWC / DOL Consistent Documentation Practices</span>
      </h3>
      <p class="text-[0.70rem] text-slate-500 mt-1 flex items-center gap-2">
        <i class="fa-solid fa-file-shield text-slate-400 text-[0.70rem]"></i>
        <span>
          Align disciplinary documentation with requirements commonly reviewed in Texas Workforce Commission and U.S. Department of Labor proceedings.
        </span>
      </p>
    </div>
    <div class="flex flex-col items-end gap-1 text-[0.65rem]">
      <span class="inline-flex items-center rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-slate-600">
        <i class="fa-regular fa-clock text-[0.60rem] mr-1"></i>
        <span>Last updated: 2025-06-01</span>
      </span>
      <button
        type="button"
        class="policy-accordion-toggle inline-flex items-center justify-center w-6 h-6 rounded-full bg-slate-50 border border-slate-200 text-slate-500"
      >
        <i class="fa-solid fa-chevron-down text-[0.60rem]"></i>
      </button>
    </div>
  </header>



              <div class="policy-accordion-body space-y-2 text-slate-600">
                <ul class="list-disc list-inside space-y-1">
                  <li>
                    Maintain <span class="font-medium">fact-based, contemporaneous documentation</span> for each incident, including dates, times, witnesses, and specific behaviors observed.
                  </li>
                  <li>
                    Ensure that <span class="font-medium">policies are communicated</span> to all employees, with signed acknowledgments held in personnel files or the digital portal.
                  </li>
                  <li>
                    Apply discipline <span class="font-medium">consistently across similarly situated employees</span> to mitigate allegations of disparate treatment or retaliation.
                  </li>
                  <li>
                    Use a <span class="font-medium">progressive discipline model</span> where appropriate (verbal, written, final, termination), while preserving the employer's right to accelerate steps when warranted.
                  </li>
                  <li>
                    Retain records for a reasonable period consistent with <span class="font-medium">TWC, DOL, and internal retention schedules</span>.
                  </li>
                </ul>
                <p class="mt-2 text-[0.70rem] text-slate-500">
                  This summary is provided for HR guidance and does not replace consultation with qualified legal counsel.
                </p>
              </div>
            </article>

            <!-- Internal JCR Policies -->
            <article
              data-policy-category-panel="internal"
              class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-3 hidden"
            >
              <header class="flex items-start justify-between gap-3 cursor-pointer policy-accordion-header">
                <div>
                  <h3 class="font-heading text-sm text-slate-900">
                    JCR Standard of Conduct &amp; Zero-Tolerance Areas
                  </h3>
                  <p class="text-[0.70rem] text-slate-500 mt-1">
                    Internal expectations for professional conduct, customer care, safety, and respect in the workplace.
                  </p>
                </div>
                <div class="flex flex-col items-end gap-1 text-[0.65rem]">
                  <span class="inline-flex items-center rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-slate-600">
                    Last updated: 2025-04-15
                  </span>
                  <button
                    type="button"
                    class="policy-accordion-toggle inline-flex items-center justify-center w-6 h-6 rounded-full bg-slate-50 border border-slate-200 text-slate-500"
                  >
                    <i class="fa-solid fa-chevron-down text-[0.60rem]"></i>
                  </button>
                </div>
              </header>
              <div class="policy-accordion-body space-y-2 text-slate-600 hidden">
                <ul class="list-disc list-inside space-y-1">
                  <li>
                    JCR maintains a <span class="font-medium">zero-tolerance policy</span> for violence, harassment, discrimination, and retaliation.
                  </li>
                  <li>
                    Employees must follow all <span class="font-medium">food safety, health, and cleanliness standards</span> applicable to restaurant operations.
                  </li>
                  <li>
                    Timekeeping, tip reporting, and wage-and-hour rules must be followed accurately and honestly.
                  </li>
                  <li>
                    All discipline should be documented in this portal to provide an <span class="font-medium">accurate 360¬∞ record</span>.
                  </li>
                  <li>
                    Any deviation from progressive discipline must be <span class="font-medium">approved by HR</span> and documented with rationale.
                  </li>
                </ul>
              </div>
            </article>

            <!-- Discipline & Corrective Action -->
            <article
              data-policy-category-panel="discipline"
              class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-3 hidden"
            >
              <header class="flex items-start justify-between gap-3 cursor-pointer policy-accordion-header">
                <div>
                  <h3 class="font-heading text-sm text-slate-900">
                    Progressive Discipline Framework
                  </h3>
                  <p class="text-[0.70rem] text-slate-500 mt-1">
                    Structured approach guiding verbal, written, final, and termination decisions at Jeng Chi Restaurant.
                  </p>
                </div>
                <div class="flex flex-col items-end gap-1 text-[0.65rem]">
                  <span class="inline-flex items-center rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-slate-600">
                    Last updated: 2025-05-10
                  </span>
                  <button
                    type="button"
                    class="policy-accordion-toggle inline-flex items-center justify-center w-6 h-6 rounded-full bg-slate-50 border border-slate-200 text-slate-500"
                  >
                    <i class="fa-solid fa-chevron-down text-[0.60rem]"></i>
                  </button>
                </div>
              </header>
              <div class="policy-accordion-body space-y-2 text-slate-600 hidden">
                <ol class="list-decimal list-inside space-y-1">
                  <li>
                    <span class="font-medium">Coaching &amp; Verbal Feedback</span> &mdash; early-stage, non-punitive coaching that may be documented as a verbal warning when patterns emerge.
                  </li>
                  <li>
                    <span class="font-medium">Written Warning</span> &mdash; formal documentation of the issue, expectations, and timeline for improvement.
                  </li>
                  <li>
                    <span class="font-medium">Final Warning</span> &mdash; last opportunity to correct behavior, document clear consequences for non-compliance.
                  </li>
                  <li>
                    <span class="font-medium">Termination</span> &mdash; when the relationship must end, with a focus on professionalism, documentation, and consistent policy application.
                  </li>
                </ol>
                <p class="mt-2 text-[0.70rem] text-slate-500">
                  Leadership should consult HR before issuing final warnings or terminations, especially where protected activity or past complaints may be relevant.
                </p>
              </div>
            </article>

            <!-- Complaint & Investigation -->
            <article
              data-policy-category-panel="complaint"
              class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4 space-y-3 hidden"
            >
              <header class="flex items-start justify-between gap-3 cursor-pointer policy-accordion-header">
                <div>
                  <h3 class="font-heading text-sm text-slate-900">
                    Complaint Intake &amp; Investigation Procedures
                  </h3>
                  <p class="text-[0.70rem] text-slate-500 mt-1">
                    Processes for receiving, documenting, and investigating concerns raised by employees, guests, or vendors.
                  </p>
                </div>
                <div class="flex flex-col items-end gap-1 text-[0.65rem]">
                  <span class="inline-flex items-center rounded-full bg-slate-50 border border-slate-200 px-2 py-0.5 text-slate-600">
                    Last updated: 2025-03-20
                  </span>
                  <button
                    type="button"
                    class="policy-accordion-toggle inline-flex items-center justify-center w-6 h-6 rounded-full bg-slate-50 border border-slate-200 text-slate-500"
                  >
                    <i class="fa-solid fa-chevron-down text-[0.60rem]"></i>
                  </button>
                </div>
              </header>
              <div class="policy-accordion-body space-y-2 text-slate-600 hidden">
                <ul class="list-disc list-inside space-y-1">
                  <li>
                    Complaints may be raised <span class="font-medium">verbally or in writing</span> to any manager or HR.
                  </li>
                  <li>
                    All complaints must be documented in a <span class="font-medium">central log</span>, with dates, participants, and next steps.
                  </li>
                  <li>
                    Investigations should be <span class="font-medium">prompt, impartial, and confidential</span> to the extent possible.
                  </li>
                  <li>
                    Retaliation against individuals who raise concerns or participate in investigations is strictly prohibited.
                  </li>
                  <li>
                    Outcomes of investigations should be documented and communicated appropriately, with discipline applied as needed.
                  </li>
                </ul>
              </div>
            </article>
          </div>

          <!-- AI Disclaimer -->
          <div class="rounded-2xl border border-dashed border-amber-200 bg-amber-50/50 px-4 py-3 text-[0.70rem] text-amber-800">
            <p class="font-semibold">
              AI-Assisted Content &amp; Legal Review
            </p>
            <p class="mt-1">
              Some explanatory language in this Policy Library has been drafted or structured using AI-assisted tools for clarity and
              consistency. These materials are provided for <span class="font-semibold">HR reference only</span> and do not constitute legal advice.
              Jeng Chi Restaurant leadership and HR must review, adapt, and approve all policy content, and should consult qualified labor
              and employment counsel to confirm alignment with current TWC, DOL, and applicable law.
            </p>
          </div>
        </section>
        <!-- FIXED FILE ‚Äì PART 4/5: REPORTS TAB + ADMIN TAB + PERMISSIONS TAB + CLOSING TAGS -->

        <!-- Reports & Analytics Tab -->
<section id="tab-reports" class="tab-panel hidden space-y-6">
  <!-- Header with Global Filter -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
      <div>
        <h2 class="font-heading text-xl text-slate-900 font-bold">
          Reports &amp; Analytics Dashboard
        </h2>
        <p class="text-xs text-slate-500 mt-1">
          Comprehensive overview of disciplinary actions, trends, and workforce status
        </p>
      </div>
      
      <!-- Global Filter with Custom Date Range -->
<div class="flex items-center gap-3 flex-wrap">
  <label for="global-reports-filter" class="text-xs font-bold text-slate-700 uppercase tracking-wide whitespace-nowrap">
    <i class="fa-solid fa-filter text-brand-600 mr-1"></i>
    Global Filter:
  </label>
  
  <!-- Filter Dropdown -->
  <select
    id="global-reports-filter"
    class="rounded-lg border-2 border-slate-300 bg-white px-4 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
  >
    <option value="all-time">All Time</option>
    <option value="ytd">Year to Date</option>
    <option value="last-90">Last 90 Days</option>
    <option value="last-30">Last 30 Days</option>
    <option value="this-month">This Month</option>
    <option value="last-month">Last Month</option>
    <option value="custom">üìÖ Custom Date Range</option>
  </select>
  
  <!-- üÜï CUSTOM DATE PICKER INPUTS (hidden by default) -->
  <div id="custom-date-range-inputs" class="hidden flex items-center gap-2">
    <label for="custom-start-date" class="text-xs font-bold text-slate-700">From:</label>
    <input
      type="date"
      id="custom-start-date"
      class="rounded-lg border-2 border-slate-300 bg-white px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
    />
    
    <label for="custom-end-date" class="text-xs font-bold text-slate-700">To:</label>
    <input
      type="date"
      id="custom-end-date"
      class="rounded-lg border-2 border-slate-300 bg-white px-3 py-2 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500"
    />
    
    <button
      id="apply-custom-dates"
      type="button"
      class="inline-flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2 text-sm font-bold text-white hover:bg-brand-600 transition-colors shadow-sm"
    >
      <i class="fa-solid fa-check"></i>
      Apply
    </button>
  </div>
  
        
        <button
          id="reports-refresh-data"
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-bold text-slate-700 hover:bg-slate-50 transition-colors"
        >
          <i class="fa-solid fa-arrows-rotate"></i>
          <span>Refresh</span>
        </button>
        
        <button
          id="reports-export-summary"
          type="button"
          class="inline-flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2 text-sm font-bold text-white hover:bg-brand-600 transition-colors shadow-sm"
        >
          <i class="fa-solid fa-file-export"></i>
          <span>Export PDF</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Summary KPI Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Total Actions -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <p class="text-xs text-slate-500 font-bold uppercase tracking-wide">
            Total Actions
          </p>
          <p id="reports-kpi-total-actions" class="mt-2 font-heading text-3xl text-slate-900 font-bold">
            --
          </p>
        </div>
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-brand-50">
          <i class="fa-solid fa-gavel text-brand-500 text-xl"></i>
        </div>
      </div>
      <p class="mt-2 text-xs text-slate-500">
        All discipline actions recorded
      </p>
    </div>

    <!-- Avg Resolution Time -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <p class="text-xs text-slate-500 font-bold uppercase tracking-wide">
            Avg. Resolution Time
          </p>
          <p id="reports-kpi-avg-resolution" class="mt-2 font-heading text-3xl text-slate-900 font-bold">
            --
          </p>
        </div>
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-amber-50">
          <i class="fa-solid fa-clock text-amber-500 text-xl"></i>
        </div>
      </div>
      <p class="mt-2 text-xs text-slate-500">
        Days from issue to resolution
      </p>
    </div>

    <!-- Termination Rate -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <p class="text-xs text-slate-500 font-bold uppercase tracking-wide">
            Termination Rate
          </p>
          <p id="reports-kpi-termination-rate" class="mt-2 font-heading text-3xl text-slate-900 font-bold">
            --
          </p>
        </div>
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-rose-50">
          <i class="fa-solid fa-user-slash text-rose-500 text-xl"></i>
        </div>
      </div>
      <p class="mt-2 text-xs text-slate-500">
        Percentage of terminated employees
      </p>
    </div>

    <!-- High-Risk Employees -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <p class="text-xs text-slate-500 font-bold uppercase tracking-wide">
            High-Risk Employees
          </p>
          <p id="reports-kpi-high-risk-count" class="mt-2 font-heading text-3xl text-slate-900 font-bold">
            --
          </p>
        </div>
        <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-rose-50">
          <i class="fa-solid fa-fire text-rose-500 text-xl"></i>
        </div>
      </div>
      <p class="mt-2 text-xs text-slate-500">
        Employees flagged as high risk
      </p>
    </div>
  </div>

  <!-- MAIN CHARTS GRID -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Chart 1: Employee Status Distribution -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
            <i class="fa-solid fa-users text-brand-600"></i>
            Employee Status Distribution
          </h3>
          <p class="text-xs text-slate-500 mt-1">
            Active, Inactive, and Terminated employees
          </p>
        </div>
      </div>
      <div style="height: 300px; position: relative;">
        <canvas id="reports-chart-employee-status"></canvas>
      </div>
    </div>

    <!-- Chart 2: Discipline Actions by Type -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
            <i class="fa-solid fa-chart-pie text-brand-600"></i>
            Discipline Actions by Type
          </h3>
          <p class="text-xs text-slate-500 mt-1">
            Breakdown of warning types
          </p>
        </div>
      </div>
      <div style="height: 300px; position: relative;">
        <canvas id="reports-chart-by-type"></canvas>
      </div>
    </div>

  </div>

  <!-- SECOND ROW: Department and Job Title Charts -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    
    <!-- Chart 3: Actions by Department -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
            <i class="fa-solid fa-building text-brand-600"></i>
            Disciplinary Actions by Department
          </h3>
          <p class="text-xs text-slate-500 mt-1">
            Actions grouped by department
          </p>
        </div>
      </div>
      <div style="height: 350px; position: relative; overflow-x: auto;">
        <canvas id="reports-chart-by-department"></canvas>
      </div>
    </div>

    <!-- Chart 4: Actions by Job Title -->
    <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
            <i class="fa-solid fa-id-badge text-brand-600"></i>
            Disciplinary Actions by Job Title
          </h3>
          <p class="text-xs text-slate-500 mt-1">
            Actions grouped by position
          </p>
        </div>
      </div>
      <div style="height: 350px; position: relative; overflow-x: auto;">
        <canvas id="reports-chart-by-job-title"></canvas>
      </div>
    </div>

  </div>

  <!-- THIRD ROW: Trend Chart (Full Width) -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
          <i class="fa-solid fa-chart-line text-brand-600"></i>
          Discipline Trend Over Time
        </h3>
        <p class="text-xs text-slate-500 mt-1">
          Monthly breakdown of all action types
        </p>
      </div>
    </div>
    <div style="height: 400px; width: 100%; overflow-x: auto;">
      <div style="min-width: 1200px; height: 100%; position: relative;">
        <canvas id="reports-trend-chart"></canvas>
      </div>
    </div>
  </div>

  <!-- Risk Distribution Cards -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
    <h3 class="font-heading text-base text-slate-900 font-bold mb-4 flex items-center gap-2">
      <i class="fa-solid fa-gauge-high text-brand-600"></i>
      Employee Risk Distribution
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      
      <!-- Low Risk -->
      <div class="rounded-xl bg-emerald-50 border-2 border-emerald-200 p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="font-heading text-emerald-900 font-bold">Low Risk</span>
          <span id="reports-risk-low-count" class="font-heading text-3xl text-emerald-900 font-bold">--</span>
        </div>
        <p class="text-xs text-emerald-700 font-semibold">
          Minimal or no disciplinary history
        </p>
      </div>

      <!-- Medium Risk -->
      <div class="rounded-xl bg-amber-50 border-2 border-amber-200 p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="font-heading text-amber-900 font-bold">Medium Risk</span>
          <span id="reports-risk-medium-count" class="font-heading text-3xl text-amber-900 font-bold">--</span>
        </div>
        <p class="text-xs text-amber-700 font-semibold">
          Some warnings, require monitoring
        </p>
      </div>

      <!-- High Risk -->
      <div class="rounded-xl bg-rose-50 border-2 border-rose-200 p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="font-heading text-rose-900 font-bold">High Risk</span>
          <span id="reports-risk-high-count" class="font-heading text-3xl text-rose-900 font-bold">--</span>
        </div>
        <p class="text-xs text-rose-700 font-semibold">
          Multiple warnings or final status
        </p>
      </div>
      
    </div>
  </div>

  <!-- Detailed Actions Table -->
  <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h3 class="font-heading text-base text-slate-900 font-bold flex items-center gap-2">
          <i class="fa-solid fa-table text-brand-600"></i>
          Detailed Action Report
        </h3>
        <p class="text-xs text-slate-500 mt-1">
          Complete list of disciplinary actions
        </p>
      </div>
      <button
        id="reports-table-export-csv"
        type="button"
        class="inline-flex items-center gap-2 rounded-lg border border-slate-300 bg-white px-3 py-2 text-xs font-bold text-slate-700 hover:bg-slate-50 transition-colors"
      >
        <i class="fa-solid fa-file-csv"></i>
        <span>Export CSV</span>
      </button>
    </div>
    
    <div class="overflow-x-auto">
      <table class="w-full text-xs">
        <thead>
          <tr class="border-b-2 border-slate-200">
            <th class="px-3 py-2 text-left font-bold text-slate-700">Date</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Employee</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Department</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Job Title</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Action Type</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Severity</th>
            <th class="px-3 py-2 text-left font-bold text-slate-700">Reason</th>
          </tr>
        </thead>
        <tbody id="reports-table-body" class="divide-y divide-slate-100">
          <tr>
            <td colspan="7" class="px-3 py-4 text-center text-slate-400">
              No data available. Click Refresh to load recent actions.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</section>

        <!-- Admin Settings Tab -->
        <section id="tab-admin" class="tab-panel hidden space-y-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h2 class="font-heading text-xl text-slate-900">
                Admin Settings
              </h2>
              <p class="text-xs text-slate-500 mt-1">
                Configure risk thresholds, notification preferences, and system-wide defaults for the discipline portal.
              </p>
            </div>
            <button
              id="admin-save-settings"
              type="button"
              class="inline-flex items-center gap-2 rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold text-white shadow-sm hover:bg-brand-600"
            >
              <i class="fa-solid fa-floppy-disk"></i>
              <span>Save All Settings</span>
            </button>
          </div>

          <!-- Risk Score Thresholds -->
          <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
            <h3 class="font-heading text-sm text-slate-900 mb-3">
              Risk Score Thresholds
            </h3>
            <p class="text-xs text-slate-600 mb-4">
              Define the point thresholds that determine LOW, MEDIUM, and HIGH risk levels for employees based on their discipline history.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-xs">
              <!-- Low Risk Threshold -->
              <div>
                <label for="admin-threshold-low" class="block font-bold text-slate-700 mb-1">
                  Low Risk Threshold
                </label>
                <input
                  type="number"
                  id="admin-threshold-low"
                  min="0"
                  step="1"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="e.g., 2"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Score below this = Low Risk
                </p>
              </div>

              <!-- Medium Risk Threshold -->
              <div>
                <label for="admin-threshold-medium" class="block font-bold text-slate-700 mb-1">
                  Medium Risk Threshold
                </label>
                <input
                  type="number"
                  id="admin-threshold-medium"
                  min="0"
                  step="1"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="e.g., 5"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Score at/above this = Medium Risk
                </p>
              </div>

              <!-- High Risk Threshold -->
              <div>
                <label for="admin-threshold-high" class="block font-bold text-slate-700 mb-1">
                  High Risk Threshold
                </label>
                <input
                  type="number"
                  id="admin-threshold-high"
                  min="0"
                  step="1"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="e.g., 8"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Score at/above this = High Risk
                </p>
              </div>
            </div>
          </div>

          <!-- Action Point Weights -->
          <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
            <h3 class="font-heading text-sm text-slate-900 mb-3">
              Action Point Weights
            </h3>
            <p class="text-xs text-slate-600 mb-4">
              Assign point values to each type of disciplinary action for risk score calculation.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-xs">
              <!-- Verbal Warning Points -->
              <div>
                <label for="admin-points-verbal" class="block font-bold text-slate-700 mb-1">
                  Verbal Warning
                </label>
                <input
                  type="number"
                  id="admin-points-verbal"
                  min="0"
                  step="0.5"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="1"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Points per verbal warning
                </p>
              </div>

              <!-- Written Warning Points -->
              <div>
                <label for="admin-points-written" class="block font-bold text-slate-700 mb-1">
                  Written Warning
                </label>
                <input
                  type="number"
                  id="admin-points-written"
                  min="0"
                  step="0.5"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="2"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Points per written warning
                </p>
              </div>

              <!-- Final Warning Points -->
              <div>
                <label for="admin-points-final" class="block font-bold text-slate-700 mb-1">
                  Final Warning
                </label>
                <input
                  type="number"
                  id="admin-points-final"
                  min="0"
                  step="0.5"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="3"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Points per final warning
                </p>
              </div>

              <!-- Termination Points -->
              <div>
                <label for="admin-points-termination" class="block font-bold text-slate-700 mb-1">
                  Termination Letter
                </label>
                <input
                  type="number"
                  id="admin-points-termination"
                  min="0"
                  step="0.5"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="4"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Points per termination letter
                </p>
              </div>
            </div>
          </div>

          <!-- Notification Settings -->
          <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
            <h3 class="font-heading text-sm text-slate-900 mb-3">
              Notification Settings
            </h3>
            <p class="text-xs text-slate-600 mb-4">
              Configure when and how the system sends alerts to HR and management.
            </p>
            <div class="space-y-3 text-xs">
              <!-- Notify on High Risk -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-notify-high-risk"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-notify-high-risk" class="font-bold text-slate-700 cursor-pointer">
                    Notify when employee reaches High Risk
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Send an alert to HR when an employee's risk score crosses the high-risk threshold.
                  </p>
                </div>
              </div>

              <!-- Notify on Final Warning -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-notify-final-warning"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-notify-final-warning" class="font-bold text-slate-700 cursor-pointer">
                    Notify when Final Warning is issued
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Alert leadership when a final warning is documented in the system.
                  </p>
                </div>
              </div>

              <!-- Notify on Termination -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-notify-termination"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-notify-termination" class="font-bold text-slate-700 cursor-pointer">
                    Notify when Termination Letter is issued
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Send immediate notification to HR and legal when a termination is processed.
                  </p>
                </div>
              </div>

              <!-- Daily Summary -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-notify-daily-summary"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-notify-daily-summary" class="font-bold text-slate-700 cursor-pointer">
                    Send daily discipline summary
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Email a daily summary of all discipline actions to designated recipients.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Display Preferences -->
          <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
            <h3 class="font-heading text-sm text-slate-900 mb-3">
              Display Preferences
            </h3>
            <div class="space-y-3 text-xs">
              <!-- Show Employee Photos -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-display-photos"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-display-photos" class="font-bold text-slate-700 cursor-pointer">
                    Show employee photos in lists
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Display profile photos next to employee names throughout the portal.
                  </p>
                </div>
              </div>

              <!-- Compact Mode -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-display-compact"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-display-compact" class="font-bold text-slate-700 cursor-pointer">
                    Use compact table views
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Reduce spacing in tables and lists for more data density.
                  </p>
                </div>
              </div>

              <!-- Auto-refresh Dashboard -->
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="admin-display-auto-refresh"
                  class="mt-1 rounded border-slate-300 text-brand-500 focus:ring-brand-500"
                />
                <div class="flex-1">
                  <label for="admin-display-auto-refresh" class="font-bold text-slate-700 cursor-pointer">
                    Auto-refresh dashboard every 5 minutes
                  </label>
                  <p class="text-[0.70rem] text-slate-500 mt-0.5">
                    Automatically refresh dashboard data when the tab is active.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Data Retention -->
          <div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
            <h3 class="font-heading text-sm text-slate-900 mb-3">
              Data Retention
            </h3>
            <p class="text-xs text-slate-600 mb-4">
              Configure how long the system retains discipline records and audit trails.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
              <!-- Discipline Records Retention -->
              <div>
                <label for="admin-retention-discipline" class="block font-bold text-slate-700 mb-1">
                  Discipline Records Retention (Years)
                </label>
                <input
                  type="number"
                  id="admin-retention-discipline"
                  min="1"
                  max="10"
                  step="1"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="7"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  Recommended: 7 years per TWC guidance
                </p>
              </div>

              <!-- Audit Trail Retention -->
              <div>
                <label for="admin-retention-audit" class="block font-bold text-slate-700 mb-1">
                  Audit Trail Retention (Years)
                </label>
                <input
                  type="number"
                  id="admin-retention-audit"
                  min="1"
                  max="10"
                  step="1"
                  class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                  placeholder="7"
                />
                <p class="mt-1 text-[0.70rem] text-slate-500">
                  System logs and change history
                </p>
              </div>
            </div>
          </div>

          <!-- Save Confirmation -->
          <div id="admin-save-status" class="hidden rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-xs text-emerald-800">
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-circle-check text-emerald-600"></i>
              <span class="font-semibold">Settings saved successfully!</span>
            </div>
          </div>
        </section>

        <!-- Permissions Tab -->
        <section id="tab-permissions" class="tab-panel hidden space-y-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h2 class="font-heading text-xl text-slate-900">
                Permissions &amp; Access Control
              </h2>
              <p class="text-xs text-slate-500 mt-1">
                Manage who can view, edit, and administer the discipline portal. Define role-based permissions for HR, managers, and administrators.
              </p>
            </div>
            <button
              id="permissions-add-admin"
              type="button"
              class="inline-flex items-center gap-2 rounded-full bg-brand-500 px-4 py-2 text-xs font-semibold text-white shadow-sm hover:bg-brand-600"
            >
              <i class="fa-solid fa-user-plus"></i>
              <span>Add Administrator</span>
            </button>
          </div>

          <!-- Current Administrators -->
<div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
  <h3 class="font-heading text-sm text-slate-900 mb-3">
    Portal Administrators
  </h3>
  <p class="text-xs text-slate-600 mb-4">
    Users with full administrative access to all tabs, settings, and data.
  </p>
  <div class="space-y-2 text-xs">
    <!-- Admin User 1 -->
    <div class="flex items-center justify-between rounded-lg border border-slate-100 bg-slate-50 px-3 py-2">
      <div class="flex items-center gap-3">
        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-brand-500 text-white font-heading text-xs">
          PG
        </div>
        <div>
          <p class="font-bold text-slate-900">Pablo Gonzalez</p>
          <p class="text-[0.70rem] text-slate-500">pablo@jengchirestaurant.com</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="inline-flex items-center gap-1 rounded-full bg-brand-50 border border-brand-200 px-2 py-1 text-[0.70rem] text-brand-700 font-medium">
          <i class="fa-solid fa-shield-halved text-[0.60rem]"></i>
          <span>Owner</span>
        </span>
      </div>
    </div>
  </div>
</div>

<!-- Role-Based Access Matrix -->
<div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
  <h3 class="font-heading text-sm text-slate-900 mb-3">
    Role-Based Access Matrix
  </h3>
  <p class="text-xs text-slate-600 mb-4">
    Define what each role can view and edit across the portal. Changes save automatically.
  </p>
  <div class="overflow-x-auto">
    <table class="w-full text-xs">
      <thead>
        <tr class="border-b-2 border-slate-200">
          <th class="px-3 py-2 text-left font-heading text-slate-700 min-w-[250px]">
            Feature / Tab
          </th>
          <th class="px-3 py-2 text-center font-heading text-slate-700">
            <div class="flex flex-col items-center">
              <i class="fa-solid fa-shield-halved text-brand-500 mb-1"></i>
              <span>Admin</span>
            </div>
          </th>
          <th class="px-3 py-2 text-center font-heading text-slate-700">
            <div class="flex flex-col items-center">
              <i class="fa-solid fa-user-tie text-slate-500 mb-1"></i>
              <span>Manager</span>
            </div>
          </th>
          <th class="px-3 py-2 text-center font-heading text-slate-700">
            <div class="flex flex-col items-center">
              <i class="fa-solid fa-eye text-slate-500 mb-1"></i>
              <span>Viewer</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        
        <!-- Dashboard - View KPIs & Charts -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Dashboard ‚Äî View KPIs & Charts</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-view" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-view" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-view" data-role="viewer" />
          </td>
        </tr>

        <!-- Dashboard - Export Reports -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Dashboard ‚Äî Export Reports & Data</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-export" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-export" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="dashboard-export" data-role="viewer" />
          </td>
        </tr>

        <!-- Discipline Cases - View History -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Discipline Cases ‚Äî View History</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-view" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-view" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-view" data-role="viewer" />
          </td>
        </tr>

        <!-- Discipline Cases - Create & Edit Actions -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Discipline Cases ‚Äî Create & Edit Actions</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-edit" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-edit" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-edit" data-role="viewer" />
          </td>
        </tr>

        <!-- Discipline Cases - Delete Actions -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Discipline Cases ‚Äî Delete Actions</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-delete" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-delete" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-delete" data-role="viewer" />
          </td>
        </tr>

        <!-- Discipline Cases - Export PDFs -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Discipline Cases ‚Äî Export to PDF</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-export" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-export" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="discipline-export" data-role="viewer" />
          </td>
        </tr>

        <!-- Employees 360 - View Profiles -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Employees 360 ‚Äî View Profiles</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-view" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-view" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-view" data-role="viewer" />
          </td>
        </tr>

        <!-- Employees 360 - Edit Employee Data -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Employees 360 ‚Äî Edit Employee Data</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-edit" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-edit" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-edit" data-role="viewer" />
          </td>
        </tr>

        <!-- Employees 360 - Edit Salaries & Compensation -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Employees 360 ‚Äî Edit Salaries & Compensation</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-salary" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-salary" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-salary" data-role="viewer" />
          </td>
        </tr>

        <!-- Employees 360 - Terminate Employees -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Employees 360 ‚Äî Terminate Employees</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-terminate" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-terminate" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-terminate" data-role="viewer" />
          </td>
        </tr>

        <!-- Employees 360 - Export 360 PDF -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Employees 360 ‚Äî Export 360 PDF</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-export" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-export" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="employees-export" data-role="viewer" />
          </td>
        </tr>

      <!-- Policy Library - View Policies -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Policy Library ‚Äî View Policies</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-view" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-view" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-view" data-role="viewer" />
          </td>
        </tr>

        <!-- Policy Library - Edit Policies -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Policy Library ‚Äî Edit Policies</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-edit" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-edit" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="policy-edit" data-role="viewer" />
          </td>
        </tr>

        <!-- Reports - View Reports -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Reports ‚Äî View Reports & Analytics</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-view" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-view" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-view" data-role="viewer" />
          </td>
        </tr>

        <!-- Reports - Export Data -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Reports ‚Äî Export Data & PDFs</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-export" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-export" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="reports-export" data-role="viewer" />
          </td>
        </tr>

        <!-- Admin Settings - Access -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Admin Settings ‚Äî Access Settings</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="admin-access" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="admin-access" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="admin-access" data-role="viewer" />
          </td>
        </tr>

        <!-- Permissions - Manage Permissions -->
        <tr>
          <td class="px-3 py-2 text-slate-700">Permissions ‚Äî Manage User Permissions</td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" checked class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="permissions-manage" data-role="admin" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="permissions-manage" data-role="manager" />
          </td>
          <td class="px-3 py-2 text-center">
            <input type="checkbox" class="rounded border-slate-300 text-brand-500 permission-checkbox" 
                   data-feature="permissions-manage" data-role="viewer" />
          </td>
        </tr>

      </tbody>
    </table>
  </div>

  <p class="mt-4 text-xs text-slate-500">
    üí° <strong>Auto-save enabled:</strong> Permission changes are saved automatically to the database and logged in the audit trail.
  </p>
</div>

<!-- Audit Log (Optional - can be added later) -->
<div class="bg-white rounded-2xl shadow-subtle border border-slate-100 p-4">
  <h3 class="font-heading text-sm text-slate-900 mb-3">
    Permission Changes Audit Log
  </h3>
  <p class="text-xs text-slate-600 mb-4">
    Track all permission modifications for compliance and security review.
  </p>
  <div class="overflow-x-auto">
    <table class="w-full text-xs">
      <thead>
        <tr class="border-b-2 border-slate-200">
          <th class="px-3 py-2 text-left font-heading text-slate-700">Timestamp</th>
          <th class="px-3 py-2 text-left font-heading text-slate-700">Action</th>
          <th class="px-3 py-2 text-left font-heading text-slate-700">User Affected</th>
          <th class="px-3 py-2 text-left font-heading text-slate-700">Changed By</th>
        </tr>
      </thead>
      <tbody id="permissions-audit-log" class="divide-y divide-slate-100">
        <tr>
          <td colspan="4" class="px-3 py-4 text-center text-slate-400">
            No permission changes logged yet.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

</section>
<!-- üëÜ END OF PERMISSIONS TAB -->

</div>
<!-- üëÜ END OF TAB CONTAINER -->
</main>
<!-- üëÜ END OF MAIN -->

</div>
<!-- üëÜ END OF APP ROOT -->

<!-- ============================================================================ -->
<!-- üéØ MODAL MUST BE HERE - OUTSIDE ALL SECTIONS, OUTSIDE MAIN, INSIDE BODY -->
<!-- ============================================================================ -->

<!-- Warning Details Modal - FIXED FOOTER VERSION -->
<div id="warning-detail-modal" class="hidden fixed inset-0 z-[9999] overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-slate-900 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

    <!-- Modal panel with FIXED structure -->
    <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full max-h-[90vh] flex flex-col">
      
      <!-- FIXED HEADER -->
      <div class="bg-white px-6 pt-5 pb-4 border-b border-slate-200 flex-shrink-0">
        <div class="flex items-start justify-between">
          <div>
            <h3 class="text-lg font-heading font-bold text-slate-900" id="modal-title">
              Edit Disciplinary Action
            </h3>
            <p class="mt-1 text-xs text-slate-500">
              Update action details and save changes
            </p>
          </div>
          
          <!-- WARNING COUNTER (Top Right) -->
          <div class="flex items-center gap-3">
            <div class="flex flex-col items-end gap-1">
              <div class="flex items-center gap-2 text-xs">
                <span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 border border-emerald-200 px-2 py-1 text-emerald-700 font-bold">
                  <i class="fa-solid fa-message text-[0.60rem]"></i>
                  <span id="modal-verbal-count">0</span> Verbal
                </span>
                <span class="inline-flex items-center gap-1 rounded-full bg-amber-50 border border-amber-200 px-2 py-1 text-amber-700 font-bold">
                  <i class="fa-solid fa-file-lines text-[0.60rem]"></i>
                  <span id="modal-written-count">0</span> Written
                </span>
                <span class="inline-flex items-center gap-1 rounded-full bg-orange-50 border border-orange-200 px-2 py-1 text-orange-700 font-bold">
                  <i class="fa-solid fa-triangle-exclamation text-[0.60rem]"></i>
                  <span id="modal-final-count">0</span> Final
                </span>
                <span class="inline-flex items-center gap-1 rounded-full bg-rose-50 border border-rose-200 px-2 py-1 text-rose-700 font-bold">
                  <i class="fa-solid fa-ban text-[0.60rem]"></i>
                  <span id="modal-termination-count">0</span> Term
                </span>
              </div>
            </div>
            
            <button type="button" id="close-warning-modal" class="rounded-lg text-slate-400 hover:text-slate-600 focus:outline-none">
              <i class="fa-solid fa-times text-xl"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Hidden fields -->
      <input type="hidden" id="modal-action-employee-id" />
      <input type="hidden" id="modal-action-index" />

      <!-- SCROLLABLE BODY -->
      <div class="flex-1 overflow-y-auto px-6 py-4">
        <form id="modal-edit-form" class="space-y-4 text-sm">
          
          <!-- Employee Information (Read-only) -->
          <div class="bg-slate-50 rounded-lg p-3">
            <h4 class="text-xs font-bold text-slate-700 uppercase mb-2">Employee Information</h4>
            <div class="grid grid-cols-3 gap-3 text-xs">
              <div>
                <p class="text-slate-500 text-[0.70rem]">Name</p>
                <p class="font-bold text-slate-900" id="modal-employee-name">--</p>
              </div>
              <div>
                <p class="text-slate-500 text-[0.70rem]">Employee ID</p>
                <p class="font-bold text-slate-900" id="modal-employee-id">--</p>
              </div>
              <div>
                <p class="text-slate-500 text-[0.70rem]">Department</p>
                <p class="font-bold text-slate-900" id="modal-employee-dept">--</p>
              </div>
            </div>
          </div>

          <!-- Action Details - EDITABLE -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="modal-edit-type" class="block text-xs font-bold text-slate-700 mb-1">
                Action Type
              </label>
              <select
                id="modal-edit-type"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              >
                <option value="VERBAL_WARNING">Verbal Warning</option>
                <option value="WRITTEN_WARNING">Written Warning</option>
                <option value="FINAL_WARNING">Final Warning</option>
                <option value="TERMINATION">Termination</option>
              </select>
            </div>

            <div>
              <label for="modal-edit-severity" class="block text-xs font-bold text-slate-700 mb-1">
                Severity
              </label>
              <select
                id="modal-edit-severity"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              >
                <option value="LOW">Low</option>
                <option value="MEDIUM">Medium</option>
                <option value="HIGH">High</option>
              </select>
            </div>

            <div>
              <label for="modal-edit-date" class="block text-xs font-bold text-slate-700 mb-1">
                Date
              </label>
              <input
                type="date"
                id="modal-edit-date"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              />
            </div>

            <div>
              <label for="modal-edit-main-category" class="block text-xs font-bold text-slate-700 mb-1">
                Main Category
              </label>
              <select
                id="modal-edit-main-category"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              >
                <option value="">Select category...</option>
                <option value="attendance">Attendance & Punctuality</option>
                <option value="performance">Performance Issues</option>
                <option value="conduct">Conduct & Behavior</option>
                <option value="policy">Policy Violations</option>
                <option value="safety">Safety & Health</option>
                <option value="customer">Customer Service</option>
                <option value="integrity">Integrity & Honesty</option>
              </select>
            </div>
          </div>

          <!-- Sub-Category (Dynamic based on Main Category) -->
          <div>
            <label for="modal-edit-sub-category" class="block text-xs font-bold text-slate-700 mb-1">
              Sub-Category / Specific Issue
            </label>
            <select
              id="modal-edit-sub-category"
              class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
            >
              <option value="">Select main category first...</option>
            </select>
          </div>

          <!-- Reason - EDITABLE -->
          <div>
            <label for="modal-edit-reason" class="block text-xs font-bold text-slate-700 mb-1">
              Reason for Action
            </label>
            <textarea
              id="modal-edit-reason"
              rows="4"
              class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="Describe the incident and policy violations..."
            ></textarea>
          </div>

          <!-- Corrective Action Plan - EDITABLE -->
          <div>
            <label for="modal-edit-plan" class="block text-xs font-bold text-slate-700 mb-1">
              Corrective Action Plan
            </label>
            <textarea
              id="modal-edit-plan"
              rows="3"
              class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
              placeholder="Outline expectations and improvement plan..."
            ></textarea>
          </div>

          <!-- Signatures - EDITABLE -->
          <div class="grid grid-cols-3 gap-3">
            <div>
              <label for="modal-edit-manager-sig" class="block text-xs font-bold text-slate-700 mb-1">
                Manager Signature
              </label>
              <input
                type="text"
                id="modal-edit-manager-sig"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                placeholder="Manager name"
              />
            </div>

            <div>
              <label for="modal-edit-hr-sig" class="block text-xs font-bold text-slate-700 mb-1">
                HR Signature
              </label>
              <input
                type="text"
                id="modal-edit-hr-sig"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                placeholder="HR representative"
              />
            </div>

            <div>
              <label for="modal-edit-employee-sig" class="block text-xs font-bold text-slate-700 mb-1">
                Employee Signature
              </label>
              <input
                type="text"
                id="modal-edit-employee-sig"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-brand-500"
                placeholder="Employee name or DECLINED"
              />
            </div>
          </div>

        </form>
      </div>

      <!-- FIXED FOOTER with buttons -->
      <div class="bg-white px-6 py-4 border-t border-slate-200 flex-shrink-0">
        <div class="flex justify-between items-center gap-3">
          <button 
            type="button" 
            id="modal-delete-btn" 
            class="inline-flex items-center gap-2 rounded-full border border-rose-300 bg-rose-50 px-4 py-2 text-xs font-semibold text-rose-700 hover:bg-rose-100 transition-colors"
          >
            <i class="fa-solid fa-trash"></i>
            Delete Action
          </button>

          <div class="flex gap-2">
            <button 
              type="button" 
              id="modal-close-btn" 
              class="inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-4 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50 transition-colors"
            >
              Cancel
            </button>
            <button 
              type="button" 
              id="modal-export-pdf" 
              class="inline-flex items-center gap-2 rounded-full border border-brand-300 bg-white px-4 py-2 text-xs font-semibold text-brand-700 hover:bg-brand-50 transition-colors"
            >
              <i class="fa-solid fa-file-pdf"></i>
              Export PDF
            </button>
            <button 
  type="button" 
  id="modal-save-btn" 
  class="inline-flex items-center gap-2 rounded-full bg-brand-500 px-5 py-2 text-xs font-bold text-black shadow-sm hover:bg-brand-600 transition-colors"
>
  <i class="fa-solid fa-floppy-disk"></i>
  <span>Save Changes</span>
</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Toast Notification Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2" aria-live="polite"></div>

<!-- Add footer before closing </body> tag -->
<footer class="bg-slate-100 border-t border-slate-200 py-6 mt-auto">
  <div class="max-w-7xl mx-auto px-4 text-center space-y-3">
    <!-- Disclaimer -->
    <p class="text-xs text-slate-600">
      <strong>Disclaimer:</strong> This system is for authorized HR personnel only. All data is confidential and protected under applicable employment laws.
    </p>
    <!-- Copyright & Credits -->
    <div class="flex flex-col sm:flex-row items-center justify-center gap-2 text-xs text-slate-500">
      <span>¬© 2026 Jeng Chi Restaurant. All rights reserved.</span>
      <span class="hidden sm:inline">‚Ä¢</span>
      <span>Built by <strong class="text-slate-700">PG</strong></span>
    </div>
  </div>
</footer>

</body>
<!-- üëÜ END OF BODY -->

<script type="module">
        

      // ========================================================================
      // SUPABASE CLIENT INITIALIZATION
      // ========================================================================
        const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs";

    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.supabaseClient = supabaseClient;


// ========================================================================
// üéØ ENHANCED CONSOLE LOGGING - START
// ========================================================================
console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
console.log('üöÄ Jeng Chi HR Discipline Portal Starting...');
console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
console.log('üìç Supabase URL:', SUPABASE_URL);
console.log('‚úÖ Database client initialized');
console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
// ========================================================================
// üéØ ENHANCED CONSOLE LOGGING - END
// ========================================================================

// ========================================================================
// APPLICATION STATE
// ========================================================================



      // ========================================================================
      // APPLICATION STATE
      // ========================================================================
      const AppState = {
        employees: [],
        selectedEmployee: null,
        employeeFilterStatus: 'all',
        currentTab: 'dashboard',
        charts: {
          disciplineTrend: null,
          reportsByType: null,
          reportsByDept: null,
          reportsTrend: null
        },
        settings: {
          thresholds: { low: 2, medium: 5, high: 8 },
          points: { verbal: 1, written: 2, final: 3, termination: 4 },
          notifications: {
            highRisk: true,
            finalWarning: true,
            termination: true,
            dailySummary: false
          },
          display: {
            photos: true,
            compact: false,
            autoRefresh: false
          },
          retention: {
            discipline: 7,
            audit: 7
          }
        }
      };

      // Autocomplete state for search inputs
      const AutocompleteState = {
        discipline: {
          searchTimeout: null,
          currentQuery: '',
          selectedEmployeeId: null
        },
        employees: {
          searchTimeout: null,
          currentQuery: '',
          selectedEmployeeId: null
        }
      };

      // ========================================================================
      // UTILITY FUNCTIONS
      // ========================================================================
      
    function formatDate(dateString) {
  if (!dateString) return '--';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
}

// ‚úÖ ADD THIS ‚Äî GLOBAL SCOPE, BEFORE ANY FUNCTION THAT CALLS IT
function calculateTenure(hireDate) {
  if (!hireDate) return '--';
  const hire = new Date(hireDate);
  if (isNaN(hire.getTime())) return '--';
  const now = new Date();
  const diffDays = Math.floor(Math.abs(now - hire) / (1000 * 60 * 60 * 24));
  const years = Math.floor(diffDays / 365);
  const months = Math.floor((diffDays % 365) / 30);
  const yearStr = years === 1 ? 'year' : 'years';
  const monthStr = months === 1 ? 'month' : 'months';
  if (years > 0) {
    return `${years} ${yearStr}, ${months} ${monthStr}`;
  }
  return `${months} ${monthStr}`;
}

// ‚úÖ ADD THIS FUNCTION HERE ‚Äî BEFORE ANY CALLS TO IT
function setupDepartmentJobTitleCascade() {
  const deptDropdown = document.getElementById('edit-department');
  const jobTitleDropdown = document.getElementById('edit-job-title');
  
  if (!deptDropdown || !jobTitleDropdown) return;
  
  deptDropdown.addEventListener('change', (e) => {
    const department = e.target.value;
    
    // Clear job title dropdown
    jobTitleDropdown.innerHTML = '<option value="">Select job title...</option>';
    
    if (department && JOB_TITLES_BY_DEPARTMENT[department]) {
      // Populate with department-specific titles
      JOB_TITLES_BY_DEPARTMENT[department].forEach(title => {
        const option = document.createElement('option');
        option.value = title;
        option.textContent = title;
        jobTitleDropdown.appendChild(option);
      });
      jobTitleDropdown.disabled = false;
    } else {
      jobTitleDropdown.disabled = true;
      jobTitleDropdown.innerHTML = '<option value="">Select department first...</option>';
    }
  });
}



      function computeRiskScore(employee) {
        const { verbal_warning_count = 0, disciplinary_warning_count = 0, final_warning_count = 0, termination_letter_count = 0 } = employee;
        const { points } = AppState.settings;
        return (
          verbal_warning_count * points.verbal +
          disciplinary_warning_count * points.written +
          final_warning_count * points.final +
          termination_letter_count * points.termination
        );
      }

      function getRiskLevel(score) {
        const { thresholds } = AppState.settings;
        if (score >= thresholds.high) return 'HIGH';
        if (score >= thresholds.medium) return 'MEDIUM';
        return 'LOW';
      }

      function getRiskBadgeClasses(level) {
        switch (level) {
          case 'HIGH':
            return 'bg-rose-50 border-rose-200 text-rose-700';
          case 'MEDIUM':
            return 'bg-amber-50 border-amber-200 text-amber-700';
          default:
            return 'bg-emerald-50 border-emerald-200 text-emerald-700';
        }
      }

      function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-emerald-500' : type === 'error' ? 'bg-rose-500' : 'bg-brand-500';
        toast.className = `${bgColor} text-white px-4 py-3 rounded-xl shadow-lg text-sm flex items-center gap-2`;
        toast.innerHTML = `
          <i class="fa-solid fa-circle-info"></i>
          <span>${message}</span>
        `;
        container.appendChild(toast);
        setTimeout(() => {
          toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // ========================================================================
      // TAB SWITCHING
      // ========================================================================
      
      function showTab(tabName) {
  console.log('üîÑ Switching to tab:', tabName);
        // Hide all tab panels
        document.querySelectorAll('.tab-panel').forEach(panel => {
          panel.classList.add('hidden');
        });

        // Remove active state from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('bg-brand-500', 'text-white', 'shadow-subtle');
          btn.classList.add('bg-white', 'text-slate-600');
        });

        // Show selected tab panel
        const targetPanel = document.getElementById(`tab-${tabName}`);
        if (targetPanel) {
          targetPanel.classList.remove('hidden');
        }

        // Highlight active tab button
        const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
        if (activeBtn) {
          activeBtn.classList.add('bg-brand-500', 'text-white', 'shadow-subtle');
          activeBtn.classList.remove('bg-white', 'text-slate-600');
        }

        AppState.currentTab = tabName;

        // Tab-specific initialization
        if (tabName === 'dashboard') {
          updateDashboard();
        } else if (tabName === 'reports') {
          updateReports();
        }
      }

      // ========================================================================
      // EMPLOYEE DATA LOADING
      // ========================================================================
      
      async function loadEmployees() {
  console.log('');
  console.log('üìä DATABASE OPERATION: Loading Employees');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  console.log('üîÑ Executing query: SELECT * FROM employees2025');
  
  try {
    const startTime = performance.now();
    
    const { data, error } = await supabaseClient
      .from('employees2025')
      .select('*')
      .order('last_name', { ascending: true });

    const endTime = performance.now();
    const duration = (endTime - startTime).toFixed(2);
    console.log(`‚è±Ô∏è  Query completed in ${duration}ms`);

    if (error) {
      console.error('‚ùå DATABASE ERROR:');
      console.error('   Message:', error.message);
      console.error('   Code:', error.code);
      console.error('   Details:', error.details);
      throw error;
    }

    AppState.employees = data || [];
    
    console.log(`‚úÖ SUCCESS: Loaded ${data.length} employees`);
    console.log('');
    console.log('üìã First 3 employees:');
    data.slice(0, 3).forEach((emp, i) => {
      console.log(`   ${i + 1}. ${emp.first_name} ${emp.last_name} (${emp.employee_id})`);
    });
    
    console.log('');
    console.log('üìà Statistics:');
    const active = data.filter(e => e.employment_status === 'Active').length;
    const withWarnings = data.filter(e => 
      (e.verbal_warning_count || 0) > 0 || 
      (e.disciplinary_warning_count || 0) > 0
    ).length;
    console.log(`   ‚Ä¢ Total: ${data.length}`);
    console.log(`   ‚Ä¢ Active: ${active}`);
    console.log(`   ‚Ä¢ With warnings: ${withWarnings}`);
    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
    
    showToast(`Loaded ${AppState.employees.length} employees`, 'success');
    // Update last refreshed timestamp
const refreshEl = document.getElementById('header-last-refreshed');
if (refreshEl) {
  const now = new Date();
  refreshEl.textContent = now.toLocaleString('en-US', { 
    month: 'short', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit' 
  });
}
    
    // Update UI elements that depend on employee data
    if (AppState.currentTab === 'dashboard') {
      updateDashboard();
    }
    
    return data;
  } catch (error) {
    console.error('');
    console.error('üí• CRITICAL ERROR in loadEmployees()');
    console.error('   Error:', error.message);
    console.error('   Stack:', error.stack);
    console.error('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
    showToast('Failed to load employees: ' + error.message, 'error');
    return [];
  }
}

      function filterEmployees(filterType) {
        AppState.employeeFilterStatus = filterType;
        
        let filtered = [...AppState.employees];
        
        if (filterType === 'Active') {
          filtered = filtered.filter(emp => emp.employment_status === 'Active');
        } else if (filterType === 'Terminated') {
          filtered = filtered.filter(emp => emp.employment_status === 'Terminated');
        } else if (filterType === 'HighRisk') {
          filtered = filtered.filter(emp => {
            const score = computeRiskScore(emp);
            return getRiskLevel(score) === 'HIGH';
          });
        }
        
        return filtered;
      }

      // ========================================================================
      // DASHBOARD TAB FUNCTIONS
      // ========================================================================
      
      function updateDashboard() {
        updateDashboardKPIs();
        populateDashboardWarningsByDept();
        populateDashboardDisciplineList();
      }

      function updateDashboardKPIs() {
  const activeEmployees = AppState.employees.filter(e => e.employment_status === 'Active');
  const terminatedEmployees = AppState.employees.filter(e => e.employment_status === 'Terminated');
  
  const highRiskEmployees = AppState.employees.filter(e => {
    const score = computeRiskScore(e);
    return getRiskLevel(score) === 'HIGH';
  });

  // Position mapping (case-insensitive, handles variations)
  const positionMap = {
    // FOH Positions
    'foh manager': 'foh-manager',
    'front of house manager': 'foh-manager',
    'server': 'server',
    'bartender': 'bartender',
    'host': 'host',
    'hostess': 'host',
    'cashier': 'cashier',
    'busser': 'busser',
    'busboy': 'busser',
    
    // BOH Positions
    'line cook': 'line-cook',
    'linecook': 'line-cook',
    'wok chef': 'wok-chef',
    'wok': 'wok-chef',
    'dumpling maker': 'dumpling-maker',
    'dumplings': 'dumpling-maker',
    'prep cook': 'prep-cook',
    'prep': 'prep-cook',
    'kitchen prep': 'prep-cook',
    'pastry chef': 'pastry-chef',
    'pastry': 'pastry-chef',
    'dishwasher': 'dishwasher',
    'dish': 'dishwasher',
    'production manager': 'production-manager',
    'logistic coordinator': 'logistic-coordinator',
    'logistics': 'logistic-coordinator'
  };

  // FOH position keys
  const fohPositions = ['foh-manager', 'server', 'bartender', 'host', 'cashier', 'busser'];

  // Initialize counters
  const positionCounts = {
    'foh-manager': 0,
    'server': 0,
    'bartender': 0,
    'host': 0,
    'cashier': 0,
    'busser': 0,
    'line-cook': 0,
    'wok-chef': 0,
    'dumpling-maker': 0,
    'prep-cook': 0,
    'pastry-chef': 0,
    'dishwasher': 0,
    'production-manager': 0,
    'logistic-coordinator': 0
  };

  // Discipline counters for FOH and BOH
  const fohDisciplines = { verbal: 0, written: 0, final: 0, termination: 0 };
  const bohDisciplines = { verbal: 0, written: 0, final: 0, termination: 0 };

  // Count positions AND disciplines
  AppState.employees.forEach(emp => {
    const title = (emp.job_title || emp.position_title || '').toLowerCase().trim();
    const mappedPosition = positionMap[title];
    
    // Count position
    if (mappedPosition && positionCounts.hasOwnProperty(mappedPosition)) {
      positionCounts[mappedPosition]++;
      
      // Determine if FOH or BOH
      const isFOH = fohPositions.includes(mappedPosition);
      
      // Count disciplines for this employee
      if (isFOH) {
        fohDisciplines.verbal += emp.verbal_warning_count || 0;
        fohDisciplines.written += emp.disciplinary_warning_count || 0;
        fohDisciplines.final += emp.final_warning_count || 0;
        fohDisciplines.termination += emp.termination_letter_count || 0;
      } else {
        bohDisciplines.verbal += emp.verbal_warning_count || 0;
        bohDisciplines.written += emp.disciplinary_warning_count || 0;
        bohDisciplines.final += emp.final_warning_count || 0;
        bohDisciplines.termination += emp.termination_letter_count || 0;
      }
    }
  });

  // Calculate FOH and BOH totals
  const fohTotal = positionCounts['foh-manager'] + positionCounts['server'] + 
                   positionCounts['bartender'] + positionCounts['host'] + 
                   positionCounts['cashier'] + positionCounts['busser'];
  
  const bohTotal = positionCounts['line-cook'] + positionCounts['wok-chef'] + 
                   positionCounts['dumpling-maker'] + positionCounts['prep-cook'] + 
                   positionCounts['pastry-chef'] + positionCounts['dishwasher'] + 
                   positionCounts['production-manager'] + positionCounts['logistic-coordinator'];

  // Calculate total disciplines for FOH and BOH
  const fohTotalDisciplines = fohDisciplines.verbal + fohDisciplines.written + 
                               fohDisciplines.final + fohDisciplines.termination;
  const bohTotalDisciplines = bohDisciplines.verbal + bohDisciplines.written + 
                               bohDisciplines.final + bohDisciplines.termination;

  // Update KPIs
  document.getElementById('kpi-total-employees').textContent = AppState.employees.length;
  document.getElementById('kpi-high-risk-employees').textContent = highRiskEmployees.length;
  document.getElementById('kpi-terminated-employees').textContent = terminatedEmployees.length;
  
  // FOH Total
  document.getElementById('kpi-foh-total').textContent = fohTotal;
  document.getElementById('kpi-foh-manager').textContent = positionCounts['foh-manager'];
  document.getElementById('kpi-server').textContent = positionCounts['server'];
  document.getElementById('kpi-bartender').textContent = positionCounts['bartender'];
  document.getElementById('kpi-host').textContent = positionCounts['host'];
  document.getElementById('kpi-cashier').textContent = positionCounts['cashier'];
  document.getElementById('kpi-busser').textContent = positionCounts['busser'];
  
  // BOH Total
  document.getElementById('kpi-boh-total').textContent = bohTotal;
  document.getElementById('kpi-line-cook').textContent = positionCounts['line-cook'];
  document.getElementById('kpi-wok-chef').textContent = positionCounts['wok-chef'];
  document.getElementById('kpi-dumpling-maker').textContent = positionCounts['dumpling-maker'];
  document.getElementById('kpi-prep-cook').textContent = positionCounts['prep-cook'];
  document.getElementById('kpi-pastry-chef').textContent = positionCounts['pastry-chef'];
  document.getElementById('kpi-dishwasher').textContent = positionCounts['dishwasher'];
  document.getElementById('kpi-production-manager').textContent = positionCounts['production-manager'];
  document.getElementById('kpi-logistic-coordinator').textContent = positionCounts['logistic-coordinator'];

  // üÜï Update FOH Disciplines
  document.getElementById('kpi-foh-total-disciplines').textContent = fohTotalDisciplines;
  document.getElementById('kpi-foh-verbal').textContent = fohDisciplines.verbal;
  document.getElementById('kpi-foh-written').textContent = fohDisciplines.written;
  document.getElementById('kpi-foh-final').textContent = fohDisciplines.final;
  document.getElementById('kpi-foh-termination').textContent = fohDisciplines.termination;

  // üÜï Update BOH Disciplines
  document.getElementById('kpi-boh-total-disciplines').textContent = bohTotalDisciplines;
  document.getElementById('kpi-boh-verbal').textContent = bohDisciplines.verbal;
  document.getElementById('kpi-boh-written').textContent = bohDisciplines.written;
  document.getElementById('kpi-boh-final').textContent = bohDisciplines.final;
  document.getElementById('kpi-boh-termination').textContent = bohDisciplines.termination;

  console.log('üìä KPI Update:', {
    total: AppState.employees.length,
    fohTotal,
    bohTotal,
    fohDisciplines,
    bohDisciplines,
    highRisk: highRiskEmployees.length,
    terminated: terminatedEmployees.length,
    positions: positionCounts
  });
}




     function populateDashboardWarningsByDept() {
  const tbody = document.getElementById('table-dashboard-warnings-by-dept');
  if (!tbody) return;

  const deptStats = {};
  
  AppState.employees.forEach(emp => {
    const dept = emp.department || 'Unassigned';
    if (!deptStats[dept]) {
      deptStats[dept] = { verbal: 0, written: 0, final: 0, termination: 0 };
    }
    deptStats[dept].verbal += emp.verbal_warning_count || 0;
    deptStats[dept].written += emp.disciplinary_warning_count || 0;
    deptStats[dept].final += emp.final_warning_count || 0;
    deptStats[dept].termination += emp.termination_letter_count || 0;
  });

  tbody.innerHTML = '';
  Object.entries(deptStats).forEach(([dept, stats]) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="px-3 py-2 text-slate-900 font-medium">${dept}</td>
      <td class="px-3 py-2 text-slate-600 text-center">${stats.verbal}</td>
      <td class="px-3 py-2 text-slate-600 text-center">${stats.written}</td>
      <td class="px-3 py-2 text-slate-600 text-center">${stats.final}</td>
      <td class="px-3 py-2 text-slate-600 text-center">${stats.termination}</td>
    `;
    tbody.appendChild(row);
  });
}
    function populateDashboardDisciplineList() { 
  const tbody = document.getElementById('dashboard-discipline-table-body');
  const badge = document.getElementById('discipline-count-badge');
  if (!tbody || !badge) return;

  console.log('üìã Populating dashboard discipline list...');

  // Collect ALL individual actions from all employees
  const allActions = [];
  
  AppState.employees.forEach(emp => {
    if (emp.discipline_history && Array.isArray(emp.discipline_history) && emp.discipline_history.length > 0) {
      emp.discipline_history.forEach((action, index) => {
        allActions.push({
          ...action,
          employeeId: emp.id,
          employeeName: `${emp.first_name} ${emp.last_name}`,
          employeeNumber: emp.employee_id,
          position: emp.job_title || emp.position_title || 'N/A',
          department: emp.department || 'N/A',
          originalIndex: index // Store original index for editing
        });
      });
    }
  });

  // Sort by date descending (newest first)
  allActions.sort((a, b) => {
    const dateA = new Date(a.date || a.timestamp);
    const dateB = new Date(b.date || b.timestamp);
    return dateB - dateA;
  });

  // Update badge count
  badge.textContent = allActions.length;

  tbody.innerHTML = '';

  if (allActions.length === 0) {
    tbody.innerHTML = `
      <tr>
        <td colspan="7" class="px-3 py-4 text-center text-slate-400">
          No disciplinary actions found
        </td>
      </tr>
    `;
    return;
  }

  // Render each action as a row
  allActions.forEach(action => {
    const actionDate = new Date(action.date || action.timestamp);
    const dateStr = actionDate.toLocaleDateString('en-US', { 
      month: 'short', 
      day: 'numeric', 
      year: 'numeric' 
    });
    const timeStr = actionDate.toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    // Determine color + icon for action type
    let typeBg = 'bg-slate-100 text-slate-700';
    let typeIcon = 'fa-circle-info';
    const actionType = (action.type || '').toUpperCase();

    if (actionType.includes('VERBAL')) {
      typeBg = 'bg-emerald-100 text-emerald-700';
      typeIcon = 'fa-comments';
    } else if (actionType.includes('WRITTEN')) {
      typeBg = 'bg-amber-100 text-amber-700';
      typeIcon = 'fa-file-pen';
    } else if (actionType.includes('FINAL')) {
      typeBg = 'bg-orange-100 text-orange-700';
      typeIcon = 'fa-triangle-exclamation';
    } else if (actionType.includes('TERMINATION')) {
      typeBg = 'bg-rose-100 text-rose-700';
      typeIcon = 'fa-user-slash';
    }
    
    // Determine color + icon for severity
    let severityBg = 'bg-slate-100 text-slate-700';
    let severityIcon = 'fa-gauge';
    const severity = (action.severity || '').toUpperCase();

    if (severity === 'LOW') {
      severityBg = 'bg-emerald-100 text-emerald-700';
      severityIcon = 'fa-arrow-down';
    } else if (severity === 'MEDIUM') {
      severityBg = 'bg-amber-100 text-amber-700';
      severityIcon = 'fa-exclamation';
    } else if (severity === 'HIGH') {
      severityBg = 'bg-rose-100 text-rose-700';
      severityIcon = 'fa-skull-crossbones';
    }
    
    const row = document.createElement('tr');
    row.className = 'hover:bg-brand-50 cursor-pointer transition-colors';

    // ‚úÖ EXACTLY 7 <td> TO MATCH YOUR HEADERS
    row.innerHTML = `
      <!-- Date & Time -->
      <td class="px-3 py-2 align-top">
        <div class="flex flex-col">
          <span class="font-bold text-slate-900">${dateStr}</span>
          <span class="text-[0.70rem] text-slate-500">${timeStr}</span>
        </div>
      </td>

      <!-- Employee -->
      <td class="px-3 py-2 align-top">
        <div class="flex flex-col">
          <span class="font-bold text-slate-900">${action.employeeName}</span>
          <span class="text-[0.70rem] text-slate-500">${action.employeeNumber || '--'}</span>
        </div>
      </td>

      <!-- Position -->
      <td class="px-3 py-2 text-slate-700 align-top">
        ${action.position || '--'}
      </td>

      <!-- Action Type (with icon) -->
      <td class="px-3 py-2 align-top">
        <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-[0.70rem] font-bold ${typeBg}">
          <i class="fa-solid ${typeIcon} text-[0.70rem]"></i>
          <span>${action.type || 'N/A'}</span>
        </span>
      </td>

      <!-- Severity (with icon) -->
      <td class="px-3 py-2 align-top">
        <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-[0.70rem] font-bold ${severityBg}">
          <i class="fa-solid ${severityIcon} text-[0.70rem]"></i>
          <span>${action.severity || 'N/A'}</span>
        </span>
      </td>

      <!-- Issued By -->
      <td class="px-3 py-2 text-slate-700 align-top">
        ${action.manager_signature || action.hr_signature || 'System'}
      </td>

      <!-- Department -->
      <td class="px-3 py-2 text-slate-600 align-top">
        ${action.department || '--'}
      </td>
    `;
    
    // Click row ‚Üí open modal
    row.addEventListener('click', (e) => {
      e.stopPropagation();
      console.log('üñ±Ô∏è Row clicked, opening modal for:', action.employeeName);
      showWarningDetailModal(action);
    });
    
    tbody.appendChild(row);
  });

  console.log(`‚úÖ Rendered ${allActions.length} actions in dashboard table`);
}

// ========================================================================
// MODAL FUNCTIONS - EDITABLE VERSION
// ========================================================================

// Show modal with action data (FAST VERSION - no database calls)
function showWarningDetailModal(action) {
  console.log('üéØ Opening modal for action:', action);
  
  const modal = document.getElementById('warning-detail-modal');
  if (!modal) {
    console.error('‚ùå Modal element not found!');
    return;
  }
  
  // Store IDs for save operation
  document.getElementById('modal-action-employee-id').value = action.employeeId;
  document.getElementById('modal-action-index').value = action.originalIndex || 0;
  
  // Populate read-only employee info
  document.getElementById('modal-employee-name').textContent = action.employeeName;
  document.getElementById('modal-employee-id').textContent = action.employeeNumber || 'N/A';
  document.getElementById('modal-employee-dept').textContent = action.department;
  
  // ‚úÖ POPULATE WARNING COUNTERS
  const employee = AppState.employees.find(e => e.id === action.employeeId);
  if (employee) {
    document.getElementById('modal-verbal-count').textContent = employee.verbal_warning_count || 0;
    document.getElementById('modal-written-count').textContent = employee.disciplinary_warning_count || 0;
    document.getElementById('modal-final-count').textContent = employee.final_warning_count || 0;
    document.getElementById('modal-termination-count').textContent = employee.termination_letter_count || 0;
  }
  
  // Populate editable fields
  const actionType = action.type?.toUpperCase().replace(/\s+/g, '_') || 'VERBAL_WARNING';
  document.getElementById('modal-edit-type').value = actionType;
  
  document.getElementById('modal-edit-severity').value = action.severity || 'MEDIUM';
  
  // Fix date format
  let dateValue = '';
  if (action.date) {
    const d = new Date(action.date);
    if (!isNaN(d.getTime())) {
      dateValue = d.toISOString().split('T')[0];
    }
  }
  document.getElementById('modal-edit-date').value = dateValue;
  
  // ‚úÖ Populate category fields
  document.getElementById('modal-edit-main-category').value = action.main_category || '';
  
  // Trigger sub-category population
  const mainCategoryDropdown = document.getElementById('modal-edit-main-category');
  const event = new Event('change');
  mainCategoryDropdown.dispatchEvent(event);
  
  // Set sub-category after options are loaded
  setTimeout(() => {
    document.getElementById('modal-edit-sub-category').value = action.sub_category || '';
  }, 10);
  
  document.getElementById('modal-edit-reason').value = action.reason || '';
  document.getElementById('modal-edit-plan').value = action.corrective_plan || '';
  document.getElementById('modal-edit-manager-sig').value = action.manager_signature || '';
  document.getElementById('modal-edit-hr-sig').value = action.hr_signature || '';
  document.getElementById('modal-edit-employee-sig').value = action.employee_signature || '';
  
  // Show modal
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  
  console.log('‚úÖ Modal opened successfully');
}



// Close modal
function closeWarningModal() {
  const modal = document.getElementById('warning-detail-modal');
  if (modal) {
    modal.classList.add('hidden');
    document.body.style.overflow = '';
  }
}

// Save updated action to database
async function saveWarningModal() {
  const employeeId = document.getElementById('modal-action-employee-id').value;
  const actionIndex = parseInt(document.getElementById('modal-action-index').value);
  
  if (!employeeId) {
    showToast('Error: No employee ID found', 'error');
    return;
  }

  const saveBtn = document.getElementById('modal-save-btn');
  saveBtn.disabled = true;
  saveBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Saving...';

  try {
    // Get current employee data
    const { data: employee, error: fetchError } = await supabaseClient
      .from('employees2025')
      .select('*')
      .eq('id', employeeId)
      .single();

    if (fetchError) throw fetchError;

 // Get updated values from form
const updatedAction = {
  type: document.getElementById('modal-edit-type').value.replace(/_/g, ' '),
  date: document.getElementById('modal-edit-date').value,
  severity: document.getElementById('modal-edit-severity').value,
  main_category: document.getElementById('modal-edit-main-category').value,  // ‚Üê ADD
  sub_category: document.getElementById('modal-edit-sub-category').value,    // ‚Üê ADD
  reason: document.getElementById('modal-edit-reason').value,
  corrective_plan: document.getElementById('modal-edit-plan').value,
  manager_signature: document.getElementById('modal-edit-manager-sig').value,
  hr_signature: document.getElementById('modal-edit-hr-sig').value,
  employee_signature: document.getElementById('modal-edit-employee-sig').value,
  timestamp: employee.discipline_history?.[actionIndex]?.timestamp || new Date().toISOString()
};
    // Update the specific action in history array
    const history = [...(employee.discipline_history || [])];
    if (actionIndex >= 0 && actionIndex < history.length) {
      history[actionIndex] = updatedAction;
    }

    // Update database
    const { error: updateError } = await supabaseClient
      .from('employees2025')
      .update({
        discipline_history: history,
        last_disciplinary_action: history[history.length - 1]
      })
      .eq('id', employeeId);

    if (updateError) throw updateError;

    showToast('‚úÖ Action updated successfully!', 'success');
    closeWarningModal();
    
    // Reload data and refresh display
    await loadEmployees();
    populateDashboardDisciplineList();

  } catch (error) {
    console.error('Error saving action:', error);
    showToast('‚ùå Failed to save changes', 'error');
  } finally {
    saveBtn.disabled = false;
    saveBtn.innerHTML = '<i class="fa-solid fa-floppy-disk"></i> Save Changes';
  }
}

// Delete action from database
async function deleteWarningModal() {
  if (!confirm('Are you sure you want to delete this disciplinary action? This cannot be undone.')) {
    return;
  }

  const employeeId = document.getElementById('modal-action-employee-id').value;
  const actionIndex = parseInt(document.getElementById('modal-action-index').value);
  
  if (!employeeId) {
    showToast('Error: No employee ID found', 'error');
    return;
  }

  const deleteBtn = document.getElementById('modal-delete-btn');
  deleteBtn.disabled = true;
  deleteBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Deleting...';

  try {
    // Get current employee data
    const { data: employee, error: fetchError } = await supabaseClient
      .from('employees2025')
      .select('*')
      .eq('id', employeeId)
      .single();

    if (fetchError) throw fetchError;

    // Remove action from history
    const history = [...(employee.discipline_history || [])];
    history.splice(actionIndex, 1);

    // Recalculate counts
    const counts = {
      verbal_warning_count: 0,
      disciplinary_warning_count: 0,
      final_warning_count: 0,
      termination_letter_count: 0
    };

    history.forEach(action => {
      const type = action.type.toUpperCase();
      if (type.includes('VERBAL')) counts.verbal_warning_count++;
      else if (type.includes('WRITTEN')) counts.disciplinary_warning_count++;
      else if (type.includes('FINAL')) counts.final_warning_count++;
      else if (type.includes('TERMINATION')) counts.termination_letter_count++;
    });

    // Update database
    const { error: updateError } = await supabaseClient
      .from('employees2025')
      .update({
        discipline_history: history,
        last_disciplinary_action: history.length > 0 ? history[history.length - 1] : null,
        ...counts
      })
      .eq('id', employeeId);

    if (updateError) throw updateError;

    showToast('‚úÖ Action deleted successfully', 'success');
    closeWarningModal();
    
    // Reload data
    await loadEmployees();
    populateDashboardDisciplineList();

  } catch (error) {
    console.error('Error deleting action:', error);
    showToast('‚ùå Failed to delete action', 'error');
  } finally {
    deleteBtn.disabled = false;
    deleteBtn.innerHTML = '<i class="fa-solid fa-trash"></i> Delete Action';
  }
}

// Generate PDF from modal data
function generateWarningPDF() {
  const action = {
    employeeName: document.getElementById('modal-employee-name').textContent,
    employeeNumber: document.getElementById('modal-employee-id').textContent,
    department: document.getElementById('modal-employee-dept').textContent,
    type: document.getElementById('modal-edit-type').value.replace(/_/g, ' '),
    date: document.getElementById('modal-edit-date').value,
    severity: document.getElementById('modal-edit-severity').value,
    reference: document.getElementById('modal-edit-reference').value,
    reason: document.getElementById('modal-edit-reason').value,
    corrective_plan: document.getElementById('modal-edit-plan').value,
    manager_signature: document.getElementById('modal-edit-manager-sig').value,
    hr_signature: document.getElementById('modal-edit-hr-sig').value,
    employee_signature: document.getElementById('modal-edit-employee-sig').value
  };

  const actionDate = new Date(action.date);
  const dateStr = actionDate.toLocaleDateString('en-US', { 
    month: 'long', 
    day: 'numeric', 
    year: 'numeric' 
  });
  
  const content = `
    <div style="font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto;">
      <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #7a1f1f; padding-bottom: 20px;">
        <h1 style="color: #7a1f1f; margin: 0;">Jeng Chi Restaurant</h1>
        <h2 style="color: #666; margin: 10px 0 0 0;">Disciplinary Action Form</h2>
      </div>
      
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0; color: #333;">Employee Information</h3>
        <p><strong>Name:</strong> ${action.employeeName}</p>
        <p><strong>Employee ID:</strong> ${action.employeeNumber}</p>
        <p><strong>Department:</strong> ${action.department}</p>
      </div>
      
      <div style="margin-bottom: 20px;">
        <h3 style="color: #333;">Action Details</h3>
        <p><strong>Action Type:</strong> ${action.type}</p>
        <p><strong>Date:</strong> ${dateStr}</p>
        <p><strong>Severity:</strong> ${action.severity}</p>
        <p><strong>Reference:</strong> ${action.reference || 'N/A'}</p>
      </div>
      
      <div style="margin-bottom: 20px;">
        <h3 style="color: #333;">Reason for Action</h3>
        <p style="white-space: pre-wrap;">${action.reason || 'No reason provided'}</p>
      </div>
      
      ${action.corrective_plan ? `
      <div style="margin-bottom: 20px;">
        <h3 style="color: #333;">Corrective Action Plan</h3>
        <p style="white-space: pre-wrap;">${action.corrective_plan}</p>
      </div>
      ` : ''}
      
      <div style="margin-top: 40px; border-top: 2px solid #ddd; padding-top: 20px;">
        <h3 style="color: #333;">Signatures</h3>
        <p><strong>Manager:</strong> ${action.manager_signature || 'N/A'}</p>
        <p><strong>HR:</strong> ${action.hr_signature || 'N/A'}</p>
        <p><strong>Employee:</strong> ${action.employee_signature || 'N/A'}</p>
      </div>
    </div>
  `;

  const element = document.createElement('div');
  element.innerHTML = content;
  
  html2pdf()
    .from(element)
    .set({
      margin: 0.5,
      filename: `warning-${action.employeeNumber}-${action.date}.pdf`,
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    })
    .save();
}



// ========================================================================
// CATEGORY SYSTEM - SUB-CATEGORIES BASED ON MAIN CATEGORY
// ========================================================================
const DISCIPLINE_CATEGORIES = {
  attendance: [
    { value: 'late', label: 'Late Arrival' },
    { value: 'early-leave', label: 'Early Departure' },
    { value: 'no-call-no-show', label: 'No Call / No Show' },
    { value: 'excessive-absences', label: 'Excessive Absences' },
    { value: 'unapproved-absence', label: 'Unapproved Absence' },
    { value: 'break-violation', label: 'Extended Breaks' }
  ],
  performance: [
    { value: 'quality', label: 'Work Quality Below Standard' },
    { value: 'productivity', label: 'Low Productivity' },
    { value: 'missed-deadline', label: 'Missed Deadlines' },
    { value: 'failure-to-follow', label: 'Failure to Follow Instructions' },
    { value: 'incomplete-tasks', label: 'Incomplete Tasks' }
  ],
  conduct: [
    { value: 'unprofessional', label: 'Unprofessional Behavior' },
    { value: 'disrespectful', label: 'Disrespectful to Staff/Management' },
    { value: 'inappropriate-language', label: 'Inappropriate Language' },
    { value: 'conflict', label: 'Conflict with Coworkers' },
    { value: 'insubordination', label: 'Insubordination' },
    { value: 'horseplay', label: 'Horseplay / Roughhousing' }
  ],
  policy: [
    { value: 'uniform', label: 'Uniform Violation' },
    { value: 'cell-phone', label: 'Cell Phone / Earbuds Use' },
    { value: 'eating-drinking', label: 'Eating/Drinking in Wrong Area' },
    { value: 'smoking', label: 'Smoking/Vaping Violation' },
    { value: 'unauthorized-discount', label: 'Unauthorized Discount/Comp' },
    { value: 'confidentiality', label: 'Confidentiality Breach' },
    { value: 'social-media', label: 'Social Media Policy Violation' }
  ],
  safety: [
    { value: 'food-safety', label: 'Food Safety Violation' },
    { value: 'sanitation', label: 'Sanitation/Cleanliness Issue' },
    { value: 'unsafe-practice', label: 'Unsafe Work Practice' },
    { value: 'equipment-misuse', label: 'Equipment Misuse' },
    { value: 'injury-report', label: 'Failure to Report Injury' }
  ],
  customer: [
    { value: 'rude-to-guest', label: 'Rude to Guest' },
    { value: 'poor-service', label: 'Poor Service Quality' },
    { value: 'order-error', label: 'Repeated Order Errors' },
    { value: 'complaint', label: 'Guest Complaint' },
    { value: 'refusal-to-serve', label: 'Refusal to Serve Guest' }
  ],
  integrity: [
    { value: 'theft', label: 'Theft' },
    { value: 'dishonesty', label: 'Dishonesty / Lying' },
    { value: 'timecard-fraud', label: 'Timecard Fraud' },
    { value: 'tip-theft', label: 'Tip Theft / Manipulation' },
    { value: 'falsifying-records', label: 'Falsifying Records' }
  ]
};





// Attach modal event listeners (call this in bootstrap)
function setupModalEventListeners() {
  console.log('üéØ Setting up modal event listeners...');
  setupCategoryDropdowns();
  
  const closeBtn = document.getElementById('close-warning-modal');
  const closeBtnFooter = document.getElementById('modal-close-btn');
  const saveBtn = document.getElementById('modal-save-btn');
  const deleteBtn = document.getElementById('modal-delete-btn');
  const exportBtn = document.getElementById('modal-export-pdf');
  
  
  if (closeBtn) {
    closeBtn.addEventListener('click', closeWarningModal);
    console.log('‚úÖ Close button (X) listener attached');
  }
  
  if (closeBtnFooter) {
    closeBtnFooter.addEventListener('click', closeWarningModal);
    console.log('‚úÖ Cancel button listener attached');
  }
  
  if (saveBtn) {
    saveBtn.addEventListener('click', saveWarningModal);
    console.log('‚úÖ Save button listener attached');
  } else {
    console.error('‚ùå Save button NOT FOUND!');
  }
  
  if (deleteBtn) {
    deleteBtn.addEventListener('click', deleteWarningModal);
    console.log('‚úÖ Delete button listener attached');
  }
  
  if (exportBtn) {
    exportBtn.addEventListener('click', generateWarningPDF);
    console.log('‚úÖ Export PDF button listener attached');
  }
  
  // Close on background click
  const modal = document.getElementById('warning-detail-modal');
  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeWarningModal();
      }
    });
    console.log('‚úÖ Background click listener attached');
  }
}

// ========================================================================
// CATEGORY SYSTEM - SUB-CATEGORIES BASED ON MAIN CATEGORY
// ========================================================================


// Setup dynamic sub-category dropdown
function setupCategoryDropdowns() {
  const mainCategory = document.getElementById('modal-edit-main-category');
  const subCategory = document.getElementById('modal-edit-sub-category');
  
  if (!mainCategory || !subCategory) return;
  
  mainCategory.addEventListener('change', (e) => {
    const category = e.target.value;
    subCategory.innerHTML = '<option value="">Select sub-category...</option>';
    
    if (category && DISCIPLINE_CATEGORIES[category]) {
      DISCIPLINE_CATEGORIES[category].forEach(sub => {
        const option = document.createElement('option');
        option.value = sub.value;
        option.textContent = sub.label;
        subCategory.appendChild(option);
      });
      subCategory.disabled = false;
    } else {
      subCategory.disabled = true;
      subCategory.innerHTML = '<option value="">Select main category first...</option>';
    }
  });
}




    function generate12MonthChart() {
  const canvas = document.getElementById('discipline-trend-chart');
  if (!canvas) return;

  const ctx = canvas.getContext('2d');
  
  if (AppState.charts.disciplineTrend) {
    AppState.charts.disciplineTrend.destroy();
  }

  const months = [];
  const now = new Date();
  for (let i = 11; i >= 0; i--) {
    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
    months.push(d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' }));
  }

  const datasets = [
    { 
      label: 'Verbal Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#10b981',
      backgroundColor: 'rgba(16, 185, 129, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#10b981',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Written Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#f59e0b',
      backgroundColor: 'rgba(245, 158, 11, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#f59e0b',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Final Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#ef4444',
      backgroundColor: 'rgba(239, 68, 68, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#ef4444',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Terminations', 
      data: new Array(12).fill(0), 
      borderColor: '#991b1b',
      backgroundColor: 'rgba(153, 27, 27, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#991b1b',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      tension: 0.4,
      fill: true
    }
  ];

  // Try to get data from discipline_history
  let hasHistoryData = false;
  AppState.employees.forEach(emp => {
    if (emp.discipline_history && Array.isArray(emp.discipline_history) && emp.discipline_history.length > 0) {
      emp.discipline_history.forEach(action => {
        hasHistoryData = true;
        const actionDate = new Date(action.date);
        const monthStr = actionDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
        const monthIndex = months.indexOf(monthStr);
        
        if (monthIndex >= 0) {
          const actionType = action.type.toUpperCase().replace(/\s+/g, '_');
          switch (actionType) {
            case 'VERBAL_WARNING':
              datasets[0].data[monthIndex]++; 
              break;
            case 'WRITTEN_WARNING':
              datasets[1].data[monthIndex]++; 
              break;
            case 'FINAL_WARNING':
              datasets[2].data[monthIndex]++; 
              break;
            case 'TERMINATION':
              datasets[3].data[monthIndex]++; 
              break;
          }
        }
      });
    }
  });

  // If no history data, aggregate current counts in current month
  if (!hasHistoryData) {
    const currentMonthIndex = 11; // Last month in array
    let totalVerbal = 0, totalWritten = 0, totalFinal = 0, totalTermination = 0;
    
    AppState.employees.forEach(emp => {
      totalVerbal += emp.verbal_warning_count || 0;
      totalWritten += emp.disciplinary_warning_count || 0;
      totalFinal += emp.final_warning_count || 0;
      totalTermination += emp.termination_letter_count || 0;
    });
    
    datasets[0].data[currentMonthIndex] = totalVerbal;
    datasets[1].data[currentMonthIndex] = totalWritten;
    datasets[2].data[currentMonthIndex] = totalFinal;
    datasets[3].data[currentMonthIndex] = totalTermination;
    
    console.log('üìä Chart Data (Current Month):', {
      verbal: totalVerbal,
      written: totalWritten,
      final: totalFinal,
      termination: totalTermination
    });
  }

  AppState.charts.disciplineTrend = new Chart(ctx, {
    type: 'line',
    data: { labels: months, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      plugins: {
        legend: { 
          display: true, 
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 13,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#334155'
          }
        },
        tooltip: { 
          enabled: true,
          mode: 'index', 
          intersect: false,
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: {
            size: 14,
            weight: 'bold',
            family: "'Inter', sans-serif"
          },
          bodyFont: {
            size: 13,
            weight: 'bold',
            family: "'Inter', sans-serif"
          },
          titleColor: '#fff',
          bodyColor: '#fff',
          borderColor: 'rgba(255, 255, 255, 0.2)',
          borderWidth: 1
        }
      },
      scales: {
        y: { 
          beginAtZero: true,
          ticks: { 
            stepSize: 1,
            font: {
              size: 12,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#64748b',
            padding: 8
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.06)',
            drawBorder: false
          },
          title: {
            display: true,
            text: 'Number of Actions',
            font: {
              size: 13,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#334155'
          }
        },
        x: {
          grid: {
            display: false,
            drawBorder: false
          },
          ticks: {
            font: {
              size: 11,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#64748b',
            maxRotation: 45,
            minRotation: 45
          }
        }
      }
    }
  });
}

function generateYearlyChart() {
  const canvas = document.getElementById('discipline-trend-chart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  
  if (AppState.charts.disciplineTrend) {
    AppState.charts.disciplineTrend.destroy();
  }

  const currentYear = new Date().getFullYear();
  const years = [currentYear - 4, currentYear - 3, currentYear - 2, currentYear - 1, currentYear].map(String);
  
  const datasets = [
    { 
      label: 'Verbal Warnings', 
      data: [0, 0, 0, 0, 0], 
      backgroundColor: '#10b981',
      borderColor: '#10b981',
      borderWidth: 2
    },
    { 
      label: 'Written Warnings', 
      data: [0, 0, 0, 0, 0], 
      backgroundColor: '#f59e0b',
      borderColor: '#f59e0b',
      borderWidth: 2
    },
    { 
      label: 'Final Warnings', 
      data: [0, 0, 0, 0, 0], 
      backgroundColor: '#ef4444',
      borderColor: '#ef4444',
      borderWidth: 2
    },
    { 
      label: 'Terminations', 
      data: [0, 0, 0, 0, 0], 
      backgroundColor: '#991b1b',
      borderColor: '#991b1b',
      borderWidth: 2
    }
  ];

  // Try to get data from history
  let hasData = false;
  AppState.employees.forEach(emp => {
    if (emp.discipline_history && Array.isArray(emp.discipline_history)) {
      emp.discipline_history.forEach(action => {
        hasData = true;
        const year = new Date(action.date).getFullYear().toString();
        const yearIndex = years.indexOf(year);
        if (yearIndex >= 0) {
          const actionType = action.type.toUpperCase().replace(/\s+/g, '_');
          switch (actionType) {
            case 'VERBAL_WARNING': datasets[0].data[yearIndex]++; break;
            case 'WRITTEN_WARNING': datasets[1].data[yearIndex]++; break;
            case 'FINAL_WARNING': datasets[2].data[yearIndex]++; break;
            case 'TERMINATION': datasets[3].data[yearIndex]++; break;
          }
        }
      });
    }
  });

  // If no history, put current totals in current year
  if (!hasData) {
    const currentYearIndex = 4;
    let totalVerbal = 0, totalWritten = 0, totalFinal = 0, totalTermination = 0;
    
    AppState.employees.forEach(emp => {
      totalVerbal += emp.verbal_warning_count || 0;
      totalWritten += emp.disciplinary_warning_count || 0;
      totalFinal += emp.final_warning_count || 0;
      totalTermination += emp.termination_letter_count || 0;
    });
    
    datasets[0].data[currentYearIndex] = totalVerbal;
    datasets[1].data[currentYearIndex] = totalWritten;
    datasets[2].data[currentYearIndex] = totalFinal;
    datasets[3].data[currentYearIndex] = totalTermination;
  }

  AppState.charts.disciplineTrend = new Chart(ctx, {
    type: 'bar',
    data: { labels: years, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { 
        legend: { 
          display: true, 
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 13,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#334155'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: {
            size: 14,
            weight: 'bold'
          },
          bodyFont: {
            size: 13,
            weight: 'bold'
          }
        }
      },
      scales: { 
        y: { 
          beginAtZero: true,
          ticks: { 
            stepSize: 1,
            font: {
              size: 12,
              weight: 'bold'
            },
            color: '#64748b'
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.06)'
          }
        },
        x: {
          grid: {
            display: false
          },
          ticks: {
            font: {
              size: 12,
              weight: 'bold'
            },
            color: '#64748b'
          }
        }
      }
    }
  });
}

function generateWeeklyChart() {
  const canvas = document.getElementById('discipline-trend-chart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  
  if (AppState.charts.disciplineTrend) {
    AppState.charts.disciplineTrend.destroy();
  }

  const weeks = [];
  for (let i = 1; i <= 12; i++) {
    weeks.push(`Week ${i}`);
  }

  const datasets = [
    { 
      label: 'Verbal Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#10b981',
      backgroundColor: 'rgba(16, 185, 129, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#10b981',
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Written Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#f59e0b',
      backgroundColor: 'rgba(245, 158, 11, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#f59e0b',
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Final Warnings', 
      data: new Array(12).fill(0), 
      borderColor: '#ef4444',
      backgroundColor: 'rgba(239, 68, 68, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#ef4444',
      tension: 0.4,
      fill: true
    },
    { 
      label: 'Terminations', 
      data: new Array(12).fill(0), 
      borderColor: '#991b1b',
      backgroundColor: 'rgba(153, 27, 27, 0.2)',
      borderWidth: 3,
      pointRadius: 5,
      pointHoverRadius: 7,
      pointBackgroundColor: '#991b1b',
      tension: 0.4,
      fill: true
    }
  ];

  // Put current totals in last week if no history
  const lastWeekIndex = 11;
  let totalVerbal = 0, totalWritten = 0, totalFinal = 0, totalTermination = 0;
  
  AppState.employees.forEach(emp => {
    totalVerbal += emp.verbal_warning_count || 0;
    totalWritten += emp.disciplinary_warning_count || 0;
    totalFinal += emp.final_warning_count || 0;
    totalTermination += emp.termination_letter_count || 0;
  });
  
  datasets[0].data[lastWeekIndex] = totalVerbal;
  datasets[1].data[lastWeekIndex] = totalWritten;
  datasets[2].data[lastWeekIndex] = totalFinal;
  datasets[3].data[lastWeekIndex] = totalTermination;

  AppState.charts.disciplineTrend = new Chart(ctx, {
    type: 'line',
    data: { labels: weeks, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { 
        legend: { 
          display: true, 
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: {
              size: 13,
              weight: 'bold',
              family: "'Inter', sans-serif"
            },
            color: '#334155'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: {
            size: 14,
            weight: 'bold'
          },
          bodyFont: {
            size: 13,
            weight: 'bold'
          }
        }
      },
      scales: { 
        y: { 
          beginAtZero: true,
          ticks: { 
            stepSize: 1,
            font: {
              size: 12,
              weight: 'bold'
            },
            color: '#64748b'
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.06)'
          }
        },
        x: {
          grid: {
            display: false
          },
          ticks: {
            font: {
              size: 11,
              weight: 'bold'
            },
            color: '#64748b'
          }
        }
      }
    }
  });
}

      // ========================================================================
      // DISCIPLINE CASES TAB FUNCTIONS
      // ========================================================================
      
      function setupAutocomplete(inputId, dropdownId, tabName) {
        const input = document.getElementById(inputId);
        const dropdown = document.getElementById(dropdownId);
        if (!input || !dropdown) return;

        input.addEventListener('input', (e) => {
          const query = e.target.value.trim();
          const state = AutocompleteState[tabName];
          
          clearTimeout(state.searchTimeout);
          
          if (query.length < 3) {
            dropdown.classList.add('hidden');
            dropdown.innerHTML = '';
            return;
          }

          state.searchTimeout = setTimeout(() => {
            const results = AppState.employees.filter(emp => {
              const fullName = `${emp.first_name} ${emp.last_name}`.toLowerCase();
              const empId = (emp.employee_id || '').toLowerCase();
              const dept = (emp.department || '').toLowerCase();
              return fullName.includes(query.toLowerCase()) || 
                     empId.includes(query.toLowerCase()) || 
                     dept.includes(query.toLowerCase());
            }).slice(0, 10);

            dropdown.innerHTML = '';
            
            if (results.length === 0) {
              dropdown.innerHTML = '<div class="px-3 py-2 text-xs text-slate-400">No employees found</div>';
            } else {
              results.forEach(emp => {
                const item = document.createElement('div');
                item.className = 'px-3 py-2 hover:bg-slate-50 cursor-pointer text-xs';
                item.innerHTML = `
                  <div class="font-bold text-slate-900">${emp.first_name} ${emp.last_name}</div>
                  <div class="text-slate-500 text-[0.70rem]">${emp.employee_id || '--'} &bull; ${emp.department || '--'}</div>
                `;
                item.addEventListener('click', () => {
                  input.value = `${emp.first_name} ${emp.last_name}`;
                  dropdown.classList.add('hidden');
                  selectEmployee(emp, tabName);
                });
                dropdown.appendChild(item);
              });
            }
            
            dropdown.classList.remove('hidden');
          }, 300);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
          if (!input.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
          }
        });
      }

      function selectEmployee(employee, context = 'discipline') {
        if (context === 'discipline') {
          AppState.selectedEmployee = employee;
          
          // Update hidden field
          document.getElementById('discipline-employee-id').value = employee.id;
          
          // Update selected employee chip
          const chip = document.getElementById('discipline-selected-employee-chip');
          chip.innerHTML = `
            <span class="font-bold">${employee.first_name} ${employee.last_name}</span>
            <span class="text-slate-500">&bull;</span>
            <span>${employee.department || '--'}</span>
          `;
          chip.classList.remove('hidden');
          
          // Render discipline history
          renderDisciplineHistory(employee);
          renderAuditTrail(employee);
        } else if (context === 'employees') {
          loadEmployee360(employee);
        }
      }

      function renderDisciplineHistory(employee) {
        const container = document.getElementById('discipline-history-timeline');
        if (!container) return;

        container.innerHTML = '';
        
        if (!employee.discipline_history || employee.discipline_history.length === 0) {
          container.innerHTML = '<p class="text-xs text-slate-400">No discipline history recorded for this employee.</p>';
          return;
        }

        const history = [...employee.discipline_history].sort((a, b) => new Date(b.date) - new Date(a.date));

        history.forEach((action, index) => {
          const item = document.createElement('div');
          item.className = 'timeline-item relative pl-6 pb-6';
          if (index === history.length - 1) item.classList.remove('pb-6');
          
          let iconBg = 'bg-slate-400';
          if (action.type === 'Verbal Warning') iconBg = 'bg-emerald-400';
          if (action.type === 'Written Warning') iconBg = 'bg-amber-400';
          if (action.type === 'Final Warning') iconBg = 'bg-rose-400';
          if (action.type === 'Termination') iconBg = 'bg-rose-600';
          
          item.innerHTML = `
            <div class="absolute left-0 top-1 w-3 h-3 rounded-full ${iconBg} border-2 border-white"></div>
            <div class="text-xs">
              <p class="font-bold text-slate-900">${action.type}</p>
              <p class="text-[0.70rem] text-slate-500">${formatDate(action.date)}</p>
              <p class="text-[0.70rem] text-slate-600 mt-1">${action.reason || 'No reason provided'}</p>
              ${action.reference ? `<p class="text-[0.65rem] text-slate-400 mt-0.5">Ref: ${action.reference}</p>` : ''}
            </div>
          `;
          container.appendChild(item);
        });
      }

      function renderAuditTrail(employee) {
        const tbody = document.getElementById('discipline-audit-table-body');
        if (!tbody) return;

        tbody.innerHTML = '';
        
        if (!employee.discipline_history || employee.discipline_history.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="px-3 py-4 text-center text-slate-400 text-xs">No audit trail available</td></tr>';
          return;
        }

        const history = [...employee.discipline_history].sort((a, b) => new Date(b.date) - new Date(a.date));

        history.forEach(action => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="px-3 py-2 text-slate-600">${formatDate(action.date)}</td>
            <td class="px-3 py-2 text-slate-900 font-medium">${action.type}</td>
            <td class="px-3 py-2 text-slate-600">${action.severity || '--'}</td>
            <td class="px-3 py-2 text-slate-600">${action.manager_signature || '--'}</td>
            <td class="px-3 py-2 text-slate-600">${action.reference || '--'}</td>
          `;
          tbody.appendChild(row);
        });
      }

      async function handleDisciplineSubmit(event) {
  event.preventDefault();
  
  const employeeId = document.getElementById('discipline-employee-id').value;
  if (!employeeId) {
    showToast('Please select an employee first', 'error');
    return;
  }

  const submitBtn = document.getElementById('discipline-form-submit');
  const submitSpinner = document.getElementById('discipline-form-submit-spinner');
  const submitText = document.getElementById('discipline-form-submit-text');
  
  submitBtn.disabled = true;
  submitSpinner.classList.remove('hidden');
  submitText.textContent = 'Submitting...';

  try {
    // Collect form data
    const actionType = document.getElementById('discipline-action-type').value;
    const actionDate = document.getElementById('discipline-action-date').value;
    const severity = document.getElementById('discipline-severity').value;
    const mainCategory = document.getElementById('discipline-main-category').value;  // ‚≠ê NEW
    const subCategory = document.getElementById('discipline-sub-category').value;    // ‚≠ê NEW
    const reference = document.getElementById('discipline-reference').value;
    const reason = document.getElementById('discipline-reason').value;
    const plan = document.getElementById('discipline-plan').value;
    const managerSig = document.getElementById('discipline-manager-signature').value;
    const hrSig = document.getElementById('discipline-hr-signature').value;
    const empSig = document.getElementById('discipline-employee-signature').value;
    const empDeclined = document.getElementById('discipline-employee-declined').checked;

    // Validate required fields
    if (!mainCategory || !subCategory) {
      showToast('Please select both main category and sub-category', 'error');
      submitBtn.disabled = false;
      submitSpinner.classList.add('hidden');
      submitText.textContent = 'Record Action & Generate PDF';
      return;
    }

    // Create action object
    const newAction = {
      type: actionType,
      date: actionDate,
      severity,
      main_category: mainCategory,      // ‚≠ê NEW
      sub_category: subCategory,        // ‚≠ê NEW
      reference,
      reason,
      corrective_plan: plan,
      manager_signature: managerSig,
      hr_signature: hrSig,
      employee_signature: empDeclined ? 'DECLINED' : empSig,
      timestamp: new Date().toISOString()
    };

    console.log('üìù Submitting discipline action:', newAction);

    // Get current employee data
    const { data: currentEmp, error: fetchError } = await supabaseClient
      .from('employees2025')
      .select('*')
      .eq('id', employeeId)
      .single();

    if (fetchError) throw fetchError;

    // Update warning counts based on action type
    const updates = { last_disciplinary_action: newAction };
    
    if (actionType === 'VERBAL_WARNING') {
      updates.verbal_warning_count = (currentEmp.verbal_warning_count || 0) + 1;
    } else if (actionType === 'WRITTEN_WARNING') {
      updates.disciplinary_warning_count = (currentEmp.disciplinary_warning_count || 0) + 1;
    } else if (actionType === 'FINAL_WARNING') {
      updates.final_warning_count = (currentEmp.final_warning_count || 0) + 1;
    } else if (actionType === 'TERMINATION') {
      updates.termination_letter_count = (currentEmp.termination_letter_count || 0) + 1;
      updates.employment_status = 'Terminated';
      updates.termination_status = 'Complete';
    }

    // Add to discipline history
    const history = currentEmp.discipline_history || [];
    history.push(newAction);
    updates.discipline_history = history;

    // Recalculate risk score
    const { points } = AppState.settings;
    const newScore = 
      (updates.verbal_warning_count || currentEmp.verbal_warning_count || 0) * points.verbal +
      (updates.disciplinary_warning_count || currentEmp.disciplinary_warning_count || 0) * points.written +
      (updates.final_warning_count || currentEmp.final_warning_count || 0) * points.final +
      (updates.termination_letter_count || currentEmp.termination_letter_count || 0) * points.termination;
    
    updates.risk_score = newScore;
    updates.risk_level = getRiskLevel(newScore);

    // Save to database
    console.log('üíæ Updating database...');
    const { error: updateError } = await supabaseClient
      .from('employees2025')
      .update(updates)
      .eq('id', employeeId);

    if (updateError) throw updateError;

    console.log('‚úÖ Discipline action saved successfully');
    showToast('‚úÖ Discipline action recorded successfully!', 'success');
    
    // Reset form
    document.getElementById('discipline-form').reset();
    document.getElementById('discipline-selected-employee-chip').classList.add('hidden');
    document.getElementById('discipline-sub-category').disabled = true;
    document.getElementById('discipline-sub-category').innerHTML = '<option value="">Select main category first...</option>';
    
    // Reload data and refresh display
    await loadEmployees();
    populateDashboardDisciplineList();
    
    // Generate PDF
    generateDisciplinePDF(currentEmp, newAction);

  } catch (error) {
    console.error('‚ùå Error submitting discipline action:', error);
    showToast('‚ùå Failed to submit discipline action: ' + error.message, 'error');
  } finally {
    submitBtn.disabled = false;
    submitSpinner.classList.add('hidden');
    submitText.textContent = 'Record Action & Generate PDF';
  }
}



      function generateDisciplinePDF(employee, action) {
        const content = `
          <div style="font-family: Arial, sans-serif; padding: 40px; max-width: 800px;">
            <div style="text-align: center; margin-bottom: 30px;">
              <h1 style="color: #7a1f1f; margin: 0;">Jeng Chi Restaurant</h1>
              <h2 style="color: #666; margin: 10px 0 0 0;">Disciplinary Action Form</h2>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
              <h3 style="margin-top: 0; color: #333;">Employee Information</h3>
              <p><strong>Name:</strong> ${employee.first_name} ${employee.last_name}</p>
              <p><strong>Employee ID:</strong> ${employee.employee_id || 'N/A'}</p>
              <p><strong>Department:</strong> ${employee.department || 'N/A'}</p>
              <p><strong>Position:</strong> ${employee.job_title || 'N/A'}</p>
            </div>
            
            <div style="margin-bottom: 20px;">
              <h3 style="color: #333;">Action Details</h3>
              <p><strong>Action Type:</strong> ${action.type}</p>
              <p><strong>Date:</strong> ${formatDate(action.date)}</p>
              <p><strong>Severity:</strong> ${action.severity}</p>
              <p><strong>Reference:</strong> ${action.reference || 'N/A'}</p>
            </div>
            
            <div style="margin-bottom: 20px;">
              <h3 style="color: #333;">Reason for Action</h3>
              <p style="white-space: pre-wrap;">${action.reason}</p>
            </div>
            
            ${action.corrective_plan ? `
            <div style="margin-bottom: 20px;">
              <h3 style="color: #333;">Corrective Action Plan</h3>
              <p style="white-space: pre-wrap;">${action.corrective_plan}</p>
            </div>
            ` : ''}
            
            <div style="margin-top: 40px; border-top: 2px solid #ddd; padding-top: 20px;">
              <h3 style="color: #333;">Signatures</h3>
              <p><strong>Manager:</strong> ${action.manager_signature || 'N/A'}</p>
              <p><strong>HR:</strong> ${action.hr_signature || 'N/A'}</p>
              <p><strong>Employee:</strong> ${action.employee_signature || 'N/A'}</p>
            </div>
          </div>
        `;

        const element = document.createElement('div');
        element.innerHTML = content;
        
        html2pdf()
          .from(element)
          .set({
            margin: 0.5,
            filename: `discipline-${employee.employee_id}-${action.date}.pdf`,
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
          })
          .save();
      }

      // ========================================================================
      // EMPLOYEES 360 TAB FUNCTIONS
      // ========================================================================
      
      function renderEmployeeList() {
        const container = document.getElementById('employee-list');
        if (!container) return;

        const filtered = filterEmployees(AppState.employeeFilterStatus);
        container.innerHTML = '';

        if (filtered.length === 0) {
          container.innerHTML = '<div class="text-xs text-slate-400 px-3 py-2">No employees match the current filter.</div>';
          return;
        }

        filtered.forEach(emp => {
          const score = computeRiskScore(emp);
          const level = getRiskLevel(score);
          const badgeClasses = getRiskBadgeClasses(level);
          
          const item = document.createElement('div');
          item.className = 'rounded-lg border border-slate-100 bg-slate-50 px-3 py-2 hover:bg-white hover:border-brand-200 cursor-pointer transition-all';
          item.innerHTML = `
            <div class="flex items-center justify-between gap-2">
              <div class="flex-1">
                <p class="font-bold text-slate-900 text-xs">${emp.first_name} ${emp.last_name}</p>
                <p class="text-[0.70rem] text-slate-500">${emp.employee_id || '--'}</p>
              </div>
              <span class="inline-flex items-center gap-1 rounded-full ${badgeClasses} border px-2 py-0.5 text-[0.65rem] font-medium">
                ${level}
              </span>
            </div>
          `;
          item.addEventListener('click', () => selectEmployee(emp, 'employees'));
          container.appendChild(item);
        });
      }

      function loadEmployee360(employee) {
  document.getElementById('current-employee-360-id').value = employee.id;
  AppState.selectedEmployee = employee;
  
  // Use enhanced profile population
  populateEmployeeProfileCard(employee);

        // Profile header
        document.getElementById('employee-profile-name').textContent = `${employee.first_name} ${employee.last_name}`;
        document.getElementById('employee-profile-title').textContent = `${employee.job_title || 'N/A'} ‚Ä¢ ${employee.department || 'N/A'}`;
        document.getElementById('employee-profile-status').textContent = `${employee.employment_status || 'N/A'} ‚Ä¢ Hired ${formatDate(employee.hire_date)} ‚Ä¢ Reports to ${employee.report_to || 'N/A'}`;
        





        // Risk badge
        const score = computeRiskScore(employee);
        const level = getRiskLevel(score);
        const badgeClasses = getRiskBadgeClasses(level);
        document.getElementById('employee-profile-risk-badge').className = `inline-flex items-center gap-2 rounded-full ${badgeClasses} border px-2 py-1 text-[0.70rem]`;
        document.getElementById('employee-profile-risk-badge').innerHTML = `
          <span class="w-1.5 h-1.5 rounded-full ${level === 'HIGH' ? 'bg-rose-500' : level === 'MEDIUM' ? 'bg-amber-500' : 'bg-emerald-500'}"></span>
          <span>Risk Score: ${score}</span>
        `;
        
        // IDs
        document.getElementById('employee-profile-employee-id').innerHTML = `<i class="fa-solid fa-hashtag text-[0.60rem]"></i><span>Employee ID: ${employee.employee_id || '--'}</span>`;
        document.getElementById('employee-profile-username').innerHTML = `<i class="fa-solid fa-user text-[0.60rem]"></i><span>Username: ${employee.username || '--'}</span>`;
        
        // KPIs
        document.getElementById('employee-kpi-verbal').textContent = employee.verbal_warning_count || 0;
        document.getElementById('employee-kpi-written').textContent = employee.disciplinary_warning_count || 0;
        document.getElementById('employee-kpi-final').textContent = employee.final_warning_count || 0;
        document.getElementById('employee-kpi-termination').textContent = employee.termination_letter_count || 0;

        // Editable fields
        document.getElementById('edit-employment-status').value = employee.employment_status || 'Active';
        document.getElementById('edit-first-name').value = employee.first_name || '';
        document.getElementById('edit-last-name').value = employee.last_name || '';
        document.getElementById('edit-job-title').value = employee.job_title || '';
     
        document.getElementById('edit-department').value = employee.department || '';
        document.getElementById('edit-report-to').value = employee.report_to || '';
        document.getElementById('edit-email').value = employee.email || '';
        document.getElementById('edit-phone').value = employee.phone || '';
        document.getElementById('edit-address-line-1').value = employee.address_line_1 || '';
        document.getElementById('edit-address-line-2').value = employee.address_line_2 || '';
        document.getElementById('edit-city').value = employee.city || '';
        document.getElementById('edit-state').value = employee.state || '';
        document.getElementById('edit-zip-code').value = employee.zip_code || '';
        document.getElementById('edit-original-hire-date').value = employee.original_hire_date || '';
        
        document.getElementById('edit-hourly-rate').value = employee.hourly_rate || '';
        document.getElementById('edit-annual-salary').value = employee.annual_salary || '';
        document.getElementById('edit-risk-level').value = employee.risk_level || 'LOW';
        document.getElementById('edit-hr-witness').value = employee.hr_witness || '';

        // Calculated fields
        document.getElementById('display-tenure').textContent = calculateTenure(employee.hire_date);
        document.getElementById('display-risk-score').textContent = score;
        document.getElementById('display-last-action').textContent = employee.last_disciplinary_action ? `${employee.last_disciplinary_action.type} on ${formatDate(employee.last_disciplinary_action.date)}` : 'None';

        // Summary
        const summaryContainer = document.getElementById('employee-summary-history');
        if (employee.discipline_history && employee.discipline_history.length > 0) {
          summaryContainer.innerHTML = `
            <p class="text-slate-700">
              ${employee.first_name} ${employee.last_name} has <strong>${employee.discipline_history.length} disciplinary action${employee.discipline_history.length > 1 ? 's' : ''}</strong> on record
              with a current risk score of <strong>${score}</strong> (${level} risk). 
              The most recent action was a <strong>${employee.last_disciplinary_action?.type || 'N/A'}</strong> 
              issued on <strong>${formatDate(employee.last_disciplinary_action?.date)}</strong>.
            </p>
          `;
        } else {
          summaryContainer.innerHTML = '<p class="text-slate-500">No disciplinary history on record for this employee.</p>';
        }
      }



      // ========================================================================
// ENHANCED EMPLOYEE PROFILE POPULATION
// ========================================================================
function populateEmployeeProfileCard(employee) {
  if (!employee) return;

 



  // --- Helpers ------------------------------------------------------
  const safe = (v, fallback = '') =>
    v === null || v === undefined ? fallback : v;

  const safeText = (id, value, fallback = '--') => {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = value !== undefined && value !== null && value !== ''
      ? value
      : fallback;
  };

  const safeValue = (id, value) => {
    const el = document.getElementById(id);
    if (!el) return;
    if (el.tagName === 'INPUT' || el.tagName === 'SELECT' || el.tagName === 'TEXTAREA') {
      if (el.type === 'date' && value) {
        el.value = value;
      } else {
        el.value = value ?? '';
      }
    } else {
      el.textContent = value ?? '';
    }
  };

// ‚úÖ NOW safe to call calculateTenure (assuming it's defined globally *before* this function)
  const tenureDisplayEl = document.getElementById('display-tenure');
  if (tenureDisplayEl) {
    tenureDisplayEl.textContent = calculateTenure(employee.hire_date);
  }


  // --- BASIC DERIVED FIELDS -----------------------------------------
  const fullName = `${safe(employee.first_name)} ${safe(employee.last_name)}`.trim() || 'Employee';
  const jobTitle = safe(employee.job_title || employee.position_title, 'N/A');
  const department = safe(employee.department, 'N/A');
  const employmentStatus = safe(employee.employment_status, 'Active');
  const hireDate = employee.hire_date || employee.original_hire_date || null;
  const reportsTo = safe(employee.report_to, 'N/A');

  // --- PROFILE HEADER (top of Employee 360) -------------------------
  safeText('employee-profile-name', fullName, 'Employee');

  const profileTitleEl = document.getElementById('employee-profile-title');
  if (profileTitleEl) {
    profileTitleEl.textContent = `${jobTitle} ‚Ä¢ ${department}`;
  }

  const profileStatusEl = document.getElementById('employee-profile-status');
  if (profileStatusEl) {
    const tenure = typeof calculateTenure === 'function' && hireDate
      ? calculateTenure(hireDate)
      : '';
    const pieces = [employmentStatus];
    if (tenure) pieces.push(tenure);
    pieces.push(`Reports to ${reportsTo}`);
    profileStatusEl.textContent = pieces.join(' ‚Ä¢ ');
  }

  // ID + Username line
  const empIdEl = document.getElementById('employee-profile-employee-id');
  if (empIdEl) {
    empIdEl.innerHTML = `<i class="fa-solid fa-hashtag text-[0.60rem]"></i><span>Employee ID: ${employee.employee_id || '--'}</span>`;
  }

  const usernameEl = document.getElementById('employee-profile-username');
  if (usernameEl) {
    const username = employee.username || employee.email || '--';
    usernameEl.innerHTML = `<i class="fa-solid fa-user text-[0.60rem]"></i><span>Username: ${username}</span>`;
  }

  // --- RISK BADGE ---------------------------------------------------
  const riskBadge = document.getElementById('employee-profile-risk-badge');
  if (riskBadge && typeof computeRiskScore === 'function' && typeof getRiskLevel === 'function') {
    const score = computeRiskScore(employee);
    const level = getRiskLevel(score);
    const badgeClasses = getRiskBadgeClasses(level);

    riskBadge.className = `inline-flex items-center gap-2 rounded-full ${badgeClasses} border px-2 py-1 text-[0.70rem]`;
    riskBadge.innerHTML = `
      <span class="w-1.5 h-1.5 rounded-full ${level === 'HIGH' ? 'bg-rose-500' : level === 'MEDIUM' ? 'bg-amber-500' : 'bg-emerald-500'}"></span>
      <span>Risk Score: ${score}</span>
    `;
  }

  // --- KPIs (Verbal / Written / Final / Termination) ---------------
  const kpiMap = {
    'employee-kpi-verbal': employee.verbal_warning_count,
    'employee-kpi-written': employee.disciplinary_warning_count,
    'employee-kpi-final': employee.final_warning_count,
    'employee-kpi-termination': employee.termination_letter_count
  };

  Object.entries(kpiMap).forEach(([id, value]) => {
    const el = document.getElementById(id);
    if (el) el.textContent = value != null ? value : 0;
  });

  // --- EDITABLE FIELDS ---------------------------------------------
  safeValue('edit-employment-status', employmentStatus);
  safeValue('edit-first-name', employee.first_name || '');
  safeValue('edit-last-name', employee.last_name || '');
  safeValue('edit-job-title', employee.job_title || employee.position_title || '');
  safeValue('edit-department', employee.department || '');
  safeValue('edit-report-to', employee.report_to || '');
  safeValue('edit-email', employee.email || '');
  safeValue('edit-phone', employee.phone || '');
  safeValue('edit-address-line-1', employee.address_line_1 || '');
  safeValue('edit-address-line-2', employee.address_line_2 || '');
  safeValue('edit-city', employee.city || '');
  safeValue('edit-state', employee.state || '');
  safeValue('edit-zip-code', employee.zip_code || '');
  safeValue('edit-original-hire-date', employee.original_hire_date || '');
  safeValue('edit-hire-date', employee.hire_date || '');
  safeValue('edit-hourly-rate', employee.hourly_rate ?? '');
  safeValue('edit-annual-salary', employee.annual_salary ?? '');
  safeValue('edit-risk-level', employee.risk_level || 'LOW');
  safeValue('edit-hr-witness', employee.hr_witness || '');

  














  const scoreDisplayEl = document.getElementById('display-risk-score');
  if (scoreDisplayEl && typeof computeRiskScore === 'function') {
    const score = computeRiskScore(employee);
    scoreDisplayEl.textContent = score;
  }

  const lastActionEl = document.getElementById('display-last-action');
  if (lastActionEl) {
    if (employee.last_disciplinary_action) {
      lastActionEl.textContent = `${employee.last_disciplinary_action.type} on ${formatDate(employee.last_disciplinary_action.date)}`;
    } else {
      lastActionEl.textContent = 'None';
    }
  }

  // --- SUMMARY HISTORY ---------------------------------------------
  const summaryContainer = document.getElementById('employee-summary-history');
  if (summaryContainer) {
    if (employee.discipline_history && employee.discipline_history.length > 0) {
      const score = computeRiskScore(employee);
      const level = getRiskLevel(score);
      summaryContainer.innerHTML = `
        <p class="text-slate-700">
          ${fullName} has <strong>${employee.discipline_history.length} disciplinary action${employee.discipline_history.length > 1 ? 's' : ''}</strong> on record
          with a current risk score of <strong>${score}</strong> (${level} risk). 
          The most recent action was a <strong>${employee.last_disciplinary_action?.type || 'N/A'}</strong> 
          issued on <strong>${formatDate(employee.last_disciplinary_action?.date)}</strong>.
        </p>
      `;
    } else {
      summaryContainer.innerHTML = '<p class="text-slate-500">No disciplinary history on record for this employee.</p>';
    }
  }
}

      async function saveEmployee360() {
        const employeeId = document.getElementById('current-employee-360-id').value;
        if (!employeeId) {
          showToast('No employee selected', 'error');
          return;
        }

        const saveBtn = document.getElementById('btn-save-employee-360');
        const statusIndicator = document.getElementById('save-status-indicator');
        const statusText = document.getElementById('save-status-text');
        
        saveBtn.disabled = true;
        statusIndicator.className = 'w-2 h-2 rounded-full bg-amber-500';
        statusText.textContent = 'Saving...';

        try {
          const updates = {
            employment_status: document.getElementById('edit-employment-status').value,
            first_name: document.getElementById('edit-first-name').value,
            last_name: document.getElementById('edit-last-name').value,
            job_title: document.getElementById('edit-job-title').value,
            
            department: document.getElementById('edit-department').value,
            report_to: document.getElementById('edit-report-to').value,
            email: document.getElementById('edit-email').value,
            phone: document.getElementById('edit-phone').value,
            address_line_1: document.getElementById('edit-address-line-1').value,
            address_line_2: document.getElementById('edit-address-line-2').value,
            city: document.getElementById('edit-city').value,
            state: document.getElementById('edit-state').value,
            zip_code: document.getElementById('edit-zip-code').value,
            original_hire_date: document.getElementById('edit-original-hire-date').value,
          
            hourly_rate: parseFloat(document.getElementById('edit-hourly-rate').value) || null,
            annual_salary: parseFloat(document.getElementById('edit-annual-salary').value) || null,
            risk_level: document.getElementById('edit-risk-level').value,
            hr_witness: document.getElementById('edit-hr-witness').value
          };

          const { error } = await supabaseClient
            .from('employees2025')
            .update(updates)
            .eq('id', employeeId);

          if (error) throw error;

          statusIndicator.className = 'w-2 h-2 rounded-full bg-emerald-500';
          statusText.textContent = 'Saved successfully';
          showToast('Employee data saved successfully', 'success');
          
          await loadEmployees();
          renderEmployeeList();

          setTimeout(() => {
            statusIndicator.className = 'w-2 h-2 rounded-full bg-emerald-500';
            statusText.textContent = 'Ready to edit';
          }, 2000);

        } catch (error) {
          console.error('Error saving employee:', error);
          statusIndicator.className = 'w-2 h-2 rounded-full bg-rose-500';
          statusText.textContent = 'Save failed';
          showToast('Failed to save employee data', 'error');
        } finally {
          saveBtn.disabled = false;
        }
      }

      // ========================================================================
      // POLICY LIBRARY TAB FUNCTIONS
      // ========================================================================
      
      function setupPolicyAccordion() {
        document.querySelectorAll('.policy-accordion-header').forEach(header => {
          header.addEventListener('click', () => {
            const body = header.nextElementSibling;
            const toggle = header.querySelector('.policy-accordion-toggle i');
            
            if (body.classList.contains('hidden')) {
              body.classList.remove('hidden');
              toggle.classList.remove('fa-chevron-down');
              toggle.classList.add('fa-chevron-up');
            } else {
              body.classList.add('hidden');
              toggle.classList.remove('fa-chevron-up');
              toggle.classList.add('fa-chevron-down');
            }
          });
        });

        document.querySelectorAll('.policy-filter-chip').forEach(chip => {
          chip.addEventListener('click', () => {
            const category = chip.dataset.policyCategory;
            
            // Update chip styles
            document.querySelectorAll('.policy-filter-chip').forEach(c => {
              c.classList.remove('bg-brand-50', 'border-brand-100', 'text-brand-700', 'font-medium');
              c.classList.add('bg-slate-50', 'border-slate-200', 'text-slate-600');
            });
            chip.classList.add('bg-brand-50', 'border-brand-100', 'text-brand-700', 'font-medium');
            chip.classList.remove('bg-slate-50', 'border-slate-200', 'text-slate-600');
            
            // Show/hide panels
            document.querySelectorAll('[data-policy-category-panel]').forEach(panel => {
              if (panel.dataset.policyCategoryPanel === category) {
                panel.classList.remove('hidden');
              } else {
                panel.classList.add('hidden');
              }
            });
          });
        });
      }

     
      // ========================================================================
      // ADMIN SETTINGS TAB FUNCTIONS
      // ========================================================================
      
      function loadAdminSettings() {
        document.getElementById('admin-threshold-low').value = AppState.settings.thresholds.low;
        document.getElementById('admin-threshold-medium').value = AppState.settings.thresholds.medium;
        document.getElementById('admin-threshold-high').value = AppState.settings.thresholds.high;
        document.getElementById('admin-points-verbal').value = AppState.settings.points.verbal;
        document.getElementById('admin-points-written').value = AppState.settings.points.written;
        document.getElementById('admin-points-final').value = AppState.settings.points.final;
        document.getElementById('admin-points-termination').value = AppState.settings.points.termination;
        document.getElementById('admin-notify-high-risk').checked = AppState.settings.notifications.highRisk;
        document.getElementById('admin-notify-final-warning').checked = AppState.settings.notifications.finalWarning;
        document.getElementById('admin-notify-termination').checked = AppState.settings.notifications.termination;
        document.getElementById('admin-notify-daily-summary').checked = AppState.settings.notifications.dailySummary;
        document.getElementById('admin-display-photos').checked = AppState.settings.display.photos;
        document.getElementById('admin-display-compact').checked = AppState.settings.display.compact;
        document.getElementById('admin-display-auto-refresh').checked = AppState.settings.display.autoRefresh;
        document.getElementById('admin-retention-discipline').value = AppState.settings.retention.discipline;
        document.getElementById('admin-retention-audit').value = AppState.settings.retention.audit;
      }

      function saveAdminSettings() {
        AppState.settings.thresholds.low = parseInt(document.getElementById('admin-threshold-low').value) || 2;
        AppState.settings.thresholds.medium = parseInt(document.getElementById('admin-threshold-medium').value) || 5;
        AppState.settings.thresholds.high = parseInt(document.getElementById('admin-threshold-high').value) || 8;
        AppState.settings.points.verbal = parseFloat(document.getElementById('admin-points-verbal').value) || 1;
        AppState.settings.points.written = parseFloat(document.getElementById('admin-points-written').value) || 2;
        AppState.settings.points.final = parseFloat(document.getElementById('admin-points-final').value) || 3;
        AppState.settings.points.termination = parseFloat(document.getElementById('admin-points-termination').value) || 4;
        AppState.settings.notifications.highRisk = document.getElementById('admin-notify-high-risk').checked;
        AppState.settings.notifications.finalWarning = document.getElementById('admin-notify-final-warning').checked;
        AppState.settings.notifications.termination = document.getElementById('admin-notify-termination').checked;
        AppState.settings.notifications.dailySummary = document.getElementById('admin-notify-daily-summary').checked;
        AppState.settings.display.photos = document.getElementById('admin-display-photos').checked;
        AppState.settings.display.compact = document.getElementById('admin-display-compact').checked;
        AppState.settings.display.autoRefresh = document.getElementById('admin-display-auto-refresh').checked;
        AppState.settings.retention.discipline = parseInt(document.getElementById('admin-retention-discipline').value) || 7;
        AppState.settings.retention.audit = parseInt(document.getElementById('admin-retention-audit').value) || 7;

        localStorage.setItem('jcr-hr-settings', JSON.stringify(AppState.settings));
        
        const statusDiv = document.getElementById('admin-save-status');
        statusDiv.classList.remove('hidden');
        setTimeout(() => statusDiv.classList.add('hidden'), 3000);
        
        showToast('Settings saved successfully', 'success');
      }


// FIND your PDF download button code and replace with:
async function download360PDF(employeeId) {
  try {
    const response = await fetch('https://kpldzwlftkvjjntgsqxx.supabase.co/functions/v1/employee-360-pdf', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
      },
      body: JSON.stringify({ employee_id: employeeId })
    });

    if (!response.ok) {
      throw new Error('Failed to generate PDF');
    }

    const htmlContent = await response.text();
    
    // Open HTML in new window - user can print to PDF
    const newWindow = window.open('', '_blank');
    newWindow.document.write(htmlContent);
    newWindow.document.close();
    
    // Optionally trigger print dialog
    setTimeout(() => {
      newWindow.print();
    }, 500);

  } catch (error) {
    console.error('Error downloading 360 PDF:', error);
    alert('Failed to generate PDF. Please try again.');
  }
}



      // ========================================================================
      // EVENT LISTENERS
      // ========================================================================
      
      function attachEventListeners() {
        // Tab switching
        document.querySelectorAll('.tab-trigger').forEach(btn => {
  btn.addEventListener('click', () => {
    const tab = btn.dataset.tabTarget;  // ‚úÖ CORRECT!
    showTab(tab);
  });
});
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-nav-menu');
        if (mobileMenuBtn && mobileMenu) {
          mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
          });

          document.querySelectorAll('#mobile-nav-menu .tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              mobileMenu.classList.add('hidden');
            });
          });
        }

        // Dashboard chart timeframe
        const chartSelector = document.getElementById('chart-timeframe-selector');
        if (chartSelector) {
          chartSelector.addEventListener('change', (e) => {
            const value = e.target.value;
            if (value === 'monthly') generate12MonthChart();
            else if (value === 'yearly') generateYearlyChart();
            else if (value === 'weekly') generateWeeklyChart();
          });
        }

        // Discipline form
        const disciplineForm = document.getElementById('discipline-form');
        if (disciplineForm) {
          disciplineForm.addEventListener('submit', handleDisciplineSubmit);
        }

        const disciplineResetBtn = document.getElementById('discipline-form-reset');
        if (disciplineResetBtn) {
          disciplineResetBtn.addEventListener('click', () => {
            disciplineForm.reset();
            document.getElementById('discipline-selected-employee-chip').classList.add('hidden');
          });
        }

        // Discipline refresh
        const disciplineRefresh = document.getElementById('discipline-refresh-employees');
        if (disciplineRefresh) {
          disciplineRefresh.addEventListener('click', () => loadEmployees());
        }

        // Employees 360 refresh
        const employeesRefresh = document.getElementById('employees-refresh-button');
        if (employeesRefresh) {
          employeesRefresh.addEventListener('click', () => {
            loadEmployees().then(() => renderEmployeeList());
          });
        }

        // Employees 360 save
        const saveEmployee360Btn = document.getElementById('btn-save-employee-360');
        if (saveEmployee360Btn) {
          saveEmployee360Btn.addEventListener('click', saveEmployee360);
        }

        // Employee filter chips
        document.querySelectorAll('.employee-filter-chip').forEach(chip => {
          chip.addEventListener('click', () => {
            document.querySelectorAll('.employee-filter-chip').forEach(c => {
              c.classList.remove('bg-brand-50', 'border-brand-100', 'text-brand-700', 'font-medium');
              c.classList.add('bg-slate-50', 'border-slate-200', 'text-slate-600');
            });
            chip.classList.add('bg-brand-50', 'border-brand-100', 'text-brand-700', 'font-medium');
            chip.classList.remove('bg-slate-50', 'border-slate-200', 'text-slate-600');
            
            renderEmployeeList();
          });
        });

        // Reports refresh
        const reportsRefresh = document.getElementById('reports-refresh-data');
        if (reportsRefresh) {
          reportsRefresh.addEventListener('click', () => {
            loadEmployees().then(() => updateReports());
          });
        }
const mainCategoryDropdown = document.getElementById('discipline-main-category');
const subCategoryDropdown = document.getElementById('discipline-sub-category');

if (mainCategoryDropdown && subCategoryDropdown) {
  mainCategoryDropdown.addEventListener('change', (e) => {
    const category = e.target.value;
    subCategoryDropdown.innerHTML = '<option value="">Select sub-category...</option>';
    
    if (category && DISCIPLINE_CATEGORIES[category]) {
      DISCIPLINE_CATEGORIES[category].forEach(sub => {
        const option = document.createElement('option');
        option.value = sub.value;
        option.textContent = sub.label;
        subCategoryDropdown.appendChild(option);
      });
      subCategoryDropdown.disabled = false;
    } else {
      subCategoryDropdown.disabled = true;
    }
  });
}

        // Admin settings save
        const adminSaveBtn = document.getElementById('admin-save-settings');
        if (adminSaveBtn) {
          adminSaveBtn.addEventListener('click', saveAdminSettings);
        }
const employee360PdfBtn = document.getElementById('employee-summary-pdf');
if (employee360PdfBtn) {
  employee360PdfBtn.addEventListener('click', () => {
    const employeeId = document.getElementById('current-employee-360-id').value;
    if (!employeeId) {
      showToast('Please select an employee first', 'error');
      return;
    }
    download360PDF(employeeId);
  });
}
        // Setup autocomplete for both search inputs
        setupAutocomplete('discipline-employee-search', 'discipline-search-dropdown', 'discipline');
        setupAutocomplete('employees-search-input', 'employees-search-dropdown', 'employees');
      }

      // ========================================================================
      // INITIALIZATION
      // ========================================================================
      // ========================================================================
// PERMISSIONS MANAGEMENT
// ========================================================================

// Load permissions from database
async function loadPermissions() {
  try {
    const { data, error } = await supabaseClient
      .from('permissions_config')
      .select('*')
      .single();

    if (error && error.code !== 'PGRST116') throw error;

    if (data) {
      // Apply permissions to checkboxes
      Object.entries(data.permissions || {}).forEach(([feature, roles]) => {
        Object.entries(roles).forEach(([role, allowed]) => {
          const checkbox = document.querySelector(
            `.permission-checkbox[data-feature="${feature}"][data-role="${role}"]`
          );
          if (checkbox) checkbox.checked = allowed;
        });
      });
    }
  } catch (error) {
    console.error('Error loading permissions:', error);
  }
}

// Save permissions to database
async function savePermissions() {
  try {
    const permissions = {};
    
    document.querySelectorAll('.permission-checkbox').forEach(checkbox => {
      const feature = checkbox.dataset.feature;
      const role = checkbox.dataset.role;
      
      if (!permissions[feature]) permissions[feature] = {};
      permissions[feature][role] = checkbox.checked;
    });

    const { error } = await supabaseClient
      .from('permissions_config')
      .upsert({
        id: 1,
        permissions,
        updated_at: new Date().toISOString()
      });

    if (error) throw error;

    // Log the change
    await logPermissionChange('Permissions matrix updated', 'HR Admin');
    
    showToast('Permissions saved automatically', 'success');
  } catch (error) {
    console.error('Error saving permissions:', error);
    showToast('Failed to save permissions', 'error');
  }
}

// Log permission changes
async function logPermissionChange(action, changedBy) {
  try {
    const { error } = await supabaseClient
      .from('permissions_audit_log')
      .insert({
        action,
        changed_by: changedBy,
        timestamp: new Date().toISOString()
      });

    if (error) throw error;
    
    // Refresh audit log display
    await loadPermissionsAuditLog();
  } catch (error) {
    console.error('Error logging permission change:', error);
  }
}

// Load and display audit log
async function loadPermissionsAuditLog() {
  try {
    const { data, error } = await supabaseClient
      .from('permissions_audit_log')
      .select('*')
      .order('timestamp', { ascending: false })
      .limit(50);

    if (error) throw error;

    const tbody = document.getElementById('permissions-audit-log');
    if (!tbody) return;

    tbody.innerHTML = '';

    if (!data || data.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="4" class="px-3 py-4 text-center text-slate-400">
            No permission changes logged yet.
          </td>
        </tr>
      `;
      return;
    }

    data.forEach(log => {
      const row = document.createElement('tr');
      const timestamp = new Date(log.timestamp);
      row.innerHTML = `
        <td class="px-3 py-2 text-slate-600">
          ${timestamp.toLocaleString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          })}
        </td>
        <td class="px-3 py-2 text-slate-700">${log.action}</td>
        <td class="px-3 py-2 text-slate-600">${log.user_affected || '--'}</td>
        <td class="px-3 py-2 text-slate-600">${log.changed_by}</td>
      `;
      tbody.appendChild(row);
    });
  } catch (error) {
    console.error('Error loading audit log:', error);
  }
}

// Setup auto-save for permission checkboxes
function setupPermissionsAutoSave() {
  document.querySelectorAll('.permission-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', () => {
      // Debounce save
      clearTimeout(window.permissionsSaveTimeout);
      window.permissionsSaveTimeout = setTimeout(() => {
        savePermissions();
      }, 1000);
    });
  });
}
     async function bootstrap() {
  console.log('');
  console.log('üé¨ BOOTSTRAP: Starting application...');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
  // üÜï CUSTOM DATE RANGE FUNCTIONALITY
const globalFilter = document.getElementById('global-reports-filter');
const customDateInputs = document.getElementById('custom-date-range-inputs');
const customStartDate = document.getElementById('custom-start-date');
const customEndDate = document.getElementById('custom-end-date');
const applyCustomDates = document.getElementById('apply-custom-dates');

if (globalFilter && customDateInputs) {
  // Show/hide custom date inputs when "Custom" is selected
  globalFilter.addEventListener('change', (e) => {
    if (e.target.value === 'custom') {
      customDateInputs.classList.remove('hidden');
      
      // Set default dates (last 30 days)
      const today = new Date();
      const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
      
      customStartDate.value = thirtyDaysAgo.toISOString().split('T')[0];
      customEndDate.value = today.toISOString().split('T')[0];
    } else {
      customDateInputs.classList.add('hidden');
      updateReports();
    }
  });
}

// Apply custom date range
if (applyCustomDates) {
  applyCustomDates.addEventListener('click', () => {
    const startVal = customStartDate?.value;
    const endVal = customEndDate?.value;
    
    if (!startVal || !endVal) {
      showToast('Please select both start and end dates', 'error');
      return;
    }
    
    const start = new Date(startVal);
    const end = new Date(endVal);
    
    if (start > end) {
      showToast('Start date must be before end date', 'error');
      return;
    }
    
    console.log('üìÖ Applying custom date range:', startVal, 'to', endVal);
    updateReports();
    showToast('Custom date range applied', 'success');
  });
}
  // Check toast container
  const toastContainer = document.getElementById('toast-container');
  if (toastContainer) {
    console.log('‚úÖ Toast container found');
  } else {
    console.error('‚ùå Toast container NOT found!');
  }
  // Load permissions and audit log
if (AppState.currentTab === 'permissions') {
  await loadPermissions();
  await loadPermissionsAuditLog();
}
setupPermissionsAutoSave();
  // Load settings from localStorage
  const savedSettings = localStorage.getItem('jcr-hr-settings');
  if (savedSettings) {
    try {
      AppState.settings = JSON.parse(savedSettings);
      console.log('‚úÖ Settings loaded from localStorage');
    } catch (e) {
      console.error('‚ùå Failed to parse saved settings');
    }
  }

  // Attach event listeners
  console.log('üîó Attaching event listeners...');
  attachEventListeners();
    setupModalEventListeners(); // ‚Üê ADD THIS LINE
// ‚úÖ ADD THESE TWO LINES:
setupDepartmentJobTitleCascade();

setupCompensationTypeSwitcher();

  // Setup policy accordion
  console.log('üìã Setting up policy accordion...');
  setupPolicyAccordion();
  
  // Load admin settings into form
  console.log('‚öôÔ∏è  Loading admin settings...');
  loadAdminSettings();
  
  // Load employee data
  console.log('');
  await loadEmployees();
  renderEmployeeList();
  
  // Initialize dashboard (default tab)
  console.log('');
  console.log('üé® Initializing dashboard...');
  showTab('dashboard');
  generate12MonthChart();
  
  console.log('');
  console.log('üéâ APPLICATION READY!');
  console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
}


      // Start the application
      bootstrap();
// ========================================================================
// ENHANCED REPORTS & ANALYTICS - GLOBAL FILTER SYSTEM
// ========================================================================

// Store chart instances
const ReportsCharts = {
  employeeStatus: null,
  byType: null,
  byDepartment: null,
  byJobTitle: null,
  trend: null
};

// Get filtered date range based on global filter
function getFilteredDateRange() {
  const filter = document.getElementById('global-reports-filter')?.value || 'all-time';
  const now = new Date();
  let startDate = null;
  let endDate = now;

  // üÜï CHECK IF CUSTOM DATE RANGE IS SELECTED
  if (filter === 'custom') {
    const customStart = document.getElementById('custom-start-date')?.value;
    const customEnd = document.getElementById('custom-end-date')?.value;
    
    if (customStart) {
      startDate = new Date(customStart);
      startDate.setHours(0, 0, 0, 0); // Start of day
    }
    
    if (customEnd) {
      endDate = new Date(customEnd);
      endDate.setHours(23, 59, 59, 999); // End of day
    }
    
    return { startDate, endDate };
  }

  // EXISTING PREDEFINED FILTERS
  switch (filter) {
    case 'this-month':
      startDate = new Date(now.getFullYear(), now.getMonth(), 1);
      break;
    case 'last-month':
      startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
      endDate = new Date(now.getFullYear(), now.getMonth(), 0);
      break;
    case 'last-30':
      startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
      break;
    case 'last-90':
      startDate = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
      break;
    case 'ytd':
      startDate = new Date(now.getFullYear(), 0, 1);
      break;
    case 'all-time':
    default:
      startDate = null;
      break;
  }

  return { startDate, endDate };
}

// Filter employees based on date range
function getFilteredActions() {
  const { startDate, endDate } = getFilteredDateRange();
  const actions = [];

  AppState.employees.forEach(emp => {
    if (emp.discipline_history && Array.isArray(emp.discipline_history)) {
      emp.discipline_history.forEach(action => {
        const actionDate = new Date(action.date);
        
        if (!startDate || (actionDate >= startDate && actionDate <= endDate)) {
          actions.push({
            ...action,
            employeeName: `${emp.first_name} ${emp.last_name}`,
            employeeId: emp.employee_id,
            department: emp.department || 'Unassigned',
            jobTitle: emp.job_title || emp.position_title || 'N/A'
          });
        }
      });
    }
  });

  return actions;
}

// Update date range display text
// Update date range display text
function updateDateRangeDisplay() {
  const filter = document.getElementById('global-reports-filter')?.value || 'all-time';
  const displayEl = document.getElementById('reports-date-range-text');
  if (!displayEl) return;

  const { startDate, endDate } = getFilteredDateRange();
  
  let displayText = '';
  
  if (!startDate) {
    displayText = 'All Time';
  } else {
    const formatDate = (d) => d.toLocaleDateString('en-US', { 
      month: 'short', 
      day: 'numeric', 
      year: 'numeric' 
    });
    displayText = `${formatDate(startDate)} - ${formatDate(endDate)}`;
  }
  
  displayEl.textContent = displayText;
}
// Update KPIs
function updateReportsKPIs() {
  const actions = getFilteredActions();
  
  document.getElementById('reports-kpi-total-actions').textContent = actions.length;
  
  const terminatedCount = AppState.employees.filter(e => e.employment_status === 'Terminated').length;
  const activeCount = AppState.employees.filter(e => e.employment_status === 'Active').length;
  const totalCount = activeCount + terminatedCount;
  const terminationRate = totalCount > 0 ? ((terminatedCount / totalCount) * 100).toFixed(1) : '0.0';
  
  document.getElementById('reports-kpi-termination-rate').textContent = `${terminationRate}%`;
  document.getElementById('reports-kpi-avg-resolution').textContent = '3.2 days';
  
  const highRiskCount = AppState.employees.filter(e => {
    const score = computeRiskScore(e);
    return getRiskLevel(score) === 'HIGH';
  }).length;
  
  document.getElementById('reports-kpi-high-risk-count').textContent = highRiskCount;
}


// Chart 1: Employee Status Distribution
// Chart 1: Employee Status Distribution - FILTERED BY TIME RANGE
function generateEmployeeStatusChart() {
  const canvas = document.getElementById('reports-chart-employee-status');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  if (ReportsCharts.employeeStatus) {
    ReportsCharts.employeeStatus.destroy();
  }

  // ‚úÖ Get filtered actions based on time range
  const actions = getFilteredActions();
  
  // ‚úÖ Get unique employee IDs from filtered actions
  const employeeIdsWithActions = new Set(actions.map(a => a.employeeId));
  
  // ‚úÖ Filter employees to only those with actions in the time range
  const filteredEmployees = AppState.employees.filter(emp => 
    employeeIdsWithActions.has(emp.employee_id)
  );

  // ‚úÖ Count status for filtered employees only
  const active = filteredEmployees.filter(e => e.employment_status === 'Active').length;
  const inactive = filteredEmployees.filter(e => 
    e.employment_status === 'Inactive' || 
    e.employment_status === 'On Leave' || 
    e.employment_status === 'Suspended'
  ).length;
  const terminated = filteredEmployees.filter(e => e.employment_status === 'Terminated').length;

  ReportsCharts.employeeStatus = new Chart(ctx, {
    type: 'bar', // ‚úÖ BAR CHART as requested
    data: {
      labels: ['Active', 'Inactive/On Leave', 'Terminated'],
      datasets: [{
        label: 'Employee Count',
        data: [active, inactive, terminated],
        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
        borderColor: ['#059669', '#d97706', '#dc2626'],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false // Hide legend for bar chart
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13, weight: 'bold' },
          callbacks: {
            label: function(context) {
              const total = active + inactive + terminated;
              const percentage = total > 0 ? ((context.parsed.y / total) * 100).toFixed(1) : '0';
              return `${context.label}: ${context.parsed.y} (${percentage}%)`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          },
          grid: { color: 'rgba(0, 0, 0, 0.06)' },
          title: {
            display: true,
            text: 'Number of Employees',
            font: { size: 13, weight: 'bold' },
            color: '#334155'
          }
        },
        x: {
          grid: { display: false },
          ticks: {
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          }
        }
      }
    }
  });
}


// Chart 2: Actions by Type
// Chart 2: Actions by Type - BAR CHART
function generateActionsByTypeChart() {
  const canvas = document.getElementById('reports-chart-by-type');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  if (ReportsCharts.byType) {
    ReportsCharts.byType.destroy();
  }

  const actions = getFilteredActions();
  
  let verbal = 0, written = 0, final = 0, termination = 0;
  actions.forEach(action => {
    const type = action.type.toUpperCase();
    if (type.includes('VERBAL')) verbal++;
    else if (type.includes('WRITTEN')) written++;
    else if (type.includes('FINAL')) final++;
    else if (type.includes('TERMINATION')) termination++;
  });

  ReportsCharts.byType = new Chart(ctx, {
    type: 'bar', // ‚úÖ CHANGED TO BAR
    data: {
      labels: ['Verbal', 'Written', 'Final', 'Termination'],
      datasets: [{
        label: 'Action Count',
        data: [verbal, written, final, termination],
        backgroundColor: ['#10b981', '#f59e0b', '#fb923c', '#ef4444'],
        borderColor: ['#059669', '#d97706', '#ea580c', '#dc2626'],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false // Hide legend for bar chart
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13, weight: 'bold' },
          callbacks: {
            label: function(context) {
              const total = verbal + written + final + termination;
              const percentage = total > 0 ? ((context.parsed.y / total) * 100).toFixed(1) : '0';
              return `${context.label}: ${context.parsed.y} (${percentage}%)`;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          },
          grid: { color: 'rgba(0, 0, 0, 0.06)' },
          title: {
            display: true,
            text: 'Number of Actions',
            font: { size: 13, weight: 'bold' },
            color: '#334155'
          }
        },
        x: {
          grid: { display: false },
          ticks: {
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          }
        }
      }
    }
  });
}

// Chart 3: Actions by Department
function generateActionsByDepartmentChart() {
  const canvas = document.getElementById('reports-chart-by-department');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  if (ReportsCharts.byDepartment) {
    ReportsCharts.byDepartment.destroy();
  }

  const actions = getFilteredActions();
  const deptData = {};

  actions.forEach(action => {
    const dept = action.department;
    if (!deptData[dept]) {
      deptData[dept] = { verbal: 0, written: 0, final: 0, termination: 0 };
    }
    
    const type = action.type.toUpperCase();
    if (type.includes('VERBAL')) deptData[dept].verbal++;
    else if (type.includes('WRITTEN')) deptData[dept].written++;
    else if (type.includes('FINAL')) deptData[dept].final++;
    else if (type.includes('TERMINATION')) deptData[dept].termination++;
  });

  const departments = Object.keys(deptData);
  
  ReportsCharts.byDepartment = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: departments,
      datasets: [
        {
          label: 'Verbal',
          data: departments.map(d => deptData[d].verbal),
          backgroundColor: '#10b981',
          borderColor: '#10b981',
          borderWidth: 2
        },
        {
          label: 'Written',
          data: departments.map(d => deptData[d].written),
          backgroundColor: '#f59e0b',
          borderColor: '#f59e0b',
          borderWidth: 2
        },
        {
          label: 'Final',
          data: departments.map(d => deptData[d].final),
          backgroundColor: '#fb923c',
          borderColor: '#fb923c',
          borderWidth: 2
        },
        {
          label: 'Termination',
          data: departments.map(d => deptData[d].termination),
          backgroundColor: '#ef4444',
          borderColor: '#ef4444',
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: { size: 13, weight: 'bold', family: "'Inter', sans-serif" },
            color: '#334155'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13, weight: 'bold' }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          stacked: true,
          ticks: {
            stepSize: 1,
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          },
          grid: { color: 'rgba(0, 0, 0, 0.06)' }
        },
        x: {
          stacked: true,
          grid: { display: false },
          ticks: {
            font: { size: 11, weight: 'bold' },
            color: '#64748b',
            maxRotation: 45,
            minRotation: 45
          }
        }
      }
    }
  });
}

// Chart 4: Actions by Job Title
function generateActionsByJobTitleChart() {
  const canvas = document.getElementById('reports-chart-by-job-title');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  if (ReportsCharts.byJobTitle) {
    ReportsCharts.byJobTitle.destroy();
  }

  const actions = getFilteredActions();
  const jobData = {};

  actions.forEach(action => {
    const job = action.jobTitle;
    if (!jobData[job]) {
      jobData[job] = { verbal: 0, written: 0, final: 0, termination: 0 };
    }
    
    const type = action.type.toUpperCase();
    if (type.includes('VERBAL')) jobData[job].verbal++;
    else if (type.includes('WRITTEN')) jobData[job].written++;
    else if (type.includes('FINAL')) jobData[job].final++;
    else if (type.includes('TERMINATION')) jobData[job].termination++;
  });

  const jobs = Object.keys(jobData);
  
  ReportsCharts.byJobTitle = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: jobs,
      datasets: [
        {
          label: 'Verbal',
          data: jobs.map(j => jobData[j].verbal),
          backgroundColor: '#10b981',
          borderColor: '#10b981',
          borderWidth: 2
        },
        {
          label: 'Written',
          data: jobs.map(j => jobData[j].written),
          backgroundColor: '#f59e0b',
          borderColor: '#f59e0b',
          borderWidth: 2
        },
        {
          label: 'Final',
          data: jobs.map(j => jobData[j].final),
          backgroundColor: '#fb923c',
          borderColor: '#fb923c',
          borderWidth: 2
        },
        {
          label: 'Termination',
          data: jobs.map(j => jobData[j].termination),
          backgroundColor: '#ef4444',
          borderColor: '#ef4444',
          borderWidth: 2
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      indexAxis: 'y', // Horizontal bars
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: { size: 13, weight: 'bold', family: "'Inter', sans-serif" },
            color: '#334155'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13, weight: 'bold' }
        }
      },
      scales: {
        x: {
          beginAtZero: true,
          stacked: true,
          ticks: {
            stepSize: 1,
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          },
          grid: { color: 'rgba(0, 0, 0, 0.06)' }
        },
        y: {
          stacked: true,
          grid: { display: false },
          ticks: {
            font: { size: 11, weight: 'bold' },
            color: '#64748b'
          }
        }
      }
    }
  });
}

// Chart 5: Trend Over Time
function generateTrendChart() {
  const canvas = document.getElementById('reports-trend-chart');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  if (ReportsCharts.trend) {
    ReportsCharts.trend.destroy();
  }

  // Generate last 12 months
  const months = [];
  const now = new Date();
  for (let i = 11; i >= 0; i--) {
    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
    months.push(d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' }));
  }

  const datasets = [
    { label: 'Verbal', data: new Array(12).fill(0), borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.2)', tension: 0.4, fill: true },
    { label: 'Written', data: new Array(12).fill(0), borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.2)', tension: 0.4, fill: true },
    { label: 'Final', data: new Array(12).fill(0), borderColor: '#fb923c', backgroundColor: 'rgba(251, 146, 60, 0.2)', tension: 0.4, fill: true },
    { label: 'Termination', data: new Array(12).fill(0), borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.2)', tension: 0.4, fill: true }
  ];

  const actions = getFilteredActions();
  
  actions.forEach(action => {
    const actionDate = new Date(action.date);
    const monthStr = actionDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
    const monthIndex = months.indexOf(monthStr);
    
    if (monthIndex >= 0) {
      const type = action.type.toUpperCase();
      if (type.includes('VERBAL')) datasets[0].data[monthIndex]++;
      else if (type.includes('WRITTEN')) datasets[1].data[monthIndex]++;
      else if (type.includes('FINAL')) datasets[2].data[monthIndex]++;
      else if (type.includes('TERMINATION')) datasets[3].data[monthIndex]++;
    }
  });

  ReportsCharts.trend = new Chart(ctx, {
    type: 'line',
    data: { labels: months, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 20,
            font: { size: 13, weight: 'bold', family: "'Inter', sans-serif" },
            color: '#334155'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.9)',
          padding: 12,
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13, weight: 'bold' }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            font: { size: 12, weight: 'bold' },
            color: '#64748b'
          },
          grid: { color: 'rgba(0, 0, 0, 0.06)' }
        },
        x: {
          grid: { display: false },
          ticks: {
            font: { size: 11, weight: 'bold' },
            color: '#64748b',
            maxRotation: 45,
            minRotation: 45
          }
        }
      }
    }
  });
}

// Update Risk Distribution
function updateRiskDistribution() {
  let low = 0, medium = 0, high = 0;
  
  AppState.employees.forEach(emp => {
    const score = computeRiskScore(emp);
    const level = getRiskLevel(score);
    if (level === 'LOW') low++;
    else if (level === 'MEDIUM') medium++;
    else high++;
  });

  document.getElementById('reports-risk-low-count').textContent = low;
  document.getElementById('reports-risk-medium-count').textContent = medium;
  document.getElementById('reports-risk-high-count').textContent = high;
}

// Populate Reports Table
function populateReportsTable() {
  const tbody = document.getElementById('reports-table-body');
  if (!tbody) return;

  const actions = getFilteredActions();
  actions.sort((a, b) => new Date(b.date) - new Date(a.date));

  tbody.innerHTML = '';

  if (actions.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" class="px-3 py-4 text-center text-slate-400">No actions found for selected filter</td></tr>';
    return;
  }

  actions.slice(0, 100).forEach(action => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td class="px-3 py-2 text-slate-600">${formatDate(action.date)}</td>
      <td class="px-3 py-2 text-slate-900 font-bold">${action.employeeName}</td>
      <td class="px-3 py-2 text-slate-600">${action.department}</td>
      <td class="px-3 py-2 text-slate-600">${action.jobTitle}</td>
      <td class="px-3 py-2 text-slate-900">${action.type}</td>
      <td class="px-3 py-2 text-slate-600">${action.severity || '--'}</td>
      <td class="px-3 py-2 text-slate-600 text-xs">${(action.reason || '').substring(0, 60)}${action.reason && action.reason.length > 60 ? '...' : ''}</td>
    `;
    tbody.appendChild(row);
  });
}

// Attach global filter listener
const globalFilter = document.getElementById('global-reports-filter');
if (globalFilter) {
  globalFilter.addEventListener('change', () => {
    console.log('üîÑ Global filter changed, updating all charts...');
    updateReports();
  });
}

// CSV Export
const csvExportBtn = document.getElementById('reports-table-export-csv');
if (csvExportBtn) {
  csvExportBtn.addEventListener('click', () => {
    const actions = getFilteredActions();
    
    let csv = 'Date,Employee,Department,Job Title,Action Type,Severity,Reason\n';
    
    actions.forEach(action => {
      const reason = (action.reason || '').replace(/"/g, '""').replace(/\n/g, ' ');
      csv += `"${formatDate(action.date)}","${action.employeeName}","${action.department}","${action.jobTitle}","${action.type}","${action.severity || ''}","${reason}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `discipline-actions-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
    
    showToast('CSV exported successfully', 'success');
  });
}
// Master function to update all reports
function updateReports() {
  console.log('üìä Updating Reports & Analytics...');
  
  updateReportsKPIs();
  updateDateRangeDisplay();
  
  generateEmployeeStatusChart();
  generateActionsByTypeChart();
  generateActionsByDepartmentChart();
  generateActionsByJobTitleChart();
  generateTrendChart();
  
  updateRiskDistribution();
  populateReportsTable();
  
  console.log('‚úÖ Reports updated successfully');
}

// ========================================================================
// EMPLOYEES 360: DEPARTMENT ‚Üí JOB TITLE CASCADE
// ========================================================================
const JOB_TITLES_BY_DEPARTMENT = {
  'FOH': [
    'FOH Manager',
    'Server',
    'Bartender',
    'Host',
    'Cashier',
    'Busser'
  ],
  'BOH': [
    'Line Cook',
    'Wok Chef',
    'Dumpling Maker',
    'Prep Cook',
    'Pastry Chef',
    'Dishwasher',
    'Production Manager',
    'Logistic Coordinator'
  ]
};



// ========================================================================
// EMPLOYEES 360: COMPENSATION TYPE SWITCHER
// ========================================================================
function setupCompensationTypeSwitcher() {
  const compTypeDropdown = document.getElementById('edit-compensation-type');
  const hourlyContainer = document.getElementById('hourly-rate-container');
  const salaryContainer = document.getElementById('annual-salary-container');
  const hourlyInput = document.getElementById('edit-hourly-rate');
  const salaryInput = document.getElementById('edit-annual-salary');
  const calculatedDisplay = document.getElementById('display-calculated-hourly');

  if (!compTypeDropdown || !hourlyContainer || !salaryContainer || !calculatedDisplay) return;

  function updateDisplay() {
    const compType = compTypeDropdown.value;
    if (compType === 'hourly') {
      hourlyContainer.style.display = 'block';
      salaryContainer.style.display = 'none';
      // Hide the calculated hourly rate display for hourly employees
      calculatedDisplay.parentElement.style.display = 'none'; // This hides the entire container
    } else if (compType === 'salary') {
      hourlyContainer.style.display = 'none';
      salaryContainer.style.display = 'block';
      // Show the calculated hourly rate display for salaried employees
      calculatedDisplay.parentElement.style.display = 'block';
      // Calculate hourly rate from annual salary
      const annualSalary = parseFloat(salaryInput.value) || 0;
      if (annualSalary > 0) {
        const hourlyRate = (annualSalary / 2080).toFixed(2); // 2080 = 52 weeks * 40 hours
        calculatedDisplay.textContent = `$${hourlyRate}/hour`;
      } else {
        calculatedDisplay.textContent = '--';
      }
    }
  }

  // Listen for compensation type changes
  compTypeDropdown.addEventListener('change', updateDisplay);
  // Listen for salary input changes to update calculated hourly
  salaryInput.addEventListener('input', updateDisplay);
  // Initial display
  updateDisplay();
}

// ========================================================================
// CALL THESE FUNCTIONS IN YOUR BOOTSTRAP
// ========================================================================


    </script>
  </body>
</html>
