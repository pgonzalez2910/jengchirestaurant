<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jeng Chi - Order Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .status-dot { font-size: 1.2rem; }
    .status-green { color: green; }
    .status-yellow { color: goldenrod; }
    .status-red { color: red; }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-blue-600">JENG CHI RESTAURANT</h1>
    <span class="text-gray-600">ORDER MANAGEMENT</span>
  </header>

  <!-- Filters -->
  <section class="bg-white shadow rounded p-4 m-4 flex gap-6">
    <div>
      <label class="block text-sm font-semibold">Select Order Date:</label>
      <input id="orderDate" type="date" class="border rounded p-2" value="2025-08-31" />
    </div>
    <div>
      <label class="block text-sm font-semibold">Filter by Vendor:</label>
      <select id="vendorFilter" class="border rounded p-2">
        <option value="">-- All Vendors --</option>
        <option>Formosa Foods</option>
        <option>North Food Group</option>
        <option>Supermarket</option>
        <option>Pacific Plus</option>
        <option>Delta Office Products</option>
      </select>
    </div>
  </section>

  <!-- Rony & Pablo -->
  <section class="m-4">
    <h2 class="text-xl font-bold text-purple-600 mb-4">Rony & Pablo Inventory (Decision Mode)</h2>
    <div id="ronyPabloInventory" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
  </section>

  <!-- Julio -->
  <section class="m-4">
    <h2 class="text-xl font-bold text-green-600 mb-4">Julio Inventory (Auto Mode)</h2>
    <div id="julioInventory" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
  </section>

  <script>
const SUPABASE_URL = "https://kpldzwlftkvjjntgsqxx.supabase.co";  // fixed URL
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtwbGR6d2xmdGt2ampudGdzcXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MzE5NzAsImV4cCI6MjA2MjIwNzk3MH0.qnWbOQv2RLPsIyO-oRwQkAN2VhmmdhTBt46SweUsLbs"; 
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);


    const vendorOptions = [
      "Formosa Foods",
      "North Food Group",
      "Supermarket",
      "Pacific Plus",
      "Delta Office Products"
    ];

    const packagingOptions = [
      "Case","Box","Bottle","Can","Bag","Pack","Roll","Jar",
      "Tub","Tray","Individual","Dozen","Gallon","Pail"
    ];

    async function loadOrders() {
      const orderDate = document.getElementById("orderDate").value;
      const { data, error } = await supabase.rpc("get_order_recommendations", { check_date: orderDate });

      if (error) {
        console.error("Error loading orders:", error);
        document.getElementById("ronyPabloInventory").innerHTML = `<p class="text-red-500">Error loading orders.</p>`;
        document.getElementById("julioInventory").innerHTML = "";
        return;
      }

      const ronyPabloContainer = document.getElementById("ronyPabloInventory");
      const julioContainer = document.getElementById("julioInventory");

      ronyPabloContainer.innerHTML = "";
      julioContainer.innerHTML = "";

      data.forEach(item => {
        const statusDot = item.days_remaining < 1
          ? '<span class="status-dot status-red">●</span>'
          : item.days_remaining < 3
            ? '<span class="status-dot status-yellow">●</span>'
            : '<span class="status-dot status-green">●</span>';

        const vendorSelect = `<select class="border rounded p-1 w-full">
          ${vendorOptions.map(v => `<option ${item.vendors === v ? "selected" : ""}>${v}</option>`).join("")}
        </select>`;

        const packagingSelect = `<select class="border rounded p-1 w-full">
          ${packagingOptions.map(p => `<option ${item.packaging === p ? "selected" : ""}>${p}</option>`).join("")}
        </select>`;

        const card = `
          <div class="bg-white shadow rounded-xl p-4">
            <img src="${item.image_url || "https://via.placeholder.com/150"}" alt="Product" class="w-full h-40 object-contain mb-3">
            <h3 class="font-bold text-lg">${item.product_name}</h3>
            <p class="text-sm text-gray-500">Item Code: ${item.item_code || "N/A"}</p>
            <div class="mt-2 text-sm">
              <p>On Hand: <b>${item.current_on_hand || 0}</b> | Par: <b>${item.par || 0}</b> | Tentative: <b>${item.tentative || 0}</b></p>
              <p>Avg Daily Use: <b>${item.avg_daily_usage || 0}</b> | Days Remaining: <b>${item.days_remaining}</b> ${statusDot}</p>
              <p>Recommended Cases: <b>${item.recommended_cases || 0}</b> | Projected On Hand: <b>${item.projected_on_hand || 0}</b></p>
            </div>

            <div class="mt-3">
              <label class="block text-sm font-semibold">Packaging:</label>
              ${packagingSelect}
            </div>

            <div class="mt-3 flex items-center gap-2">
              <button class="bg-blue-500 text-white px-2 rounded">-</button>
              <input type="number" class="border w-16 text-center rounded" value="0">
              <button class="bg-blue-500 text-white px-2 rounded">+</button>
            </div>

            <div class="mt-3">
              <label class="block text-sm font-semibold">Vendor:</label>
              ${vendorSelect}
            </div>
          </div>
        `;

        if (item.last_user && item.last_user.toLowerCase() === "julio") {
          julioContainer.innerHTML += card;
        } else {
          ronyPabloContainer.innerHTML += card;
        }
      });
    }

    document.getElementById("orderDate").addEventListener("change", loadOrders);
    document.getElementById("vendorFilter").addEventListener("change", loadOrders);
    window.onload = loadOrders;
  </script>
</body>
</html>
